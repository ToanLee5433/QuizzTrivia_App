// Fixed navigation logic - only navigate if save succeeds
        resultId = await submitQuizResult(resultData);
        console.log('‚úÖ Quiz result saved with ID:', resultId);
      }
    } catch (error) {
      console.error('‚ùå Failed to save quiz result:', error);
      // IMPORTANT: Show error and don't navigate if save failed
      alert('Kh√¥ng th·ªÉ l∆∞u k·∫øt qu·∫£ quiz. Vui l√≤ng th·ª≠ l·∫°i.');
      return; // Don't navigate if save failed
    }

    // Only navigate if we have a valid resultId
    if (resultId) {
      console.log('üöÄ Navigating to result page with resultId:', resultId);
      navigate(`/results/${resultId}`, { 
        state: { 
          quiz, 
          session: finalSession, 
          score,
          correct: score.correct,
          total: score.total,
          answers: finalSession.answers,
          timeSpent: Math.round(finalSession.timeSpent / 1000),
          quizId: quiz.id,
          attemptId: resultId
        } 
      });
    } else {
      console.error('‚ùå No resultId available, cannot navigate to results page');
      alert('Kh√¥ng th·ªÉ hi·ªÉn th·ªã k·∫øt qu·∫£. Vui l√≤ng ki·ªÉm tra l·∫°i trong Profile.');
      navigate('/profile');
    }

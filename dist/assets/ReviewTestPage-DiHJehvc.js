import{a as S,b as C,r as o,i as g,y as l,j as e,m as T,U as j,E as q,S as k,M as E}from"./index-BSJrQLtH.js";import{R as L}from"./ReviewList-BTb04cIo.js";import{R as Q}from"./ReviewForm-9ooRSGB4.js";import{A as I}from"./arrow-left-BMoVhpMc.js";import{L as A}from"./loader-circle-DklZ0hVd.js";import"./calendar-BpKxQpeH.js";const U=()=>{var p,w;const{quizId:t}=S(),h=C(),[x,v]=o.useState([]),[n,r]=o.useState(!1),[c,f]=o.useState(null),[u,d]=o.useState(null),b=["quiz-toan-hoc-co-ban","quiz-lich-su-viet-nam","quiz-tieng-anh-giao-tiep"];o.useEffect(()=>{t&&m()},[t]);const m=async()=>{if(t){r(!0),d({action:"Loading reviews...",quizId:t});try{console.log("🔍 Loading reviews for quiz:",t);const s=await g.getQuizReviews(t);console.log("📊 Reviews loaded:",s),v(s||[]);const a=await g.getQuizReviewStats(t);console.log("📈 Stats loaded:",a),f(a),d({action:"Reviews loaded successfully",quizId:t,reviewCount:(s==null?void 0:s.length)||0,stats:a,reviewIds:(s==null?void 0:s.map(i=>i.id))||[]}),l.success(`Tải thành công ${(s==null?void 0:s.length)||0} đánh giá`)}catch(s){console.error("❌ Error loading reviews:",s),d({action:"Error loading reviews",error:s instanceof Error?s.message:String(s),quizId:t}),l.error("Lỗi khi tải đánh giá")}finally{r(!1)}}},N=async()=>{if(t){r(!0),l.info("Đang tạo dữ liệu mẫu...");try{console.log("Creating sample data..."),console.log("Creating sample reviews..."),l.success("Tạo dữ liệu mẫu thành công!"),setTimeout(()=>{m()},1e3)}catch(s){console.error("❌ Error creating sample data:",s),l.error("Lỗi khi tạo dữ liệu mẫu"),r(!1)}}},y=async()=>{r(!0);const s=[];for(const a of b)try{const i=await g.getQuizReviews(a),R=await g.getQuizReviewStats(a);s.push({quizId:a,reviewCount:(i==null?void 0:i.length)||0,stats:R,success:!0})}catch(i){s.push({quizId:a,error:i instanceof Error?i.message:String(i),success:!1})}d({action:"Test all quizzes",results:s}),r(!1),l.info("Kiểm tra hoàn tất - xem Debug Info")},z=()=>{l.success("Đánh giá đã được gửi!"),m()};return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>h(-1),className:"inline-flex items-center text-blue-600 hover:text-blue-800 mb-4",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Quay lại"]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"🧪 Review System Test Page"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Quiz ID: ",e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded",children:t})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:m,disabled:n,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[n?e.jsx(A,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(T,{className:"w-4 h-4 mr-2"}),"Tải lại Reviews"]}),e.jsxs("button",{onClick:N,disabled:n,className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Tạo dữ liệu mẫu"]}),e.jsxs("button",{onClick:y,disabled:n,className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Test tất cả Quiz"]})]})]})]}),c&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"w-8 h-8 text-yellow-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Điểm trung bình"}),e.jsx("p",{className:"text-2xl font-bold",children:((p=c.averageRating)==null?void 0:p.toFixed(1))||"0.0"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"w-8 h-8 text-blue-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tổng đánh giá"}),e.jsx("p",{className:"text-2xl font-bold",children:c.totalReviews||0})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"w-8 h-8 text-green-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tỷ lệ 5 sao"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((w=c.fiveStarPercentage)==null?void 0:w.toFixed(0))||0,"%"]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"🎯 Test với Quiz có dữ liệu mẫu:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:b.map(s=>e.jsxs("button",{onClick:()=>h(`/test-reviews/${s}`),className:`p-3 rounded-lg border-2 transition-colors ${t===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("p",{className:"font-medium",children:s}),e.jsx("p",{className:"text-sm text-gray-500",children:s==="quiz-toan-hoc-co-ban"?"Toán học cơ bản":s==="quiz-lich-su-viet-nam"?"Lịch sử Việt Nam":"Tiếng Anh giao tiếp"})]},s))})]}),u&&e.jsxs("div",{className:"bg-gray-900 text-green-400 rounded-lg p-4 mb-8 font-mono text-sm",children:[e.jsx("h3",{className:"text-white font-bold mb-2",children:"🔍 Debug Info:"}),e.jsx("pre",{children:JSON.stringify(u,null,2)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"✍️ Viết đánh giá mới:"}),e.jsx(Q,{quizId:t||"",onReviewSubmitted:z,onClose:()=>{}})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["📋 Danh sách đánh giá (",x.length,")"]}),e.jsx(L,{reviews:x,loading:n,onHelpfulClick:s=>console.log("Helpful clicked:",s),onReportClick:s=>console.log("Report clicked:",s)})]})]})})};export{U as default};

import{u as Z,d as _,r as d,A as D,t as v,l as w,D as Q,F as B,y as h,j as e,G as ee,M as E,H as S,I as L,E as M,T as se,J as te,K as ae,q as re,s as le,N as de,O as ie}from"./index-CNQy308a.js";import{P as H}from"./plus-Bz0Kn-zX.js";import{S as ne}from"./send-jCzz2FPG.js";const me=()=>{const{user:l}=Z(s=>s.auth),m=_(),[i,P]=d.useState([]),[F,C]=d.useState(!0),[c,K]=d.useState(""),[o,$]=d.useState("all"),[I,y]=d.useState(!1),[u,j]=d.useState(null),[g,b]=d.useState(""),[k,A]=d.useState(!1);d.useEffect(()=>{l&&R()},[l]);const R=async()=>{var s,t,r,n;if(l){C(!0);try{const N=D(v(w,"quizzes"),Q("createdBy","==",l.uid)),O=await B(N),f=[];for(const x of O.docs){const a=x.data(),U=D(v(w,"editRequests"),Q("quizId","==",x.id)),W=(await B(U)).docs.map(p=>{var T,z;return{id:p.id,...p.data(),requestedAt:((T=p.data().requestedAt)==null?void 0:T.toDate())||new Date,approvedAt:(z=p.data().approvedAt)==null?void 0:z.toDate()}});f.push({id:x.id,...a,views:((s=a.stats)==null?void 0:s.views)||a.views||0,attempts:((t=a.stats)==null?void 0:t.attempts)||a.attempts||0,completions:((r=a.stats)==null?void 0:r.completions)||a.completions||0,averageScore:((n=a.stats)==null?void 0:n.averageScore)||a.averageScore||0,createdAt:a.createdAt&&typeof a.createdAt.toDate=="function"?a.createdAt.toDate():a.createdAt instanceof Date?a.createdAt:new Date,updatedAt:a.updatedAt&&typeof a.updatedAt.toDate=="function"?a.updatedAt.toDate():a.updatedAt instanceof Date?a.updatedAt:new Date,editRequests:W})}f.sort((x,a)=>a.createdAt.getTime()-x.createdAt.getTime()),P(f)}catch(N){console.error("Error loading quizzes:",N),h.error("L·ªói khi t·∫£i danh s√°ch quiz")}finally{C(!1)}}},V=async()=>{if(!u||!g.trim()){h.error("Vui l√≤ng nh·∫≠p l√Ω do ch·ªânh s·ª≠a");return}A(!0);try{await re(v(w,"editRequests"),{quizId:u.id,requestedBy:l==null?void 0:l.uid,requestedAt:le(),reason:g.trim(),status:"pending"}),h.success("Y√™u c·∫ßu ch·ªânh s·ª≠a ƒë√£ ƒë∆∞·ª£c g·ª≠i, ch·ªù admin ph√™ duy·ªát"),y(!1),b(""),j(null),R()}catch(s){console.error("Error submitting edit request:",s),h.error("L·ªói khi g·ª≠i y√™u c·∫ßu ch·ªânh s·ª≠a")}finally{A(!1)}},X=s=>{const t={pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",draft:"bg-gray-100 text-gray-800"},r={pending:e.jsx(L,{className:"w-3 h-3"}),approved:e.jsx(S,{className:"w-3 h-3"}),rejected:e.jsx(ie,{className:"w-3 h-3"}),draft:e.jsx(de,{className:"w-3 h-3"})},n={pending:"Ch·ªù duy·ªát",approved:"ƒê√£ duy·ªát",rejected:"B·ªã t·ª´ ch·ªëi",draft:"B·∫£n nh√°p"};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${t[s]}`,children:[r[s],n[s]]})},Y=s=>{const t={easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-red-100 text-red-800"},r={easy:"üü¢ D·ªÖ",medium:"üü° Trung b√¨nh",hard:"üî¥ Kh√≥"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${t[s]}`,children:r[s]})},G=s=>{var r;return((r=s.editRequests)==null?void 0:r.find(n=>n.status==="pending"))?{allowed:!1,reason:"C√≥ y√™u c·∫ßu ch·ªânh s·ª≠a ƒëang ch·ªù duy·ªát"}:s.status==="approved"?{allowed:!1,reason:"Quiz ƒë√£ ƒë∆∞·ª£c duy·ªát, c·∫ßn xin ph√©p admin ƒë·ªÉ ch·ªânh s·ª≠a"}:{allowed:!0}},J=s=>{const t=G(s);t.allowed?m(`/quiz/${s.id}/edit`):s.status==="approved"?(j(s),y(!0)):h.warning(t.reason)},q=i.filter(s=>{const t=s.title.toLowerCase().includes(c.toLowerCase())||s.description.toLowerCase().includes(c.toLowerCase()),r=o==="all"||s.status===o;return t&&r});return!l||l.role!=="creator"&&l.role!=="admin"?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p"}),e.jsx("p",{className:"text-gray-600",children:"B·∫°n c·∫ßn c√≥ vai tr√≤ Creator ho·∫∑c Admin ƒë·ªÉ xem trang n√†y"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Quiz c·ªßa t√¥i"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Qu·∫£n l√Ω v√† theo d√µi quiz b·∫°n ƒë√£ t·∫°o"})]}),e.jsxs("button",{onClick:()=>m("/creator"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition-colors",children:[e.jsx(H,{className:"w-5 h-5"}),"T·∫°o Quiz M·ªõi"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"T√¨m ki·∫øm quiz...",value:c,onChange:s=>K(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),e.jsx("div",{className:"sm:w-48",children:e.jsxs("select",{value:o,onChange:s=>$(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"T·∫•t c·∫£ tr·∫°ng th√°i"}),e.jsx("option",{value:"draft",children:"B·∫£n nh√°p"}),e.jsx("option",{value:"pending",children:"Ch·ªù duy·ªát"}),e.jsx("option",{value:"approved",children:"ƒê√£ duy·ªát"}),e.jsx("option",{value:"rejected",children:"B·ªã t·ª´ ch·ªëi"})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(E,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"T·ªïng quiz"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(S,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ƒê√£ duy·ªát"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(s=>s.status==="approved").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(L,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ch·ªù duy·ªát"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(s=>s.status==="pending").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(M,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"T·ªïng l∆∞·ª£t xem"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.reduce((s,t)=>s+(t.views||0),0)})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(se,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"T·ªïng l∆∞·ª£t th·ª≠"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.reduce((s,t)=>s+(t.attempts||0),0)})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(S,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Ho√†n th√†nh"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.reduce((s,t)=>s+(t.completions||0),0)})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:F?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):q.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Ch∆∞a c√≥ quiz n√†o"}),e.jsx("p",{className:"text-gray-600 mb-4",children:c||o!=="all"?"Kh√¥ng t√¨m th·∫•y quiz ph√π h·ª£p v·ªõi b·ªô l·ªçc":"B·∫°n ch∆∞a t·∫°o quiz n√†o. H√£y t·∫°o quiz ƒë·∫ßu ti√™n!"}),!c&&o==="all"&&e.jsxs("button",{onClick:()=>m("/creator"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold inline-flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"T·∫°o Quiz ƒê·∫ßu Ti√™n"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quiz"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Danh m·ª•c & ƒê·ªô kh√≥"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tr·∫°ng th√°i"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Th·ªëng k√™"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ng√†y t·∫°o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"H√†nh ƒë·ªông"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:q.map(s=>{var t;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.title}),e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:s.description}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[((t=s.questions)==null?void 0:t.length)||0," c√¢u h·ªèi"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-gray-900",children:s.category}),Y(s.difficulty)]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[X(s.status),s.editRequests&&s.editRequests.length>0&&e.jsx("div",{className:"text-xs text-gray-500",children:s.editRequests.filter(r=>r.status==="pending").length>0&&e.jsx("span",{className:"text-yellow-600",children:"C√≥ y√™u c·∫ßu ch·ªânh s·ª≠a"})})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["üëÅÔ∏è ",s.views||0," l∆∞·ª£t xem"]}),e.jsxs("div",{children:["üéØ ",s.attempts||0," l∆∞·ª£t th·ª≠"]}),e.jsxs("div",{children:["‚úÖ ",s.completions||0," ho√†n th√†nh"]}),s.averageScore!==void 0&&e.jsxs("div",{children:["üìä ",s.averageScore,"% ƒëi·ªÉm TB"]}),s.avgRating&&e.jsxs("div",{children:["‚≠ê ",s.avgRating.toFixed(1),"/5"]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:s.createdAt.toLocaleDateString("vi-VN")}),e.jsx("td",{className:"px-6 py-4 text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>m(`/quiz/${s.id}/preview`),className:"text-blue-600 hover:text-blue-900 p-1",title:"Xem tr∆∞·ªõc",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>J(s),className:"text-green-600 hover:text-green-900 p-1",title:"Ch·ªânh s·ª≠a",children:e.jsx(te,{className:"w-4 h-4"})}),s.status==="draft"&&e.jsx("button",{onClick:()=>{window.confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a quiz n√†y?")},className:"text-red-600 hover:text-red-900 p-1",title:"X√≥a",children:e.jsx(ae,{className:"w-4 h-4"})})]})})]},s.id)})})]})})}),I&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Y√™u c·∫ßu ch·ªânh s·ª≠a quiz"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Quiz: ",u.title]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"L√Ω do ch·ªânh s·ª≠a *"}),e.jsx("textarea",{value:g,onChange:s=>b(s.target.value),placeholder:"Vui l√≤ng m√¥ t·∫£ l√Ω do b·∫°n mu·ªën ch·ªânh s·ª≠a quiz n√†y...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"‚ö†Ô∏è Quiz ƒë√£ ƒë∆∞·ª£c duy·ªát. Y√™u c·∫ßu ch·ªânh s·ª≠a s·∫Ω ƒë∆∞·ª£c g·ª≠i t·ªõi admin ƒë·ªÉ x√©t duy·ªát. Sau khi ƒë∆∞·ª£c ph√©p ch·ªânh s·ª≠a, b·∫°n c·∫ßn g·ª≠i l·∫°i ƒë·ªÉ admin duy·ªát n·ªôi dung m·ªõi."})})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{y(!1),b(""),j(null)},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",children:"H·ªßy"}),e.jsxs("button",{onClick:V,disabled:!g.trim()||k,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[k?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(ne,{className:"w-4 h-4"}),"G·ª≠i y√™u c·∫ßu"]})]})]})})]})})};export{me as default};

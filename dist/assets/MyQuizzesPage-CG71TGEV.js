import{u as Z,d as _,r as d,A as D,t as v,l as w,D as Q,F as B,y as h,j as e,G as ee,M as E,H as S,I as L,E as M,T as se,J as te,K as ae,q as re,s as le,N as de,O as ie}from"./index-CNQy308a.js";import{P as H}from"./plus-Bz0Kn-zX.js";import{S as ne}from"./send-jCzz2FPG.js";const me=()=>{const{user:l}=Z(s=>s.auth),m=_(),[i,P]=d.useState([]),[F,C]=d.useState(!0),[c,K]=d.useState(""),[o,$]=d.useState("all"),[I,y]=d.useState(!1),[u,j]=d.useState(null),[g,b]=d.useState(""),[k,A]=d.useState(!1);d.useEffect(()=>{l&&R()},[l]);const R=async()=>{var s,t,r,n;if(l){C(!0);try{const N=D(v(w,"quizzes"),Q("createdBy","==",l.uid)),O=await B(N),f=[];for(const x of O.docs){const a=x.data(),U=D(v(w,"editRequests"),Q("quizId","==",x.id)),W=(await B(U)).docs.map(p=>{var T,z;return{id:p.id,...p.data(),requestedAt:((T=p.data().requestedAt)==null?void 0:T.toDate())||new Date,approvedAt:(z=p.data().approvedAt)==null?void 0:z.toDate()}});f.push({id:x.id,...a,views:((s=a.stats)==null?void 0:s.views)||a.views||0,attempts:((t=a.stats)==null?void 0:t.attempts)||a.attempts||0,completions:((r=a.stats)==null?void 0:r.completions)||a.completions||0,averageScore:((n=a.stats)==null?void 0:n.averageScore)||a.averageScore||0,createdAt:a.createdAt&&typeof a.createdAt.toDate=="function"?a.createdAt.toDate():a.createdAt instanceof Date?a.createdAt:new Date,updatedAt:a.updatedAt&&typeof a.updatedAt.toDate=="function"?a.updatedAt.toDate():a.updatedAt instanceof Date?a.updatedAt:new Date,editRequests:W})}f.sort((x,a)=>a.createdAt.getTime()-x.createdAt.getTime()),P(f)}catch(N){console.error("Error loading quizzes:",N),h.error("Lá»—i khi táº£i danh sÃ¡ch quiz")}finally{C(!1)}}},V=async()=>{if(!u||!g.trim()){h.error("Vui lÃ²ng nháº­p lÃ½ do chá»‰nh sá»­a");return}A(!0);try{await re(v(w,"editRequests"),{quizId:u.id,requestedBy:l==null?void 0:l.uid,requestedAt:le(),reason:g.trim(),status:"pending"}),h.success("YÃªu cáº§u chá»‰nh sá»­a Ä‘Ã£ Ä‘Æ°á»£c gá»­i, chá» admin phÃª duyá»‡t"),y(!1),b(""),j(null),R()}catch(s){console.error("Error submitting edit request:",s),h.error("Lá»—i khi gá»­i yÃªu cáº§u chá»‰nh sá»­a")}finally{A(!1)}},X=s=>{const t={pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",draft:"bg-gray-100 text-gray-800"},r={pending:e.jsx(L,{className:"w-3 h-3"}),approved:e.jsx(S,{className:"w-3 h-3"}),rejected:e.jsx(ie,{className:"w-3 h-3"}),draft:e.jsx(de,{className:"w-3 h-3"})},n={pending:"Chá» duyá»‡t",approved:"ÄÃ£ duyá»‡t",rejected:"Bá»‹ tá»« chá»‘i",draft:"Báº£n nhÃ¡p"};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${t[s]}`,children:[r[s],n[s]]})},Y=s=>{const t={easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-red-100 text-red-800"},r={easy:"ðŸŸ¢ Dá»…",medium:"ðŸŸ¡ Trung bÃ¬nh",hard:"ðŸ”´ KhÃ³"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${t[s]}`,children:r[s]})},G=s=>{var r;return((r=s.editRequests)==null?void 0:r.find(n=>n.status==="pending"))?{allowed:!1,reason:"CÃ³ yÃªu cáº§u chá»‰nh sá»­a Ä‘ang chá» duyá»‡t"}:s.status==="approved"?{allowed:!1,reason:"Quiz Ä‘Ã£ Ä‘Æ°á»£c duyá»‡t, cáº§n xin phÃ©p admin Ä‘á»ƒ chá»‰nh sá»­a"}:{allowed:!0}},J=s=>{const t=G(s);t.allowed?m(`/quiz/${s.id}/edit`):s.status==="approved"?(j(s),y(!0)):h.warning(t.reason)},q=i.filter(s=>{const t=s.title.toLowerCase().includes(c.toLowerCase())||s.description.toLowerCase().includes(c.toLowerCase()),r=o==="all"||s.status===o;return t&&r});return!l||l.role!=="creator"&&l.role!=="admin"?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"KhÃ´ng cÃ³ quyá»n truy cáº­p"}),e.jsx("p",{className:"text-gray-600",children:"Báº¡n cáº§n cÃ³ vai trÃ² Creator hoáº·c Admin Ä‘á»ƒ xem trang nÃ y"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Quiz cá»§a tÃ´i"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Quáº£n lÃ½ vÃ  theo dÃµi quiz báº¡n Ä‘Ã£ táº¡o"})]}),e.jsxs("button",{onClick:()=>m("/creator"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition-colors",children:[e.jsx(H,{className:"w-5 h-5"}),"Táº¡o Quiz Má»›i"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"TÃ¬m kiáº¿m quiz...",value:c,onChange:s=>K(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),e.jsx("div",{className:"sm:w-48",children:e.jsxs("select",{value:o,onChange:s=>$(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"Táº¥t cáº£ tráº¡ng thÃ¡i"}),e.jsx("option",{value:"draft",children:"Báº£n nhÃ¡p"}),e.jsx("option",{value:"pending",children:"Chá» duyá»‡t"}),e.jsx("option",{value:"approved",children:"ÄÃ£ duyá»‡t"}),e.jsx("option",{value:"rejected",children:"Bá»‹ tá»« chá»‘i"})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(E,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tá»•ng quiz"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(S,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ÄÃ£ duyá»‡t"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(s=>s.status==="approved").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(L,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Chá» duyá»‡t"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(s=>s.status==="pending").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(M,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tá»•ng lÆ°á»£t xem"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.reduce((s,t)=>s+(t.views||0),0)})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(se,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Tá»•ng lÆ°á»£t thá»­"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.reduce((s,t)=>s+(t.attempts||0),0)})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(S,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"HoÃ n thÃ nh"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.reduce((s,t)=>s+(t.completions||0),0)})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:F?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):q.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ChÆ°a cÃ³ quiz nÃ o"}),e.jsx("p",{className:"text-gray-600 mb-4",children:c||o!=="all"?"KhÃ´ng tÃ¬m tháº¥y quiz phÃ¹ há»£p vá»›i bá»™ lá»c":"Báº¡n chÆ°a táº¡o quiz nÃ o. HÃ£y táº¡o quiz Ä‘áº§u tiÃªn!"}),!c&&o==="all"&&e.jsxs("button",{onClick:()=>m("/creator"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold inline-flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Táº¡o Quiz Äáº§u TiÃªn"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quiz"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Danh má»¥c & Äá»™ khÃ³"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tráº¡ng thÃ¡i"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thá»‘ng kÃª"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"NgÃ y táº¡o"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"HÃ nh Ä‘á»™ng"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:q.map(s=>{var t;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.title}),e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:s.description}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[((t=s.questions)==null?void 0:t.length)||0," cÃ¢u há»i"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-gray-900",children:s.category}),Y(s.difficulty)]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[X(s.status),s.editRequests&&s.editRequests.length>0&&e.jsx("div",{className:"text-xs text-gray-500",children:s.editRequests.filter(r=>r.status==="pending").length>0&&e.jsx("span",{className:"text-yellow-600",children:"CÃ³ yÃªu cáº§u chá»‰nh sá»­a"})})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["ðŸ‘ï¸ ",s.views||0," lÆ°á»£t xem"]}),e.jsxs("div",{children:["ðŸŽ¯ ",s.attempts||0," lÆ°á»£t thá»­"]}),e.jsxs("div",{children:["âœ… ",s.completions||0," hoÃ n thÃ nh"]}),s.averageScore!==void 0&&e.jsxs("div",{children:["ðŸ“Š ",s.averageScore,"% Ä‘iá»ƒm TB"]}),s.avgRating&&e.jsxs("div",{children:["â­ ",s.avgRating.toFixed(1),"/5"]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:s.createdAt.toLocaleDateString("vi-VN")}),e.jsx("td",{className:"px-6 py-4 text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>m(`/quiz/${s.id}/preview`),className:"text-blue-600 hover:text-blue-900 p-1",title:"Xem trÆ°á»›c",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>J(s),className:"text-green-600 hover:text-green-900 p-1",title:"Chá»‰nh sá»­a",children:e.jsx(te,{className:"w-4 h-4"})}),s.status==="draft"&&e.jsx("button",{onClick:()=>{window.confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a quiz nÃ y?")},className:"text-red-600 hover:text-red-900 p-1",title:"XÃ³a",children:e.jsx(ae,{className:"w-4 h-4"})})]})})]},s.id)})})]})})}),I&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"YÃªu cáº§u chá»‰nh sá»­a quiz"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Quiz: ",u.title]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"LÃ½ do chá»‰nh sá»­a *"}),e.jsx("textarea",{value:g,onChange:s=>b(s.target.value),placeholder:"Vui lÃ²ng mÃ´ táº£ lÃ½ do báº¡n muá»‘n chá»‰nh sá»­a quiz nÃ y...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"âš ï¸ Quiz Ä‘Ã£ Ä‘Æ°á»£c duyá»‡t. YÃªu cáº§u chá»‰nh sá»­a sáº½ Ä‘Æ°á»£c gá»­i tá»›i admin Ä‘á»ƒ xÃ©t duyá»‡t. Sau khi Ä‘Æ°á»£c phÃ©p chá»‰nh sá»­a, báº¡n cáº§n gá»­i láº¡i Ä‘á»ƒ admin duyá»‡t ná»™i dung má»›i."})})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{y(!1),b(""),j(null)},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Há»§y"}),e.jsxs("button",{onClick:V,disabled:!g.trim()||k,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[k?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(ne,{className:"w-4 h-4"}),"Gá»­i yÃªu cáº§u"]})]})]})})]})})};export{me as default};

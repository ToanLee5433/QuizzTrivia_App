import{r as e,j as t,u as s,a,m as l,l as r,h as i,y as n,p as d,g as c}from"./index-BcvsJ6SD.js";import{A as o}from"./AdminLayout-C9BITLMG.js";const u=({isOpen:s,onClose:a,title:l,children:r,size:i="md",closeOnBackdrop:n=!0,showCloseButton:d=!0})=>{e.useEffect(()=>{const e=e=>{"Escape"===e.key&&a()};return s&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[s,a]);return s?t.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:n?a:void 0}),t.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:t.jsxs("div",{className:`\n            relative bg-white rounded-lg shadow-xl transform transition-all\n            w-full ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[i]}\n          `,onClick:e=>e.stopPropagation(),children:[(l||d)&&t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[l&&t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l}),d&&t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors p-1","aria-label":"ÄÃ³ng modal",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsx("div",{className:"p-6",children:r})]})})]}):null},m=()=>{const{user:m}=s(e=>e.auth),{t:x}=a(),[h,p]=e.useState([]),[g,y]=e.useState(!0),[v,f]=e.useState("all"),[b,j]=e.useState({open:!1,type:null});e.useEffect(()=>{w()},[]);const w=async()=>{try{const e=(await l(r(i,"users"))).docs.map(e=>({id:e.id,...e.data()})).filter(e=>!e.isDeleted);p(e)}catch(e){}finally{y(!1)}},N="all"===v?h:h.filter(e=>e.role===v);return"admin"!==(null==m?void 0:m.role)?t.jsx("div",{className:"text-center py-12",children:t.jsx("p",{className:"text-gray-600",children:x("admin.loginAsAdmin","You need admin rights to access this page.")})}):g?t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):t.jsxs(o,{title:`ðŸ‘¥ ${x("admin.userManagement","User Management")}`,children:[t.jsx("div",{className:"mb-6",children:t.jsx("div",{className:"flex space-x-4",children:[{key:"all",label:x("common.all","All"),count:h.length},{key:"admin",label:x("ui.admin","Admin"),count:h.filter(e=>"admin"===e.role).length},{key:"creator",label:x("ui.creator","Creator"),count:h.filter(e=>"creator"===e.role).length},{key:"user",label:x("ui.user","User"),count:h.filter(e=>"user"===e.role).length}].map(e=>t.jsxs("button",{onClick:()=>f(e.key),className:"px-4 py-2 rounded-lg font-medium transition-colors "+(v===e.key?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[e.label," (",e.count,")"]},e.key))})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x("admin.userManagementCards.totalUsers","Total users")}),t.jsx("p",{className:"text-3xl font-bold text-blue-600",children:h.length})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x("admin.userManagementCards.activeUsers","Active users")}),t.jsx("p",{className:"text-3xl font-bold text-green-600",children:h.filter(e=>!1!==e.isActive).length})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x("ui.creator","Creator")}),t.jsx("p",{className:"text-3xl font-bold text-purple-600",children:h.filter(e=>"creator"===e.role).length})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x("ui.admin","Admin")}),t.jsx("p",{className:"text-3xl font-bold text-red-600",children:h.filter(e=>"admin"===e.role).length})]})]}),t.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:x("ui.user","User")}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:x("ui.role","Role")}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:x("status.label","Status")}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:x("common.createdAt","Created at")}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:x("action.actions","Actions")})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(e=>{var s,a,l,r,i;return t.jsxs("tr",{className:e.id===(null==m?void 0:m.uid)?"bg-blue-50":"",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:t.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-700",children:(null==(s=e.displayName)?void 0:s.charAt(0))||(null==(a=e.email)?void 0:a.charAt(0))||"U"})})}),t.jsxs("div",{className:"ml-4",children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[e.displayName||x("profile.displayName","Display Name"),e.id===(null==m?void 0:m.uid)&&t.jsxs("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:["(",x("common.you","You"),")"]})]}),t.jsx("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("select",{value:e.role,onChange:t=>j({open:!0,type:"roleChange",payload:{userId:e.id,newRole:t.target.value},message:`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Ä‘á»•i quyá»n cho ngÆ°á»i dÃ¹ng nÃ y thÃ nh ${t.target.value}?`}),disabled:e.id===(null==m?void 0:m.uid),className:"text-sm border border-gray-300 rounded px-2 py-1",children:[t.jsx("option",{value:"user",children:"User"}),t.jsx("option",{value:"creator",children:x("nav.creator")}),t.jsx("option",{value:"admin",children:x("admin.quizManagement.adminBadge")})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(!1!==e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:!1!==e.isActive?x("status.active","Active"):x("status.inactive","Inactive")})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(null==(i=null==(r=null==(l=e.createdAt)?void 0:l.toDate)?void 0:r.call(l))?void 0:i.toLocaleDateString())||"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:t.jsx("div",{className:"flex space-x-2",children:e.id!==(null==m?void 0:m.uid)&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>j({open:!0,type:"toggleUserStatus",payload:{userId:e.id,currentStatus:!1!==e.isActive},message:!1!==e.isActive?"Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n khÃ³a tÃ i khoáº£n nÃ y?":"Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n kÃ­ch hoáº¡t tÃ i khoáº£n nÃ y?"}),className:"px-3 py-1 rounded text-xs "+(!1!==e.isActive?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"),disabled:g,children:!1!==e.isActive?x("action.deactivate","Deactivate"):x("action.activate","Activate")}),t.jsx("button",{onClick:()=>j({open:!0,type:"deleteUser",payload:{userId:e.id},message:x("users.confirmDelete","Are you sure you want to delete this user?")}),className:"px-3 py-1 bg-red-100 text-red-600 rounded text-xs hover:bg-red-200",disabled:g,children:x("delete","Delete")})]})})})]},e.id)})})]})}),t.jsxs(u,{isOpen:b.open,onClose:()=>j({open:!1,type:null}),title:x("action.confirm","Confirm"),children:[t.jsx("div",{className:"mb-4",children:b.message}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx("button",{onClick:()=>j({open:!1,type:null}),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",disabled:g,children:x("cancel","Cancel")}),t.jsx("button",{onClick:async()=>{"deleteUser"===b.type&&await(async e=>{if(e!==(null==m?void 0:m.uid)){y(!0);try{await d(c(i,"users",e),{isActive:!1,isDeleted:!0,deletedAt:new Date,deletedBy:null==m?void 0:m.uid}),p(t=>t.filter(t=>t.id!==e)),n.success(x("admin.userDeleteSuccess","User deleted successfully!"))}catch(t){n.error(x("admin.userDeleteError","Error occurred while deleting user!"))}finally{y(!1)}}else n.error(x("admin.users.cannotDeleteSelf","You cannot delete your own account!"))})(b.payload.userId),"toggleUserStatus"===b.type&&await(async(e,t)=>{if(e!==(null==m?void 0:m.uid)){y(!0);try{await d(c(i,"users",e),{isActive:!t}),p(s=>s.map(s=>s.id===e?{...s,isActive:!t}:s)),n.success(x("admin.userStatusUpdateSuccess",{action:x(t?"admin.deactivated":"admin.activated")}))}catch(s){n.error(x("messages.error","An error occurred"))}finally{y(!1)}}else n.error(x("admin.users.cannotDeactivateSelf","You cannot change your own status!"))})(b.payload.userId,b.payload.currentStatus),"roleChange"===b.type&&await(async(e,t)=>{if(e!==(null==m?void 0:m.uid)||"admin"===t){y(!0);try{await d(c(i,"users",e),{role:t}),p(s=>s.map(s=>s.id===e?{...s,role:t}:s)),n.success(x("admin.roleUpdateSuccess","Role updated successfully!"))}catch(s){n.error(x("messages.error","An error occurred"))}finally{y(!1)}}else n.error(x("admin.users.cannotChangeSelfRole","You cannot change your own role!"))})(b.payload.userId,b.payload.newRole),j({open:!1,type:null})},className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",disabled:g,children:x("action.confirm","Confirm")})]})]})]})};export{m as default};

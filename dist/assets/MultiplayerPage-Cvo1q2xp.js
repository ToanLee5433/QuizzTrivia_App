var e=Object.defineProperty,s=(s,t,r)=>((s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r)(s,"symbol"!=typeof t?t+"":t,r);import{d as t,a as r,j as a,U as l,S as i,o as n,V as o,r as d,a4 as c,R as m,C as x,F as u,g as h,m as g,h as p,s as b,Z as y,q as j,w as v,z as f,n as w,x as N,i as k,t as C,p as S,a5 as I,v as z,y as M,a6 as R,l as P,u as D}from"./index-Dp2ZjDRA.js";import{T as q}from"./trophy-BdqRw4Kk.js";import{P as L}from"./play-BHRJcPA0.js";import{M as A}from"./message-square-DhERZ26W.js";import{C as _}from"./circle-alert-Cf7uNtQW.js";import{X as T}from"./x-Bbxc2d81.js";import{S as F}from"./send-CZRsQT1N.js";import{A as Q}from"./award-BJj3H4dp.js";
/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=t("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),E=t("crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]),H=t("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),O=t("medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]),$=t("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),B=t("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),J=t("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),W=({isOpen:e,onClose:s,onSelectSinglePlayer:t,onSelectMultiplayer:d,connectionStatus:c})=>{const{t:m}=r();if(!e)return null;return a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 p-4 sm:p-6 text-white",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1 sm:mb-2",children:m("multiplayer.title")}),a.jsx("p",{className:"text-purple-100 text-sm sm:text-base",children:m("multiplayer.subtitle")})]}),a.jsx("button",{onClick:s,className:"text-white/80 hover:text-white transition-colors p-1",children:a.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),a.jsx("div",{className:"p-3 sm:p-4 border-b border-gray-200",children:(()=>{const e={disconnected:{icon:B,color:"text-red-500",bg:"bg-red-500/10",text:m("multiplayer.errors.connectionLost")},connecting:{icon:J,color:"text-yellow-500",bg:"bg-yellow-500/10",text:m("multiplayer.errors.reconnecting")},connected:{icon:J,color:"text-green-500",bg:"bg-green-500/10",text:m("multiplayer.success.connectionRestored")},error:{icon:_,color:"text-red-500",bg:"bg-red-500/10",text:m("multiplayer.errors.connectionFailed")}}[c],s=e.icon;return a.jsxs("div",{className:`flex items-center gap-2 ${e.color} ${e.bg} px-3 py-2 rounded-lg text-sm`,children:[a.jsx(s,{size:16}),a.jsx("span",{children:e.text})]})})()}),a.jsxs("div",{className:"p-4 sm:p-6",children:[a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[a.jsx("div",{className:"group cursor-pointer",onClick:t,children:a.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 border-2 border-gray-200 hover:border-blue-300 rounded-xl p-4 sm:p-6 transition-all duration-300 transform hover:scale-[1.02] hover:shadow-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[a.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center",children:a.jsx(l,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white"})}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-xs sm:text-sm text-gray-500",children:m("common.recommended")}),a.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((e,s)=>a.jsx(i,{className:"w-3 h-3 sm:w-4 sm:h-4 text-yellow-500 fill-current"},s))})]})]}),a.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-800 mb-2",children:m("gameMode.singlePlayer")}),a.jsx("p",{className:"text-gray-600 mb-3 sm:mb-4 text-sm sm:text-base",children:m("gameMode.singlePlayerDesc")}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-gray-600",children:[a.jsx(n,{className:"w-3 h-3 sm:w-4 sm:h-4"}),a.jsx("span",{children:m("gameMode.noPressure")})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-gray-600",children:[a.jsx(q,{className:"w-3 h-3 sm:w-4 sm:h-4"}),a.jsx("span",{children:m("gameMode.trackProgress")})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-gray-600",children:[a.jsx($,{className:"w-3 h-3 sm:w-4 sm:h-4"}),a.jsx("span",{children:m("gameMode.customizable")})]})]}),a.jsx("div",{className:"mt-4 sm:mt-6",children:a.jsx("button",{className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 sm:py-3 px-4 sm:px-6 rounded-lg transition-colors text-sm sm:text-base",children:m("gameMode.startSolo")})})]})}),a.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[a.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[a.jsx("h3",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-800 mb-1 sm:mb-2",children:m("gameMode.multiplayer")}),a.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:m("gameMode.multiplayerDesc")})]}),a.jsx("div",{className:"group cursor-pointer "+("connected"===c?"":"opacity-50 cursor-not-allowed"),onClick:()=>"connected"===c&&d("create"),children:a.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-100 hover:from-green-100 hover:to-emerald-200 border-2 border-green-200 hover:border-green-400 rounded-xl p-4 sm:p-5 transition-all duration-300 transform hover:scale-[1.02] hover:shadow-lg",children:[a.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 mb-3 sm:mb-4",children:[a.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:a.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-base sm:text-lg font-bold text-gray-800",children:m("gameMode.createRoom")}),a.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:m("gameMode.createRoomDesc")})]})]}),a.jsxs("div",{className:"space-y-1 sm:space-y-2 mb-3 sm:mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-gray-600",children:[a.jsx(E,{className:"w-3 h-3 sm:w-4 sm:h-4"}),a.jsx("span",{children:m("gameMode.becomeHost")})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-gray-600",children:[a.jsx(o,{className:"w-3 h-3 sm:w-4 sm:h-4"}),a.jsx("span",{children:m("gameMode.invitePlayers")})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-gray-600",children:[a.jsx($,{className:"w-3 h-3 sm:w-4 sm:h-4"}),a.jsx("span",{children:m("gameMode.customizeSettings")})]})]}),a.jsx("button",{className:"w-full font-semibold py-2 sm:py-3 px-4 sm:px-6 rounded-lg transition-colors text-sm sm:text-base "+("connected"===c?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-400 text-gray-200 cursor-not-allowed"),disabled:"connected"!==c,children:m("connected"===c?"gameMode.createRoom":"common.connecting")})]})}),a.jsx("div",{className:"group cursor-pointer "+("connected"===c?"":"opacity-50 cursor-not-allowed"),onClick:()=>"connected"===c&&d("join"),children:a.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-indigo-100 hover:from-purple-100 hover:to-indigo-200 border-2 border-purple-200 hover:border-purple-400 rounded-xl p-6 transition-all duration-300 transform hover:scale-105 hover:shadow-lg",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[a.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center",children:a.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})})}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-lg font-bold text-gray-800",children:"Join Room"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Enter a room code or browse public rooms"})]})]}),a.jsxs("div",{className:"space-y-2 mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx(L,{className:"w-4 h-4"}),a.jsx("span",{children:"Quick join"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx(o,{className:"w-4 h-4"}),a.jsx("span",{children:"Find active games"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx(q,{className:"w-4 h-4"}),a.jsx("span",{children:"Compete with others"})]})]}),a.jsx("button",{className:"w-full font-semibold py-3 px-6 rounded-lg transition-colors "+("connected"===c?"bg-purple-600 hover:bg-purple-700 text-white":"bg-gray-400 text-gray-200 cursor-not-allowed"),disabled:"connected"!==c,children:"connected"===c?"Join Room":"Connecting..."})]})})]})]}),a.jsxs("div",{className:"mt-12 pt-8 border-t border-gray-200",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-6 text-center",children:"Why Choose Multiplayer?"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-3",children:a.jsx(o,{className:"w-6 h-6 text-blue-600"})}),a.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Real-time Competition"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Compete with friends and players worldwide in real-time"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mx-auto mb-3",children:a.jsx(q,{className:"w-6 h-6 text-green-600"})}),a.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Leaderboards"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Track your ranking and achievements on global leaderboards"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mx-auto mb-3",children:a.jsx(A,{className:"w-6 h-6 text-purple-600"})}),a.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Live Chat"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Communicate with other players during the game"})]})]})]})]})]})})},V=({isOpen:e,onClose:s,onCreateRoom:t,selectedQuiz:l})=>{var i;const{t:m}=r(),[x,u]=d.useState(""),[h,g]=d.useState(4),[p,b]=d.useState(30),[y,j]=d.useState(!1),[v,f]=d.useState(""),[w,N]=d.useState(!0);return e?a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:m("multiplayer.createRoom")}),a.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(T,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!x.trim())return;const s={name:x.trim(),maxPlayers:h,timeLimit:p,isPrivate:y,password:y?v:void 0,showLeaderboard:w,quizId:null==l?void 0:l.id,quiz:l};t(s)},className:"p-6 space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:m("multiplayer.roomName")}),a.jsx("input",{type:"text",value:x,onChange:e=>u(e.target.value),placeholder:m("multiplayer.enterRoomName"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a.jsx(o,{className:"w-4 h-4 inline mr-2"}),m("multiplayer.maxPlayers")]}),a.jsxs("select",{value:h,onChange:e=>g(parseInt(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[a.jsx("option",{value:2,children:"2 ngÆ°á»i"}),a.jsx("option",{value:4,children:"4 ngÆ°á»i"}),a.jsx("option",{value:6,children:"6 ngÆ°á»i"}),a.jsx("option",{value:8,children:"8 ngÆ°á»i"}),a.jsx("option",{value:10,children:"10 ngÆ°á»i"})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a.jsx(n,{className:"w-4 h-4 inline mr-2"}),m("multiplayer.timeLimit")]}),a.jsxs("select",{value:p,onChange:e=>b(parseInt(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[a.jsx("option",{value:15,children:"15 giÃ¢y"}),a.jsx("option",{value:20,children:"20 giÃ¢y"}),a.jsx("option",{value:30,children:"30 giÃ¢y"}),a.jsx("option",{value:45,children:"45 giÃ¢y"}),a.jsx("option",{value:60,children:"60 giÃ¢y"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("h3",{className:"text-sm font-medium text-gray-700 flex items-center",children:[a.jsx($,{className:"w-4 h-4 mr-2"}),m("multiplayer.roomSettings")]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"showLeaderboard",checked:w,onChange:e=>N(e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),a.jsx("label",{htmlFor:"showLeaderboard",className:"ml-2 text-sm text-gray-700",children:m("multiplayer.showLeaderboard")})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"isPrivate",checked:y,onChange:e=>j(e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),a.jsxs("label",{htmlFor:"isPrivate",className:"ml-2 text-sm text-gray-700 flex items-center",children:[a.jsx(c,{className:"w-4 h-4 mr-1"}),m("multiplayer.private")]})]}),y&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:m("multiplayer.password")}),a.jsx("input",{type:"password",value:v,onChange:e=>f(e.target.value),placeholder:m("multiplayer.enterPassword"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:y})]})]}),l&&a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[a.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:m("quiz.selectedQuiz")}),a.jsxs("div",{className:"text-sm text-blue-800",children:[a.jsx("div",{className:"font-medium",children:l.title}),a.jsxs("div",{className:"text-blue-600",children:[(null==(i=l.questions)?void 0:i.length)||0," cÃ¢u há»i"]})]})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:m("common.cancel")}),a.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors font-medium",children:m("multiplayer.createRoom")})]})]})]})}):null},G=({isOpen:e,onClose:s,onJoinRoom:t,loading:l=!1,error:i})=>{const{t:n}=r(),[o,x]=d.useState(""),[u,h]=d.useState(""),[g,p]=d.useState(!1),[b,y]=d.useState("code"),j=()=>{x(""),h(""),p(!1),y("code"),s()};return m.useEffect(()=>{"room_requires_password"===i&&(y("password"),p(!0))},[i]),e?a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:n("multiplayer.joinRoom")}),a.jsx("button",{onClick:j,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(T,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),"code"===b){if(!o.trim())return;t(o.trim().toUpperCase())}else if("password"===b){if(!u.trim())return;t(o.trim().toUpperCase(),u.trim())}},className:"p-6 space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n("multiplayer.roomCode")}),a.jsx("input",{type:"text",value:o,onChange:e=>x(e.target.value.toUpperCase()),placeholder:n("multiplayer.enterRoomCode"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg font-mono tracking-wider",maxLength:6,required:!0,disabled:l||"password"===b}),a.jsx("div",{className:"text-xs text-gray-500 mt-1 text-center",children:n("multiplayer.roomCodeHint")})]}),g&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a.jsx(c,{className:"w-4 h-4 inline mr-2"}),n("multiplayer.password")]}),a.jsx("input",{type:"password",value:u,onChange:e=>h(e.target.value),placeholder:n("multiplayer.enterPassword"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:"password"===b,disabled:l})]}),i&&"room_requires_password"!==i&&a.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[a.jsx(_,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),a.jsxs("span",{className:"text-red-700 text-sm",children:["room_not_found"===i&&n("multiplayer.errors.roomNotFound"),"room_full"===i&&n("multiplayer.errors.roomFull"),"wrong_password"===i&&n("multiplayer.errors.wrongPassword"),"game_in_progress"===i&&n("multiplayer.errors.gameInProgress"),!["room_not_found","room_full","wrong_password","game_in_progress"].includes(i)&&i]})]}),"password"===b&&a.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[a.jsx(c,{className:"w-5 h-5 text-yellow-600 flex-shrink-0"}),a.jsx("span",{className:"text-yellow-700 text-sm",children:n("multiplayer.passwordRequired")})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:j,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",disabled:l,children:n("common.cancel")}),"password"===b&&a.jsx("button",{type:"button",onClick:()=>{y("code"),p(!1),h("")},className:"px-4 py-2 text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",disabled:l,children:n("common.back")}),a.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors font-medium disabled:opacity-50",disabled:l||!o.trim()||"password"===b&&!u.trim(),children:l?a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),n("common.loading")]}):n("code"===b?"multiplayer.joinRoom":"common.submit")})]})]})]})}):null},Z=({roomData:e,currentUserId:s,onLeaveRoom:t,multiplayerService:l})=>{const{t:i}=r(),[c,m]=d.useState(!1),[u,h]=d.useState(null),g=(null==e?void 0:e.players)||[],p=d.useMemo(()=>g.filter(e=>e.isReady).length,[g]),b=d.useMemo(()=>g.length>=2&&g.every(e=>e.isReady),[g]),y=g.find(e=>e.id===s);d.useEffect(()=>{if(b&&g.length>=2){h(5);const s=setInterval(()=>{h(t=>null===t||t<=1?(clearInterval(s),l&&(null==e?void 0:e.id)&&l.startGame(e.id),null):t-1)},1e3);return()=>clearInterval(s)}h(null)},[b,g.length,l,null==e?void 0:e.id]);return e?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 p-4 lg:p-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6",children:[a.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent",children:e.name}),a.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[a.jsx(o,{size:18,className:"text-blue-500"}),a.jsx("span",{className:"font-semibold",children:g.length}),a.jsxs("span",{className:"text-sm",children:["/",e.maxPlayers," ",i("multiplayer.players")]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[a.jsx(x,{size:18,className:"text-green-500"}),a.jsx("span",{className:"font-semibold",children:p}),a.jsx("span",{className:"text-sm",children:i("multiplayer.ready")})]}),a.jsxs("button",{onClick:async()=>{if(null==e?void 0:e.code)try{await navigator.clipboard.writeText(e.code),m(!0),setTimeout(()=>m(!1),2e3)}catch(s){}},className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg font-medium transition-all "+(c?"bg-green-100 text-green-700 border border-green-200":"bg-blue-100 text-blue-700 border border-blue-200 hover:bg-blue-200"),children:[a.jsx(U,{size:16}),a.jsx("span",{className:"font-mono text-lg",children:e.code}),c&&a.jsx("span",{className:"text-xs",children:"Copied!"})]})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[u&&a.jsxs("div",{className:"flex items-center justify-center gap-2 bg-orange-100 text-orange-700 px-4 py-2 rounded-xl font-bold",children:[a.jsx(n,{size:18}),a.jsxs("span",{children:[i("multiplayer.startingIn")," ",u,"s"]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:t,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl border border-gray-300 transition-colors flex items-center gap-2",children:[a.jsx(H,{size:16}),i("multiplayer.leaveRoom")]}),a.jsxs("button",{onClick:async()=>{if(!l||!(null==e?void 0:e.id))return;const s=!(null==y?void 0:y.isReady);await l.updatePlayerStatus(e.id,s)},className:"px-6 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 flex items-center gap-2 shadow-lg "+((null==y?void 0:y.isReady)?"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white":"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white"),children:[a.jsx(x,{size:18}),(null==y?void 0:y.isReady)?i("multiplayer.notReady"):i("multiplayer.ready")]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6",children:[a.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.length}),a.jsx("div",{className:"text-sm text-blue-700",children:i("multiplayer.totalPlayers")})]}),a.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-xl p-4 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-green-600",children:p}),a.jsx("div",{className:"text-sm text-green-700",children:i("multiplayer.readyPlayers")})]}),a.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl p-4 text-center",children:[a.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[e.settings.timeLimit,"s"]}),a.jsx("div",{className:"text-sm text-purple-700",children:i("multiplayer.timePerQuestion")})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[g.map(e=>a.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border-2 transition-all duration-200 "+(e.id===s?"border-blue-400 bg-gradient-to-br from-blue-50 to-indigo-50":"border-gray-200 hover:border-gray-300"),children:[a.jsx("div",{className:"flex items-center justify-between mb-4",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"relative w-14 h-14 rounded-2xl flex items-center justify-center text-white font-bold text-lg bg-gradient-to-br from-blue-500 to-purple-600",children:[e.username.charAt(0).toUpperCase(),e.isHost&&a.jsx(E,{className:"absolute -top-2 -right-2 w-5 h-5 text-yellow-500"})]}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("div",{className:"font-bold text-gray-800 text-lg flex items-center gap-2",children:[a.jsx("span",{className:"truncate",children:e.username}),e.id===s&&a.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full shrink-0",children:i("common.you")})]}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsx("div",{className:"w-2 h-2 rounded-full "+(e.isOnline?"bg-green-400":"bg-gray-400")}),a.jsx("span",{className:"text-sm text-gray-600",children:e.isOnline?i("common.online"):i("common.offline")})]})]})]})}),a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("div",{className:"flex items-center gap-2 px-3 py-2 rounded-xl font-medium w-full justify-center "+(e.isReady?"bg-green-100 text-green-700 border border-green-200":"bg-gray-100 text-gray-600 border border-gray-200"),children:e.isReady?a.jsxs(a.Fragment,{children:[a.jsx(x,{size:16}),a.jsx("span",{children:i("multiplayer.ready")})]}):a.jsxs(a.Fragment,{children:[a.jsx(n,{size:16}),a.jsx("span",{children:i("multiplayer.waiting")})]})})})]},e.id)),Array.from({length:Math.max(0,e.maxPlayers-g.length)}).map((e,s)=>a.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-2xl p-6 flex items-center justify-center text-gray-400 min-h-[120px]",children:a.jsxs("div",{className:"text-center",children:[a.jsx(o,{size:24,className:"mx-auto mb-2 opacity-50"}),a.jsx("div",{className:"text-sm font-medium",children:i("multiplayer.waitingForPlayer")})]})},`empty-${s}`))]})]})}):a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"mt-4 text-gray-600",children:i("common.loading")})]})})},K=({gameData:e,roomData:s,multiplayerService:t})=>{var r,l,i;const[c,m]=d.useState(null),[u,h]=d.useState(!1),[g,p]=d.useState(()=>{var t;return(null==e?void 0:e.timeLeft)??(null==(t=null==s?void 0:s.settings)?void 0:t.timePerQuestion)??30}),[b,y]=d.useState(!1),[j,v]=d.useState(null),[f,w]=d.useState(null),N=d.useRef(null),k=(null==e?void 0:e.currentQuestion)||(null==(r=null==e?void 0:e.questions)?void 0:r[(null==e?void 0:e.currentQuestionIndex)||0])||{id:"q",title:"Question",options:[]};d.useEffect(()=>{var t;m(null),h(!1),y(!1),v(null),w(null);const r=(null==e?void 0:e.timeLeft)??(null==(t=null==s?void 0:s.settings)?void 0:t.timePerQuestion)??30;p(r)},[null==k?void 0:k.id]),d.useEffect(()=>{if(!u&&!b){if(!(g<=0))return N.current=window.setTimeout(()=>p(e=>e-1),1e3),()=>{N.current&&window.clearTimeout(N.current)};u||C()}},[g,u,b]),d.useEffect(()=>{if(null===f)return;if(f<=0)return y(!1),void w(null);const e=setTimeout(()=>{w(e=>null!==e?e-1:null)},1e3);return()=>clearTimeout(e)},[f]);const C=async()=>{if(!u&&(h(!0),t&&(null==s?void 0:s.id)&&(null==k?void 0:k.id)))try{await t.submitAnswer(s.id,k.id,c,g),setTimeout(()=>{var e,s,t;const r=c===k.correct,a=r?Math.max(1,Math.floor(g/2)):0;v({isCorrect:r,correctAnswer:k.correct,selectedAnswer:c,points:a,explanation:k.explanation||`Correct answer: ${(null==(s=null==(e=k.options)?void 0:e[k.correct])?void 0:s.text)||(null==(t=k.options)?void 0:t[k.correct])||"N/A"}`}),y(!0),w(3)},1e3)}catch(e){}},S=d.useMemo(()=>{var e;const t=(null==(e=null==s?void 0:s.settings)?void 0:e.timePerQuestion)??30;return Math.max(0,Math.min(100,Math.round(g/t*100)))},[g,null==(l=null==s?void 0:s.settings)?void 0:l.timePerQuestion]);return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-blue-100 p-2 sm:p-4 lg:p-6",children:a.jsxs("div",{className:"max-w-4xl mx-auto",children:[a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-4 sm:p-6 mb-4 sm:mb-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[a.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-blue-600 text-white px-3 sm:px-4 py-2 rounded-xl font-bold text-sm sm:text-base text-center",children:["Question ",(null==e?void 0:e.index)||1," of ",(null==e?void 0:e.total)||10]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-600 justify-center sm:justify-start",children:[a.jsx(o,{size:18}),a.jsxs("span",{className:"text-sm sm:text-base",children:[(null==(i=null==s?void 0:s.players)?void 0:i.length)||0," players"]})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 sm:gap-4",children:[u&&a.jsxs("div",{className:"flex items-center gap-2 bg-green-100 text-green-700 px-3 py-2 rounded-xl font-medium text-sm",children:[a.jsx(x,{size:16}),a.jsx("span",{children:"Answer Submitted!"})]}),a.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[a.jsxs("div",{className:"flex items-center gap-2 px-3 sm:px-4 py-2 rounded-xl font-bold text-sm sm:text-base "+(g<=5?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"),children:[a.jsx(n,{size:16}),a.jsxs("span",{children:[g,"s"]})]}),a.jsxs("div",{className:"relative w-12 h-12 sm:w-16 sm:h-16",children:[a.jsxs("svg",{className:"w-12 h-12 sm:w-16 sm:h-16 transform -rotate-90",viewBox:"0 0 36 36",children:[a.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"#e5e7eb",strokeWidth:"3"}),a.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:g<=5?"#ef4444":"#3b82f6",strokeWidth:"3",strokeLinecap:"round",strokeDasharray:`${S} 100`,className:"transition-all duration-1000"})]}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsxs("span",{className:"text-xs font-bold "+(g<=5?"text-red-600":"text-blue-600"),children:[S,"%"]})})]})]})]})]}),g<=10&&!u&&a.jsx("div",{className:"bg-orange-100 border-l-4 border-orange-500 p-4 rounded-r-lg mb-4",children:a.jsxs("div",{className:"flex items-center gap-2 text-orange-700",children:[a.jsx(_,{size:18}),a.jsxs("span",{className:"font-medium",children:["Hurry up! Only ",g," seconds left!"]})]})})]}),a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-4 sm:p-6 lg:p-8",children:[a.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[a.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-800 mb-4",children:k.title}),a.jsx("div",{className:"w-12 sm:w-16 h-1 bg-gradient-to-r from-purple-500 to-blue-600 mx-auto rounded-full"})]}),a.jsx("div",{className:"grid gap-3 sm:gap-4 mb-6 sm:mb-8",children:(k.options||[]).map((e,s)=>{const t=(null==e?void 0:e.value)??s,r=(null==e?void 0:e.text)??String(e),l=c===t;return a.jsxs("button",{onClick:()=>(e=>{u||m(e)})(t),className:`group relative px-4 sm:px-6 py-3 sm:py-4 rounded-2xl text-left transition-all duration-200 transform hover:scale-105 ${l?"border-2 border-blue-500 bg-gradient-to-r from-blue-50 to-indigo-50 shadow-lg":"border-2 border-gray-200 bg-white hover:border-gray-300 hover:shadow-md"} ${u?"opacity-60 cursor-not-allowed transform-none":""}`,disabled:u,children:[a.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[a.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-xl flex items-center justify-center font-bold text-xs sm:text-sm "+(l?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 group-hover:bg-gray-200"),children:["A","B","C","D"][s]||s+1}),a.jsx("span",{className:"font-medium text-gray-800 text-sm sm:text-base",children:r})]}),l&&a.jsx("div",{className:"absolute top-2 right-2 sm:top-3 sm:right-3",children:a.jsx(x,{size:16,className:"text-blue-500 sm:w-5 sm:h-5"})})]},t)})}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[a.jsx("div",{className:"text-sm text-gray-500 text-center sm:text-left",children:null!==c?"Answer selected":"Choose your answer"}),a.jsx("button",{onClick:C,disabled:u||null===c,className:"px-6 sm:px-8 py-3 rounded-2xl font-bold transition-all transform hover:scale-105 disabled:scale-100 flex items-center justify-center gap-2 shadow-lg w-full sm:w-auto "+(u?"bg-green-500 text-white cursor-not-allowed":null!==c?"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:u?a.jsxs(a.Fragment,{children:[a.jsx(x,{size:18}),a.jsx("span",{children:"Submitted!"})]}):a.jsxs(a.Fragment,{children:[a.jsx(F,{size:18}),a.jsx("span",{children:"Submit Answer"})]})})]})]}),b&&j&&a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-6 transform animate-in fade-in zoom-in-95 duration-300",children:a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("div",{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center mb-4 "+(j.isCorrect?"bg-green-100 text-green-600":"bg-red-100 text-red-600"),children:j.isCorrect?a.jsx(x,{size:40}):a.jsx(_,{size:40})}),a.jsx("h3",{className:"text-2xl font-bold mb-2 "+(j.isCorrect?"text-green-600":"text-red-600"),children:j.isCorrect?"ðŸŽ‰ Correct!":"âŒ Incorrect"}),a.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-4",children:["+",j.points," points"]}),a.jsx("p",{className:"text-gray-600 mb-4",children:j.explanation}),null!==f&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:a.jsxs("div",{className:"flex items-center justify-center gap-2 text-blue-700",children:[a.jsx(n,{size:20}),a.jsxs("span",{className:"font-semibold",children:["Next question in ",f," seconds..."]})]})})]})})})]})})},X=({players:e=[],currentUserId:s="",gameStats:t={totalQuestions:0,totalTime:0,averageScore:0},onPlayAgain:l,onBackToLobby:i,onLeaveRoom:d})=>{const{t:c}=r(),m=e=>{switch(e){case 1:return a.jsx(q,{className:"w-6 h-6 text-yellow-500"});case 2:return a.jsx(O,{className:"w-6 h-6 text-gray-400"});case 3:return a.jsx(Q,{className:"w-6 h-6 text-orange-500"});default:return a.jsxs("div",{className:"w-6 h-6 flex items-center justify-center text-gray-500 font-bold",children:["#",e]})}},x=e=>{switch(e){case 1:return"bg-gradient-to-r from-yellow-100 to-yellow-200 border-yellow-300";case 2:return"bg-gradient-to-r from-gray-100 to-gray-200 border-gray-300";case 3:return"bg-gradient-to-r from-orange-100 to-orange-200 border-orange-300";default:return"bg-gray-50 border-gray-200"}},h=e.find(e=>e.id===s),g=[...e].sort((e,s)=>s.score-e.score);return a.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[a.jsxs("div",{className:"text-center space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-center gap-3",children:[a.jsx(q,{className:"w-8 h-8 text-yellow-500"}),a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:c("multiplayer.game.gameOver")})]}),h&&a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 inline-block",children:[a.jsx("div",{className:"text-lg font-semibold text-blue-900",children:c("multiplayer.yourResult")}),a.jsxs("div",{className:"flex items-center justify-center gap-6 mt-2 text-blue-800",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-2xl font-bold",children:h.score}),a.jsx("div",{className:"text-sm",children:c("common.points")})]}),a.jsxs("div",{className:"text-center",children:[a.jsxs("div",{className:"text-2xl font-bold",children:["#",h.rank]}),a.jsx("div",{className:"text-sm",children:c("common.rank")})]}),a.jsxs("div",{className:"text-center",children:[a.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(h.correctAnswers/h.totalAnswers*100),"%"]}),a.jsx("div",{className:"text-sm",children:c("common.accuracy")})]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:a.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[a.jsx(q,{className:"w-6 h-6"}),c("multiplayer.game.finalResults")]})}),a.jsx("div",{className:"divide-y divide-gray-200",children:g.map((e,t)=>a.jsxs("div",{className:`p-4 flex items-center gap-4 ${x(t+1)} ${e.id===s?"ring-2 ring-blue-500":""}`,children:[a.jsx("div",{className:"flex items-center justify-center w-12",children:m(t+1)}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.username,e.id===s&&a.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:c("common.you")})]}),a.jsxs("div",{className:"text-sm text-gray-600",children:[e.correctAnswers,"/",e.totalAnswers," ",c("common.correct")," â€¢",Math.round(e.averageTime),"s ",c("common.avgTime")]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-xl font-bold text-gray-900",children:e.score}),a.jsx("div",{className:"text-xs text-gray-500",children:c("common.points")})]}),a.jsxs("div",{className:"text-right w-16",children:[a.jsxs("div",{className:"text-lg font-semibold text-gray-700",children:[Math.round(e.correctAnswers/e.totalAnswers*100),"%"]}),a.jsx("div",{className:"text-xs text-gray-500",children:c("common.accuracy")})]})]},e.id))})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-4 text-center",children:[a.jsx(u,{className:"w-8 h-8 text-blue-600 mx-auto mb-2"}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:t.totalQuestions}),a.jsx("div",{className:"text-sm text-gray-600",children:c("multiplayer.totalQuestions")})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-4 text-center",children:[a.jsx(n,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),a.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[Math.round(t.totalTime/60),"m"]}),a.jsx("div",{className:"text-sm text-gray-600",children:c("multiplayer.totalTime")})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-4 text-center",children:[a.jsx(o,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:Math.round(t.averageScore)}),a.jsx("div",{className:"text-sm text-gray-600",children:c("multiplayer.avgScore")})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[l&&a.jsx("button",{onClick:l,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:c("multiplayer.playAgain")}),i&&a.jsx("button",{onClick:i,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:c("multiplayer.backToLobby")}),d&&a.jsx("button",{onClick:d,className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",children:c("multiplayer.leaveRoom")})]})]})},Y=({messages:e,onSendMessage:s,currentUserId:t,disabled:l=!1})=>{const{t:i}=r(),[n,o]=d.useState(""),c=d.useRef(null),m=d.useRef(null);d.useEffect(()=>{var e;null==(e=c.current)||e.scrollIntoView({behavior:"smooth"})},[e]);return a.jsxs("div",{className:"flex flex-col h-full bg-white border border-gray-200 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-2 p-3 border-b border-gray-200 bg-gray-50 rounded-t-lg",children:[a.jsx(A,{className:"w-5 h-5 text-blue-600"}),a.jsx("h3",{className:"font-medium text-gray-900",children:i("multiplayer.chat.title")}),a.jsx("div",{className:"ml-auto",children:a.jsxs("span",{className:"text-xs text-gray-500",children:[e.length," ",i("common.messages")]})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2 max-h-64",children:[0===e.length?a.jsx("div",{className:"text-center text-gray-500 text-sm py-8",children:i("multiplayer.chat.noMessages")}):e.map(e=>{return a.jsx("div",{className:"flex flex-col "+("system"===e.type?"items-center":e.userId===t?"items-end":"items-start"),children:"system"===e.type?a.jsx("div",{className:"bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full",children:e.message}):a.jsxs("div",{className:"max-w-xs lg:max-w-md px-3 py-2 rounded-lg text-sm "+(e.userId===t?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[e.userId!==t&&a.jsx("div",{className:"text-xs opacity-75 mb-1 font-medium",children:e.username}),a.jsx("div",{children:e.message}),a.jsx("div",{className:"text-xs mt-1 "+(e.userId===t?"text-blue-200":"text-gray-500"),children:(s=e.timestamp,new Intl.DateTimeFormat("vi-VN",{hour:"2-digit",minute:"2-digit"}).format(s))})]})},e.id);var s}),a.jsx("div",{ref:c})]}),a.jsxs("form",{onSubmit:e=>{var t;e.preventDefault(),n.trim()&&!l&&(s(n.trim()),o(""),null==(t=m.current)||t.focus())},className:"p-3 border-t border-gray-200",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{ref:m,type:"text",value:n,onChange:e=>o(e.target.value),placeholder:i(l?"multiplayer.chat.disabled":"multiplayer.chat.placeholder"),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm disabled:bg-gray-100 disabled:text-gray-500",disabled:l,maxLength:200}),a.jsx("button",{type:"submit",disabled:!n.trim()||l,className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a.jsx(F,{className:"w-4 h-4"})})]}),n.length>150&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[n.length,"/200"]})]})]})};class ee{constructor(){s(this,"events",{})}on(e,s){this.events[e]||(this.events[e]=[]),this.events[e].push(s)}off(e,s){this.events[e]&&(this.events[e]=this.events[e].filter(e=>e!==s))}emit(e,...s){this.events[e]&&this.events[e].forEach(e=>e(...s))}}class se extends ee{constructor(){super(...arguments),s(this,"userId",""),s(this,"username",""),s(this,"currentRoomId",null),s(this,"unsubscribeFunctions",[])}async connect(e,s){this.userId=e,this.username=s,this.emit("connected",{userId:e,username:s})}async disconnect(){this.unsubscribeFunctions.forEach(e=>e()),this.unsubscribeFunctions=[],this.currentRoomId&&await this.leaveRoom(this.currentRoomId),this.emit("disconnected")}async createRoom(e,s){var t,r,a;try{const l=this.generateRoomCode(),i=h(g(p,"multiplayer_rooms")),n={id:this.userId,username:this.username,isReady:!1,isHost:!0,score:0,answers:[],joinedAt:new Date},o={code:l,name:e.name||`${this.username}'s Room`,hostId:this.userId,maxPlayers:e.maxPlayers||4,isPrivate:e.isPrivate||!1,password:e.password||null,status:"waiting",quizId:(null==s?void 0:s.id)||null,quiz:s?{id:s.id,title:s.title,description:s.description,questions:s.questions||[]}:null,settings:{timeLimit:(null==(t=e.settings)?void 0:t.timeLimit)||30,showLeaderboard:(null==(r=e.settings)?void 0:r.showLeaderboard)??!0,allowLateJoin:(null==(a=e.settings)?void 0:a.allowLateJoin)??!0},createdAt:b()};await y(i,o);const d=h(g(p,"multiplayer_rooms",i.id,"players"),this.userId);await y(d,n),this.currentRoomId=i.id,this.listenToRoom(i.id),this.listenToPlayers(i.id),this.listenToMessages(i.id);const c={id:i.id,code:l,name:o.name,hostId:this.userId,players:[n],maxPlayers:o.maxPlayers,isPrivate:o.isPrivate,password:o.password||void 0,status:"waiting",quizId:(null==s?void 0:s.id)||void 0,quiz:o.quiz||void 0,settings:o.settings,createdAt:new Date};return this.emit("room:created",c),{room:c,player:n}}catch(l){throw l}}async joinRoom(e,s){var t;try{const r=j(g(p,"multiplayer_rooms"),v("code","==",e),f(1)),a=await w(r);if(a.empty)throw new Error("room_not_found");const l=a.docs[0],i=l.data();if(i.isPrivate&&!s)throw new Error("room_requires_password");if(i.isPrivate&&i.password!==s)throw new Error("wrong_password");if((await w(g(p,"multiplayer_rooms",l.id,"players"))).size>=i.maxPlayers)throw new Error("room_full");if("playing"===i.status&&!i.settings.allowLateJoin)throw new Error("game_in_progress");const n={id:this.userId,username:this.username,isReady:!1,isHost:!1,score:0,answers:[],joinedAt:new Date},o=h(g(p,"multiplayer_rooms",l.id,"players"),this.userId);await y(o,n),this.currentRoomId=l.id,this.listenToRoom(l.id),this.listenToPlayers(l.id),this.listenToMessages(l.id),await this.sendSystemMessage(l.id,`${this.username} joined the room`);const d={id:l.id,code:i.code,name:i.name,hostId:i.hostId,players:[n],maxPlayers:i.maxPlayers,isPrivate:i.isPrivate,password:i.password,status:i.status,quizId:i.quizId,quiz:i.quiz,settings:i.settings,createdAt:(null==(t=i.createdAt)?void 0:t.toDate())||new Date};return this.emit("room:joined",d),{room:d,player:n}}catch(r){throw r}}async leaveRoom(e){try{if(!this.userId)return;const s=h(p,"multiplayer_rooms",e,"players",this.userId);await N(s),await this.sendSystemMessage(e,`${this.username} left the room`),this.unsubscribeFunctions.forEach(e=>e()),this.unsubscribeFunctions=[],this.currentRoomId=null,this.emit("room:left",e)}catch(s){throw s}}async startGame(e){try{const s=h(p,"multiplayer_rooms",e),t=await k(s);if(!t.exists())throw new Error("Room not found");const r=t.data();let a=[];a=r.quiz&&r.quiz.questions&&r.quiz.questions.length>0?r.quiz.questions:[{id:"q1",title:"What is 2+2?",options:["3","4","5","6"],correct:1},{id:"q2",title:"Capital of Vietnam?",options:["Ho Chi Minh","Hanoi","Da Nang","Hue"],correct:1},{id:"q3",title:"JavaScript is a...?",options:["Language","Framework","Library","Database"],correct:0}];const l={currentQuestionIndex:0,questions:a,startTime:new Date};await C(s,{status:"playing",startedAt:b(),gameData:l}),this.emit("game:start",l)}catch(s){throw s}}async submitAnswer(e,s,t,r){try{const a=h(p,"multiplayer_rooms",e,"players",this.userId),l=await k(a);if(!l.exists())return;const i=l.data(),n={questionId:s,selectedAnswer:t,isCorrect:!1,timeSpent:r,points:0,timestamp:new Date},o=[...i.answers||[],n];await C(a,{answers:o}),this.emit("answer:submitted",{questionId:s,answer:t,timeSpent:r})}catch(a){throw a}}async sendChatMessage(e,s){try{const t={userId:this.userId,username:this.username,message:s.trim(),timestamp:b(),type:"user"};await S(g(p,"multiplayer_rooms",e,"messages"),t)}catch(t){throw t}}async sendSystemMessage(e,s){try{const t={userId:"system",username:"System",message:s,timestamp:b(),type:"system"};await S(g(p,"multiplayer_rooms",e,"messages"),t)}catch(t){}}async updatePlayerStatus(e,s){try{const t=h(p,"multiplayer_rooms",e,"players",this.userId);await C(t,{isReady:s}),this.emit("player:status_updated",{isReady:s})}catch(t){throw t}}async kickPlayer(e,s){try{const t=h(p,"multiplayer_rooms",e,"players",s);await N(t),this.emit("player:kicked",s)}catch(t){throw t}}async updateRoomSettings(e,s){try{const t=h(p,"multiplayer_rooms",e);await C(t,{[`settings.${Object.keys(s)[0]}`]:Object.values(s)[0]}),this.emit("room:settings_updated",s)}catch(t){throw t}}listenToRoom(e){const s=h(p,"multiplayer_rooms",e),t=I(s,e=>{var s,t,r;if(e.exists()){const a=e.data(),l={id:e.id,code:a.code,name:a.name,hostId:a.hostId,players:[],maxPlayers:a.maxPlayers,isPrivate:a.isPrivate,password:a.password,status:a.status,quizId:a.quizId,quiz:a.quiz,settings:a.settings,createdAt:(null==(s=a.createdAt)?void 0:s.toDate())||new Date,startedAt:null==(t=a.startedAt)?void 0:t.toDate(),finishedAt:null==(r=a.finishedAt)?void 0:r.toDate()};this.emit("room:updated",l),a.gameData&&this.emit("game:data_updated",a.gameData)}});this.unsubscribeFunctions.push(t)}listenToPlayers(e){const s=g(p,"multiplayer_rooms",e,"players"),t=j(s,z("joinedAt","asc")),r=I(t,e=>{const s=[];e.forEach(e=>{var t;const r=e.data();s.push({...r,joinedAt:(null==(t=r.joinedAt)?void 0:t.toDate())||new Date})}),this.emit("players:updated",s)});this.unsubscribeFunctions.push(r)}listenToMessages(e){const s=g(p,"multiplayer_rooms",e,"messages"),t=j(s,z("timestamp","asc")),r=I(t,e=>{const s=[];e.forEach(e=>{var t;const r=e.data();s.push({id:e.id,userId:r.userId,username:r.username,message:r.message,timestamp:(null==(t=r.timestamp)?void 0:t.toDate())||new Date,type:r.type})}),this.emit("messages:updated",s)});this.unsubscribeFunctions.push(r)}generateRoomCode(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let s="";for(let t=0;t<6;t++)s+=e.charAt(Math.floor(36*Math.random()));return s}}let te=null;const re=({selectedQuiz:e,currentUserId:s,currentUserName:t,onBackToQuizSelection:l,onQuizComplete:i})=>{var n;const{t:c}=r(),[m,x]=d.useState({currentState:"mode-selection",isConnecting:!1,isConnected:!1}),[u,h]=d.useState(null),[g,p]=d.useState([]),[b,y]=d.useState("disconnected"),[j,v]=d.useState(null);d.useEffect(()=>{const e=(te||(te=new se),te);h(e);return(async()=>{try{y("connecting"),await e.connect(s,t),y("connected"),x(e=>({...e,isConnected:!0})),e.on("room:update",f),e.on("game:start",w),e.on("game:next-question",N),e.on("game:finish",k),e.on("chat:message",C),e.on("connection:lost",S),e.on("connection:restored",I)}catch(r){y("error"),M.error(c("multiplayer.errors.connectionFailed"))}})(),()=>{e.disconnect()}},[s,t,c]);const f=d.useCallback(e=>{x(s=>({...s,roomData:e}));try{const s=(null==e?void 0:e.players)||[],t=s.length,r=s.filter(e=>e.isReady).length;t>=2&&r===t&&"lobby"===m.currentState?null===j&&v(5):null!==j&&v(null)}catch(s){}},[m.currentState,j]);d.useEffect(()=>{if(null===j)return;if(j<=0)return u&&m.roomId&&u.startGame(m.roomId).then(()=>{}).catch(e=>{M.error("Failed to start game")}),void v(null);const e=setTimeout(()=>{v(e=>null!==e?e-1:null)},1e3);return()=>clearTimeout(e)},[j,u,m.roomId]);const w=d.useCallback(e=>{x(s=>({...s,currentState:"game",gameData:e})),M.success(c("multiplayer.success.gameStarted"))},[c]),N=d.useCallback(e=>{x(s=>({...s,gameData:{...s.gameData,currentQuestion:e}}))},[]),k=d.useCallback(e=>{x(s=>({...s,currentState:"results",results:e})),i(e)},[i]),C=d.useCallback(e=>{p(s=>[...s,e])},[]),S=d.useCallback(()=>{y("disconnected"),M.warning(c("multiplayer.errors.connectionLost"))},[c]),I=d.useCallback(()=>{y("connected"),M.success(c("multiplayer.success.connectionRestored"))},[c]),z=e=>{x("create"===e?e=>({...e,currentState:"create-room"}):e=>({...e,currentState:"join-room"}))},R=()=>{x(e=>({...e,currentState:"mode-selection",roomId:void 0,roomData:void 0,gameData:void 0,results:void 0}))},P=(e,s)=>{x(t=>({...t,currentState:"lobby",roomId:e,roomData:s})),M.success(c("multiplayer.success.roomCreated"))},D=(e,s)=>{x(t=>({...t,currentState:"lobby",roomId:e,roomData:s})),M.success(c("multiplayer.success.joinedRoom"))},q=()=>{u&&m.roomId&&u.leaveRoom(m.roomId),x(e=>({...e,currentState:"mode-selection",roomId:void 0,roomData:void 0,gameData:void 0,results:void 0})),M.info(c("multiplayer.success.leftRoom"))},L=e=>{u&&m.roomId&&u.sendChatMessage(m.roomId,e).then(()=>{}).catch(e=>{})};return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:[a.jsx("div",{className:"bg-white/10 backdrop-blur-md border-b border-white/20 p-4",children:a.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("button",{onClick:l,className:"text-white hover:text-gray-200 transition-colors",children:["â† ",c("common.back")]}),a.jsx("h1",{className:"text-xl font-bold text-white",children:c("multiplayer.title")})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[(()=>{const e={disconnected:{icon:B,color:"text-red-500",text:c("multiplayer.errors.connectionLost")},connecting:{icon:J,color:"text-yellow-500",text:c("multiplayer.errors.reconnecting")},connected:{icon:J,color:"text-green-500",text:c("multiplayer.success.connectionRestored")},error:{icon:_,color:"text-red-500",text:c("multiplayer.errors.connectionFailed")}}[b],s=e.icon;return a.jsxs("div",{className:`flex items-center gap-2 ${e.color} text-sm`,children:[a.jsx(s,{size:16}),a.jsx("span",{children:e.text})]})})(),m.roomData&&a.jsxs("div",{className:"flex items-center gap-2 text-white",children:[a.jsx(o,{size:16}),a.jsxs("span",{children:[(null==(n=m.roomData.players)?void 0:n.length)||0,"/",m.roomData.maxPlayers||10]})]})]})]})}),a.jsx("div",{className:"flex-1",children:(()=>{switch(m.currentState){case"mode-selection":return a.jsx(W,{isOpen:!0,onClose:l,onSelectSinglePlayer:l,onSelectMultiplayer:z,connectionStatus:b});case"create-room":return a.jsx(V,{isOpen:!0,onClose:R,onCreateRoom:e=>{},onRoomCreated:P,selectedQuiz:e,currentUserId:s,currentUserName:t,multiplayerService:u});case"join-room":return a.jsx(G,{isOpen:!0,onClose:R,onJoinRoom:(e,s)=>{},onRoomJoined:D,currentUserId:s,currentUserName:t,multiplayerService:u});case"lobby":return a.jsxs("div",{className:"flex h-screen",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx(Z,{roomData:m.roomData,currentUserId:s,onLeaveRoom:q,multiplayerService:u}),null!==j&&a.jsxs("div",{className:"m-4 p-3 bg-blue-50 border border-blue-200 rounded text-blue-700 inline-block",children:[c("common.start"),": ",j,"s"]})]}),a.jsx("div",{className:"w-80 border-l border-gray-200",children:a.jsx(Y,{messages:g,onSendMessage:L,currentUserId:s})})]});case"game":return a.jsxs("div",{className:"flex h-screen",children:[a.jsx("div",{className:"flex-1",children:a.jsx(K,{gameData:m.gameData,roomData:m.roomData,currentUserId:s,currentUserName:t,multiplayerService:u})}),a.jsx("div",{className:"w-80 border-l border-gray-200",children:a.jsx(Y,{messages:g,onSendMessage:L,currentUserId:s})})]});case"results":return a.jsx(X,{results:m.results,roomData:m.roomData,onPlayAgain:R,onBackToMenu:l});default:return null}})()})]})},ae=()=>{const e=R(),s=P(),t=e.state,{user:r}=D(e=>e.auth);return r?a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsx(re,{selectedQuiz:null==t?void 0:t.selectedQuiz,currentUserId:r.uid,currentUserName:r.displayName||r.email||"User",onBackToQuizSelection:()=>s("/quizzes"),onQuizComplete:()=>s("/leaderboard")})}):(s("/login"),null)};export{ae as default};

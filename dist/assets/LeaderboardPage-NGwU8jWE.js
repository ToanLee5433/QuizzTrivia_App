import{R as g,r as d,u as X,J as I,K as _,N as A,O as L,V as b,h as j,j as e,I as H,W as Q}from"./index-BSJrQLtH.js";var q={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},U=g.createContext&&g.createContext(q),k=["attr","size","title"];function G(t,a){if(t==null)return{};var s=J(t,a),r,c;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(c=0;c<i.length;c++)r=i[c],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function J(t,a){if(t==null)return{};var s={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(a.indexOf(r)>=0)continue;s[r]=t[r]}return s}function v(){return v=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},v.apply(this,arguments)}function $(t,a){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,r)}return s}function y(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?$(Object(s),!0).forEach(function(r){V(t,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$(Object(s)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(s,r))})}return t}function V(t,a,s){return a=Y(a),a in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}function Y(t){var a=Z(t,"string");return typeof a=="symbol"?a:a+""}function Z(t,a){if(typeof t!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var r=s.call(t,a);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function B(t){return t&&t.map((a,s)=>g.createElement(a.tag,y({key:s},a.attr),B(a.child)))}function D(t){return a=>g.createElement(ee,v({attr:y({},t.attr)},a),B(t.child))}function ee(t){var a=s=>{var{attr:r,size:c,title:i}=t,m=G(t,k),f=c||s.size||"1em",o;return s.className&&(o=s.className),t.className&&(o=(o?o+" ":"")+t.className),g.createElement("svg",v({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,r,m,{className:o,style:y(y({color:t.color||s.color},s.style),t.style),height:f,width:f,xmlns:"http://www.w3.org/2000/svg"}),i&&g.createElement("title",null,i),t.children)};return U!==void 0?g.createElement(U.Consumer,null,s=>a(s)):a(q)}function te(t){return D({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"},child:[]}]})(t)}function O(t){return D({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"},child:[]}]})(t)}const ae=()=>{const[t,a]=d.useState([]),[s,r]=d.useState([]),[c,i]=d.useState(!0),[m,f]=d.useState(null),{user:o}=X(l=>l.auth),[F,K]=d.useState("all"),[C,W]=d.useState(""),[N,M]=d.useState(!1),[w,R]=d.useState(!1);d.useEffect(()=>{i(!0);const l=I(_(b(j,"user_stats"),L("totalScore","desc"),A(100)),n=>{const x=[];n.forEach(h=>x.push(h.data())),a(x),i(!1)},()=>{i(!1)});return()=>l()},[]),d.useEffect(()=>{i(!0);const l=I(_(b(j,"quizzes"),L("attempts","desc"),A(100)),n=>{const x=[];n.forEach(h=>x.push({...h.data(),id:h.id})),r(x),i(!1)},()=>{i(!1)});return()=>l()},[]),d.useEffect(()=>{(async()=>{try{const n=await Q(b(j,"user_stats")),x=await Q(b(j,"quizzes"));let h=0,P=0,E=0,T=0,z=0;n.forEach(S=>{h++;const p=S.data();T+=p.totalScore||0,z+=p.totalAttempts||0}),x.forEach(S=>{P++;const p=S.data();E+=p.attempts||0}),f({totalUsers:h,totalQuizzes:P,totalAttempts:E,averageScore:z>0?Math.round(T/z*10)/10:0})}catch{f(null)}})()},[]);const u=t.filter(l=>{const n=C.toLowerCase();return l.displayName&&l.displayName.toLowerCase().includes(n)||l.userId&&l.userId.toLowerCase().includes(n)});return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 py-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-8 text-center",children:"Bảng Xếp Hạng"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Thời gian:"}),e.jsxs("select",{className:"border rounded p-2",value:F,onChange:l=>K(l.target.value),children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"week",children:"Tuần này"}),e.jsx("option",{value:"month",children:"Tháng này"})]})]}),e.jsx("input",{className:"border rounded p-2 w-full md:w-64",placeholder:"Tìm kiếm người chơi...",value:C,onChange:l=>W(l.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:m?m.totalUsers:"--"}),e.jsx("div",{className:"text-gray-600 text-sm",children:"Người chơi"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-700",children:m?m.totalQuizzes:"--"}),e.jsx("div",{className:"text-gray-600 text-sm",children:"Quiz"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-700",children:m?m.totalAttempts:"--"}),e.jsx("div",{className:"text-gray-600 text-sm",children:"Lượt chơi"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[m?m.averageScore:"--","%"]}),e.jsx("div",{className:"text-gray-600 text-sm",children:"Điểm TB"})]})]}),e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-center",children:"Top Người Chơi"}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:c?e.jsxs("div",{className:"flex gap-2",children:[Array.from({length:3}).map((l,n)=>e.jsx("div",{className:"animate-pulse bg-gray-100 rounded-full h-20 w-20 mx-auto"},n)),Array.from({length:7}).map((l,n)=>e.jsx("div",{className:"animate-pulse bg-gray-100 rounded-lg h-10 w-full mt-2"},n))]}):u.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"Không tìm thấy người chơi phù hợp."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center items-end gap-4 mb-8",children:u.slice(0,3).map((l,n)=>e.jsxs("div",{className:`flex flex-col items-center ${n===0?"z-10":"z-0"}`,style:{transform:n===0?"scale(1.15)":"scale(1)"},children:[e.jsxs("div",{className:`relative mb-2 ${n===0?"shadow-2xl":"shadow-lg"}`,style:{width:80,height:80},children:[e.jsx(O,{className:`w-full h-full ${n===0?"text-yellow-400":n===1?"text-gray-400":"text-orange-400"}`}),e.jsx(te,{className:`absolute -top-4 left-1/2 -translate-x-1/2 text-3xl ${n===0?"text-yellow-400":n===1?"text-gray-400":"text-orange-400"}`})]}),e.jsx("div",{className:`font-bold text-lg ${n===0?"text-yellow-600":n===1?"text-gray-600":"text-orange-600"}`,children:l.displayName||l.userId}),e.jsxs("div",{className:"text-sm text-gray-500",children:[l.totalScore," điểm"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[l.totalAttempts," lần chơi"]}),e.jsxs("div",{className:"mt-1 font-bold text-xl",children:["#",n+1]})]},l.userId))}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("ol",{className:"divide-y divide-gray-100",children:(N?u.slice(3):u.slice(3,10)).map((l,n)=>e.jsxs("li",{className:"flex items-center gap-3 py-2",children:[e.jsxs("span",{className:"font-bold text-blue-600",children:["#",n+4]}),e.jsx(O,{className:"w-8 h-8 text-blue-300"}),e.jsx("span",{className:"font-semibold truncate max-w-[120px]",children:l.displayName||l.userId}),e.jsxs("span",{className:"ml-auto text-gray-500 font-medium",children:[l.totalScore," điểm"]}),e.jsxs("span",{className:"ml-4 text-xs text-gray-400",children:[l.totalAttempts," lần chơi"]})]},l.userId))}),u.length>10&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>M(!N),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:N?`Thu gọn (hiển thị ${u.length} người)`:`Xem thêm ${u.length-10} người`})})]}),o&&u.findIndex(l=>l.userId===o.uid)===-1&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg flex items-center gap-3",children:[e.jsx("span",{className:"font-bold text-blue-700",children:"--"}),e.jsx(O,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"font-semibold truncate max-w-[120px]",children:o.displayName||o.email||o.uid}),e.jsx("span",{className:"ml-auto text-gray-500 font-medium",children:"(Không nằm trong top 10)"})]})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-center flex-1",children:"Top Quiz Được Chơi Nhiều"}),s.length>10&&e.jsx("button",{onClick:()=>R(!w),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:w?"Thu gọn":`Xem tất cả (${s.length})`})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c?Array.from({length:6}).map((l,n)=>e.jsx("div",{className:"animate-pulse bg-white rounded-xl shadow-lg h-24"},n)):s.length===0?e.jsx("div",{className:"text-center text-gray-500 col-span-full",children:"Chưa có dữ liệu quiz."}):(w?s:s.slice(0,12)).map(l=>e.jsx(H,{quiz:l},l.id))})]})]})})};export{ae as default};

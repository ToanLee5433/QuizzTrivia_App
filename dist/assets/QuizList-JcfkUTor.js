import{j as e,a as s,e as l,k as t,u as r,r as a,Q as i,f as n,M as d,y as c}from"./index-BslwS0KI.js";const o=({quizzes:s})=>{const l=s.length,t=s.filter(e=>e.isCompleted).length,r=s.reduce((e,s)=>e+s.questions.length,0),a=l>0?Math.round(r/l):0,i={easy:s.filter(e=>"easy"===e.difficulty).length,medium:s.filter(e=>"medium"===e.difficulty).length,hard:s.filter(e=>"hard"===e.difficulty).length},n=s.reduce((e,s)=>(e[s.category]=(e[s.category]||0)+1,e),{}),d=Object.entries(n).sort(([,e],[,s])=>s-e).slice(0,5),c=s.reduce((e,s)=>e+(s.totalPlayers||0),0),o=s.filter(e=>e.averageScore).reduce((e,s)=>e+(s.averageScore||0),0)/s.filter(e=>e.averageScore).length||0,h=l>0?Math.round(t/l*100):0;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Tổng Quiz"}),e.jsx("p",{className:"text-3xl font-bold",children:l})]}),e.jsx("div",{className:"p-3 bg-white/20 rounded-lg",children:e.jsx("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsx("div",{className:"mt-4 flex items-center text-blue-100 text-sm",children:e.jsxs("span",{children:[a," câu hỏi trung bình"]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Đã hoàn thành"}),e.jsx("p",{className:"text-3xl font-bold",children:t})]}),e.jsx("div",{className:"p-3 bg-white/20 rounded-lg",children:e.jsx("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-green-100 text-sm mb-1",children:[e.jsx("span",{children:"Tiến độ"}),e.jsxs("span",{children:[h,"%"]})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-2",children:e.jsx("div",{className:"bg-white rounded-full h-2 transition-all duration-300",style:{width:`${h}%`}})})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm font-medium",children:"Lượt chơi"}),e.jsx("p",{className:"text-3xl font-bold",children:c.toLocaleString()})]}),e.jsx("div",{className:"p-3 bg-white/20 rounded-lg",children:e.jsx("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})})})]}),e.jsx("div",{className:"mt-4 flex items-center text-purple-100 text-sm",children:e.jsxs("span",{children:[l>0?Math.round(c/l):0," trung bình/quiz"]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-100 text-sm font-medium",children:"Điểm TB"}),e.jsxs("p",{className:"text-3xl font-bold",children:[Math.round(o),"%"]})]}),e.jsx("div",{className:"p-3 bg-white/20 rounded-lg",children:e.jsx("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})})]}),e.jsx("div",{className:"mt-4 flex items-center text-orange-100 text-sm",children:e.jsx("span",{children:"Chất lượng tốt"})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 md:col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Phân bố độ khó"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Dễ"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium",children:i.easy}),e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:(l>0?i.easy/l*100:0)+"%"}})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Trung bình"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium",children:i.medium}),e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full",style:{width:(l>0?i.medium/l*100:0)+"%"}})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-red-500 rounded"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Khó"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium",children:i.hard}),e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:(l>0?i.hard/l*100:0)+"%"}})})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 md:col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Danh mục phổ biến"}),e.jsxs("div",{className:"space-y-3",children:[d.map(([s,t],r)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 bg-blue-100 text-blue-600 rounded-full text-xs font-medium",children:r+1}),e.jsx("span",{className:"text-sm text-gray-900 font-medium",children:s})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[t," quiz"]}),e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:(l>0?t/l*100:0)+"%"}})})]})]},s)),0===d.length&&e.jsx("div",{className:"text-center text-gray-500 py-4",children:"Chưa có dữ liệu danh mục"})]})]})]})},h=({quizzes:h,title:x})=>{const{t:m}=s(),u=l(),g=t(),j=h||r(e=>e.quiz.quizzes),b=r(e=>e.quiz.loading||e.quiz.isLoading),v=r(e=>e.quiz.error),p=r(e=>e.auth.user),f=v&&(v.includes("ad blocker")||v.includes("ERR_BLOCKED_BY_CLIENT")||v.includes("Không thể kết nối Firestore")),[N,y]=a.useState(0);a.useEffect(()=>{(async()=>{if(!h&&0===j.length&&!b)try{await u(n({user:p})).unwrap()}catch(e){if(e instanceof Error&&e.code,N<3){const e=Math.min(1e3*Math.pow(2,N),1e4);c.info("Đang thử kết nối lại..."),setTimeout(()=>{y(e=>e+1)},e)}else c.error(m("messages.serverError","Không thể kết nối đến server. Vui lòng thử lại sau."))}})()},[u,h,j.length,p,b,N]);const[w,k]=a.useState(""),[z,C]=a.useState("all"),[M,T]=a.useState("all"),[q,L]=a.useState("newest"),[B,S]=a.useState("grid"),[H,K]=a.useState(!0),[A,D]=a.useState(!1),P=Array.from(new Set(j.map(e=>e.category))),E=Array.from(new Set(j.map(e=>e.difficulty)));let R=j.filter(e=>"approved"===e.status&&("all"===z||e.category===z)&&("all"===M||e.difficulty===M)&&(H||!e.isCompleted)&&e.title.toLowerCase().includes(w.toLowerCase()));R=R.sort((e,s)=>{switch(q){case"newest":return new Date(s.createdAt||0).getTime()-new Date(e.createdAt||0).getTime();case"oldest":return new Date(e.createdAt||0).getTime()-new Date(s.createdAt||0).getTime();case"popular":return(s.totalPlayers||0)-(e.totalPlayers||0);case"difficulty":const l={easy:1,medium:2,hard:3};return(l[e.difficulty]||2)-(l[s.difficulty]||2);default:return 0}});const V=()=>{y(0),u(n({user:p}))};return v?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 text-xl mb-4",children:v}),e.jsx("button",{onClick:V,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:"Thử lại"})]})})}):b?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4",children:e.jsxs("div",{className:"flex justify-center items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Đang tải dữ liệu..."})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:x||"Khám phá Quiz"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Tìm hiểu kiến thức mới qua các quiz thú vị"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>D(!A),className:"flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors "+(A?"bg-blue-50 border-blue-200 text-blue-700":"border-gray-300 text-gray-600 hover:bg-gray-50"),children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"})}),A?"Ẩn thống kê":"Hiện thống kê"]}),("creator"===(null==p?void 0:p.role)||"admin"===(null==p?void 0:p.role))&&e.jsxs("button",{onClick:()=>g("/creator"),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Tạo Quiz mới"]})]})]})}),A&&j.length>0&&e.jsx(o,{quizzes:j}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsx("div",{className:"lg:col-span-2 relative",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:m("quiz.searchPlaceholder","🔍 Tìm kiếm quiz, danh mục, tags..."),value:w,onChange:e=>k(e.target.value),className:"w-full border border-gray-300 rounded-lg p-3 pl-10 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),w&&e.jsx("button",{onClick:()=>k(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 hover:text-gray-600",children:e.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("select",{className:"border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:z,onChange:e=>C(e.target.value),children:[e.jsx("option",{value:"all",children:"🏷️ Tất cả danh mục"}),P.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{className:"border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:M,onChange:e=>T(e.target.value),children:[e.jsx("option",{value:"all",children:"📊 Tất cả độ khó"}),E.map(s=>e.jsx("option",{value:s,children:"easy"===s?"😊 Dễ":"medium"===s?"😐 Trung bình":"😤 Khó"},s))]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{className:"border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:q,onChange:e=>L(e.target.value),children:[e.jsx("option",{value:"newest",children:"🆕 Mới nhất"}),e.jsx("option",{value:"oldest",children:"📅 Cũ nhất"}),e.jsx("option",{value:"popular",children:"🔥 Phổ biến"}),e.jsx("option",{value:"difficulty",children:"📈 Theo độ khó"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:e=>K(e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),"Hiện quiz đã hoàn thành"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Hiển thị:"}),e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>S("grid"),className:"p-2 "+("grid"===B?"bg-blue-500 text-white":"bg-white text-gray-600 hover:bg-gray-50"),title:"Lưới",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsx("button",{onClick:()=>S("list"),className:"p-2 "+("list"===B?"bg-blue-500 text-white":"bg-white text-gray-600 hover:bg-gray-50"),title:"Danh sách",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})})})]})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Tìm thấy ",e.jsx("span",{className:"font-semibold text-blue-600",children:R.length})," quiz",w&&e.jsxs("span",{children:[' cho "',w,'"']}),"all"!==z&&e.jsxs("span",{children:[' trong danh mục "',z,'"']}),"all"!==M&&e.jsxs("span",{children:[' với độ khó "',M,'"']})]})]}),e.jsx("div",{className:"grid"===B?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6":"space-y-4",children:b?Array.from({length:8}).map((s,l)=>e.jsx(i,{},l)):f?e.jsxs("div",{className:"col-span-full bg-red-50 border border-red-200 rounded-xl p-8 text-center",children:[e.jsx("div",{className:"text-red-600 text-xl font-semibold mb-3",children:"🚫 Kết nối Firestore bị chặn"}),e.jsx("div",{className:"text-red-700 mb-6",children:v}),e.jsxs("div",{className:"text-sm text-gray-600 mb-6 max-w-md mx-auto",children:[e.jsx("div",{className:"mb-3",children:e.jsx("strong",{children:"Khắc phục:"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:"1. Tắt Ad Blocker cho localhost:5174"}),e.jsx("div",{children:"2. Thêm *.googleapis.com vào whitelist"}),e.jsx("div",{children:"3. Thử chế độ Incognito/Private"}),e.jsx("div",{children:"4. Kiểm tra Firewall/Antivirus"})]})]}),e.jsx("button",{className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",onClick:()=>u(n({user:p})),children:"🔄 Thử lại kết nối"})]}):v?e.jsx("div",{className:"col-span-full text-center",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-8",children:[e.jsx("div",{className:"text-red-600 text-lg font-medium mb-4",children:"❌ Có lỗi xảy ra"}),e.jsx("div",{className:"text-red-700 mb-6",children:v}),e.jsx("button",{className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>u(n({user:p})),children:"🔄 Thử lại"})]})}):0===R.length?e.jsx("div",{className:"col-span-full text-center",children:e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-12",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.75 17L9 21m6-4l.75 4M4 4v16c0 1.104.896 2 2 2h12a2 2 0 002-2V4M4 4l8 8m0 0l8-8"})}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"Không tìm thấy quiz"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Không có quiz nào phù hợp với bộ lọc hiện tại."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:()=>{k(""),C("all"),T("all")},className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"🔄 Xóa bộ lọc"}),("creator"===(null==p?void 0:p.role)||"admin"===(null==p?void 0:p.role))&&e.jsx("button",{className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",onClick:()=>g("/creator"),children:"➕ Tạo quiz mới"})]})]})}):R.map(s=>e.jsx(d,{quiz:s,viewMode:B},s.id))})]})})};export{h as default};

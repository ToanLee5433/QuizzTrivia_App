import{d as e,a as s,u as t,e as r,r as a,F as l,j as n,U as i,T as c,n as o,S as d,D as h,L as x,G as u,E as m,H as g,I as p,y as b,J as j,K as f,M as y}from"./index-9G1y_mGg.js";import{P as N}from"./pen-line-_XpPNirX.js";import{S as v}from"./search-DuMBi8uH.js";import{A as w,a as k}from"./arrow-up-CPnAPxLH.js";import{C as z}from"./calendar-DQ8V8GS6.js";import{R as S}from"./rotate-ccw-C97_obaa.js";
/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=e("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),q=e("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]),M=()=>{const{t:e}=s(),{user:M}=t(e=>e.auth),Q=t(e=>e.quiz.userResults),A=r(),[T,U]=a.useState([]),[L,H]=a.useState({}),[R,D]=a.useState(!0),[I,$]=a.useState(null),[E,P]=a.useState("overview"),[F,X]=a.useState((null==M?void 0:M.displayName)||""),[_,V]=a.useState(""),[B,K]=a.useState(""),[G,J]=a.useState(""),[O,W]=a.useState((null==M?void 0:M.photoURL)||""),[Y,Z]=a.useState(!1),[ee,se]=a.useState(10),[te,re]=a.useState(1),[ae,le]=a.useState(!1),[ne,ie]=a.useState("date"),[ce,oe]=a.useState("desc"),[de,he]=a.useState(""),[xe,ue]=a.useState("all");a.useEffect(()=>{M&&(D(!0),A(l(M.uid)))},[M,A]),a.useEffect(()=>{if(!M)return;Q.length>0?(async()=>{const e={};for(const t of Q)if(!e[t.quizId])try{const s=await u(t.quizId);e[t.quizId]=(null==s?void 0:s.title)||"Quiz không tên"}catch(s){e[t.quizId]="Quiz không tên"}H(e),U(Q)})():(U([]),H({})),Q.length>0&&Q.forEach((e,s)=>{});const e=Q.length,s=Q.map(e=>"number"==typeof e.correctAnswers&&"number"==typeof e.totalQuestions&&e.totalQuestions>0?Math.round(e.correctAnswers/e.totalQuestions*100):"number"!=typeof e.score||isNaN(e.score)?0:e.score<=1?Math.round(100*e.score):Math.round(e.score)),t=s.reduce((e,s)=>e+s,0),r=Q.reduce((e,s)=>e+(s.correctAnswers||0),0),a=Q.reduce((e,s)=>e+(s.totalQuestions||0),0),l=Q.reduce((e,s)=>e+(s.timeSpent||0),0),n=e>0?t/e:0,i=a>0?r/a*100:0,c=e>0?l/e:0,o=s.filter(e=>e>=100).length,d=s.filter(e=>e>=80).length;$({totalQuizzes:e,totalScore:t,averageScore:n,accuracy:i,averageTime:c,perfectScores:o,highScores:d,recentActivity:Q.slice(0,5)}),D(!1)},[Q,M]);const me=T.filter(e=>{if(de){return(L[e.quizId]||"Quiz không tên").toLowerCase().includes(de.toLowerCase())}return!0}).filter(e=>{const s=e.totalQuestions>0?e.correctAnswers/e.totalQuestions*100:0;switch(xe){case"high":return s>=80;case"medium":return s>=60&&s<80;case"low":return s<60;default:return!0}}).sort((e,s)=>{let t=0;switch(ne){case"date":t=new Date(e.completedAt).getTime()-new Date(s.completedAt).getTime();break;case"score":t=(e.score||0)-(s.score||0);break;case"percentage":t=(e.totalQuestions>0?e.correctAnswers/e.totalQuestions*100:0)-(s.totalQuestions>0?s.correctAnswers/s.totalQuestions*100:0);break}return"asc"===ce?t:-t}),ge=Math.ceil(me.length/ee),pe=(te-1)*ee,be=ae?me:me.slice(pe,pe+ee),je=(e,s,t,r,a="bg-blue-500")=>n.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:`p-3 rounded-full ${a}`,children:e}),n.jsxs("div",{children:[n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t}),n.jsx("p",{className:"text-sm text-gray-600",children:s}),r&&n.jsx("p",{className:"text-xs text-gray-500",children:r})]})]})})}),fe=e=>{let s=0,t="none";"number"==typeof e.correctAnswers&&"number"==typeof e.totalQuestions&&e.totalQuestions>0?(s=Math.round(e.correctAnswers/e.totalQuestions*100),t="answers_calculation"):"number"!=typeof e.score||isNaN(e.score)?(t="fallback_zero",s=0):(s=e.score<=1?Math.round(100*e.score):Math.round(e.score),t=e.score<=1?"score_decimal":"score_percentage");return n.jsx("div",{className:"bg-white rounded-lg border border-gray-100 p-4 hover:shadow-md transition-shadow",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:L[e.quizId]||"Quiz không tên"}),n.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[n.jsxs("span",{className:"flex items-center space-x-1",children:[n.jsx(h,{className:"w-4 h-4"}),n.jsxs("span",{children:[e.correctAnswers,"/",e.totalQuestions]})]}),n.jsxs("span",{className:"flex items-center space-x-1",children:[n.jsx(o,{className:"w-4 h-4"}),n.jsxs("span",{children:[Math.round((e.timeSpent||0)/60),"p"]})]}),n.jsxs("span",{className:"flex items-center space-x-1",children:[n.jsx(z,{className:"w-4 h-4"}),n.jsx("span",{children:new Date(e.completedAt).toLocaleDateString("vi-VN")})]})]})]}),n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsxs("div",{className:"px-3 py-1 rounded-full text-sm font-medium "+(r=s,r>=90?"text-green-600 bg-green-50":r>=70?"text-blue-600 bg-blue-50":r>=50?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50"),children:[s,"%"]}),n.jsx(x,{to:`/quiz/${e.quizId}/reviews`,className:"p-2 text-gray-400 hover:text-purple-600 transition-colors",title:"Xem lại quiz",children:n.jsx(S,{className:"w-4 h-4"})}),n.jsx(x,{to:`/quiz-result/${e.id}`,className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Xem kết quả chi tiết",children:n.jsx(m,{className:"w-4 h-4"})})]})]})},e.id);var r};return M?n.jsx("div",{className:"min-h-screen bg-gray-50",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[n.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8",children:n.jsxs("div",{className:"flex items-center space-x-6",children:[n.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:M.photoURL?n.jsx("img",{src:M.photoURL,alt:"Avatar",className:"w-full h-full rounded-full object-cover"}):n.jsx(i,{className:"w-10 h-10 text-white"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:M.displayName||M.email}),n.jsx("p",{className:"text-gray-600",children:M.email}),n.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Thành viên từ ",(new Date).toLocaleDateString("vi-VN")]})]}),n.jsx("button",{onClick:()=>P("settings"),className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",children:n.jsx(N,{className:"w-5 h-5"})})]})}),n.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 mb-8",children:n.jsx("div",{className:"flex space-x-8 px-6",children:[{id:"overview",label:"Tổng quan",icon:c},{id:"history",label:"Lịch sử Quiz",icon:o},{id:"achievements",label:"Thành tích",icon:q},{id:"settings",label:"Cài đặt",icon:i}].map(({id:e,label:s,icon:t})=>n.jsxs("button",{onClick:()=>P(e),className:"flex items-center space-x-2 py-4 border-b-2 transition-colors "+(E===e?"border-blue-500 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:[n.jsx(t,{className:"w-4 h-4"}),n.jsx("span",{children:s})]},e))})}),"overview"===E&&I&&n.jsxs("div",{children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[je(n.jsx(q,{className:"w-6 h-6 text-white"}),"Quiz đã hoàn thành",I.totalQuizzes,void 0,"bg-yellow-500"),je(n.jsx(d,{className:"w-6 h-6 text-white"}),"Điểm trung bình",I.averageScore.toFixed(1),"Trên tổng số quiz","bg-blue-500"),je(n.jsx(h,{className:"w-6 h-6 text-white"}),"Độ chính xác",`${I.accuracy.toFixed(1)}%`,"Tỷ lệ trả lời đúng","bg-green-500"),je(n.jsx(c,{className:"w-6 h-6 text-white"}),"Điểm cao",`${I.highScores}/${I.totalQuizzes}`,"Quiz đạt trên 80%","bg-purple-500")]}),n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Hoạt động gần đây"}),n.jsx("div",{className:"space-y-4",children:I.recentActivity.map(e=>fe(e))}),I.totalQuizzes>5&&n.jsx("div",{className:"mt-6 text-center",children:n.jsxs("button",{onClick:()=>P("history"),className:"text-blue-600 hover:text-blue-700 font-medium flex items-center space-x-1 mx-auto",children:[n.jsx("span",{children:"Xem tất cả lịch sử"}),n.jsx(C,{className:"w-4 h-4"})]})})]})]}),"history"===E&&n.jsxs("div",{children:[n.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6",children:n.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx(v,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),n.jsx("input",{type:"text",placeholder:"Tìm kiếm quiz...",value:de,onChange:e=>he(e.target.value),className:"pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),n.jsxs("select",{value:xe,onChange:e=>ue(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[n.jsx("option",{value:"all",children:"Tất cả điểm"}),n.jsx("option",{value:"high",children:"Cao (≥80%)"}),n.jsx("option",{value:"medium",children:"Trung bình (60-79%)"}),n.jsx("option",{value:"low",children:"Thấp (<60%)"})]})]}),n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("span",{className:"text-sm text-gray-600",children:"Sắp xếp:"}),n.jsxs("select",{value:ne,onChange:e=>ie(e.target.value),className:"px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:"date",children:"Ngày"}),n.jsx("option",{value:"score",children:"Điểm"}),n.jsx("option",{value:"percentage",children:"Phần trăm"})]}),n.jsx("button",{onClick:()=>oe("asc"===ce?"desc":"asc"),className:"p-1 text-gray-400 hover:text-gray-600",children:"asc"===ce?n.jsx(w,{className:"w-4 h-4"}):n.jsx(k,{className:"w-4 h-4"})})]}),n.jsxs("select",{value:ee,onChange:e=>se(Number(e.target.value)),className:"px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500",children:[n.jsx("option",{value:10,children:"10/trang"}),n.jsx("option",{value:25,children:"25/trang"}),n.jsx("option",{value:50,children:"50/trang"}),n.jsx("option",{value:100,children:"100/trang"})]}),me.length>ee&&n.jsx("button",{onClick:()=>le(!ae),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:ae?"Phân trang":`Xem tất cả (${me.length})`})]})]})}),n.jsx("div",{className:"space-y-4 mb-6",children:R?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-4 text-gray-600",children:"Đang tải..."})]}):be.length>0?be.map(e=>fe(e)):n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-8 text-center",children:[n.jsx(q,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Chưa có kết quả nào"}),n.jsx("p",{className:"text-gray-600 mb-4",children:"Bạn chưa hoàn thành quiz nào. Hãy bắt đầu làm quiz đầu tiên!"}),n.jsx(x,{to:"/quizzes",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Khám phá Quiz"})]})}),!ae&&ge>1&&n.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("p",{className:"text-sm text-gray-600",children:["Hiển thị ",pe+1,"-",Math.min(pe+ee,me.length)," trong tổng ",me.length," kết quả"]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("button",{onClick:()=>re(Math.max(te-1,1)),disabled:1===te,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Trước"}),n.jsxs("span",{className:"px-3 py-1 text-sm text-gray-600",children:["Trang ",te,"/",ge]}),n.jsx("button",{onClick:()=>re(Math.min(te+1,ge)),disabled:te===ge,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Sau"})]})]})})]}),"achievements"===E&&n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Thành tích"}),n.jsxs("div",{className:"text-center py-8",children:[n.jsx(q,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Hệ thống thành tích"}),n.jsx("p",{className:"text-gray-600",children:"Tính năng đang được phát triển"})]})]}),"settings"===E&&n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Thông tin cá nhân"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tên hiển thị"}),n.jsx("input",{type:"text",value:F,onChange:e=>X(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL Avatar"}),n.jsx("input",{type:"url",value:O,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),n.jsx("button",{onClick:async()=>{if(M&&g.currentUser){Z(!0);try{await p(g.currentUser,{displayName:F,photoURL:O}),b.success(e("profile.profileUpdateSuccess"))}catch(s){b.error(e("profile.profileUpdateError"))}finally{Z(!1)}}},disabled:Y,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:Y?"Đang cập nhật...":"Cập nhật Profile"})]})]}),n.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Đổi mật khẩu"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mật khẩu hiện tại"}),n.jsx("input",{type:"password",value:_,onChange:e=>V(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nhập mật khẩu hiện tại để xác thực"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mật khẩu mới"}),n.jsx("input",{type:"password",value:B,onChange:e=>K(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(B&&B.length<6?"border-red-300":"border-gray-300"),placeholder:"Nhập mật khẩu mới (tối thiểu 6 ký tự)"}),B&&B.length<6&&n.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Mật khẩu phải có ít nhất 6 ký tự"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Xác nhận mật khẩu mới"}),n.jsx("input",{type:"password",value:G,onChange:e=>J(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(G&&B!==G?"border-red-300":"border-gray-300"),placeholder:"Nhập lại mật khẩu mới để xác nhận"}),G&&B!==G&&n.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Mật khẩu xác nhận không khớp"})]}),n.jsx("button",{onClick:async()=>{if(g.currentUser&&_&&B&&G)if(B===G)if(B.length<6)b.error(e("profile.passwordTooShort"));else if(B!==_)if(g.currentUser.email){Z(!0);try{const s=j.credential(g.currentUser.email,_);await f(g.currentUser,s),await y(g.currentUser,B),V(""),K(""),J(""),b.success(e("profile.passwordChangeSuccess"))}catch(s){"auth/wrong-password"===s.code||"auth/invalid-credential"===s.code?b.error(e("profile.wrongPassword")):"auth/weak-password"===s.code?b.error(e("profile.weakPassword")):"auth/requires-recent-login"===s.code?b.error(e("profile.requiresRecentLogin")):b.error(e("profile.passwordChangeError",{message:s.message}))}finally{Z(!1)}}else b.error(e("profile.emailNotFound"));else b.error(e("profile.passwordMustDiffer"));else b.error(e("profile.passwordMismatch"));else b.error(e("profile.fillAllFields"))},disabled:Y||!_||!B||!G||B.length<6||B!==G||B===_,className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors",children:Y?"Đang xác thực...":"Đổi mật khẩu"}),n.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[n.jsx("p",{children:"⚠️ Bạn cần nhập đúng mật khẩu hiện tại để xác thực trước khi đổi mật khẩu mới"}),n.jsx("p",{children:"✓ Mật khẩu mới phải có ít nhất 6 ký tự"}),n.jsx("p",{children:"✓ Mật khẩu mới phải khác mật khẩu hiện tại"})]})]})]})]})]})}):n.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:n.jsx("div",{className:"text-center",children:n.jsx("p",{className:"text-gray-600",children:e("profile.loginRequired")})})})};export{M as default};

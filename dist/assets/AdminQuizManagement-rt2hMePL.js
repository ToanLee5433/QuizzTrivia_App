import{u as e,k as s,a as t,r as a,q as i,l as r,h as n,t as d,m as l,y as c,w as o,j as m,U as x,n as u,E as h,g,p,v as j,o as b,s as y}from"./index-BcvsJ6SD.js";import{B as f}from"./book-open-Cm84JLOK.js";import{R as w}from"./rotate-ccw-CpLcfvpT.js";import{C as N}from"./chart-column-B5QpRKzR.js";import{C as v}from"./check-B4Hge1vH.js";import{X as q}from"./x-Dr67ee2A.js";import{C as z}from"./circle-alert-Ca5QarVZ.js";import{S as C}from"./search-DpGcZwSd.js";import{P as A}from"./pen-line-DWE6WjnP.js";import{T as k}from"./trash-2-DSFyVg_H.js";const D=()=>{const{user:D}=e(e=>e.auth),R=s(),{t:M}=t(),[B,T]=a.useState([]),[P,S]=a.useState([]),[E,Q]=a.useState(!0),[K,L]=a.useState(null),[I,Y]=a.useState("all"),[$,_]=a.useState("quizzes"),[F,U]=a.useState(!1),[V,G]=a.useState(null),[H,J]=a.useState(""),O=e=>{if(!e)return new Date;if(e&&"function"==typeof e.toDate)return e.toDate();if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e){const s=new Date(e);return isNaN(s.getTime())?new Date:s}return e&&"object"==typeof e&&e.seconds?new Date(1e3*e.seconds):new Date};a.useEffect(()=>{W(),X()},[]);const W=async()=>{try{Q(!0),L(null);const e=i(r(n,"quizzes"),d("createdAt","desc")),s=await l(e),t=[];s.forEach(e=>{const s=e.data();try{t.push({id:e.id,title:s.title||"Untitled Quiz",description:s.description||"",status:s.status||"pending",createdBy:s.createdBy||"unknown",createdAt:O(s.createdAt),questions:s.questions||[],difficulty:s.difficulty||"easy",category:s.category||"general",isPublic:s.isPublic||!1,isPublished:s.isPublished||!1})}catch(a){}}),T(t),0===t.length&&c.info("Chưa có quiz nào trong hệ thống")}catch(e){L("Không thể tải danh sách quiz"),c.error("Không thể tải danh sách quiz: "+e)}finally{Q(!1)}},X=async()=>{try{const e=i(r(n,"editRequests"),o("status","==","pending")),s=await l(e),t=[];s.forEach(e=>{const s=e.data();t.push({id:e.id,...s,requestedAt:O(s.requestedAt)})}),t.sort((e,s)=>{const t=e.requestedAt?new Date(e.requestedAt).getTime():0;return(s.requestedAt?new Date(s.requestedAt).getTime():0)-t}),S(t)}catch(e){try{const e=i(r(n,"editRequests")),s=await l(e),t=[];s.forEach(e=>{const s=e.data();"pending"===s.status&&t.push({id:e.id,...s,requestedAt:O(s.requestedAt)})}),t.sort((e,s)=>{const t=e.requestedAt?new Date(e.requestedAt).getTime():0;return(s.requestedAt?new Date(s.requestedAt).getTime():0)-t}),S(t)}catch(s){S([])}}},Z=B.filter(e=>{const s="all"===I||e.status===I,t=e.title.toLowerCase().includes(H.toLowerCase())||e.description.toLowerCase().includes(H.toLowerCase());return s&&t}),ee={all:B.length,pending:B.filter(e=>"pending"===e.status).length,approved:B.filter(e=>"approved"===e.status).length,rejected:B.filter(e=>"rejected"===e.status).length},se=e=>{switch(e){case"approved":return m.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium",children:"✅ Đã duyệt"});case"rejected":return m.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium",children:"❌ Từ chối"});default:return m.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium",children:"⏳ Chờ duyệt"})}},te=e=>{switch(e){case"easy":return m.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs",children:"🟢 Dễ"});case"hard":return m.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs",children:"🔴 Khó"});default:return m.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs",children:"🟡 Trung bình"})}};return D&&"admin"===D.role?E?m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),m.jsx("p",{className:"mt-4 text-gray-600",children:M("loadingData","Loading data...")})]})}):K?m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsxs("div",{className:"text-center",children:[m.jsxs("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:["❌ ",M("error","Error")]}),m.jsx("p",{className:"text-gray-600 mb-4",children:K}),m.jsx("button",{onClick:W,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:M("tryAgain","Try again")})]})}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-blue-50",children:m.jsx("div",{className:"bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-800 shadow-xl",children:m.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8",children:m.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center space-x-4",children:[m.jsx("div",{className:"w-12 h-12 lg:w-14 lg:h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center ring-2 ring-white/30 shadow-lg",children:m.jsx(f,{className:"w-6 h-6 lg:w-7 lg:h-7 text-white drop-shadow-sm"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-white drop-shadow-sm",children:M("admin.quizManagement","Quiz Management")}),m.jsx("p",{className:"text-blue-100 text-sm lg:text-base mt-1",children:M("admin.quizManagement.description","Review and manage all quizzes in the system")})]})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 lg:gap-4",children:[m.jsxs("button",{onClick:()=>{W(),X()},className:"w-full sm:w-auto px-4 py-2.5 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-xl transition-all duration-200 flex items-center justify-center gap-2 border border-white/20 hover:border-white/40 shadow-lg hover:shadow-xl",title:"Làm mới danh sách",children:[m.jsx(w,{className:"w-4 h-4"}),m.jsx("span",{className:"font-medium",children:M("refresh","Refresh")})]}),m.jsx("div",{className:"flex items-center space-x-3 bg-white/10 backdrop-blur-sm rounded-xl px-4 py-2.5 border border-white/20 shadow-lg",children:m.jsx(x,{className:"w-4 h-4 text-white"})}),m.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3",children:[m.jsx("span",{className:"text-white text-sm font-medium truncate max-w-32 lg:max-w-none",children:null==D?void 0:D.email}),m.jsx("span",{className:"px-2 py-1 bg-gradient-to-r from-yellow-400 to-yellow-500 text-yellow-900 rounded-full text-xs font-bold shadow-sm",children:M("admin.quizManagement.adminBadge","Admin")})]})]})]})})})}),m.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[m.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600",children:M("admin.quizManagement.cards.totalQuizzes","Total Quizzes")}),m.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ee.all})]}),m.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:m.jsx(N,{className:"w-6 h-6 text-blue-600"})})]})}),m.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600",children:M("status.pending","Pending")}),m.jsx("p",{className:"text-2xl font-bold text-orange-600",children:ee.pending})]}),m.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:m.jsx(u,{className:"w-6 h-6 text-orange-600"})})]})}),m.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600",children:M("status.approved","Approved")}),m.jsx("p",{className:"text-2xl font-bold text-green-600",children:ee.approved})]}),m.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:m.jsx(v,{className:"w-6 h-6 text-green-600"})})]})}),m.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600",children:M("status.rejected","Rejected")}),m.jsx("p",{className:"text-2xl font-bold text-red-600",children:ee.rejected})]}),m.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:m.jsx(q,{className:"w-6 h-6 text-red-600"})})]})})]}),m.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 mb-8",children:m.jsxs("div",{className:"flex border-b border-gray-200",children:[m.jsx("button",{onClick:()=>_("quizzes"),className:"px-6 py-4 text-sm font-medium border-b-2 transition-colors "+("quizzes"===$?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(f,{className:"w-4 h-4"}),M("admin.quizManagement.tab.quizzes","Manage Quizzes"),m.jsx("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs",children:B.length})]})}),m.jsx("button",{onClick:()=>_("editRequests"),className:"px-6 py-4 text-sm font-medium border-b-2 transition-colors "+("editRequests"===$?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(z,{className:"w-4 h-4"}),M("admin.quizManagement.tab.editRequests","Edit requests"),m.jsx("span",{className:"bg-orange-100 text-orange-600 px-2 py-1 rounded-full text-xs",children:P.length})]})})]})}),"quizzes"===$&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8",children:m.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"relative",children:[m.jsx(C,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),m.jsx("input",{type:"text",placeholder:M("admin.quizManagement.searchPlaceholder","Search quizzes by title, description..."),value:H,onChange:e=>J(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),m.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[m.jsx("button",{onClick:()=>Y("all"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("all"===I?"bg-blue-600 text-white shadow-sm":"text-gray-700 hover:text-gray-900"),children:M("common.all","All")}),m.jsx("button",{onClick:()=>Y("pending"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("pending"===I?"bg-orange-600 text-white shadow-sm":"text-gray-700 hover:text-gray-900"),children:M("status.pending","Pending")}),m.jsx("button",{onClick:()=>Y("approved"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("approved"===I?"bg-green-600 text-white shadow-sm":"text-gray-700 hover:text-gray-900"),children:M("status.approved","Approved")}),m.jsx("button",{onClick:()=>Y("rejected"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("rejected"===I?"bg-red-600 text-white shadow-sm":"text-gray-700 hover:text-gray-900"),children:M("status.rejected","Rejected")})]})]})}),0===Z.length?m.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center",children:[m.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:m.jsx(f,{className:"w-10 h-10 text-gray-400"})}),m.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:H?M("admin.quizManagement.empty.noMatchTitle","No matching quizzes found"):M("admin.quizManagement.empty.noQuizzesTitle","No quizzes yet")}),m.jsx("p",{className:"text-gray-600 mb-8 max-w-md mx-auto",children:H?M("admin.quizManagement.empty.noMatchDesc","Try changing the search keyword or filters to see more quizzes."):M("admin.quizManagement.empty.noQuizzesDesc","There are currently no quizzes in the system. Creators can create quizzes from the Creator page.")}),!H&&m.jsx("div",{className:"flex justify-center",children:m.jsxs("button",{onClick:()=>window.open("/creator","_blank"),className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[m.jsx(f,{className:"w-5 h-5"}),M("admin.quizManagement.empty.goToCreator","Go to Creator")]})})]}):m.jsx("div",{className:"grid gap-6",children:Z.map(e=>m.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow",children:m.jsxs("div",{className:"flex items-start justify-between",children:[m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("h3",{className:"text-xl font-bold text-gray-900",children:e.title}),se(e.status),te(e.difficulty)]}),m.jsx("p",{className:"text-gray-600 mb-4 line-clamp-2",children:e.description}),m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[m.jsxs("div",{children:[m.jsxs("span",{className:"font-medium",children:[M("admin.quizManagement.table.category","Category"),":"]})," ",e.category]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-medium",children:[M("quiz.questions","Questions"),":"]})," ",e.questions.length]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-medium",children:[M("admin.quizManagement.table.createdAt","Created at"),":"]})," ",e.createdAt.toLocaleDateString()]})]})]}),m.jsxs("div",{className:"flex items-center gap-2 ml-6",children:[m.jsx("button",{onClick:()=>(e=>{G(e),U(!0)})(e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:M("admin.quizManagement.tooltips.preview","Preview details"),children:m.jsx(h,{className:"w-5 h-5"})}),m.jsx("button",{onClick:()=>{return s=e.id,void R(`/admin/edit-quiz/${s}`);var s},className:"p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:M("admin.quizManagement.tooltips.edit","Edit quiz"),children:m.jsx(A,{className:"w-5 h-5"})}),"pending"===e.status&&m.jsxs(m.Fragment,{children:[m.jsx("button",{onClick:()=>(async e=>{try{const s=g(n,"quizzes",e);await p(s,{status:"approved",isPublished:!0,approvedAt:new Date,approvedBy:null==D?void 0:D.uid}),T(s=>s.map(s=>s.id===e?{...s,status:"approved",isPublished:!0}:s)),c.success("Đã phê duyệt quiz thành công!")}catch(s){c.error("Không thể duyệt quiz")}})(e.id),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:M("admin.quizManagement.tooltips.approve","Approve quiz"),children:m.jsx(v,{className:"w-5 h-5"})}),m.jsx("button",{onClick:()=>(async e=>{try{const s=g(n,"quizzes",e);await p(s,{status:"rejected",isPublished:!1,rejectedAt:new Date,rejectedBy:null==D?void 0:D.uid}),T(s=>s.map(s=>s.id===e?{...s,status:"rejected",isPublished:!1}:s)),c.success("Đã từ chối quiz!")}catch(s){c.error("Không thể từ chối quiz")}})(e.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:M("admin.quizManagement.tooltips.reject","Reject quiz"),children:m.jsx(q,{className:"w-5 h-5"})})]}),("approved"===e.status||"rejected"===e.status)&&m.jsx("button",{onClick:()=>(async e=>{try{const s=g(n,"quizzes",e);await p(s,{status:"pending",isPublished:!1,reopenedAt:new Date,reopenedBy:null==D?void 0:D.uid}),T(s=>s.map(s=>s.id===e?{...s,status:"pending",isPublished:!1}:s)),c.success("Đã mở lại quiz để xem xét!")}catch(s){c.error("Không thể mở lại quiz")}})(e.id),className:"p-2 text-orange-600 hover:bg-orange-50 rounded-lg transition-colors",title:M("admin.quizManagement.tooltips.reopen","Reopen for review"),children:m.jsx(w,{className:"w-5 h-5"})}),m.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Bạn có chắc chắn muốn xóa quiz này không?"))try{await j(g(n,"quizzes",e)),T(s=>s.filter(s=>s.id!==e)),c.success("Quiz đã được xóa khỏi database")}catch(s){c.error("Không thể xóa quiz: "+s)}})(e.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:M("admin.quizManagement.tooltips.delete","Permanently delete quiz"),children:m.jsx(k,{className:"w-5 h-5"})})]})]})},e.id))})]}),"editRequests"===$&&m.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[m.jsx("div",{className:"flex justify-between items-center mb-6",children:m.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[m.jsx(z,{className:"w-5 h-5 text-orange-500"}),"Yêu cầu chỉnh sửa Quiz (",P.length,")"]})}),0===P.length?m.jsxs("div",{className:"text-center py-12",children:[m.jsx(z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-500 mb-4",children:M("admin.editRequests.emptyTitle")}),m.jsx("p",{className:"text-sm text-gray-400",children:M("admin.editRequests.emptyDesc")})]}):m.jsx("div",{className:"space-y-4",children:P.map(e=>{var s;return m.jsx("div",{className:"border border-gray-200 rounded-lg p-6 bg-white shadow-sm",children:m.jsxs("div",{className:"flex items-start justify-between",children:[m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:m.jsx(x,{className:"w-5 h-5 text-blue-600"})}),m.jsxs("div",{children:[m.jsx("h4",{className:"font-semibold text-gray-900",children:e.requestedByName||e.requestedByEmail||"Người dùng không xác định"}),m.jsx("p",{className:"text-sm text-gray-500",children:e.requestedByEmail||e.requestedBy||"Email không xác định"})]})]}),m.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-3",children:[m.jsxs("h5",{className:"font-medium text-gray-900 mb-2",children:["📝 Quiz: ",e.quizTitle||"Tên quiz không xác định"]}),m.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[m.jsx("strong",{children:"Lý do yêu cầu:"})," ",e.reason||"Không có lý do cụ thể"]}),e.description&&m.jsxs("p",{className:"text-sm text-gray-600",children:[m.jsx("strong",{children:"Chi tiết:"})," ",e.description]})]}),m.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[m.jsxs("span",{className:"flex items-center gap-1",children:[m.jsx(u,{className:"w-4 h-4"}),(null==(s=e.requestedAt)?void 0:s.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}))||"Thời gian không xác định"]}),m.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium",children:M("admin.editRequests.pending")})]})]}),m.jsxs("div",{className:"flex gap-2 ml-6",children:[m.jsxs("button",{onClick:()=>(async(e,s)=>{try{const t=P.find(s=>s.id===e);if(!t)return void c.error("Không tìm thấy yêu cầu chỉnh sửa");const a=g(n,"editRequests",e);await p(a,{status:"approved",reviewedBy:null==D?void 0:D.uid,reviewedByName:(null==D?void 0:D.displayName)||"Admin",reviewedAt:new Date});const i=g(n,"quizzes",s);await p(i,{status:"draft",isApproved:!1,canEdit:!0,editRequestApproved:!0,lastEditRequestApproved:new Date,approvedBy:null==D?void 0:D.uid,needsReApproval:!0}),await b(r(n,"notifications"),{userId:t.requestedBy,type:"edit_request_approved",title:"Yêu cầu chỉnh sửa đã được phê duyệt",message:`Yêu cầu chỉnh sửa quiz "${t.quizTitle}" của bạn đã được admin phê duyệt. Quiz đã được gỡ xuống để bạn chỉnh sửa. Sau khi sửa xong, vui lòng nộp lại để admin duyệt.`,quizId:s,createdAt:y(),read:!1}),S(s=>s.filter(s=>s.id!==e)),c.success(`Đã phê duyệt yêu cầu chỉnh sửa của ${t.requestedByName||t.requestedByEmail}!`)}catch(t){c.error("Không thể phê duyệt yêu cầu chỉnh sửa")}})(e.id,e.quizId),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 shadow-sm",title:M("admin.editRequests.approveTitle"),children:[m.jsx(v,{className:"w-4 h-4"}),M("admin.editRequests.approve")]}),m.jsxs("button",{onClick:()=>(async e=>{try{const s=P.find(s=>s.id===e);if(!s)return void c.error("Không tìm thấy yêu cầu chỉnh sửa");const t=g(n,"editRequests",e);await p(t,{status:"rejected",reviewedBy:null==D?void 0:D.uid,reviewedByName:(null==D?void 0:D.displayName)||"Admin",reviewedAt:new Date}),await b(r(n,"notifications"),{userId:s.requestedBy,type:"edit_request_rejected",title:"Yêu cầu chỉnh sửa đã bị từ chối",message:`Yêu cầu chỉnh sửa quiz "${s.quizTitle}" của bạn đã bị admin từ chối. Vui lòng liên hệ admin để biết thêm chi tiết.`,quizId:s.quizId,createdAt:y(),read:!1}),S(s=>s.filter(s=>s.id!==e)),c.success(`Đã từ chối yêu cầu chỉnh sửa của ${s.requestedByName||s.requestedByEmail}!`)}catch(s){c.error("Không thể từ chối yêu cầu chỉnh sửa")}})(e.id),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2 shadow-sm",title:M("admin.editRequests.rejectTitle"),children:[m.jsx(q,{className:"w-4 h-4"}),M("admin.editRequests.reject")]})]})]})},e.id)})})]}),F&&V&&m.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:m.jsxs("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[m.jsx("div",{className:"p-6 border-b border-gray-200",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("h2",{className:"text-xl font-bold",children:[M("admin.preview.title","Preview Quiz"),": ",V.title]}),m.jsx("button",{onClick:()=>U(!1),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg",children:m.jsx(q,{className:"w-5 h-5"})})]})}),m.jsx("div",{className:"p-6",children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsxs("h3",{className:"font-semibold mb-2",children:[M("admin.preview.description","Description"),":"]}),m.jsx("p",{className:"text-gray-600",children:V.description})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[m.jsxs("div",{children:[m.jsxs("span",{className:"font-semibold",children:[M("admin.preview.category","Category"),":"]})," ",V.category]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-semibold",children:[M("admin.preview.difficulty","Difficulty"),":"]})," ",V.difficulty]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-semibold",children:[M("admin.preview.questions","Questions"),":"]})," ",V.questions.length]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-semibold",children:[M("admin.preview.status","Status"),":"]})," ",se(V.status||"pending")]})]}),V.questions.length>0&&m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold mb-4",children:M("admin.preview.questionList","Questions:")}),m.jsx("div",{className:"space-y-4",children:V.questions.map((e,s)=>m.jsxs("div",{className:"border rounded-lg p-4",children:[m.jsxs("h4",{className:"font-medium mb-2",children:[s+1,". ",e.text]}),e.answers&&m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:e.answers.map((e,s)=>m.jsxs("div",{className:"p-2 rounded "+(e.isCorrect?"bg-green-100 text-green-800":"bg-gray-100"),children:[String.fromCharCode(65+s),". ",e.text,e.isCorrect&&" ✓"]},s))})]},s))})]})]})})]})})]})]}):m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsxs("div",{className:"text-center",children:[m.jsxs("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:["⛔ ",M("errors.unauthorized","Unauthorized access")]}),m.jsx("p",{className:"text-gray-600",children:M("admin.loginAsAdmin","You need admin rights to access this page.")})]})})};export{D as default};

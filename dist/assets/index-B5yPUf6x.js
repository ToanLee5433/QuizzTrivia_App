const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BLDlbKWj.js","assets/index-YzN0UneP.css"])))=>i.map(i=>d[i]);
import{a as e,u as t,r as s,q as r,l as a,P as i,w as l,m as n,j as d,y as c,o,$ as m,k as x,_ as u,z as h,a0 as g,a1 as b}from"./index-BLDlbKWj.js";const p=({quizId:m,quizTitle:x="Quiz này",showSubmitForm:u=!0})=>{const{t:h}=e(),g=t(e=>e.auth.user),[b,p]=s.useState([]),[j,f]=s.useState(!0),[N,y]=s.useState(!1),[v,w]=s.useState(0),[z,q]=s.useState(""),[S,A]=s.useState(!1),C=s.useCallback(async()=>{try{f(!0);const e=r(a(i,"quizReviews"),l("quizId","==",m)),t=await n(e),s=[];if(t.forEach(e=>{var t;const r=e.data();s.push({id:e.id,...r,createdAt:(null==(t=r.createdAt)?void 0:t.toDate())||new Date})}),s.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()),p(s),g){const e=s.find(e=>e.userId===g.uid);A(!!e)}}catch(e){p([])}finally{f(!1)}},[m,g]);s.useEffect(()=>{C()},[C]);const k=({rating:e,onRatingChange:t,readonly:s=!1})=>d.jsx("div",{className:"flex space-x-1",children:[1,2,3,4,5].map(r=>d.jsx("button",{type:"button",disabled:s,onClick:()=>!s&&(null==t?void 0:t(r)),className:"text-2xl transition-all duration-200 "+(s?"cursor-default":"cursor-pointer hover:scale-110"),children:r<=e?"⭐":"☆"},r))}),I=b.length>0?b.reduce((e,t)=>e+t.rating,0)/b.length:0;return d.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[d.jsxs("div",{className:"flex items-center justify-between mb-6",children:[d.jsxs("h3",{className:"text-2xl font-bold text-gray-900",children:["💬 ",h("quiz.reviews.title")]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(k,{rating:Math.round(I),readonly:!0}),d.jsx("span",{className:"text-lg font-semibold text-gray-700",children:I.toFixed(1)}),d.jsxs("span",{className:"text-sm text-gray-500",children:["(",b.length," ",h("quiz.reviews.reviewsCount"),")"]})]})]}),u&&g&&!S&&d.jsxs("div",{className:"mb-8 p-6 bg-blue-50 rounded-xl border border-blue-200",children:[d.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:h("quiz.reviews.reviewQuiz",{quizTitle:x})}),d.jsxs("div",{className:"mb-4",children:[d.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[h("quiz.reviews.yourRating"),":"]}),d.jsx(k,{rating:v,onRatingChange:w})]}),d.jsxs("div",{className:"mb-4",children:[d.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[h("quiz.reviews.comment"),":"]}),d.jsx("textarea",{value:z,onChange:e=>q(e.target.value),placeholder:h("quiz.reviews.commentPlaceholder"),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4,maxLength:500}),d.jsxs("div",{className:"text-right text-sm text-gray-500 mt-1",children:[z.length,"/500"]})]}),d.jsx("button",{onClick:async()=>{if(g)if(0!==v)if(z.trim().length<10)c.error(h("quiz.reviews.commentTooShort"));else try{y(!0);const e={quizId:m,userId:g.uid,userName:g.displayName||g.email||"Người dùng ẩn danh",rating:v,comment:z.trim(),createdAt:new Date},t=await o(a(i,"quizReviews"),e);p(s=>[{...e,id:t.id},...s]),A(!0),w(0),q(""),c.success(h("quiz.reviews.submitSuccess"))}catch(e){c.error(h("quiz.reviews.submitError"))}finally{y(!1)}else c.error(h("quiz.reviews.ratingRequired"));else c.error(h("quiz.reviews.loginRequired"))},disabled:N||0===v,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:N?`⏳ ${h("quiz.reviews.submitting")}`:`📤 ${h("quiz.reviews.submitReview")}`})]}),S&&d.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:d.jsxs("p",{className:"text-green-800 font-medium",children:["✅ ",h("quiz.reviews.alreadyReviewed")]})}),d.jsx("div",{className:"space-y-4",children:j?d.jsx("div",{className:"flex justify-center py-8",children:d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===b.length?d.jsxs("div",{className:"text-center py-8 text-gray-500",children:[d.jsx("div",{className:"text-4xl mb-2",children:"💬"}),d.jsx("p",{children:h("quiz.reviews.noReviews")}),d.jsx("p",{className:"text-sm",children:h("quiz.reviews.beFirst")})]}):b.map(e=>d.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[d.jsxs("div",{className:"flex items-start justify-between mb-2",children:[d.jsxs("div",{children:[d.jsx("h5",{className:"font-semibold text-gray-900",children:e.userName}),d.jsx(k,{rating:e.rating,readonly:!0})]}),d.jsx("span",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleDateString("vi-VN")})]}),d.jsx("p",{className:"text-gray-700 leading-relaxed",children:e.comment})]},e.id))})]})},j=()=>d.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden",children:[...Array(50)].map((e,t)=>d.jsx("div",{className:"absolute animate-bounce",style:{left:100*Math.random()+"%",animationDelay:3*Math.random()+"s",animationDuration:2+3*Math.random()+"s"},children:d.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full",style:{backgroundColor:["#f59e0b","#10b981","#3b82f6","#8b5cf6","#ef4444"][Math.floor(5*Math.random())]}})},t))}),f=e=>{const t=Math.floor(e/3600),s=Math.floor(e%3600/60),r=e%60;return t>0?`${t}h ${s}m ${r}s`:s>0?`${s}m ${r}s`:`${r}s`},N=e=>{const t=new Date(e),s=new Date,r=new Date(s);r.setDate(r.getDate()-1);const a=t.toDateString()===s.toDateString(),i=t.toDateString()===r.toDateString(),l=t.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return a?`Hôm nay ${l}`:i?`Hôm qua ${l}`:t.toLocaleString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})},y=(e,t=0)=>{const s=Number(e);return isNaN(s)?t:s},v=e=>e>=80?"text-green-600":e>=60?"text-yellow-600":"text-red-600",w=e=>e>=90?"Outstanding! 🏆":e>=80?"Excellent! 🌟":e>=70?"Great Job! 👏":e>=60?"Good Work! 👍":e>=50?"Not Bad! 📚":"Keep Practicing! 💪",z=e=>0===e?"🥇":1===e?"🥈":2===e?"🥉":e+1,q=e=>0===e?"bg-yellow-400 text-yellow-900":1===e?"bg-gray-300 text-gray-700":2===e?"bg-amber-600 text-amber-100":"bg-gray-200 text-gray-600",S=({score:e})=>{const[t,r]=s.useState(0);s.useEffect(()=>{const t=setTimeout(()=>{let t=0;const s=e/50,a=setInterval(()=>{t+=s,t>=e?(r(e),clearInterval(a)):r(Math.floor(t))},20)},500);return()=>clearTimeout(t)},[e]);const a=2*Math.PI*45,i=a,l=a-t/100*a;return d.jsxs("div",{className:"relative w-32 h-32",children:[d.jsxs("svg",{className:"w-32 h-32 transform -rotate-90",viewBox:"0 0 100 100",children:[d.jsx("circle",{cx:"50",cy:"50",r:"45",stroke:"currentColor",strokeWidth:"6",fill:"transparent",className:"text-gray-200"}),d.jsx("circle",{cx:"50",cy:"50",r:"45",stroke:"currentColor",strokeWidth:"6",fill:"transparent",strokeDasharray:i,strokeDashoffset:l,strokeLinecap:"round",className:"transition-all duration-1000 ease-out "+(t>=80?"text-green-500":t>=60?"text-yellow-500":"text-red-500")})]}),d.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:d.jsx("div",{className:"text-center",children:d.jsxs("div",{className:`text-2xl font-bold ${v(t)}`,children:[t,"%"]})})})]})},A=({result:e,percentage:t,correct:s,total:r})=>d.jsx("div",{className:"text-center mb-8",children:d.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-6",children:[e.isTimeUp&&d.jsx("div",{className:"bg-yellow-100 border border-yellow-300 text-yellow-800 px-4 py-3 rounded-lg mb-6",children:"⏰ Time's up! Quiz was automatically submitted."}),d.jsxs("div",{className:"flex flex-col items-center",children:[d.jsx(S,{score:t}),d.jsx("h1",{className:"text-3xl font-bold text-gray-900 mt-4 mb-2",children:"Quiz Completed!"}),d.jsx("p",{className:"text-xl text-gray-600 mb-4",children:w(t)}),d.jsxs("div",{className:"text-lg text-gray-700 mb-2",children:["You got ",d.jsx("span",{className:"font-bold text-blue-600",children:s})," out of"," ",d.jsx("span",{className:"font-bold",children:r})," questions correct"]}),"number"==typeof e.timeSpent&&d.jsxs("div",{className:"text-md text-gray-500 mt-2",children:["⏱️ Time taken: ",d.jsx("span",{className:"font-semibold text-blue-700",children:f(y(e.timeSpent))})]})]})]})}),C=({correct:e,total:t,percentage:s})=>d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[d.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 text-center",children:[d.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:e}),d.jsx("div",{className:"text-gray-600",children:"Correct Answers"})]}),d.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 text-center",children:[d.jsx("div",{className:"text-3xl font-bold text-red-600 mb-2",children:t-e}),d.jsx("div",{className:"text-gray-600",children:"Incorrect Answers"})]}),d.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 text-center",children:[d.jsxs("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:[s,"%"]}),d.jsx("div",{className:"text-gray-600",children:"Final Score"})]})]}),k=({quiz:e,result:t,percentage:s})=>d.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[d.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Performance Analysis"}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-gray-600",children:"Accuracy Rate"}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2 mr-3",children:d.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-1000",style:{width:`${s}%`}})}),d.jsxs("span",{className:"font-semibold",children:[s,"%"]})]})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-gray-600",children:"Quiz Difficulty"}),d.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium "+("easy"===e.difficulty?"bg-green-100 text-green-800":"medium"===e.difficulty?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.difficulty.charAt(0).toUpperCase()+e.difficulty.slice(1)})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-gray-600",children:"Time Management"}),d.jsx("span",{className:"font-semibold text-green-600",children:t.isTimeUp?"Used full time":"Completed early"})]})]})]}),I=({quiz:e,result:t})=>{const[r,a]=s.useState(!1);return d.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[d.jsxs("div",{className:"flex items-center justify-between mb-6",children:[d.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Review Answers"}),d.jsxs(m,{variant:"outline",onClick:()=>a(!r),children:[r?"Hide":"Show"," Detailed Review"]})]}),r&&d.jsx("div",{className:"space-y-6",children:e.questions.map((e,s)=>{const r=t.answers[e.id];let a=!1,i="";switch(e.type){case"boolean":case"multiple":case"image":{const t=e.answers.find(e=>e.id===r);a=(null==t?void 0:t.isCorrect)||!1,i=(null==t?void 0:t.text)||"Chưa trả lời";break}case"short_answer":{const t=e=>e.trim().toLowerCase().replace(/\s+/g," "),s=t(r||"");e.correctAnswer&&t(e.correctAnswer)===s?a=!0:e.acceptedAnswers&&(a=e.acceptedAnswers.some(e=>t(e)===s)),i=r||"Chưa trả lời";break}case"checkbox":{const t=e.answers.filter(e=>e.isCorrect).map(e=>e.id).sort(),s=Array.isArray(r)?[...r].sort():[];a=JSON.stringify(t)===JSON.stringify(s);const l=e.answers.filter(e=>s.includes(e.id));i=l.length>0?l.map(e=>e.text).join(", "):"Chưa trả lời";break}}return d.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[d.jsxs("div",{className:"flex items-start justify-between mb-3",children:[d.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:[s+1,". ",e.text]}),d.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium "+(a?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:a?"✓ Correct":"✗ Incorrect"})]}),d.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[d.jsx("span",{className:"font-medium text-blue-800",children:"Câu trả lời của bạn: "}),d.jsx("span",{className:"text-blue-700",children:i})]}),("multiple"===e.type||"image"===e.type||"boolean"===e.type)&&d.jsx("div",{className:"space-y-2",children:e.answers.map(t=>d.jsx("div",{className:"p-3 rounded-lg border "+(t.isCorrect?"border-green-300 bg-green-50":t.id===r?"border-red-300 bg-red-50":"border-gray-200 bg-gray-50"),children:d.jsxs("div",{className:"flex items-center",children:[d.jsxs("span",{className:"font-medium mr-3",children:[String.fromCharCode(65+e.answers.indexOf(t)),"."]}),d.jsx("span",{children:t.text}),t.isCorrect&&d.jsx("span",{className:"ml-auto text-green-600 font-medium",children:"✓ Correct Answer"}),t.id===r&&!t.isCorrect&&d.jsx("span",{className:"ml-auto text-red-600 font-medium",children:"Your Answer"})]})},t.id))}),"checkbox"===e.type&&d.jsx("div",{className:"space-y-2",children:e.answers.map(t=>{const s=(Array.isArray(r)?r:[]).includes(t.id);return d.jsx("div",{className:"p-3 rounded-lg border "+(t.isCorrect?"border-green-300 bg-green-50":s?"border-red-300 bg-red-50":"border-gray-200 bg-gray-50"),children:d.jsxs("div",{className:"flex items-center",children:[d.jsxs("span",{className:"font-medium mr-3",children:[String.fromCharCode(65+e.answers.indexOf(t)),"."]}),d.jsx("span",{children:t.text}),t.isCorrect&&d.jsx("span",{className:"ml-auto text-green-600 font-medium",children:"✓ Should Select"}),s&&!t.isCorrect&&d.jsx("span",{className:"ml-auto text-red-600 font-medium",children:"Wrong Selection"}),s&&t.isCorrect&&d.jsx("span",{className:"ml-auto text-green-600 font-medium",children:"✓ Correct Selection"})]})},t.id)})}),"short_answer"===e.type&&d.jsx("div",{className:"space-y-2",children:d.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[d.jsx("span",{className:"font-medium text-green-800",children:"Đáp án đúng: "}),d.jsxs("span",{className:"text-green-700",children:[e.correctAnswer,e.acceptedAnswers&&e.acceptedAnswers.length>0&&d.jsxs("span",{className:"text-sm",children:[" (hoặc: ",e.acceptedAnswers.join(", "),")"]})]})]})}),e.explanation&&d.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[d.jsx("span",{className:"font-medium text-blue-800",children:"Explanation: "}),d.jsx("span",{className:"text-blue-700",children:e.explanation})]})]},e.id)})})]})},D=({leaderboard:e,userRank:s,loadingStats:r})=>{const{user:a}=t(e=>e.auth);return d.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"🏆 Leaderboard"}),r?d.jsxs("div",{className:"flex justify-center items-center h-24",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),d.jsx("span",{className:"ml-3 text-gray-600",children:"Loading leaderboard..."})]}):e.length>0?d.jsxs("div",{className:"space-y-3",children:[e.map((e,t)=>d.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border "+("current-attempt"===e.id?"bg-gradient-to-r from-green-50 via-emerald-50 to-green-50 border-green-400 shadow-xl ring-4 ring-green-200 ring-opacity-50":e.userId===(null==a?void 0:a.uid)?"bg-blue-50 border-blue-200 shadow-md":"bg-gray-50 border-gray-200"),children:[d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center font-bold text-sm ${"current-attempt"===e.id?"bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-lg transform scale-110":q(t)}`,children:"current-attempt"===e.id?"�":z(t)}),d.jsxs("div",{children:[d.jsxs("div",{className:"font-medium text-gray-900",children:[e.userName,"current-attempt"===e.id&&d.jsx("div",{className:"flex items-center mt-1",children:d.jsxs("span",{className:"text-white ml-2 font-bold bg-gradient-to-r from-green-500 to-emerald-600 px-3 py-1 rounded-full text-sm shadow-lg animate-pulse",children:["� LƯỢT MỚI NHẤT - XẾP HẠNG #",t+1]})}),e.userId===(null==a?void 0:a.uid)&&"current-attempt"!==e.id&&d.jsx("span",{className:"text-gray-500 ml-2 text-sm",children:"(Lượt trước đó)"})]}),d.jsxs("div",{className:"text-sm text-gray-500",children:[e.correctAnswers,"/",e.totalQuestions," correct"]}),d.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["📅 ",N(e.completedAt instanceof Date?e.completedAt.getTime():new Date(e.completedAt).getTime())]})]})]}),d.jsxs("div",{className:"text-right",children:[d.jsxs("div",{className:"font-bold text-xl text-gray-900",children:[y(e.score),"%"]}),d.jsxs("div",{className:"text-sm text-gray-500",children:["⏱️ ",f(y(e.timeSpent))]})]})]},e.id)),a&&s&&s>10&&d.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:d.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:d.jsx("div",{className:"text-center",children:d.jsxs("span",{className:"text-blue-800 font-medium",children:["Your Rank: #",s]})})})})]}):d.jsxs("div",{className:"text-center py-12 text-gray-500",children:[d.jsx("div",{className:"text-6xl mb-4",children:"🏆"}),d.jsx("p",{className:"text-lg",children:"No results yet!"}),d.jsx("p",{children:"Be the first to complete this quiz and claim the top spot!"})]})]})},R=({quiz:e,percentage:t})=>{const s=x();return d.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[d.jsx(m,{onClick:()=>s(`/quiz/${e.id}`),className:"bg-blue-600 hover:bg-blue-700",children:"🔄 Làm lại Quiz"}),d.jsx(m,{onClick:()=>s("/multiplayer",{state:{selectedQuiz:e}}),className:"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white",children:"👥 Chơi cùng bạn bè"}),d.jsx(m,{onClick:()=>{s("/quizzes")},variant:"outline",children:"📚 Xem thêm Quiz"}),d.jsx(m,{onClick:()=>s("/dashboard"),variant:"outline",children:"🏠 Về Dashboard"}),d.jsx(m,{variant:"outline",onClick:()=>{navigator.clipboard.writeText(`I scored ${t}% on "${e.title}" quiz! 🎯`),c.success("Result copied to clipboard!")},children:"📤 Chia sẻ kết quả"}),d.jsx(m,{onClick:()=>s("/profile"),variant:"outline",children:"👤 Xem tất cả kết quả"})]})},Q=()=>{const e=x();return d.jsx("div",{className:"flex items-center justify-center min-h-screen",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mb-4"}),d.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Loading results..."}),d.jsx(m,{onClick:()=>e("/quiz-list"),children:"Back to Quiz List"})]})})},T=()=>{var e;const{resultId:r}=h(),a=x(),[i,l]=s.useState(null),[n,o]=s.useState(null),[m,f]=s.useState(!0);s.useEffect(()=>{(async()=>{if(r)try{f(!0);const e=await g(r);if(!e)return c.error("Không tìm thấy kết quả quiz!"),void a("/profile");if(l(e),e.quizId){const t=await b(e.quizId);t&&o(t)}}catch(e){c.error("Không thể tải kết quả quiz!"),a("/profile")}finally{f(!1)}else a("/profile")})()},[r,a]);const N=i?"number"==typeof i.correctAnswers&&"number"==typeof i.totalQuestions&&i.totalQuestions>0?Math.round(i.correctAnswers/i.totalQuestions*100):"number"!=typeof i.score||isNaN(i.score)?0:i.score<=1?Math.round(100*i.score):Math.round(i.score):0,y=(null==i?void 0:i.correctAnswers)||0,v=(null==i?void 0:i.totalQuestions)||0,w=i?{score:N,correct:y,total:v,timeSpent:i.timeSpent,answers:(null==(e=i.answers)?void 0:e.reduce((e,t)=>(e[t.questionId]=t.selectedAnswerId||"",e),{}))||{},completedAt:i.completedAt,isTimeUp:!1,quizId:i.quizId}:null,z=w?{score:{percentage:N},correct:y,total:v,timeSpent:w.timeSpent}:void 0,{leaderboard:q,userRank:S,loadingStats:T}=((e,r)=>{const{user:a}=t(e=>e.auth),[i,l]=s.useState([]),[n,d]=s.useState(null),[o,m]=s.useState(!0);return s.useEffect(()=>{(async()=>{var t,s;if(e)try{m(!0);const{getQuizResults:i}=await u(async()=>{const{getQuizResults:e}=await import("./index-BLDlbKWj.js").then(e=>e.ah);return{getQuizResults:e}},__vite__mapDeps([0,1]));let n=await i(e);if(r&&a){const i={id:"current-attempt",userId:a.uid,userName:a.displayName||(null==(t=a.email)?void 0:t.split("@")[0])||"Bạn",userEmail:a.email||"",quizId:e,score:(null==(s=r.score)?void 0:s.percentage)||0,correctAnswers:r.correct||0,totalQuestions:r.total||0,timeSpent:r.timeSpent||0,answers:[],completedAt:new Date};n.push(i)}const c=n.map(e=>({id:e.id,userId:e.userId,userName:e.userName,userEmail:e.userEmail,score:e.score,correctAnswers:e.correctAnswers,totalQuestions:e.totalQuestions,timeSpent:e.timeSpent,completedAt:e.completedAt instanceof Date?e.completedAt:new Date(e.completedAt)})).sort((e,t)=>e.score!==t.score?t.score-e.score:e.timeSpent-t.timeSpent);if(l(c.slice(0,10)),a){const e=c.findIndex(e=>e.userId===a.uid);d(e>=0?e+1:null)}}catch(i){c.error("Không thể tải bảng xếp hạng!")}finally{m(!1)}})()},[e,a]),{leaderboard:i,userRank:n,loadingStats:o}})((null==n?void 0:n.id)||null,z);if(m)return d.jsx(Q,{});if(!i||!n||!w)return d.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Không tìm thấy kết quả"}),d.jsx("button",{onClick:()=>a("/profile"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Quay lại Profile"})]})});const $=N>=80;return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 py-8",children:[$&&d.jsx(j,{}),d.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[d.jsx(A,{result:w,percentage:N,correct:y,total:v}),d.jsx(C,{correct:y,total:v,percentage:N}),d.jsx(k,{quiz:n,result:w,percentage:N}),d.jsx(I,{quiz:n,result:w}),d.jsx(D,{leaderboard:q,userRank:S,loadingStats:T}),d.jsx(p,{quizId:n.id,quizTitle:n.title,showSubmitForm:!0}),d.jsx(R,{quiz:n,percentage:N})]})]})};export{T as QuizResultViewer,T as default};

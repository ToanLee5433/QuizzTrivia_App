import{i as c,k as o,l as n,s,m as l,n as p,o as S,p as D,q}from"./index-CUTuLMUt.js";class A{async trackView(e,t){try{const a=c(o,"quizzes",e);if(await n(a,{"stats.views":l(1),"stats.lastUpdated":s()}),t){const r=c(o,"userQuizActivities",`${t}_${e}`);(await p(r)).exists()?await n(r,{viewed:!0,lastView:s()}):await S(r,{userId:t,quizId:e,viewed:!0,attempted:!1,completed:!1,attempts:0,bestScore:0,firstView:s(),lastView:s()})}}catch(a){console.error("Error tracking view:",a)}}async trackAttempt(e,t){try{const a=c(o,"quizzes",e);await n(a,{"stats.attempts":l(1),"stats.lastUpdated":s()});const r=c(o,"userQuizActivities",`${t}_${e}`);(await p(r)).exists()?await n(r,{attempted:!0,attempts:l(1),lastAttempt:s()}):await S(r,{userId:t,quizId:e,viewed:!0,attempted:!0,completed:!1,attempts:1,bestScore:0,firstView:s(),lastAttempt:s()})}catch(a){console.error("Error tracking attempt:",a)}}async trackCompletion(e,t,a,r){try{const i=Math.round(a/r*100),m=c(o,"quizzes",e),d=await p(m);if(d.exists()){const u=d.data().stats||{},v=u.completions||0,z=(u.totalScore||0)+i,f=v+1,g=Math.round(z/f);await n(m,{"stats.completions":l(1),"stats.totalScore":l(i),"stats.averageScore":g,"stats.lastUpdated":s()})}else await n(m,{"stats.completions":1,"stats.totalScore":i,"stats.averageScore":i,"stats.views":l(0),"stats.attempts":l(0),"stats.lastUpdated":s()});const w=c(o,"userQuizActivities",`${t}_${e}`),y=await p(w);if(y.exists()){const u=y.data().bestScore||0,v=Math.max(u,i);await n(w,{completed:!0,bestScore:v,lastCompletion:s()})}else await S(w,{userId:t,quizId:e,viewed:!0,attempted:!0,completed:!0,attempts:1,bestScore:i,firstView:s(),lastAttempt:s(),lastCompletion:s()});await D(q(o,"quizCompletions"),{userId:t,quizId:e,score:i,totalQuestions:r,completedAt:s()})}catch(i){console.error("Error tracking completion:",i)}}async getQuizStats(e){try{const t=c(o,"quizzes",e),a=await p(t);return a.exists()?a.data().stats||{views:0,attempts:0,completions:0,averageScore:0,totalScore:0,lastUpdated:new Date}:null}catch(t){return console.error("Error getting quiz stats:",t),null}}async getUserQuizActivity(e,t){try{const a=c(o,"userQuizActivities",`${e}_${t}`),r=await p(a);return r.exists()?r.data():null}catch(a){return console.error("Error getting user quiz activity:",a),null}}async initializeStatsForQuiz(e){try{const t=c(o,"quizzes",e);await n(t,{"stats.views":0,"stats.attempts":0,"stats.completions":0,"stats.averageScore":0,"stats.totalScore":0,"stats.lastUpdated":s()})}catch(t){console.error("Error initializing stats:",t)}}}const $=new A;export{$ as q};

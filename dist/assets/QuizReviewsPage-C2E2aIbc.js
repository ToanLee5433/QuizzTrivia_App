import{d as e,r as s,j as t,S as a,U as l,z as i,F as r,y as n,b as c,O as d,T as x,c as m}from"./index-Cq0ntLoY.js";import{R as h}from"./ReviewForm-9EykIGjU.js";import{C as o}from"./calendar-BBgXIYEx.js";import{M as g}from"./message-square-CtFGKPxC.js";import{C as u}from"./chart-column-B_uVnzRm.js";import"./x-LZGdLuKF.js";import"./send-ChUdTVZC.js";
/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=e("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),p=e("flag",[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]]),b=e("thumbs-up",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]),N=({reviews:e,loading:i,onHelpfulClick:r,onReportClick:n})=>{const[c,d]=s.useState(new Set),x=e=>{if(!e)return"";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric"})},m=e=>{switch(e){case 1:return"Rất tệ";case 2:return"Tệ";case 3:return"Bình thường";case 4:return"Tốt";case 5:return"Rất tốt";default:return""}};return i?t.jsx("div",{className:"space-y-4",children:[1,2,3].map(e=>t.jsx("div",{className:"animate-pulse",children:t.jsxs("div",{className:"bg-gray-100 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gray-300 rounded-full"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/4 mb-1"}),t.jsx("div",{className:"h-3 bg-gray-300 rounded w-1/3"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 bg-gray-300 rounded w-full"}),t.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4"})]})]})},e))}):0===e.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(a,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Chưa có đánh giá nào"}),t.jsx("p",{className:"text-gray-600",children:"Hãy là người đầu tiên đánh giá quiz này!"})]}):t.jsx("div",{className:"space-y-4",children:e.map(e=>{var s;const i=c.has(e.id),h=e.comment&&e.comment.length>200,g=h&&!i?e.comment.substring(0,200)+"...":e.comment;return t.jsxs("div",{className:"bg-white rounded-lg border border-gray-100 p-6 hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:e.userAvatar?t.jsx("img",{src:e.userAvatar,alt:e.userName,className:"w-full h-full rounded-full object-cover"}):t.jsx(l,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-gray-900",children:e.userName||"Người dùng ẩn danh"}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[t.jsx(o,{className:"w-3 h-3"}),t.jsx("span",{children:x(e.createdAt)})]})]})]}),t.jsx("div",{className:"flex items-center space-x-2",children:t.jsx("button",{className:"p-1 text-gray-400 hover:text-gray-600 rounded",children:t.jsx(j,{className:"w-4 h-4"})})})]}),t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[(u=e.rating,t.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(e=>t.jsx(a,{className:"w-4 h-4 "+(e<=u?"fill-yellow-400 text-yellow-400":"text-gray-300")},e))})),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:m(e.rating)}),t.jsxs("span",{className:"text-sm text-gray-500",children:["(",e.rating,"/5 sao)"]})]}),e.comment&&t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"text-gray-700 leading-relaxed",children:g}),h&&t.jsx("button",{onClick:()=>(e=>{const s=new Set(c);s.has(e)?s.delete(e):s.add(e),d(s)})(e.id),className:"mt-2 text-blue-600 hover:text-blue-700 text-sm font-medium",children:i?"Thu gọn":"Xem thêm"})]}),t.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("button",{onClick:()=>null==r?void 0:r(e.id),className:"flex items-center space-x-2 text-sm text-gray-600 hover:text-green-600 transition-colors",children:[t.jsx(b,{className:"w-4 h-4"}),t.jsxs("span",{children:["Hữu ích (",(null==(s=e.helpful)?void 0:s.length)||0,")"]})]}),t.jsxs("button",{onClick:()=>null==n?void 0:n(e.id),className:"flex items-center space-x-2 text-sm text-gray-600 hover:text-red-600 transition-colors",children:[t.jsx(p,{className:"w-4 h-4"}),t.jsx("span",{children:"Báo cáo"})]})]}),e.updatedAt&&e.updatedAt!==e.createdAt&&t.jsxs("span",{className:"text-xs text-gray-500",children:["Đã chỉnh sửa ",x(e.updatedAt)]})]})]},e.id);var u})})},y=()=>{const{id:e}=i(),[l,o]=s.useState(null),[j,p]=s.useState([]),[b,y]=s.useState(null),[v,f]=s.useState(!0),[w,C]=s.useState(!1);s.useEffect(()=>{e?k():f(!1)},[e]);const k=async()=>{if(e){f(!0);try{let a;try{if(a=await r(e),a)o(a);else{o({id:e,title:`Quiz Sample ${e}`,description:"Đây là quiz mẫu để test hệ thống đánh giá",category:"General",difficulty:"easy",questions:[{id:"1",text:"Câu hỏi mẫu?",type:"multiple",answers:[{id:"1",text:"Đáp án A",isCorrect:!0},{id:"2",text:"Đáp án B",isCorrect:!1},{id:"3",text:"Đáp án C",isCorrect:!1},{id:"4",text:"Đáp án D",isCorrect:!1}],explanation:"Giải thích mẫu",points:10}],duration:300,createdBy:"system",createdAt:new Date,updatedAt:new Date,isPublished:!0,tags:["sample","test"]})}}catch(s){return n.error("Không tìm thấy quiz này"),void f(!1)}try{const s=await c.getQuizReviewsSimple(e);if(p(s||[]),s&&s.length>0){const e=s.reduce((e,s)=>e+(s.rating||0),0)/s.length,t={5:s.filter(e=>5===e.rating).length,4:s.filter(e=>4===e.rating).length,3:s.filter(e=>3===e.rating).length,2:s.filter(e=>2===e.rating).length,1:s.filter(e=>1===e.rating).length};y({totalReviews:s.length,averageRating:Math.round(10*e)/10,ratingDistribution:t})}else y({totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0}})}catch(t){p([]),y({totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0}}),n.error("Không thể tải đánh giá")}}catch(a){n.error("Có lỗi khi tải trang đánh giá")}finally{f(!1)}}else f(!1)};return v?t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),t.jsx("p",{className:"mt-4 text-gray-600",children:"Đang tải thông tin quiz..."})]})}):l?t.jsx("div",{className:"min-h-screen bg-gray-50",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:l.title}),t.jsx("p",{className:"text-gray-600 mb-4",children:l.description}),t.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500",children:[t.jsxs("span",{className:"flex items-center space-x-1",children:[t.jsx(d,{className:"w-4 h-4"}),t.jsx("span",{children:l.category})]}),t.jsxs("span",{className:"flex items-center space-x-1",children:[t.jsx(x,{className:"w-4 h-4"}),t.jsx("span",{className:"capitalize",children:l.difficulty})]}),t.jsxs("span",{className:"flex items-center space-x-1",children:[t.jsx(g,{className:"w-4 h-4"}),t.jsxs("span",{children:[l.questions.length," câu hỏi"]})]})]})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:()=>{k()},disabled:v,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium disabled:opacity-50",title:"Làm mới đánh giá",children:t.jsx(m,{className:"w-4 h-4 "+(v?"animate-spin":"")})}),t.jsx("button",{onClick:()=>C(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Viết đánh giá"})]})]})}),b&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[t.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:t.jsx(a,{className:"w-6 h-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:b.averageRating.toFixed(1)}),t.jsx("p",{className:"text-sm text-gray-600",children:"Điểm trung bình"}),t.jsx("div",{className:"flex items-center mt-1",children:[1,2,3,4,5].map(e=>t.jsx(a,{className:"w-4 h-4 "+(e<=Math.round(b.averageRating)?"fill-yellow-400 text-yellow-400":"text-gray-300")},e))})]})]})}),t.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:t.jsx(g,{className:"w-6 h-6 text-green-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(null==b?void 0:b.totalReviews)||0}),t.jsx("p",{className:"text-sm text-gray-600",children:"Tổng đánh giá"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:0===(null==b?void 0:b.totalReviews)?"Chưa có đánh giá":"người đã đánh giá"})]})]})}),t.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:t.jsx(x,{className:"w-6 h-6 text-purple-600"})}),t.jsxs("div",{children:[t.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[b.totalReviews>0?Math.round((b.ratingDistribution[5]+b.ratingDistribution[4])/b.totalReviews*100):0,"%"]}),t.jsx("p",{className:"text-sm text-gray-600",children:"Đánh giá tích cực"})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[t.jsx("div",{className:"lg:col-span-1",children:b?t.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[t.jsx(u,{className:"w-5 h-5 mr-2"}),"Phân bố đánh giá"]}),t.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(e=>{const s=b.ratingDistribution[e]||0,l=b.totalReviews>0?s/b.totalReviews*100:0;return t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("div",{className:"flex items-center space-x-1 w-16",children:[t.jsx("span",{className:"text-sm font-medium",children:e}),t.jsx(a,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"})]}),t.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-yellow-400 h-2 rounded-full transition-all duration-300",style:{width:`${l}%`}})}),t.jsx("span",{className:"text-sm text-gray-600 w-12",children:s})]},e)})})]}):null}),t.jsx("div",{className:"lg:col-span-2",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100",children:[t.jsx("div",{className:"p-6 border-b border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Đánh giá từ người dùng (",j.length,")"]}),t.jsx("button",{onClick:()=>C(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Viết đánh giá"})]})}),t.jsx("div",{className:"p-6",children:0===j.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"text-6xl mb-4",children:"💭"}),t.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Chưa có đánh giá nào"}),t.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Hãy trở thành người đầu tiên đánh giá quiz này! Chia sẻ trải nghiệm của bạn để giúp những người khác."}),t.jsxs("button",{onClick:()=>C(!0),className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[t.jsx(g,{className:"w-5 h-5 mr-2"}),"Viết đánh giá đầu tiên"]}),t.jsxs("div",{className:"mt-8 flex justify-center space-x-4",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-200 rounded-full animate-pulse"}),t.jsx("div",{className:"w-2 h-2 bg-blue-300 rounded-full animate-pulse delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse delay-150"})]})]}):t.jsx(N,{reviews:j,loading:!1,onHelpfulClick:async e=>{},onReportClick:async e=>{}})})]})})]}),w&&e&&t.jsx(h,{quizId:e,onReviewSubmitted:async()=>{C(!1),p([]),f(!0),setTimeout(()=>{k()},1500)},onClose:()=>C(!1)})]})}):t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-6xl mb-4",children:"😔"}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Quiz không tồn tại"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Không thể tìm thấy quiz này"}),t.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Quay lại"})]})})};export{y as default};

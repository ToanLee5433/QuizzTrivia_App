import{v as w,r as x,j as e,S as p,V as D,b as A,f as Q,y,t as E,a5 as L,T as q,M as v,a as $,a2 as T}from"./index-CUTuLMUt.js";import{R as M}from"./ReviewForm-CUyZab1E.js";import{C as F}from"./calendar-3Wsr6Ss3.js";import"./send-C6orf-r8.js";/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],V=w("ellipsis-vertical",P);/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],U=w("flag",I);/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],B=w("thumbs-up",_),H=({reviews:i,loading:c,onHelpfulClick:m,onReportClick:o})=>{const[h,a]=x.useState(new Set),u=s=>{const n=new Set(h);n.has(s)?n.delete(s):n.add(s),a(n)},g=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric"}):"",d=s=>e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(n=>e.jsx(p,{className:`w-4 h-4 ${n<=s?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},n))}),f=s=>{switch(s){case 1:return"R·∫•t t·ªá";case 2:return"T·ªá";case 3:return"B√¨nh th∆∞·ªùng";case 4:return"T·ªët";case 5:return"R·∫•t t·ªët";default:return""}};return c?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-300 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/4 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-1/3"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4"})]})]})},s))}):i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Ch∆∞a c√≥ ƒë√°nh gi√° n√†o"}),e.jsx("p",{className:"text-gray-600",children:"H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë√°nh gi√° quiz n√†y!"})]}):e.jsx("div",{className:"space-y-4",children:i.map(s=>{var b;const n=h.has(s.id),j=s.comment&&s.comment.length>200,N=j&&!n?s.comment.substring(0,200)+"...":s.comment;return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-100 p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:s.userAvatar?e.jsx("img",{src:s.userAvatar,alt:s.userName,className:"w-full h-full rounded-full object-cover"}):e.jsx(D,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.userName||"Ng∆∞·ªùi d√πng ·∫©n danh"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx(F,{className:"w-3 h-3"}),e.jsx("span",{children:g(s.createdAt)})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{className:"p-1 text-gray-400 hover:text-gray-600 rounded",children:e.jsx(V,{className:"w-4 h-4"})})})]}),e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[d(s.rating),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:f(s.rating)}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",s.rating,"/5 sao)"]})]}),s.comment&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-700 leading-relaxed",children:N}),j&&e.jsx("button",{onClick:()=>u(s.id),className:"mt-2 text-blue-600 hover:text-blue-700 text-sm font-medium",children:n?"Thu g·ªçn":"Xem th√™m"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>m==null?void 0:m(s.id),className:"flex items-center space-x-2 text-sm text-gray-600 hover:text-green-600 transition-colors",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsxs("span",{children:["H·ªØu √≠ch (",((b=s.helpful)==null?void 0:b.length)||0,")"]})]}),e.jsxs("button",{onClick:()=>o==null?void 0:o(s.id),className:"flex items-center space-x-2 text-sm text-gray-600 hover:text-red-600 transition-colors",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:"B√°o c√°o"})]})]}),s.updatedAt&&s.updatedAt!==s.createdAt&&e.jsxs("span",{className:"text-xs text-gray-500",children:["ƒê√£ ch·ªânh s·ª≠a ",g(s.updatedAt)]})]})]},s.id)})})},J=()=>{const{id:i}=A(),[c,m]=x.useState(null),[o,h]=x.useState([]),[a,u]=x.useState(null),[g,d]=x.useState(!0),[f,s]=x.useState(!1);x.useEffect(()=>{i?(console.log("üéØ QuizReviewsPage mounted with quizId:",i),n()):(console.error("‚ùå No quizId provided in URL params"),d(!1))},[i]);const n=async()=>{if(!i){console.error("‚ùå No quizId provided"),d(!1);return}d(!0),console.log("üîÑ Starting to load quiz and reviews for:",i);try{console.log("üìù Loading quiz details...");let l;try{if(l=await Q(i),console.log("üîç Raw quiz data from API:",l),l)console.log("‚úÖ Quiz data loaded successfully:",l.title),m(l);else{console.error("‚ùå Quiz not found in database for ID:",i),console.log("üîß Creating fallback quiz for testing...");const t={id:i,title:`Quiz Sample ${i}`,description:"ƒê√¢y l√† quiz m·∫´u ƒë·ªÉ test h·ªá th·ªëng ƒë√°nh gi√°",category:"General",difficulty:"easy",questions:[{id:"1",text:"C√¢u h·ªèi m·∫´u?",type:"multiple",answers:[{id:"1",text:"ƒê√°p √°n A",isCorrect:!0},{id:"2",text:"ƒê√°p √°n B",isCorrect:!1},{id:"3",text:"ƒê√°p √°n C",isCorrect:!1},{id:"4",text:"ƒê√°p √°n D",isCorrect:!1}],explanation:"Gi·∫£i th√≠ch m·∫´u",points:10}],duration:300,createdBy:"system",createdAt:new Date,updatedAt:new Date,isPublished:!0,tags:["sample","test"]};m(t),console.log("‚úÖ Using fallback quiz for testing")}}catch(t){console.error("‚ùå Failed to load quiz:",t),y.error("Kh√¥ng t√¨m th·∫•y quiz n√†y"),d(!1);return}console.log("üìä Loading reviews...");try{const t=await E.getQuizReviewsSimple(i);if(console.log(`‚úÖ Reviews loaded: ${t.length} reviews found`),h(t||[]),t&&t.length>0){const z=t.reduce((r,k)=>r+(k.rating||0),0)/t.length,S={5:t.filter(r=>r.rating===5).length,4:t.filter(r=>r.rating===4).length,3:t.filter(r=>r.rating===3).length,2:t.filter(r=>r.rating===2).length,1:t.filter(r=>r.rating===1).length};u({totalReviews:t.length,averageRating:Math.round(z*10)/10,ratingDistribution:S}),console.log(`üìà Stats calculated: ${t.length} reviews, ${z.toFixed(1)} avg rating`)}else console.log("üìä No reviews found, setting empty stats"),u({totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0}})}catch(t){console.error("‚ö†Ô∏è Error loading reviews:",t),h([]),u({totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0}}),y.error("Kh√¥ng th·ªÉ t·∫£i ƒë√°nh gi√°")}console.log("üéâ Page loading completed successfully")}catch(l){console.error("‚ùå Critical error in loadQuizAndReviews:",l),y.error("C√≥ l·ªói khi t·∫£i trang ƒë√°nh gi√°")}finally{d(!1),console.log("‚úÖ Loading state set to false")}},j=async()=>{console.log("üîÑ Review submitted, refreshing data..."),s(!1),h([]),d(!0),setTimeout(()=>{console.log("‚è∞ Delay completed, reloading reviews with cache bypass..."),n()},1500)},N=async l=>{console.log("Helpful clicked for review:",l)},b=async l=>{console.log("Report clicked for review:",l)},C=()=>a?e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(T,{className:"w-5 h-5 mr-2"}),"Ph√¢n b·ªë ƒë√°nh gi√°"]}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(l=>{const t=a.ratingDistribution[l]||0,R=a.totalReviews>0?t/a.totalReviews*100:0;return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-1 w-16",children:[e.jsx("span",{className:"text-sm font-medium",children:l}),e.jsx(p,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"})]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-400 h-2 rounded-full transition-all duration-300",style:{width:`${R}%`}})}),e.jsx("span",{className:"text-sm text-gray-600 w-12",children:t})]},l)})})]}):null;return g?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"ƒêang t·∫£i th√¥ng tin quiz..."})]})}):c?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:c.title}),e.jsx("p",{className:"text-gray-600 mb-4",children:c.description}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:c.category})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{className:"capitalize",children:c.difficulty})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(v,{className:"w-4 h-4"}),e.jsxs("span",{children:[c.questions.length," c√¢u h·ªèi"]})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{n()},disabled:g,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium disabled:opacity-50",title:"L√†m m·ªõi ƒë√°nh gi√°",children:e.jsx($,{className:`w-4 h-4 ${g?"animate-spin":""}`})}),e.jsx("button",{onClick:()=>s(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Vi·∫øt ƒë√°nh gi√°"})]})]})}),a&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(p,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.averageRating.toFixed(1)}),e.jsx("p",{className:"text-sm text-gray-600",children:"ƒêi·ªÉm trung b√¨nh"}),e.jsx("div",{className:"flex items-center mt-1",children:[1,2,3,4,5].map(l=>e.jsx(p,{className:`w-4 h-4 ${l<=Math.round(a.averageRating)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},l))})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(v,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(a==null?void 0:a.totalReviews)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"T·ªïng ƒë√°nh gi√°"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:(a==null?void 0:a.totalReviews)===0?"Ch∆∞a c√≥ ƒë√°nh gi√°":"ng∆∞·ªùi ƒë√£ ƒë√°nh gi√°"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:e.jsx(q,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[a.totalReviews>0?Math.round((a.ratingDistribution[5]+a.ratingDistribution[4])/a.totalReviews*100):0,"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"ƒê√°nh gi√° t√≠ch c·ª±c"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:C()}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["ƒê√°nh gi√° t·ª´ ng∆∞·ªùi d√πng (",o.length,")"]}),e.jsx("button",{onClick:()=>s(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Vi·∫øt ƒë√°nh gi√°"})]})}),e.jsx("div",{className:"p-6",children:o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üí≠"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Ch∆∞a c√≥ ƒë√°nh gi√° n√†o"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"H√£y tr·ªü th√†nh ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë√°nh gi√° quiz n√†y! Chia s·∫ª tr·∫£i nghi·ªám c·ªßa b·∫°n ƒë·ªÉ gi√∫p nh·ªØng ng∆∞·ªùi kh√°c."}),e.jsxs("button",{onClick:()=>s(!0),className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(v,{className:"w-5 h-5 mr-2"}),"Vi·∫øt ƒë√°nh gi√° ƒë·∫ßu ti√™n"]}),e.jsxs("div",{className:"mt-8 flex justify-center space-x-4",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-200 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-blue-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse delay-150"})]})]}):e.jsx(H,{reviews:o,loading:!1,onHelpfulClick:N,onReportClick:b})})]})})]}),f&&i&&e.jsx(M,{quizId:i,onReviewSubmitted:j,onClose:()=>s(!1)})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üòî"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Quiz kh√¥ng t·ªìn t·∫°i"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Kh√¥ng th·ªÉ t√¨m th·∫•y quiz n√†y"}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Quay l·∫°i"})]})})};export{J as default};

import{e as K,u as V,c as ge,r as l,x as pe,j as e,o as X,P as be,l as _,C as O,S as ye,T as G,z as je,L as q,k as fe,A as ve,E as Ne,D as z,F as we,y as S,G as ze}from"./index-BSJrQLtH.js";import{A as Se,a as ke}from"./arrow-up-DxHbG8_8.js";import{C as Ce}from"./calendar-BpKxQpeH.js";/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Qe=K("chevron-right",Te);/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],k=K("trophy",qe),Le=()=>{const{user:r}=V(s=>s.auth),c=V(s=>s.quiz.userResults),A=ge(),[J,P]=l.useState([]),[U,L]=l.useState({}),[W,R]=l.useState(!0),[d,Y]=l.useState(null),[g,C]=l.useState("overview"),[M,Z]=l.useState((r==null?void 0:r.displayName)||""),[b,I]=l.useState(""),[D,ee]=l.useState((r==null?void 0:r.photoURL)||""),[y,j]=l.useState(!1),[x,se]=l.useState(10),[u,$]=l.useState(1),[f,te]=l.useState(!1),[E,re]=l.useState("date"),[T,ae]=l.useState("desc"),[Q,le]=l.useState(""),[H,ne]=l.useState("all");l.useEffect(()=>{r&&(R(!0),A(pe(r.uid)))},[r,A]),l.useEffect(()=>{if(!r)return;const s=async()=>{const a={};for(const i of c)if(!a[i.quizId])try{const p=await fe(i.quizId);a[i.quizId]=(p==null?void 0:p.title)||"Quiz không tên"}catch(p){console.error("Error fetching quiz:",p),a[i.quizId]="Quiz không tên"}L(a),P(c)};c.length>0?s():(P([]),L({}));const t=c.length,n=c.reduce((a,i)=>a+(i.score||0),0),o=c.reduce((a,i)=>a+(i.correctAnswers||0),0),m=c.reduce((a,i)=>a+(i.totalQuestions||0),0),oe=c.reduce((a,i)=>a+(i.timeSpent||0),0),de=t>0?n/t:0,he=m>0?o/m*100:0,xe=t>0?oe/t:0,ue=c.filter(a=>a.correctAnswers/a.totalQuestions===1).length,me=c.filter(a=>a.correctAnswers/a.totalQuestions>=.8).length;Y({totalQuizzes:t,totalScore:n,averageScore:de,accuracy:he,averageTime:xe,perfectScores:ue,highScores:me,recentActivity:c.slice(0,5)}),R(!1)},[c,r]);const h=J.filter(s=>Q?(U[s.quizId]||"Quiz không tên").toLowerCase().includes(Q.toLowerCase()):!0).filter(s=>{const t=s.correctAnswers/s.totalQuestions*100;switch(H){case"high":return t>=80;case"medium":return t>=60&&t<80;case"low":return t<60;default:return!0}}).sort((s,t)=>{let n=0;switch(E){case"date":n=new Date(s.completedAt).getTime()-new Date(t.completedAt).getTime();break;case"score":n=(s.score||0)-(t.score||0);break;case"percentage":const o=s.correctAnswers/s.totalQuestions*100,m=t.correctAnswers/t.totalQuestions*100;n=o-m;break}return T==="asc"?n:-n}),v=Math.ceil(h.length/x),N=(u-1)*x,B=f?h:h.slice(N,N+x),ce=async()=>{if(!(!r||!z.currentUser)){j(!0);try{await we(z.currentUser,{displayName:M,photoURL:D}),S.success("Cập nhật profile thành công!")}catch(s){console.error("Error updating profile:",s),S.error("Có lỗi khi cập nhật profile")}finally{j(!1)}}},ie=async()=>{if(!(!z.currentUser||!b)){j(!0);try{await ze(z.currentUser,b),I(""),S.success("Cập nhật mật khẩu thành công!")}catch(s){console.error("Error updating password:",s),S.error("Có lỗi khi cập nhật mật khẩu")}finally{j(!1)}}},w=(s,t,n,o,m="bg-blue-500")=>e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-3 rounded-full ${m}`,children:s}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n}),e.jsx("p",{className:"text-sm text-gray-600",children:t}),o&&e.jsx("p",{className:"text-xs text-gray-500",children:o})]})]})})}),F=s=>{const t=Math.round(s.correctAnswers/s.totalQuestions*100),n=o=>o>=90?"text-green-600 bg-green-50":o>=70?"text-blue-600 bg-blue-50":o>=50?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50";return e.jsx("div",{className:"bg-white rounded-lg border border-gray-100 p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:U[s.quizId]||"Quiz không tên"}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.correctAnswers,"/",s.totalQuestions]})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:[Math.round((s.timeSpent||0)/60),"p"]})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(s.completedAt).toLocaleDateString("vi-VN")})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${n(t)}`,children:[t,"%"]}),e.jsx(q,{to:`/quiz/${s.quizId}/reviews`,className:"p-2 text-gray-400 hover:text-purple-600 transition-colors",title:"Xem lại quiz",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx(q,{to:`/results/${s.id}`,className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Xem kết quả",children:e.jsx(Ne,{className:"w-4 h-4"})})]})]})},s.id)};return r?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:r.photoURL?e.jsx("img",{src:r.photoURL,alt:"Avatar",className:"w-full h-full rounded-full object-cover"}):e.jsx(X,{className:"w-10 h-10 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r.displayName||r.email}),e.jsx("p",{className:"text-gray-600",children:r.email}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Thành viên từ ",new Date().toLocaleDateString("vi-VN")]})]}),e.jsx("button",{onClick:()=>C("settings"),className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",children:e.jsx(be,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 mb-8",children:e.jsx("div",{className:"flex space-x-8 px-6",children:[{id:"overview",label:"Tổng quan",icon:_},{id:"history",label:"Lịch sử Quiz",icon:O},{id:"achievements",label:"Thành tích",icon:k},{id:"settings",label:"Cài đặt",icon:X}].map(({id:s,label:t,icon:n})=>e.jsxs("button",{onClick:()=>C(s),className:`flex items-center space-x-2 py-4 border-b-2 transition-colors ${g===s?"border-blue-500 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{children:t})]},s))})}),g==="overview"&&d&&e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[w(e.jsx(k,{className:"w-6 h-6 text-white"}),"Quiz đã hoàn thành",d.totalQuizzes,void 0,"bg-yellow-500"),w(e.jsx(ye,{className:"w-6 h-6 text-white"}),"Điểm trung bình",d.averageScore.toFixed(1),"Trên tổng số quiz","bg-blue-500"),w(e.jsx(G,{className:"w-6 h-6 text-white"}),"Độ chính xác",`${d.accuracy.toFixed(1)}%`,"Tỷ lệ trả lời đúng","bg-green-500"),w(e.jsx(_,{className:"w-6 h-6 text-white"}),"Điểm cao",`${d.highScores}/${d.totalQuizzes}`,"Quiz đạt trên 80%","bg-purple-500")]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Hoạt động gần đây"}),e.jsx("div",{className:"space-y-4",children:d.recentActivity.map(s=>F(s))}),d.totalQuizzes>5&&e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("button",{onClick:()=>C("history"),className:"text-blue-600 hover:text-blue-700 font-medium flex items-center space-x-1 mx-auto",children:[e.jsx("span",{children:"Xem tất cả lịch sử"}),e.jsx(Qe,{className:"w-4 h-4"})]})})]})]}),g==="history"&&e.jsxs("div",{children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Tìm kiếm quiz...",value:Q,onChange:s=>le(s.target.value),className:"pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:H,onChange:s=>ne(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Tất cả điểm"}),e.jsx("option",{value:"high",children:"Cao (≥80%)"}),e.jsx("option",{value:"medium",children:"Trung bình (60-79%)"}),e.jsx("option",{value:"low",children:"Thấp (<60%)"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sắp xếp:"}),e.jsxs("select",{value:E,onChange:s=>re(s.target.value),className:"px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"date",children:"Ngày"}),e.jsx("option",{value:"score",children:"Điểm"}),e.jsx("option",{value:"percentage",children:"Phần trăm"})]}),e.jsx("button",{onClick:()=>ae(T==="asc"?"desc":"asc"),className:"p-1 text-gray-400 hover:text-gray-600",children:T==="asc"?e.jsx(Se,{className:"w-4 h-4"}):e.jsx(ke,{className:"w-4 h-4"})})]}),e.jsxs("select",{value:x,onChange:s=>se(Number(s.target.value)),className:"px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:10,children:"10/trang"}),e.jsx("option",{value:25,children:"25/trang"}),e.jsx("option",{value:50,children:"50/trang"}),e.jsx("option",{value:100,children:"100/trang"})]}),h.length>x&&e.jsx("button",{onClick:()=>te(!f),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:f?"Phân trang":`Xem tất cả (${h.length})`})]})]})}),e.jsx("div",{className:"space-y-4 mb-6",children:W?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Đang tải..."})]}):B.length>0?B.map(s=>F(s)):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-8 text-center",children:[e.jsx(k,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Chưa có kết quả nào"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Bạn chưa hoàn thành quiz nào. Hãy bắt đầu làm quiz đầu tiên!"}),e.jsx(q,{to:"/quizzes",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Khám phá Quiz"})]})}),!f&&v>1&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Hiển thị ",N+1,"-",Math.min(N+x,h.length)," trong tổng ",h.length," kết quả"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>$(Math.max(u-1,1)),disabled:u===1,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Trước"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-600",children:["Trang ",u,"/",v]}),e.jsx("button",{onClick:()=>$(Math.min(u+1,v)),disabled:u===v,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Sau"})]})]})})]}),g==="achievements"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Thành tích"}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(k,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Hệ thống thành tích"}),e.jsx("p",{className:"text-gray-600",children:"Tính năng đang được phát triển"})]})]}),g==="settings"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Thông tin cá nhân"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tên hiển thị"}),e.jsx("input",{type:"text",value:M,onChange:s=>Z(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL Avatar"}),e.jsx("input",{type:"url",value:D,onChange:s=>ee(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("button",{onClick:ce,disabled:y,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:y?"Đang cập nhật...":"Cập nhật Profile"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Đổi mật khẩu"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mật khẩu mới"}),e.jsx("input",{type:"password",value:b,onChange:s=>I(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nhập mật khẩu mới"})]}),e.jsx("button",{onClick:ie,disabled:y||!b,className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors",children:y?"Đang cập nhật...":"Đổi mật khẩu"})]})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-600",children:"Vui lòng đăng nhập để xem profile"})})})};export{Le as default};

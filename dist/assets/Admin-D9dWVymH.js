import{r as e,u as s,j as t,L as a,m as l,l as r,h as d,p as n,y as i,g as o,o as c}from"./index-0teFe5Sq.js";import{A as m}from"./AdminLayout-DR5EOYqR.js";const x=()=>{const[x,h]=e.useState({totalQuizzes:0,totalUsers:0,completedQuizzes:0,totalCreators:0});e.useEffect(()=>{(async()=>{try{const e=await l(r(d,"quizzes")),s=e.docs.map(e=>e.data()).filter(e=>"approved"===e.status),t=s.length,a=s.filter(e=>!0===e.completed||"completed"===e.status).length,n=s.map(e=>e.creatorId).filter((e,s,t)=>e&&t.indexOf(e)===s).length,i=await l(r(d,"users")),o=i.docs.map(e=>e.data()).length;h({totalQuizzes:t,totalUsers:o,completedQuizzes:a,totalCreators:n})}catch(e){}})()},[]);const{user:g}=s(e=>e.auth),[u,b]=e.useState(!1),[p,f]=e.useState(!1),[j,v]=e.useState({message:"",type:"info",targetRole:"all"});return"admin"!==(null==g?void 0:g.role)?t.jsx("div",{className:"text-center py-12",children:t.jsx("p",{className:"text-gray-600",children:"Bạn không có quyền truy cập trang này."})}):t.jsxs(m,{title:"Dashboard",children:[t.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg shadow-lg p-6 mb-8 text-white",children:[t.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:"Chào mừng đến với Admin Dashboard"}),t.jsx("p",{className:"text-blue-100",children:"Quản lý toàn bộ hệ thống Quiz một cách hiệu quả"})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6 border border-gray-200",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx("span",{className:"text-2xl",children:"📚"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("h3",{className:"text-sm md:text-base font-semibold text-gray-900",children:"Tổng số Quiz"}),t.jsx("div",{className:"text-xl md:text-3xl font-bold text-blue-600",children:x.totalQuizzes})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6 border border-gray-200",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:t.jsx("span",{className:"text-2xl",children:"👥"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("h3",{className:"text-sm md:text-base font-semibold text-gray-900",children:"Người dùng"}),t.jsx("div",{className:"text-xl md:text-3xl font-bold text-green-600",children:x.totalUsers})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6 border border-gray-200",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:t.jsx("span",{className:"text-2xl",children:"✅"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("h3",{className:"text-sm md:text-base font-semibold text-gray-900",children:"Quiz hoàn thành"}),t.jsx("div",{className:"text-xl md:text-3xl font-bold text-purple-600",children:x.completedQuizzes})]})]})}),t.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6 border border-gray-200",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:t.jsx("span",{className:"text-2xl",children:"✏️"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("h3",{className:"text-sm md:text-base font-semibold text-gray-900",children:"Người tạo"}),t.jsx("div",{className:"text-xl md:text-3xl font-bold text-orange-600",children:x.totalCreators})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6",children:[t.jsx("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-3 md:mb-4",children:"Quản lý Quiz"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(a,{to:"/admin/quiz-management",className:"w-full text-left p-2 md:p-3 hover:bg-gray-50 rounded border block text-sm md:text-base",children:"◆ Quản lý Quiz"}),t.jsx(a,{to:"/admin/categories",className:"w-full text-left p-2 md:p-3 hover:bg-gray-50 rounded border block text-sm md:text-base",children:"📂 Quản lý danh mục"}),t.jsx(a,{to:"/admin/quiz-stats",className:"w-full text-left p-2 md:p-3 hover:bg-gray-50 rounded border block text-sm md:text-base",children:"📊 Thống kê Quiz"})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6",children:[t.jsx("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-3 md:mb-4",children:"Quản lý người dùng"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(a,{to:"/admin/users",className:"w-full text-left p-2 md:p-3 hover:bg-gray-50 rounded border block text-sm md:text-base",children:"👥 Danh sách người dùng"}),t.jsx(a,{to:"/admin/roles",className:"w-full text-left p-2 md:p-3 hover:bg-gray-50 rounded border block text-sm md:text-base",children:"🔐 Phân quyền người dùng"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6 border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-lg md:text-xl font-semibold text-gray-900 flex items-center",children:[t.jsx("span",{className:"bg-blue-100 p-2 rounded-lg mr-3",children:"⚡"}),"Thao tác nhanh"]}),t.jsx("span",{className:"text-sm text-gray-500",children:"Các chức năng quan trọng"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4",children:[t.jsx("button",{onClick:()=>b(!0),className:"group bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-md hover:shadow-lg",disabled:p,children:t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx("span",{className:"text-2xl group-hover:scale-110 transition-transform",children:"📢"}),t.jsx("span",{className:"text-sm font-medium",children:"Gửi thông báo"})]})}),t.jsx("button",{onClick:async()=>{if(confirm("Bạn có chắc muốn xóa tất cả thông báo đang hiển thị?")){f(!0);try{const e=(await l(r(d,"system_notifications"))).docs.map(e=>n(e.ref,{isActive:!1}));await Promise.all(e),i.success("Đã tắt tất cả thông báo!")}catch(e){i.error("Lỗi khi xóa thông báo!")}finally{f(!1)}}},className:"group bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white p-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-md hover:shadow-lg",disabled:p,children:t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx("span",{className:"text-2xl group-hover:scale-110 transition-transform",children:"❌"}),t.jsx("span",{className:"text-sm font-medium",children:"Xóa thông báo"})]})}),t.jsx("button",{onClick:async()=>{f(!0);try{const e=["users","quizzes","categories","quiz_results"],s={};for(const i of e){const e=await l(r(d,i));s[i]=e.docs.map(e=>({id:e.id,...e.data()}))}const t=JSON.stringify(s,null,2),a=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download=`quiz-app-backup-${(new Date).toISOString().split("T")[0]}.json`,o.click(),i.success("Backup dữ liệu thành công!")}catch(e){i.error("Lỗi khi backup dữ liệu!")}finally{f(!1)}},className:"group bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white p-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-md hover:shadow-lg",disabled:p,children:t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx("span",{className:"text-2xl group-hover:scale-110 transition-transform",children:"💾"}),t.jsx("span",{className:"text-sm font-medium",children:"Backup dữ liệu"})]})}),t.jsx("button",{onClick:async()=>{if(confirm("Bạn có chắc muốn dọn dẹp dữ liệu đã xoá (quiz, user)?")){f(!0);try{const e=await l(r(d,"quizzes")),s=e.docs.filter(e=>!0===e.data().deleted).map(e=>n(o(d,"quizzes",e.id),{isPurged:!0})),t=await l(r(d,"users")),a=t.docs.filter(e=>!0===e.data().deleted).map(e=>n(o(d,"users",e.id),{isPurged:!0}));await Promise.all([...s,...a]),i.success("Đã dọn dẹp dữ liệu xoá!")}catch(e){i.error("Lỗi khi dọn dẹp dữ liệu xoá!")}finally{f(!1)}}},className:"group bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white p-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-md hover:shadow-lg",disabled:p,children:t.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[t.jsx("span",{className:"text-2xl group-hover:scale-110 transition-transform",children:"🗑️"}),t.jsx("span",{className:"text-sm font-medium",children:"Dọn dẹp dữ liệu"})]})})]})]}),u&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 w-full max-w-md mx-4",children:[t.jsx("h2",{className:"text-lg md:text-xl font-semibold mb-4",children:"Gửi thông báo hệ thống"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nội dung thông báo"}),t.jsx("textarea",{value:j.message,onChange:e=>v(s=>({...s,message:e.target.value})),placeholder:"Nhập nội dung thông báo...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base",rows:4})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Loại thông báo"}),t.jsxs("select",{value:j.type,onChange:e=>v(s=>({...s,type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base",children:[t.jsx("option",{value:"info",children:"Thông tin (Xanh)"}),t.jsx("option",{value:"warning",children:"Cảnh báo (Vàng)"}),t.jsx("option",{value:"success",children:"Thành công (Xanh lá)"}),t.jsx("option",{value:"error",children:"Lỗi (Đỏ)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Đối tượng nhận"}),t.jsxs("select",{value:j.targetRole,onChange:e=>v(s=>({...s,targetRole:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base",children:[t.jsx("option",{value:"all",children:"Tất cả người dùng"}),t.jsx("option",{value:"user",children:"Chỉ User"}),t.jsx("option",{value:"creator",children:"Chỉ Creator"})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 pt-4",children:[t.jsx("button",{onClick:()=>b(!1),className:"w-full sm:w-auto px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors text-sm md:text-base",disabled:p,children:"Hủy"}),t.jsx("button",{onClick:async()=>{if(j.message.trim()){f(!0);try{await c(r(d,"system_notifications"),{message:j.message,type:j.type,createdAt:new Date,isActive:!0,targetRole:j.targetRole}),v({message:"",type:"info",targetRole:"all"}),b(!1),i.success("Đã gửi thông báo hệ thống!")}catch(e){i.error("Lỗi khi gửi thông báo!")}finally{f(!1)}}else i.error("Vui lòng nhập nội dung thông báo!")},disabled:p||!j.message.trim(),className:"w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm md:text-base",children:p?"Đang gửi...":"Gửi thông báo"})]})]})]})})]})};export{x as default};

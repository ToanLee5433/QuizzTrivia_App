import{d as e,a as s,u as r,e as t,r as a,H as l,j as i,U as o,T as c,o as n,S as d,G as x,L as u,I as p,E as m,J as h,K as g,y as f,M as b,N as j,O as w}from"./index-D8X0wEz4.js";import{P as y}from"./pen-line-Bg7ReexT.js";import{T as v}from"./trophy-BdpQ7BI1.js";import{S as N}from"./search-0GL34Vbi.js";import{A as S,a as z}from"./arrow-up-BxVCgxk7.js";import{C as q}from"./calendar-DN7BqZzM.js";import{R as C}from"./rotate-ccw-B6WftStv.js";
/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=e("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Q=()=>{const{t:e,i18n:Q}=s(),{user:k}=r(e=>e.auth),P=r(e=>e.quiz.userResults),U=t(),[M,R]=a.useState([]),[D,L]=a.useState({}),[T,I]=a.useState(null),[E,$]=a.useState("overview"),[F,_]=a.useState((null==k?void 0:k.displayName)||""),[H,G]=a.useState(""),[J,K]=a.useState(""),[O,B]=a.useState(""),[V,W]=a.useState((null==k?void 0:k.photoURL)||""),[X,Y]=a.useState(!1),[Z,ee]=a.useState(10),[se]=a.useState(1),[re,te]=a.useState(!1),[ae,le]=a.useState("date"),[ie,oe]=a.useState("desc"),[ce,ne]=a.useState(""),[de,xe]=a.useState("all");a.useEffect(()=>{k&&U(l(k.uid))},[k,U]),a.useEffect(()=>{if(!k)return;P.length>0?(async()=>{const s={};for(const t of P)if(!s[t.quizId])try{const r=await p(t.quizId);s[t.quizId]=(null==r?void 0:r.title)||e("quiz.untitled")}catch(r){s[t.quizId]=e("quiz.untitled")}L(s),R(P)})():(R([]),L({})),P.length>0&&P.forEach((e,s)=>{});const s=P.length,r=P.map(e=>"number"==typeof e.correctAnswers&&"number"==typeof e.totalQuestions&&e.totalQuestions>0?Math.round(e.correctAnswers/e.totalQuestions*100):"number"!=typeof e.score||isNaN(e.score)?0:e.score<=1?Math.round(100*e.score):Math.round(e.score)),t=r.reduce((e,s)=>e+s,0),a=P.reduce((e,s)=>e+(s.correctAnswers||0),0),l=P.reduce((e,s)=>e+(s.totalQuestions||0),0),i=P.reduce((e,s)=>e+(s.timeSpent||0),0),o=s>0?t/s:0,c=l>0?a/l*100:0,n=s>0?i/s:0,d=r.filter(e=>e>=100).length,x=r.filter(e=>e>=80).length;I({totalQuizzes:s,totalScore:t,averageScore:o,accuracy:c,averageTime:n,perfectScores:d,highScores:x,recentActivity:P.slice(0,5)})},[P,k]);const ue=M.filter(s=>{if(ce){return(D[s.quizId]||e("quiz.untitled")).toLowerCase().includes(ce.toLowerCase())}return!0}).filter(e=>{const s=e.totalQuestions>0?e.correctAnswers/e.totalQuestions*100:0;switch(de){case"high":return s>=80;case"medium":return s>=60&&s<80;case"low":return s<60;default:return!0}}).sort((e,s)=>{let r=0;const t=e.totalQuestions>0?e.correctAnswers/e.totalQuestions*100:0,a=s.totalQuestions>0?s.correctAnswers/s.totalQuestions*100:0;switch(ae){case"date":r=new Date(s.completedAt).getTime()-new Date(e.completedAt).getTime();break;case"score":case"percentage":r=a-t;break;default:r=0}return"asc"===ie?-r:r}),pe=(se-1)*Z,me=re?ue:ue.slice(pe,pe+Z),he=(e,s,r,t,a="bg-blue-500")=>i.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx("div",{className:`p-3 rounded-full ${a}`,children:e}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r}),i.jsx("p",{className:"text-sm text-gray-600",children:s}),t&&i.jsx("p",{className:"text-xs text-gray-500",children:t})]})]})})}),ge=s=>{let r=0,t="none";"number"==typeof s.correctAnswers&&"number"==typeof s.totalQuestions&&s.totalQuestions>0?(r=Math.round(s.correctAnswers/s.totalQuestions*100),t="answers_calculation"):"number"!=typeof s.score||isNaN(s.score)?(t="fallback_zero",r=0):(r=s.score<=1?Math.round(100*s.score):Math.round(s.score),t=s.score<=1?"score_decimal":"score_percentage");return i.jsx("div",{className:"bg-white rounded-lg border border-gray-100 p-4 hover:shadow-md transition-shadow",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:D[s.quizId]||e("quiz.untitled")}),i.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[i.jsxs("span",{className:"flex items-center space-x-1",children:[i.jsx(x,{className:"w-4 h-4"}),i.jsxs("span",{children:[s.correctAnswers,"/",s.totalQuestions]})]}),i.jsxs("span",{className:"flex items-center space-x-1",children:[i.jsx(n,{className:"w-4 h-4"}),i.jsxs("span",{children:[Math.round((s.timeSpent||0)/60)," ",e("minutes")]})]}),i.jsxs("span",{className:"flex items-center space-x-1",children:[i.jsx(q,{className:"w-4 h-4"}),i.jsx("span",{children:new Date(s.completedAt).toLocaleDateString(Q.language)})]})]})]}),i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsxs("div",{className:"px-3 py-1 rounded-full text-sm font-medium "+(a=r,a>=90?"text-green-600 bg-green-50":a>=70?"text-blue-600 bg-blue-50":a>=50?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50"),children:[r,"%"]}),i.jsx(u,{to:`/quiz/${s.quizId}/reviews`,className:"p-2 text-gray-400 hover:text-purple-600 transition-colors",title:e("profile.viewAgain"),children:i.jsx(C,{className:"w-4 h-4"})}),i.jsx(u,{to:`/quiz-result/${s.id}`,className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:e("profile.viewDetails"),children:i.jsx(m,{className:"w-4 h-4"})})]})]})},s.id);var a};return k?i.jsx("div",{className:"min-h-screen bg-gray-50",children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8",children:i.jsxs("div",{className:"flex items-center space-x-6",children:[i.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:k.photoURL?i.jsx("img",{src:k.photoURL,alt:"Avatar",className:"w-full h-full rounded-full object-cover"}):i.jsx(o,{className:"w-10 h-10 text-white"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:k.displayName||k.email}),i.jsx("p",{className:"text-gray-600",children:k.email}),i.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[e("profile.memberSince")," ",(new Date).toLocaleDateString(Q.language)]})]}),i.jsx("button",{onClick:()=>$("settings"),className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",children:i.jsx(y,{className:"w-5 h-5"})})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 mb-8",children:i.jsx("div",{className:"flex space-x-8 px-6",children:[{id:"overview",label:e("profile.tabs.overview"),icon:c},{id:"history",label:e("profile.tabs.history"),icon:n},{id:"achievements",label:e("profile.tabs.achievements"),icon:v},{id:"settings",label:e("profile.tabs.settings"),icon:o}].map(({id:e,label:s,icon:r})=>i.jsxs("button",{onClick:()=>$(e),className:"flex items-center space-x-2 py-4 border-b-2 transition-colors "+(E===e?"border-blue-500 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"),children:[i.jsx(r,{className:"w-4 h-4"}),i.jsx("span",{children:s})]},e))})}),"overview"===E&&T&&i.jsxs("div",{children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[he(i.jsx(v,{className:"w-6 h-6 text-white"}),e("profile.stats.completedQuizzes"),T.totalQuizzes,void 0,"bg-yellow-500"),he(i.jsx(d,{className:"w-6 h-6 text-white"}),e("profile.stats.averageScore"),T.averageScore.toFixed(1),e("profile.stats.onTotal"),"bg-blue-500"),he(i.jsx(x,{className:"w-6 h-6 text-white"}),e("profile.stats.accuracy"),`${T.accuracy.toFixed(1)}%`,e("profile.stats.correctRate"),"bg-green-500"),he(i.jsx(c,{className:"w-6 h-6 text-white"}),e("profile.stats.highScores"),`${T.highScores}/${T.totalQuizzes}`,e("profile.stats.over80"),"bg-purple-500")]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:e("profile.recentActivity")}),i.jsx("div",{className:"space-y-4",children:T.recentActivity.map(e=>ge(e))}),T.totalQuizzes>5&&i.jsx("div",{className:"mt-6 text-center",children:i.jsxs("button",{onClick:()=>$("history"),className:"text-blue-600 hover:text-blue-700 font-medium flex items-center space-x-1 mx-auto",children:[i.jsx("span",{children:e("profile.viewAllHistory")}),i.jsx(A,{className:"w-4 h-4"})]})})]})]}),"history"===E&&i.jsxs("div",{children:[i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6",children:i.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsxs("div",{className:"relative",children:[i.jsx(N,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),i.jsx("input",{type:"text",placeholder:e("profile.searchPlaceholder"),value:ce,onChange:e=>ne(e.target.value),className:"pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),i.jsxs("select",{value:de,onChange:e=>xe(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[i.jsx("option",{value:"all",children:e("profile.filters.score.all")}),i.jsx("option",{value:"high",children:e("profile.filters.score.high")}),i.jsx("option",{value:"medium",children:e("profile.filters.score.medium")}),i.jsx("option",{value:"low",children:e("profile.filters.score.low")})]})]}),i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsxs("span",{className:"text-sm text-gray-600",children:[e("profile.sort.label"),":"]}),i.jsxs("select",{value:ae,onChange:e=>le(e.target.value),className:"px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500",children:[i.jsx("option",{value:"date",children:e("profile.sort.date")}),i.jsx("option",{value:"score",children:e("profile.sort.score")}),i.jsx("option",{value:"percentage",children:e("profile.sort.percentage")})]}),i.jsx("button",{onClick:()=>oe("asc"===ie?"desc":"asc"),className:"p-1 text-gray-400 hover:text-gray-600",children:"asc"===ie?i.jsx(S,{className:"w-4 h-4"}):i.jsx(z,{className:"w-4 h-4"})})]}),i.jsxs("select",{value:Z,onChange:e=>ee(Number(e.target.value)),className:"px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500",children:[i.jsx("option",{value:10,children:e("profile.pagination.perPage10")}),i.jsx("option",{value:25,children:e("profile.pagination.perPage25")}),i.jsx("option",{value:50,children:e("profile.pagination.perPage50")}),i.jsx("option",{value:100,children:e("profile.pagination.perPage100")})]}),ue.length>Z&&i.jsx("button",{onClick:()=>te(!re),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:e(re?"profile.pagination.paginate":"profile.viewAllCount")})]})]})}),i.jsx("div",{className:"space-y-4",children:me.length>0?me.map(e=>ge(e)):i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-8 text-center",children:[i.jsx(v,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:e("profile.noResults")}),i.jsx("p",{className:"text-gray-600 mb-4",children:e("profile.noResultsDesc")}),i.jsx(u,{to:"/quizzes",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:e("quiz.exploreQuizzes")})]})}),!re&&ue.length>Z&&i.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("p",{className:"text-sm text-gray-600",children:"Showing results"}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("button",{className:"px-3 py-1 border border-gray-300 rounded text-sm",children:"Previous"}),i.jsx("span",{className:"px-3 py-1 text-sm text-gray-600",children:"Page info"})]})]})})]}),"achievements"===E&&i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:e("profile.achievements")}),i.jsxs("div",{className:"text-center py-8",children:[i.jsx(v,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),i.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:e("profile.achievementSystem")}),i.jsx("p",{className:"text-gray-600",children:e("profile.inDevelopment")})]})]}),"settings"===E&&i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:e("profile.settings.title")}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e("auth.displayName")}),i.jsx("input",{type:"text",value:F,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e("profile.avatarUrl")}),i.jsx("input",{type:"url",value:V,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),i.jsx("button",{onClick:async()=>{if(k&&h.currentUser){Y(!0);try{await g(h.currentUser,{displayName:F,photoURL:V}),f.success(e("profile.profileUpdateSuccess"))}catch(s){f.error(e("profile.profileUpdateError"))}finally{Y(!1)}}},disabled:X,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:e(X?"profile.updating":"profile.updateProfile")})]})]}),i.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:e("profile.changePassword")}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e("profile.currentPassword")}),i.jsx("input",{type:"password",value:H,onChange:e=>G(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:e("profile.currentPasswordRequired")})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e("profile.newPassword")}),i.jsx("input",{type:"password",value:J,onChange:e=>K(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(J&&J.length<6?"border-red-300":"border-gray-300"),placeholder:e("profile.passwordTooShort")}),J&&J.length<6&&i.jsx("p",{className:"text-xs text-red-500 mt-1",children:e("profile.passwordTooShort")})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e("profile.confirmNewPassword")}),i.jsx("input",{type:"password",value:O,onChange:e=>B(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(O&&J!==O?"border-red-300":"border-gray-300"),placeholder:e("profile.passwordMismatch")}),O&&J!==O&&i.jsx("p",{className:"text-xs text-red-500 mt-1",children:e("profile.passwordMismatch")})]}),i.jsx("button",{onClick:async()=>{if(h.currentUser&&H&&J&&O)if(J===O)if(J.length<6)f.error(e("profile.passwordTooShort"));else if(J!==H)if(h.currentUser.email){Y(!0);try{const s=b.credential(h.currentUser.email,H);await j(h.currentUser,s),await w(h.currentUser,J),G(""),K(""),B(""),f.success(e("profile.passwordChangeSuccess"))}catch(s){"auth/wrong-password"===s.code||"auth/invalid-credential"===s.code?f.error(e("profile.wrongPassword")):"auth/weak-password"===s.code?f.error(e("profile.weakPassword")):"auth/requires-recent-login"===s.code?f.error(e("profile.requiresRecentLogin")):f.error(e("profile.passwordChangeError",{message:s.message}))}finally{Y(!1)}}else f.error(e("profile.emailNotFound"));else f.error(e("profile.passwordMustDiffer"));else f.error(e("profile.passwordMismatch"));else f.error(e("profile.fillAllFields"))},disabled:X||!H||!J||!O||J.length<6||J!==O||J===H,className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors",children:e(X?"profile.authenticating":"profile.changePassword")}),i.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[i.jsxs("p",{children:["⚠️ ",e("profile.currentPasswordRequired")]}),i.jsxs("p",{children:["✓ ",e("profile.passwordMinLength")]}),i.jsxs("p",{children:["✓ ",e("profile.passwordMustDiffer")]})]})]})]})]})]})}):i.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:i.jsx("div",{className:"text-center",children:i.jsx("p",{className:"text-gray-600",children:e("profile.loginRequired")})})})};export{Q as default};

import{r as e,j as s,u as t,a,n as l,m as i,h as n,y as r,t as d,g as c}from"./index-D8X0wEz4.js";import{A as o}from"./AdminLayout-COYfPZQl.js";const x=({isOpen:t,onClose:a,title:l,children:i,size:n="md",closeOnBackdrop:r=!0,showCloseButton:d=!0})=>{e.useEffect(()=>{const e=e=>{"Escape"===e.key&&a()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,a]);return t?s.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:r?a:void 0}),s.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:s.jsxs("div",{className:`\n            relative bg-white rounded-lg shadow-xl transform transition-all\n            w-full ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[n]}\n          `,onClick:e=>e.stopPropagation(),children:[(l||d)&&s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[l&&s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l}),d&&s.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors p-1","aria-label":"Đóng modal",children:s.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{className:"p-6",children:i})]})})]}):null},m=()=>{const{user:m}=t(e=>e.auth),{t:u}=a(),[h,p]=e.useState([]),[g,y]=e.useState(!0),[v,f]=e.useState("all"),[b,j]=e.useState({open:!1,type:null});e.useEffect(()=>{N()},[]);const N=async()=>{try{const e=(await l(i(n,"users"))).docs.map(e=>({id:e.id,...e.data()})).filter(e=>!e.isDeleted);p(e)}catch(e){}finally{y(!1)}},w="all"===v?h:h.filter(e=>e.role===v);return"admin"!==(null==m?void 0:m.role)?s.jsx("div",{className:"text-center py-12",children:s.jsx("p",{className:"text-gray-600",children:u("admin.loginAsAdmin")})}):g?s.jsx("div",{className:"flex items-center justify-center min-h-96",children:s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):s.jsxs(o,{title:`👥 ${u("admin.userManagement")}`,children:[s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"flex space-x-4",children:[{key:"all",label:u("common.all"),count:h.length},{key:"admin",label:u("ui.admin"),count:h.filter(e=>"admin"===e.role).length},{key:"creator",label:u("ui.creator"),count:h.filter(e=>"creator"===e.role).length},{key:"user",label:u("ui.user"),count:h.filter(e=>"user"===e.role).length}].map(e=>s.jsxs("button",{onClick:()=>f(e.key),className:"px-4 py-2 rounded-lg font-medium transition-colors "+(v===e.key?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[e.label," (",e.count,")"]},e.key))})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:u("admin.userManagementCards.totalUsers")}),s.jsx("p",{className:"text-3xl font-bold text-blue-600",children:h.length})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:u("admin.userManagementCards.activeUsers")}),s.jsx("p",{className:"text-3xl font-bold text-green-600",children:h.filter(e=>!1!==e.isActive).length})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:u("ui.creator")}),s.jsx("p",{className:"text-3xl font-bold text-purple-600",children:h.filter(e=>"creator"===e.role).length})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:u("ui.admin")}),s.jsx("p",{className:"text-3xl font-bold text-red-600",children:h.filter(e=>"admin"===e.role).length})]})]}),s.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("ui.user")}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("ui.role")}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("status.label")}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("common.createdAt")}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:u("action.actions")})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(e=>{var t,a,l,i,n;return s.jsxs("tr",{className:e.id===(null==m?void 0:m.uid)?"bg-blue-50":"",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:s.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:s.jsx("span",{className:"text-sm font-medium text-gray-700",children:(null==(t=e.displayName)?void 0:t.charAt(0))||(null==(a=e.email)?void 0:a.charAt(0))||"U"})})}),s.jsxs("div",{className:"ml-4",children:[s.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[e.displayName||u("profile.displayName"),e.id===(null==m?void 0:m.uid)&&s.jsxs("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:["(",u("common.you"),")"]})]}),s.jsx("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("select",{value:e.role,onChange:s=>j({open:!0,type:"roleChange",payload:{userId:e.id,newRole:s.target.value},message:`Bạn có chắc chắn muốn đổi quyền cho người dùng này thành ${s.target.value}?`}),disabled:e.id===(null==m?void 0:m.uid),className:"text-sm border border-gray-300 rounded px-2 py-1",children:[s.jsx("option",{value:"user",children:"User"}),s.jsx("option",{value:"creator",children:u("nav.creator")}),s.jsx("option",{value:"admin",children:u("admin.quizManagement.adminBadge")})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(!1!==e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:!1!==e.isActive?u("status.active"):u("status.inactive")})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(null==(n=null==(i=null==(l=e.createdAt)?void 0:l.toDate)?void 0:i.call(l))?void 0:n.toLocaleDateString())||"N/A"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:s.jsx("div",{className:"flex space-x-2",children:e.id!==(null==m?void 0:m.uid)&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>j({open:!0,type:"toggleUserStatus",payload:{userId:e.id,currentStatus:!1!==e.isActive},message:!1!==e.isActive?"Bạn có chắc chắn muốn khóa tài khoản này?":"Bạn có chắc chắn muốn kích hoạt tài khoản này?"}),className:"px-3 py-1 rounded text-xs "+(!1!==e.isActive?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"),disabled:g,children:!1!==e.isActive?u("action.deactivate"):u("action.activate")}),s.jsx("button",{onClick:()=>j({open:!0,type:"deleteUser",payload:{userId:e.id},message:u("users.confirmDelete")}),className:"px-3 py-1 bg-red-100 text-red-600 rounded text-xs hover:bg-red-200",disabled:g,children:u("delete")})]})})})]},e.id)})})]})}),s.jsxs(x,{isOpen:b.open,onClose:()=>j({open:!1,type:null}),title:u("action.confirm"),children:[s.jsx("div",{className:"mb-4",children:b.message}),s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx("button",{onClick:()=>j({open:!1,type:null}),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",disabled:g,children:u("cancel")}),s.jsx("button",{onClick:async()=>{"deleteUser"===b.type&&await(async e=>{if(e!==(null==m?void 0:m.uid)){y(!0);try{await d(c(n,"users",e),{isActive:!1,isDeleted:!0,deletedAt:new Date,deletedBy:null==m?void 0:m.uid}),p(s=>s.filter(s=>s.id!==e)),r.success(u("admin.userDeleteSuccess"))}catch(s){r.error(u("admin.userDeleteError"))}finally{y(!1)}}else r.error(u("admin.users.cannotDeleteSelf"))})(b.payload.userId),"toggleUserStatus"===b.type&&await(async(e,s)=>{if(e!==(null==m?void 0:m.uid)){y(!0);try{await d(c(n,"users",e),{isActive:!s}),p(t=>t.map(t=>t.id===e?{...t,isActive:!s}:t)),r.success(u("admin.userStatusUpdateSuccess",{action:u(s?"admin.deactivated":"admin.activated")}))}catch(t){r.error(u("messages.error"))}finally{y(!1)}}else r.error(u("admin.users.cannotDeactivateSelf"))})(b.payload.userId,b.payload.currentStatus),"roleChange"===b.type&&await(async(e,s)=>{if(e!==(null==m?void 0:m.uid)||"admin"===s){y(!0);try{await d(c(n,"users",e),{role:s}),p(t=>t.map(t=>t.id===e?{...t,role:s}:t)),r.success(u("admin.roleUpdateSuccess"))}catch(t){r.error(u("messages.error"))}finally{y(!1)}}else r.error(u("admin.users.cannotChangeSelfRole"))})(b.payload.userId,b.payload.newRole),j({open:!1,type:null})},className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",disabled:g,children:u("action.confirm")})]})]})]})};export{m as default};

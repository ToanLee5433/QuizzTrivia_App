const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dp2ZjDRA.js","assets/index-DwacsBZh.css"])))=>i.map(i=>d[i]);
import{g as e,h as t,t as s,s as r,Y as a,i as n,Z as i,p as l,m as o,B as d,l as c,e as u,u as m,r as x,_ as h,$ as g,a0 as b,y as p,j as w,a as f}from"./index-Dp2ZjDRA.js";const j=new class{async trackView(l,o){try{const d=e(t,"quizzes",l);if(await s(d,{"stats.views":a(1),"stats.lastUpdated":r()}),o){const a=e(t,"userQuizActivities",`${o}_${l}`);(await n(a)).exists()?await s(a,{viewed:!0,lastView:r()}):await i(a,{userId:o,quizId:l,viewed:!0,attempted:!1,completed:!1,attempts:0,bestScore:0,firstView:r(),lastView:r()})}}catch(d){}}async trackAttempt(l,o){try{const d=e(t,"quizzes",l);await s(d,{"stats.attempts":a(1),"stats.lastUpdated":r()});const c=e(t,"userQuizActivities",`${o}_${l}`);(await n(c)).exists()?await s(c,{attempted:!0,attempts:a(1),lastAttempt:r()}):await i(c,{userId:o,quizId:l,viewed:!0,attempted:!0,completed:!1,attempts:1,bestScore:0,firstView:r(),lastAttempt:r()})}catch(d){}}async trackCompletion(d,c,u,m){try{const x=Math.round(u/m*100),h=e(t,"quizzes",d),g=await n(h);if(g.exists()){const e=g.data().stats||{},t=e.completions||0,n=(e.totalScore||0)+x,i=t+1,l=Math.round(n/i);await s(h,{"stats.completions":a(1),"stats.totalScore":a(x),"stats.averageScore":l,"stats.lastUpdated":r()})}else await s(h,{"stats.completions":1,"stats.totalScore":x,"stats.averageScore":x,"stats.views":a(0),"stats.attempts":a(0),"stats.lastUpdated":r()});const b=e(t,"userQuizActivities",`${c}_${d}`),p=await n(b);if(p.exists()){const e=p.data().bestScore||0,t=Math.max(e,x);await s(b,{completed:!0,bestScore:t,lastCompletion:r()})}else await i(b,{userId:c,quizId:d,viewed:!0,attempted:!0,completed:!0,attempts:1,bestScore:x,firstView:r(),lastAttempt:r(),lastCompletion:r()});await l(o(t,"quizCompletions"),{userId:c,quizId:d,score:x,totalQuestions:m,completedAt:r()})}catch(x){}}async getQuizStats(s){try{const r=e(t,"quizzes",s),a=await n(r);if(a.exists()){return a.data().stats||{views:0,attempts:0,completions:0,averageScore:0,totalScore:0,lastUpdated:new Date}}return null}catch(r){return null}}async getUserQuizActivity(s,r){try{const a=e(t,"userQuizActivities",`${s}_${r}`),i=await n(a);return i.exists()?i.data():null}catch(a){return null}}async initializeStatsForQuiz(a){try{const n=e(t,"quizzes",a);await s(n,{"stats.views":0,"stats.attempts":0,"stats.completions":0,"stats.averageScore":0,"stats.totalScore":0,"stats.lastUpdated":r()})}catch(n){}}},y=({timeLeft:e,isWarning:t,isCritical:s,percentage:r=0})=>w.jsxs("div",{className:`rounded-md border p-3 transition-all duration-300 ${s?"bg-red-50 border-red-200":t?"bg-amber-50 border-amber-200":"bg-blue-50 border-blue-200"} ${s?"animate-pulse":""}`,children:[w.jsxs("div",{className:"flex items-center justify-between mb-2",children:[w.jsxs("span",{className:"text-xs font-medium text-gray-600 flex items-center",children:[w.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Thời gian còn lại"]}),w.jsx("span",{className:"text-lg font-bold font-mono "+(s?"text-red-600":t?"text-amber-600":"text-blue-600"),children:e})]}),w.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:w.jsx("div",{className:"h-1.5 rounded-full transition-all duration-1000 "+(s?"bg-red-500":t?"bg-amber-500":"bg-blue-500"),style:{width:`${Math.min(r,100)}%`}})}),s&&w.jsxs("div",{className:"text-xs text-red-600 font-medium mt-1 flex items-center",children:[w.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:w.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Sắp hết giờ!"]}),t&&!s&&w.jsxs("div",{className:"text-xs text-amber-600 font-medium mt-1 flex items-center",children:[w.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:w.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"Còn ít thời gian"]})]}),v=({current:e,total:t,percentage:s})=>w.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4",children:[w.jsxs("div",{className:"flex items-center justify-between mb-3",children:[w.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Tiến độ"}),w.jsxs("span",{className:"text-sm font-bold text-gray-900",children:[e," / ",t]})]}),w.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:w.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${s}%`}})})]}),N=({question:e,questionNumber:t,value:s,onChange:r})=>{const{t:a}=f();return w.jsxs("div",{className:"space-y-6",children:[w.jsxs("div",{children:[w.jsxs("div",{className:"flex items-center justify-between mb-4",children:[w.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[a("quiz.question")," ",t," / ",e.points," ",a("common.points")]}),w.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:["multiple"===e.type&&a("quiz.questionTypes.multiple"),"boolean"===e.type&&a("quiz.questionTypes.boolean"),"short_answer"===e.type&&a("quiz.questionTypes.short_answer"),"image"===e.type&&a("quiz.questionTypes.image"),"checkbox"===e.type&&a("quiz.questionTypes.checkbox")]})]}),w.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-6",dangerouslySetInnerHTML:{__html:e.text||""}})]}),(()=>{switch(e.type){case"multiple":return w.jsx("div",{className:"space-y-3",children:e.answers.map((e,t)=>w.jsx("button",{onClick:()=>r(e.id),className:"w-full p-4 text-left rounded-lg border-2 transition-all "+(s===e.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:w.jsxs("div",{className:"flex items-center space-x-3",children:[w.jsx("div",{className:"w-4 h-4 rounded-full border-2 "+(s===e.id?"border-blue-500 bg-blue-500":"border-gray-300"),children:s===e.id&&w.jsx("div",{className:"w-2 h-2 bg-white rounded-full mx-auto mt-0.5"})}),w.jsxs("span",{className:"font-medium mr-3",children:[String.fromCharCode(65+t),"."]}),w.jsx("span",{className:"flex-1",dangerouslySetInnerHTML:{__html:e.text||""}})]})},e.id))});case"boolean":return w.jsx("div",{className:"space-y-3",children:e.answers.map((e,t)=>w.jsx("button",{onClick:()=>r(e.id),className:"w-full p-4 text-left rounded-lg border-2 transition-all "+(s===e.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:w.jsxs("div",{className:"flex items-center space-x-3",children:[w.jsx("div",{className:"w-4 h-4 rounded-full border-2 "+(s===e.id?"border-blue-500 bg-blue-500":"border-gray-300"),children:s===e.id&&w.jsx("div",{className:"w-2 h-2 bg-white rounded-full mx-auto mt-0.5"})}),w.jsxs("span",{className:"font-medium mr-3",children:[String.fromCharCode(65+t),"."]}),w.jsx("span",{className:"flex-1 font-medium "+(e.text===a("quiz.boolean.true")?"text-green-600":"text-red-600"),dangerouslySetInnerHTML:{__html:e.text||""}})]})},e.id))});case"short_answer":return w.jsx("div",{className:"space-y-4",children:w.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[w.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"💡 Nhập đáp án vào ô bên dưới:"}),w.jsx("input",{type:"text",value:s||"",onChange:e=>r(e.target.value),placeholder:a("quiz.enterAnswer"),className:"w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-lg"})]})});case"image":return w.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.answers.map((e,t)=>w.jsxs("button",{onClick:()=>r(e.id),className:"relative p-4 rounded-lg border-2 transition-all "+(s===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:[e.imageUrl?w.jsxs("div",{className:"w-full h-32 mb-3 rounded-lg overflow-hidden bg-gray-100",children:[w.jsx("img",{src:e.imageUrl,alt:e.text||`Option ${String.fromCharCode(65+t)}`,className:"w-full h-full object-cover",onError:e=>{var t;const s=e.target;s.style.display="none",null==(t=s.nextElementSibling)||t.classList.remove("hidden")}}),w.jsx("div",{className:"hidden w-full h-full flex items-center justify-center text-gray-400",children:w.jsx("span",{className:"text-sm",children:"Không thể tải ảnh"})})]}):w.jsx("div",{className:"w-full h-32 mb-3 rounded-lg bg-gray-100 flex items-center justify-center",children:w.jsx("span",{className:"text-gray-400 text-sm",children:"Chưa có ảnh"})}),w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("span",{className:"font-medium text-gray-700",children:[String.fromCharCode(65+t),". ",e.text||`Ảnh ${t+1}`]}),w.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center "+(s===e.id?"border-blue-500 bg-blue-500":"border-gray-300"),children:s===e.id&&w.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})]},e.id))});case"checkbox":return w.jsxs("div",{className:"space-y-3",children:[w.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:w.jsx("p",{className:"text-sm text-yellow-700",children:"💡 Bạn có thể chọn nhiều đáp án cho câu hỏi này."})}),e.answers.map((e,t)=>{const a=Array.isArray(s)&&s.includes(e.id);return w.jsx("button",{onClick:()=>{const t=Array.isArray(s)?s:[],n=a?t.filter(t=>t!==e.id):[...t,e.id];r(n)},className:"w-full p-4 text-left rounded-lg border-2 transition-all "+(a?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:w.jsxs("div",{className:"flex items-center space-x-3",children:[w.jsx("div",{className:"w-4 h-4 rounded border-2 "+(a?"border-blue-500 bg-blue-500":"border-gray-300"),children:a&&w.jsx("div",{className:"text-white text-xs flex items-center justify-center h-full",children:"✓"})}),w.jsxs("span",{className:"font-medium mr-3",children:[String.fromCharCode(65+t),"."]}),w.jsx("span",{className:"flex-1",dangerouslySetInnerHTML:{__html:e.text||""}})]})},e.id)})]});default:return w.jsx("div",{children:a("quiz.unsupportedType")})}})()]})},C=({questions:e,currentQuestionIndex:t,answers:s,onQuestionSelect:r})=>w.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4",children:[w.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-3",children:"Điều hướng nhanh"}),w.jsx("div",{className:"grid grid-cols-5 gap-2",children:e.map((e,a)=>w.jsx("button",{onClick:()=>r(a),className:"w-8 h-8 rounded text-xs font-medium transition-colors "+(a===t?"bg-blue-500 text-white":s[e.id]?"bg-green-500 text-white":"bg-gray-200 text-gray-600 hover:bg-gray-300"),children:a+1},e.id))})]}),z=({modalControls:e,onConfirmExit:t,onConfirmSubmit:s,unansweredQuestions:r,onGoToQuestion:a})=>{const{t:n}=f();return w.jsxs(w.Fragment,{children:[e.showExitModal&&w.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:w.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[w.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Bạn có chắc muốn thoát?"}),w.jsx("p",{className:"text-gray-600 mb-6",children:"Tiến độ của bạn sẽ bị mất nếu thoát bây giờ."}),w.jsxs("div",{className:"flex gap-3",children:[w.jsx("button",{onClick:()=>e.setShowExitModal(!1),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",children:"Tiếp tục làm bài"}),w.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Thoát"})]})]})}),e.showSubmitModal&&w.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:w.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[w.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Xác nhận nộp bài"}),w.jsx("p",{className:"text-gray-600 mb-6",children:"Bạn có chắc chắn muốn nộp bài? Sau khi nộp sẽ không thể thay đổi đáp án."}),w.jsxs("div",{className:"flex gap-3",children:[w.jsx("button",{onClick:()=>e.setShowSubmitModal(!1),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",children:n("common.cancel")}),w.jsx("button",{onClick:s,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Nộp bài"})]})]})}),e.showUnansweredModal&&w.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:w.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg mx-4",children:[w.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Còn câu hỏi chưa trả lời"}),w.jsxs("p",{className:"text-gray-600 mb-4",children:["Bạn còn ",r.length," câu hỏi chưa trả lời:"]}),w.jsx("div",{className:"max-h-40 overflow-y-auto mb-6",children:r.map((t,s)=>w.jsxs("button",{onClick:()=>{e.setShowUnansweredModal(!1),a(s)},className:"block w-full text-left p-2 hover:bg-gray-100 rounded text-blue-600 hover:text-blue-800",children:["Câu ",s+1,": ",t.text.slice(0,50),"..."]},t.id))}),w.jsxs("div",{className:"flex gap-3",children:[w.jsx("button",{onClick:()=>e.setShowUnansweredModal(!1),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",children:"Tiếp tục làm bài"}),w.jsx("button",{onClick:s,className:"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors",children:"Nộp bài luôn"})]})]})})]})},k=()=>{const{quiz:e,loading:t,error:s}=(()=>{const{id:e}=d(),t=c(),s=u(),{quizzes:r,currentQuiz:a,loading:n,error:i}=m(e=>e.quiz),l=m(e=>e.auth.user),[o,g]=x.useState(null);return x.useEffect(()=>{if(!e)return void t("/quiz-list");const a=r.find(t=>t.id===e);a?(g(a),s(h(a)),l?j.trackView(e,l.uid):j.trackView(e)):t("/quiz-list")},[e,r,t,s,l]),x.useEffect(()=>{a&&a.id===e&&g(a)},[a,e]),{quiz:o,loading:n,error:i}})();return t?w.jsx("div",{className:"min-h-screen flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),w.jsx("p",{className:"mt-4 text-gray-600",children:"Đang tải quiz..."})]})}):s||!e?w.jsx("div",{className:"min-h-screen flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),w.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Không thể tải quiz"}),w.jsx("p",{className:"text-gray-600",children:s||"Quiz không tồn tại"})]})}):w.jsx(S,{quiz:e})},S=({quiz:e})=>{const t=c(),{session:s,updateAnswer:r,setCurrentQuestion:a,completeQuiz:n,getUnansweredQuestions:i,progress:l}=(({quiz:e})=>{const t=c(),{user:s}=m(e=>e.auth),[r,a]=x.useState({quizId:e.id,startTime:Date.now(),currentQuestionIndex:0,answers:{},isCompleted:!1,timeSpent:0});x.useEffect(()=>{s&&j.trackAttempt(e.id,s.uid)},[e.id,s]),x.useEffect(()=>{const e=setInterval(()=>{a(e=>({...e,timeSpent:Date.now()-e.startTime}))},1e3);return()=>clearInterval(e)},[]);const n=x.useCallback((e,t)=>{a(s=>({...s,answers:{...s.answers,[e]:t}}))},[]),i=x.useCallback(e=>{a(t=>({...t,currentQuestionIndex:e}))},[]),l=x.useCallback((e,t)=>{var s;if(null==t)return!1;switch(e.type){case"boolean":case"multiple":case"image":return t===(null==(s=e.answers.find(e=>e.isCorrect))?void 0:s.id);case"checkbox":{const s=e.answers.filter(e=>e.isCorrect).map(e=>e.id).sort(),r=Array.isArray(t)?[...t].sort():[];return JSON.stringify(s)===JSON.stringify(r)}case"short_answer":return((e,t)=>{if("short_answer"!==t.type)return!1;const s=e=>e.trim().toLowerCase().replace(/\s+/g," "),r=s(e);return!(!t.correctAnswer||s(t.correctAnswer)!==r)||!!t.acceptedAnswers&&t.acceptedAnswers.some(e=>s(e)===r)})(t,e);default:return!1}},[]),o=x.useCallback((e,t)=>{let s=0;const r=e.length;e.forEach(e=>{const r=t[e.id];l(e,r)&&s++});const a=r>0?Math.round(s/r*100):0;return{correct:s,total:r,percentage:a}},[l]),d=x.useCallback(async()=>{var n;const i={...r,isCompleted:!0,endTime:Date.now(),timeSpent:Date.now()-r.startTime};a(i);const d=o(e.questions,i.answers);let c;try{if(s){const t=Object.entries(i.answers).map(([t,s])=>{const r=e.questions.find(e=>e.id===t),a=!!r&&l(r,s);return{questionId:t,selectedAnswerId:"string"==typeof s?s:JSON.stringify(s),isCorrect:a,timeSpent:0}}),r={userId:s.uid,userEmail:s.email||"",userName:s.displayName||(null==(n=s.email)?void 0:n.split("@")[0])||"Anonymous",quizId:e.id,score:d.percentage,correctAnswers:d.correct,totalQuestions:d.total,timeSpent:Math.round(i.timeSpent/1e3),answers:t,completedAt:new Date},{submitQuizResult:a}=await b(async()=>{const{submitQuizResult:e}=await import("./index-Dp2ZjDRA.js").then(e=>e.aj);return{submitQuizResult:e}},__vite__mapDeps([0,1]));c=await a(r)}}catch(u){}c?t(`/quiz-result/${c}`,{state:{quiz:e,session:i,score:d,correct:d.correct,total:d.total,answers:i.answers,timeSpent:Math.round(i.timeSpent/1e3),quizId:e.id,resultId:c}}):(p.error("Không thể lưu kết quả quiz. Vui lòng thử lại!"),t("/quizzes"))},[r,e,t,o,s]),u=x.useCallback(()=>Object.keys(r.answers).filter(e=>{const t=r.answers[e];return null!=t&&""!==t&&!(Array.isArray(t)&&0===t.length)}),[r.answers]),h=x.useCallback(()=>e.questions.filter(e=>{const t=r.answers[e.id];return null==t||""===t||Array.isArray(t)&&0===t.length}),[e.questions,r.answers]),g=u().length/e.questions.length*100;return{session:r,updateAnswer:n,setCurrentQuestion:i,completeQuiz:d,calculateScore:o,getAnsweredQuestions:u,getUnansweredQuestions:h,progress:g}})({quiz:e}),{formattedTime:o,isTimeRunningOut:d,isTimeCritical:h,percentage:f}=(({onTimeUp:e,isActive:t=!0})=>{const s=u(),{timeLeft:r,totalTime:a,quizStartTime:n,isTimeWarning:i}=m(e=>e.quiz),l=x.useRef(null),[o,d]=x.useState(!1);x.useEffect(()=>(t&&n&&a>0?(l.current=setInterval(()=>{s(g())},1e3),s(g())):l.current&&(clearInterval(l.current),l.current=null),()=>{l.current&&(clearInterval(l.current),l.current=null)}),[t,n,a,s]),x.useEffect(()=>{r<=0&&!o&&n&&(d(!0),e())},[r,o,e,n]);const c=x.useCallback(e=>{const t=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},[]),h=c(r),b=a>0?(a-r)/a*100:0,p=Math.ceil(.1*a),w=r<=p,f=r<=Math.ceil(.05*a),j=n?Math.floor((Date.now()-n)/1e3):0,y=c(j);return{timeLeft:r,formattedTime:h,percentage:b,isRunning:t,isTimeRunningOut:w,isTimeCritical:f,isTimeWarning:i,timeTaken:j,timeTakenFormatted:y,totalTime:a,formatTime:c}})({onTimeUp:n,isActive:!s.isCompleted}),{goToNextQuestion:k,goToPreviousQuestion:S,goToQuestion:q,handleExitQuiz:Q,confirmExitQuiz:T,handleSubmitQuiz:A,isFirstQuestion:M,isLastQuestion:I,modalControls:L}=(({questions:e,currentQuestionIndex:t,onQuestionChange:s,answers:r})=>{const a=c(),[n,i]=x.useState(!1),[l,o]=x.useState(!1),[d,u]=x.useState(!1);return{goToNextQuestion:x.useCallback(()=>{t<e.length-1&&s(t+1)},[t,e.length,s]),goToPreviousQuestion:x.useCallback(()=>{t>0&&s(t-1)},[t,s]),goToQuestion:x.useCallback(t=>{t>=0&&t<e.length&&s(t)},[e.length,s]),handleExitQuiz:x.useCallback(()=>{i(!0)},[]),confirmExitQuiz:x.useCallback(()=>{a("/quiz-list")},[a]),handleSubmitQuiz:x.useCallback(()=>{e.filter(e=>!r[e.id]||Array.isArray(r[e.id])&&0===r[e.id].length||""===r[e.id]).length>0?u(!0):o(!0)},[e,r]),getUnansweredQuestions:x.useCallback(()=>e.filter(e=>!r[e.id]||Array.isArray(r[e.id])&&0===r[e.id].length||""===r[e.id]),[e,r]),isFirstQuestion:0===t,isLastQuestion:t===e.length-1,modalControls:{showExitModal:n,setShowExitModal:i,showSubmitModal:l,setShowSubmitModal:o,showUnansweredModal:d,setShowUnansweredModal:u}}})({questions:e.questions,currentQuestionIndex:s.currentQuestionIndex,onQuestionChange:a,answers:s.answers}),_=e.questions[s.currentQuestionIndex];return s.isCompleted?w.jsx("div",{className:"min-h-screen flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),w.jsx("p",{className:"mt-4 text-gray-600",children:"Đang xử lý kết quả..."})]})}):w.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 py-8",children:[w.jsx("div",{className:"bg-white shadow-sm border-b",children:w.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center space-x-4",children:[w.jsxs("button",{onClick:Q,className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),w.jsx("span",{children:"Thoát"})]}),w.jsx("div",{className:"h-6 w-px bg-gray-300"}),w.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:e.title})]}),w.jsxs("div",{className:"flex items-center space-x-3",children:[w.jsx("button",{onClick:()=>t("/multiplayer",{state:{selectedQuiz:e}}),className:"px-3 py-2 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-sm font-medium hover:opacity-90 shadow-sm",title:"Chơi cùng bạn bè",children:"Chơi cùng"}),w.jsx(v,{current:s.currentQuestionIndex+1,total:e.questions.length,percentage:l}),w.jsx(y,{timeLeft:o,isWarning:d,isCritical:h,percentage:f})]})]})})}),w.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:w.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[w.jsx("div",{className:"lg:col-span-1",children:w.jsx(C,{questions:e.questions,currentQuestionIndex:s.currentQuestionIndex,answers:s.answers,onQuestionSelect:q})}),w.jsx("div",{className:"lg:col-span-3",children:w.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:[w.jsx(N,{question:_,questionNumber:s.currentQuestionIndex+1,value:s.answers[_.id],onChange:e=>r(_.id,e)}),w.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t",children:[w.jsxs("button",{onClick:S,disabled:M,className:"flex items-center space-x-2 px-6 py-3 rounded-lg font-medium transition-all "+(M?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-600 text-white hover:bg-gray-700 shadow-sm hover:shadow-md"),children:[w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),w.jsx("span",{children:"Câu trước"})]}),w.jsx("div",{className:"flex space-x-3",children:I?w.jsxs("button",{onClick:A,className:"flex items-center space-x-2 px-8 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 shadow-sm hover:shadow-md transition-all",children:[w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),w.jsx("span",{children:"Nộp bài"})]}):w.jsxs("button",{onClick:k,className:"flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 shadow-sm hover:shadow-md transition-all",children:[w.jsx("span",{children:"Câu tiếp"}),w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]})]})})]})}),w.jsx(z,{modalControls:L,onConfirmExit:T,onConfirmSubmit:n,unansweredQuestions:i(),onGoToQuestion:q}),d&&w.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 text-red-600 rounded-lg flex items-center gap-2",children:[w.jsx("span",{className:"text-xl",children:"⏰"}),w.jsx("span",{className:"font-medium",children:h?"Chỉ còn ít hơn 1 phút! Hãy hoàn thành ngay.":"Sắp hết giờ! Chỉ còn 10% thời gian."})]})]})};export{k as default};

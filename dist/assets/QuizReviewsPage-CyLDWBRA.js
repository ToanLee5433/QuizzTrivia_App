import{a as S,r as c,g as D,y as u,b as Q,j as e,U as I,T as w,M as p,c as L,S as b,C as P}from"./index-CNQy308a.js";import{R as $}from"./ReviewForm-Dtv3lQdi.js";import{R as A}from"./ReviewList-DHtqEmV-.js";import"./send-jCzz2FPG.js";import"./calendar-CB6uY_Il.js";const T=()=>{const{id:l}=S(),[r,f]=c.useState(null),[d,x]=c.useState([]),[i,g]=c.useState(null),[m,n]=c.useState(!0),[y,o]=c.useState(!1);c.useEffect(()=>{l?(console.log("🎯 QuizReviewsPage mounted with quizId:",l),h()):(console.error("❌ No quizId provided in URL params"),n(!1))},[l]);const h=async()=>{if(!l){console.error("❌ No quizId provided"),n(!1);return}n(!0),console.log("🔄 Starting to load quiz and reviews for:",l);try{console.log("📝 Loading quiz details...");let t;try{if(t=await D(l),console.log("🔍 Raw quiz data from API:",t),t)console.log("✅ Quiz data loaded successfully:",t.title),f(t);else{console.error("❌ Quiz not found in database for ID:",l),console.log("🔧 Creating fallback quiz for testing...");const s={id:l,title:`Quiz Sample ${l}`,description:"Đây là quiz mẫu để test hệ thống đánh giá",category:"General",difficulty:"easy",questions:[{id:"1",text:"Câu hỏi mẫu?",type:"multiple",answers:[{id:"1",text:"Đáp án A",isCorrect:!0},{id:"2",text:"Đáp án B",isCorrect:!1},{id:"3",text:"Đáp án C",isCorrect:!1},{id:"4",text:"Đáp án D",isCorrect:!1}],explanation:"Giải thích mẫu",points:10}],duration:300,createdBy:"system",createdAt:new Date,updatedAt:new Date,isPublished:!0,tags:["sample","test"]};f(s),console.log("✅ Using fallback quiz for testing")}}catch(s){console.error("❌ Failed to load quiz:",s),u.error("Không tìm thấy quiz này"),n(!1);return}console.log("📊 Loading reviews...");try{const s=await Q.getQuizReviewsSimple(l);if(console.log(`✅ Reviews loaded: ${s.length} reviews found`),x(s||[]),s&&s.length>0){const j=s.reduce((a,k)=>a+(k.rating||0),0)/s.length,q={5:s.filter(a=>a.rating===5).length,4:s.filter(a=>a.rating===4).length,3:s.filter(a=>a.rating===3).length,2:s.filter(a=>a.rating===2).length,1:s.filter(a=>a.rating===1).length};g({totalReviews:s.length,averageRating:Math.round(j*10)/10,ratingDistribution:q}),console.log(`📈 Stats calculated: ${s.length} reviews, ${j.toFixed(1)} avg rating`)}else console.log("📊 No reviews found, setting empty stats"),g({totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0}})}catch(s){console.error("⚠️ Error loading reviews:",s),x([]),g({totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0}}),u.error("Không thể tải đánh giá")}console.log("🎉 Page loading completed successfully")}catch(t){console.error("❌ Critical error in loadQuizAndReviews:",t),u.error("Có lỗi khi tải trang đánh giá")}finally{n(!1),console.log("✅ Loading state set to false")}},N=async()=>{console.log("🔄 Review submitted, refreshing data..."),o(!1),x([]),n(!0),setTimeout(()=>{console.log("⏰ Delay completed, reloading reviews with cache bypass..."),h()},1500)},R=async t=>{console.log("Helpful clicked for review:",t)},z=async t=>{console.log("Report clicked for review:",t)},C=()=>i?e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(P,{className:"w-5 h-5 mr-2"}),"Phân bố đánh giá"]}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(t=>{const s=i.ratingDistribution[t]||0,v=i.totalReviews>0?s/i.totalReviews*100:0;return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-1 w-16",children:[e.jsx("span",{className:"text-sm font-medium",children:t}),e.jsx(b,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"})]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-400 h-2 rounded-full transition-all duration-300",style:{width:`${v}%`}})}),e.jsx("span",{className:"text-sm text-gray-600 w-12",children:s})]},t)})})]}):null;return m?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Đang tải thông tin quiz..."})]})}):r?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:r.title}),e.jsx("p",{className:"text-gray-600 mb-4",children:r.description}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:r.category})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{className:"capitalize",children:r.difficulty})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsxs("span",{children:[r.questions.length," câu hỏi"]})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{h()},disabled:m,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium disabled:opacity-50",title:"Làm mới đánh giá",children:e.jsx(L,{className:`w-4 h-4 ${m?"animate-spin":""}`})}),e.jsx("button",{onClick:()=>o(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Viết đánh giá"})]})]})}),i&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(b,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.averageRating.toFixed(1)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Điểm trung bình"}),e.jsx("div",{className:"flex items-center mt-1",children:[1,2,3,4,5].map(t=>e.jsx(b,{className:`w-4 h-4 ${t<=Math.round(i.averageRating)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},t))})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(p,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(i==null?void 0:i.totalReviews)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Tổng đánh giá"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:(i==null?void 0:i.totalReviews)===0?"Chưa có đánh giá":"người đã đánh giá"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:e.jsx(w,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[i.totalReviews>0?Math.round((i.ratingDistribution[5]+i.ratingDistribution[4])/i.totalReviews*100):0,"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Đánh giá tích cực"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:C()}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Đánh giá từ người dùng (",d.length,")"]}),e.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Viết đánh giá"})]})}),e.jsx("div",{className:"p-6",children:d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"💭"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Chưa có đánh giá nào"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Hãy trở thành người đầu tiên đánh giá quiz này! Chia sẻ trải nghiệm của bạn để giúp những người khác."}),e.jsxs("button",{onClick:()=>o(!0),className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(p,{className:"w-5 h-5 mr-2"}),"Viết đánh giá đầu tiên"]}),e.jsxs("div",{className:"mt-8 flex justify-center space-x-4",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-200 rounded-full animate-pulse"}),e.jsx("div",{className:"w-2 h-2 bg-blue-300 rounded-full animate-pulse delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse delay-150"})]})]}):e.jsx(A,{reviews:d,loading:!1,onHelpfulClick:R,onReportClick:z})})]})})]}),y&&l&&e.jsx($,{quizId:l,onReviewSubmitted:N,onClose:()=>o(!1)})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"😔"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Quiz không tồn tại"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Không thể tìm thấy quiz này"}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Quay lại"})]})})};export{T as default};

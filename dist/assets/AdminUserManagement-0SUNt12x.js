import{r as e,j as t,u as s,m as l,l as a,h as n,y as i,p as r,g as d}from"./index-Cq0ntLoY.js";import{A as c}from"./AdminLayout-7c73j_Ni.js";const o=({isOpen:s,onClose:l,title:a,children:n,size:i="md",closeOnBackdrop:r=!0,showCloseButton:d=!0})=>{e.useEffect(()=>{const e=e=>{"Escape"===e.key&&l()};return s&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[s,l]);return s?t.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:r?l:void 0}),t.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:t.jsxs("div",{className:`\n            relative bg-white rounded-lg shadow-xl transform transition-all\n            w-full ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[i]}\n          `,onClick:e=>e.stopPropagation(),children:[(a||d)&&t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[a&&t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a}),d&&t.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors p-1","aria-label":"ƒê√≥ng modal",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsx("div",{className:"p-6",children:n})]})})]}):null},h=()=>{const{user:h}=s(e=>e.auth),[x,m]=e.useState([]),[u,g]=e.useState(!0),[p,y]=e.useState("all"),[v,j]=e.useState({open:!1,type:null});e.useEffect(()=>{b()},[]);const b=async()=>{try{const e=(await l(a(n,"users"))).docs.map(e=>({id:e.id,...e.data()})).filter(e=>!e.isDeleted);m(e)}catch(e){}finally{g(!1)}},f="all"===p?x:x.filter(e=>e.role===p);return"admin"!==(null==h?void 0:h.role)?t.jsx("div",{className:"text-center py-12",children:t.jsx("p",{className:"text-gray-600",children:"B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang n√†y."})}):u?t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):t.jsxs(c,{title:"üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng",children:[t.jsx("div",{className:"mb-6",children:t.jsx("div",{className:"flex space-x-4",children:[{key:"all",label:"T·∫•t c·∫£",count:x.length},{key:"admin",label:"Admin",count:x.filter(e=>"admin"===e.role).length},{key:"creator",label:"Creator",count:x.filter(e=>"creator"===e.role).length},{key:"user",label:"User",count:x.filter(e=>"user"===e.role).length}].map(e=>t.jsxs("button",{onClick:()=>y(e.key),className:"px-4 py-2 rounded-lg font-medium transition-colors "+(p===e.key?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[e.label," (",e.count,")"]},e.key))})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"T·ªïng ng∆∞·ªùi d√πng"}),t.jsx("p",{className:"text-3xl font-bold text-blue-600",children:x.length})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ƒêang ho·∫°t ƒë·ªông"}),t.jsx("p",{className:"text-3xl font-bold text-green-600",children:x.filter(e=>!1!==e.isActive).length})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Creator"}),t.jsx("p",{className:"text-3xl font-bold text-purple-600",children:x.filter(e=>"creator"===e.role).length})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Admin"}),t.jsx("p",{className:"text-3xl font-bold text-red-600",children:x.filter(e=>"admin"===e.role).length})]})]}),t.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ng∆∞·ªùi d√πng"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vai tr√≤"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tr·∫°ng th√°i"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ng√†y t·∫°o"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thao t√°c"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(e=>{var s,l,a,n,i;return t.jsxs("tr",{className:e.id===(null==h?void 0:h.uid)?"bg-blue-50":"",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:t.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:t.jsx("span",{className:"text-sm font-medium text-gray-700",children:(null==(s=e.displayName)?void 0:s.charAt(0))||(null==(l=e.email)?void 0:l.charAt(0))||"U"})})}),t.jsxs("div",{className:"ml-4",children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[e.displayName||"Ch∆∞a c√≥ t√™n",e.id===(null==h?void 0:h.uid)&&t.jsx("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"(B·∫°n)"})]}),t.jsx("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("select",{value:e.role,onChange:t=>j({open:!0,type:"roleChange",payload:{userId:e.id,newRole:t.target.value},message:`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒë·ªïi quy·ªÅn cho ng∆∞·ªùi d√πng n√†y th√†nh ${t.target.value}?`}),disabled:e.id===(null==h?void 0:h.uid),className:"text-sm border border-gray-300 rounded px-2 py-1",children:[t.jsx("option",{value:"user",children:"User"}),t.jsx("option",{value:"creator",children:"Creator"}),t.jsx("option",{value:"admin",children:"Admin"})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(!1!==e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:!1!==e.isActive?"Ho·∫°t ƒë·ªông":"B·ªã kh√≥a"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(null==(i=null==(n=null==(a=e.createdAt)?void 0:a.toDate)?void 0:n.call(a))?void 0:i.toLocaleDateString())||"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:t.jsx("div",{className:"flex space-x-2",children:e.id!==(null==h?void 0:h.uid)&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>j({open:!0,type:"toggleUserStatus",payload:{userId:e.id,currentStatus:!1!==e.isActive},message:!1!==e.isActive?"B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën kh√≥a t√†i kho·∫£n n√†y?":"B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën k√≠ch ho·∫°t t√†i kho·∫£n n√†y?"}),className:"px-3 py-1 rounded text-xs "+(!1!==e.isActive?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"),disabled:u,children:!1!==e.isActive?"Kh√≥a":"K√≠ch ho·∫°t"}),t.jsx("button",{onClick:()=>j({open:!0,type:"deleteUser",payload:{userId:e.id},message:"B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?"}),className:"px-3 py-1 bg-red-100 text-red-600 rounded text-xs hover:bg-red-200",disabled:u,children:"X√≥a"})]})})})]},e.id)})})]})}),t.jsxs(o,{isOpen:v.open,onClose:()=>j({open:!1,type:null}),title:"X√°c nh·∫≠n thao t√°c",children:[t.jsx("div",{className:"mb-4",children:v.message}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx("button",{onClick:()=>j({open:!1,type:null}),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",disabled:u,children:"H·ªßy"}),t.jsx("button",{onClick:async()=>{"deleteUser"===v.type&&await(async e=>{if(e!==(null==h?void 0:h.uid)){g(!0);try{await r(d(n,"users",e),{isActive:!1,isDeleted:!0,deletedAt:new Date,deletedBy:null==h?void 0:h.uid}),m(t=>t.filter(t=>t.id!==e)),i.success("ƒê√£ v√¥ hi·ªáu h√≥a t√†i kho·∫£n ng∆∞·ªùi d√πng!")}catch(t){i.error("C√≥ l·ªói x·∫£y ra khi x√≥a ng∆∞·ªùi d√πng!")}finally{g(!1)}}else i.error("B·∫°n kh√¥ng th·ªÉ x√≥a t√†i kho·∫£n c·ªßa ch√≠nh m√¨nh!")})(v.payload.userId),"toggleUserStatus"===v.type&&await(async(e,t)=>{if(e!==(null==h?void 0:h.uid)){g(!0);try{await r(d(n,"users",e),{isActive:!t}),m(s=>s.map(s=>s.id===e?{...s,isActive:!t}:s)),i.success(`ƒê√£ ${t?"kh√≥a":"k√≠ch ho·∫°t"} t√†i kho·∫£n!`)}catch(s){i.error("C√≥ l·ªói x·∫£y ra!")}finally{g(!1)}}else i.error("B·∫°n kh√¥ng th·ªÉ kh√≥a t√†i kho·∫£n c·ªßa ch√≠nh m√¨nh!")})(v.payload.userId,v.payload.currentStatus),"roleChange"===v.type&&await(async(e,t)=>{if(e!==(null==h?void 0:h.uid)||"admin"===t){g(!0);try{await r(d(n,"users",e),{role:t}),m(s=>s.map(s=>s.id===e?{...s,role:t}:s)),i.success("ƒê√£ c·∫≠p nh·∫≠t quy·ªÅn ng∆∞·ªùi d√πng!")}catch(s){i.error("C√≥ l·ªói x·∫£y ra!")}finally{g(!1)}}else i.error("B·∫°n kh√¥ng th·ªÉ thay ƒë·ªïi quy·ªÅn c·ªßa ch√≠nh m√¨nh!")})(v.payload.userId,v.payload.newRole),j({open:!1,type:null})},className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",disabled:u,children:"X√°c nh·∫≠n"})]})]})]})};export{h as default};

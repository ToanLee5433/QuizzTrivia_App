import{a as e,u as s,k as t,r as a,q as r,l,h as d,w as i,m as c,y as n,j as x,C as o,n as m,E as h,T as u,o as g,s as p}from"./index-0teFe5Sq.js";import{P as j}from"./plus-4hh2Ehcx.js";import{S as y}from"./search-B4lNefS0.js";import{M as b}from"./message-square-iM3Tfj7y.js";import{S as v}from"./square-pen-BKijrNdk.js";import{T as N}from"./trash-2-DcPTudVx.js";import{S as f}from"./send-CSXJnp51.js";import{C as w}from"./circle-alert-zBFyIZbN.js";import{C as q}from"./circle-x-Dfvncfrb.js";const z=()=>{const{t:z}=e(),{user:C}=s(e=>e.auth),k=t(),[A,S]=a.useState([]),[T,D]=a.useState(!0),[R,B]=a.useState(""),[L,Q]=a.useState("all"),[E,H]=a.useState(!1),[$,K]=a.useState(null),[V,Y]=a.useState(""),[I,M]=a.useState(!1);a.useEffect(()=>{C&&X()},[C]);const X=async()=>{var e,s,t,a;if(C){D(!0);try{const n=r(l(d,"quizzes"),i("createdBy","==",C.uid)),x=await c(n),o=[];for(const m of x.docs){const n=m.data(),x=r(l(d,"editRequests"),i("quizId","==",m.id)),h=(await c(x)).docs.map(e=>{var s,t;return{id:e.id,...e.data(),requestedAt:(null==(s=e.data().requestedAt)?void 0:s.toDate())||new Date,approvedAt:null==(t=e.data().approvedAt)?void 0:t.toDate()}});o.push({id:m.id,...n,views:(null==(e=n.stats)?void 0:e.views)||n.views||0,attempts:(null==(s=n.stats)?void 0:s.attempts)||n.attempts||0,completions:(null==(t=n.stats)?void 0:t.completions)||n.completions||0,averageScore:(null==(a=n.stats)?void 0:a.averageScore)||n.averageScore||0,createdAt:n.createdAt&&"function"==typeof n.createdAt.toDate?n.createdAt.toDate():n.createdAt instanceof Date?n.createdAt:new Date,updatedAt:n.updatedAt&&"function"==typeof n.updatedAt.toDate?n.updatedAt.toDate():n.updatedAt instanceof Date?n.updatedAt:new Date,editRequests:h})}o.sort((e,s)=>s.createdAt.getTime()-e.createdAt.getTime()),S(o)}catch(x){n.error(z("quiz.loadError","Lỗi khi tải danh sách quiz"))}finally{D(!1)}}},F=e=>{const s={pending:x.jsx(m,{className:"w-3 h-3"}),approved:x.jsx(o,{className:"w-3 h-3"}),rejected:x.jsx(q,{className:"w-3 h-3"}),draft:x.jsx(w,{className:"w-3 h-3"})};return x.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",draft:"bg-gray-100 text-gray-800"}[e]}`,children:[s[e],{pending:"Chờ duyệt",approved:"Đã duyệt",rejected:"Bị từ chối",draft:"Bản nháp"}[e]]})},G=A.filter(e=>{const s=e.title.toLowerCase().includes(R.toLowerCase())||e.description.toLowerCase().includes(R.toLowerCase()),t="all"===L||e.status===L;return s&&t});return!C||"creator"!==C.role&&"admin"!==C.role?x.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:x.jsxs("div",{className:"text-center",children:[x.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:z("messages.unauthorized","Không có quyền truy cập")}),x.jsx("p",{className:"text-gray-600",children:z("creator.roleRequired","Bạn cần có vai trò Creator hoặc Admin để xem trang này")})]})}):x.jsx("div",{className:"min-h-screen bg-gray-50",children:x.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[x.jsxs("div",{className:"flex items-center justify-between mb-8",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Quiz của tôi"}),x.jsx("p",{className:"text-gray-600 mt-2",children:"Quản lý và theo dõi quiz bạn đã tạo"})]}),x.jsxs("button",{onClick:()=>k("/creator"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition-colors",children:[x.jsx(j,{className:"w-5 h-5"}),"Tạo Quiz Mới"]})]}),x.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:x.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[x.jsx("div",{className:"flex-1",children:x.jsxs("div",{className:"relative",children:[x.jsx(y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),x.jsx("input",{type:"text",placeholder:"Tìm kiếm quiz...",value:R,onChange:e=>B(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),x.jsx("div",{className:"sm:w-48",children:x.jsxs("select",{value:L,onChange:e=>Q(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[x.jsx("option",{value:"all",children:"Tất cả trạng thái"}),x.jsx("option",{value:"draft",children:"Bản nháp"}),x.jsx("option",{value:"pending",children:"Chờ duyệt"}),x.jsx("option",{value:"approved",children:"Đã duyệt"}),x.jsx("option",{value:"rejected",children:"Bị từ chối"})]})})]})}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:x.jsx(b,{className:"w-6 h-6 text-blue-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"Tổng quiz"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.length})]})]})}),x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:x.jsx(o,{className:"w-6 h-6 text-green-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"Đã duyệt"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.filter(e=>"approved"===e.status).length})]})]})}),x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:x.jsx(m,{className:"w-6 h-6 text-yellow-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"Chờ duyệt"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.filter(e=>"pending"===e.status).length})]})]})}),x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:x.jsx(h,{className:"w-6 h-6 text-purple-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"Tổng lượt xem"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.reduce((e,s)=>e+(s.views||0),0)})]})]})}),x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:x.jsx(u,{className:"w-6 h-6 text-blue-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"Tổng lượt thử"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.reduce((e,s)=>e+(s.attempts||0),0)})]})]})}),x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:x.jsx(o,{className:"w-6 h-6 text-green-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"Hoàn thành"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.reduce((e,s)=>e+(s.completions||0),0)})]})]})})]}),x.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:T?x.jsx("div",{className:"flex items-center justify-center py-12",children:x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===G.length?x.jsxs("div",{className:"text-center py-12",children:[x.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),x.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Chưa có quiz nào"}),x.jsx("p",{className:"text-gray-600 mb-4",children:R||"all"!==L?"Không tìm thấy quiz phù hợp với bộ lọc":"Bạn chưa tạo quiz nào. Hãy tạo quiz đầu tiên!"}),!R&&"all"===L&&x.jsxs("button",{onClick:()=>k("/creator"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold inline-flex items-center gap-2",children:[x.jsx(j,{className:"w-5 h-5"}),"Tạo Quiz Đầu Tiên"]})]}):x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[x.jsx("thead",{className:"bg-gray-50",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quiz"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Danh mục & Độ khó"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Trạng thái"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thống kê"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ngày tạo"}),x.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hành động"})]})}),x.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:G.map(e=>{var s,t;return x.jsxs("tr",{className:"hover:bg-gray-50",children:[x.jsx("td",{className:"px-6 py-4",children:x.jsxs("div",{children:[x.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.title}),x.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:e.description}),x.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[(null==(s=e.questions)?void 0:s.length)||0," câu hỏi"]})]})}),x.jsx("td",{className:"px-6 py-4",children:x.jsxs("div",{className:"space-y-1",children:[x.jsx("div",{className:"text-sm text-gray-900",children:e.category}),(t=e.difficulty,x.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${{easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-red-100 text-red-800"}[t]}`,children:{easy:"🟢 Dễ",medium:"🟡 Trung bình",hard:"🔴 Khó"}[t]}))]})}),x.jsx("td",{className:"px-6 py-4",children:x.jsxs("div",{className:"space-y-2",children:[F(e.status),e.editRequests&&e.editRequests.length>0&&x.jsx("div",{className:"text-xs text-gray-500",children:e.editRequests.filter(e=>"pending"===e.status).length>0&&x.jsx("span",{className:"text-yellow-600",children:"Có yêu cầu chỉnh sửa"})})]})}),x.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:x.jsxs("div",{className:"space-y-1",children:[x.jsxs("div",{children:["👁️ ",e.views||0," lượt xem"]}),x.jsxs("div",{children:["🎯 ",e.attempts||0," lượt thử"]}),x.jsxs("div",{children:["✅ ",e.completions||0," hoàn thành"]}),void 0!==e.averageScore&&x.jsxs("div",{children:["📊 ",e.averageScore,"% điểm TB"]}),e.avgRating&&x.jsxs("div",{children:["⭐ ",e.avgRating.toFixed(1),"/5"]})]})}),x.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.createdAt.toLocaleDateString("vi-VN")}),x.jsx("td",{className:"px-6 py-4 text-right text-sm font-medium",children:x.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[x.jsx("button",{onClick:()=>k(`/quiz/${e.id}/preview`),className:"text-blue-600 hover:text-blue-900 p-1",title:"Xem trước",children:x.jsx(h,{className:"w-4 h-4"})}),x.jsx("button",{onClick:()=>(e=>{const s=(e=>{var s;return(null==(s=e.editRequests)?void 0:s.find(e=>"pending"===e.status))?{allowed:!1,reason:"Có yêu cầu chỉnh sửa đang chờ duyệt"}:"approved"===e.status?{allowed:!1,reason:"Quiz đã được duyệt, cần xin phép admin để chỉnh sửa"}:{allowed:!0}})(e);s.allowed?k(`/quiz/${e.id}/edit`):"approved"===e.status?(K(e),H(!0)):n.warning(s.reason)})(e),className:"text-green-600 hover:text-green-900 p-1",title:"Chỉnh sửa",children:x.jsx(v,{className:"w-4 h-4"})}),"draft"===e.status&&x.jsx("button",{onClick:()=>{window.confirm("Bạn có chắc muốn xóa quiz này?")},className:"text-red-600 hover:text-red-900 p-1",title:"Xóa",children:x.jsx(N,{className:"w-4 h-4"})})]})})]},e.id)})})]})})}),E&&$&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:x.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full",children:[x.jsxs("div",{className:"p-6 border-b border-gray-200",children:[x.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Yêu cầu chỉnh sửa quiz"}),x.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Quiz: ",$.title]})]}),x.jsxs("div",{className:"p-6",children:[x.jsxs("div",{className:"mb-4",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lý do chỉnh sửa *"}),x.jsx("textarea",{value:V,onChange:e=>Y(e.target.value),placeholder:"Vui lòng mô tả lý do bạn muốn chỉnh sửa quiz này...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4})]}),x.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:x.jsx("p",{className:"text-sm text-yellow-800",children:"⚠️ Quiz đã được duyệt. Yêu cầu chỉnh sửa sẽ được gửi tới admin để xét duyệt. Sau khi được phép chỉnh sửa, bạn cần gửi lại để admin duyệt nội dung mới."})})]}),x.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3",children:[x.jsx("button",{onClick:()=>{H(!1),Y(""),K(null)},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Hủy"}),x.jsxs("button",{onClick:async()=>{if($&&V.trim()){M(!0);try{await g(l(d,"editRequests"),{quizId:$.id,requestedBy:null==C?void 0:C.uid,requestedAt:p(),reason:V.trim(),status:"pending"}),n.success("Yêu cầu chỉnh sửa đã được gửi, chờ admin phê duyệt"),H(!1),Y(""),K(null),X()}catch(e){n.error(z("quiz.editRequestError","Lỗi khi gửi yêu cầu chỉnh sửa"))}finally{M(!1)}}else n.error(z("quiz.editReasonRequired","Vui lòng nhập lý do chỉnh sửa"))},disabled:!V.trim()||I,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[I?x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):x.jsx(f,{className:"w-4 h-4"}),"Gửi yêu cầu"]})]})]})})]})})};export{z as default};

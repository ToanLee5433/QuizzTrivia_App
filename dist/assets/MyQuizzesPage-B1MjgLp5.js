import{a as e,u as s,k as t,r as a,q as r,l,h as d,w as i,m as c,y as n,j as x,C as o,n as m,E as h,T as u,o as g,s as p}from"./index-0teFe5Sq.js";import{P as j}from"./plus-4hh2Ehcx.js";import{S as y}from"./search-B4lNefS0.js";import{M as b}from"./message-square-iM3Tfj7y.js";import{S as v}from"./square-pen-BKijrNdk.js";import{T as N}from"./trash-2-DcPTudVx.js";import{S as f}from"./send-CSXJnp51.js";import{C as w}from"./circle-alert-zBFyIZbN.js";import{C as q}from"./circle-x-Dfvncfrb.js";const z=()=>{const{t:z}=e(),{user:C}=s(e=>e.auth),k=t(),[A,S]=a.useState([]),[T,D]=a.useState(!0),[R,B]=a.useState(""),[L,Q]=a.useState("all"),[E,H]=a.useState(!1),[$,K]=a.useState(null),[V,Y]=a.useState(""),[I,M]=a.useState(!1);a.useEffect(()=>{C&&X()},[C]);const X=async()=>{var e,s,t,a;if(C){D(!0);try{const n=r(l(d,"quizzes"),i("createdBy","==",C.uid)),x=await c(n),o=[];for(const m of x.docs){const n=m.data(),x=r(l(d,"editRequests"),i("quizId","==",m.id)),h=(await c(x)).docs.map(e=>{var s,t;return{id:e.id,...e.data(),requestedAt:(null==(s=e.data().requestedAt)?void 0:s.toDate())||new Date,approvedAt:null==(t=e.data().approvedAt)?void 0:t.toDate()}});o.push({id:m.id,...n,views:(null==(e=n.stats)?void 0:e.views)||n.views||0,attempts:(null==(s=n.stats)?void 0:s.attempts)||n.attempts||0,completions:(null==(t=n.stats)?void 0:t.completions)||n.completions||0,averageScore:(null==(a=n.stats)?void 0:a.averageScore)||n.averageScore||0,createdAt:n.createdAt&&"function"==typeof n.createdAt.toDate?n.createdAt.toDate():n.createdAt instanceof Date?n.createdAt:new Date,updatedAt:n.updatedAt&&"function"==typeof n.updatedAt.toDate?n.updatedAt.toDate():n.updatedAt instanceof Date?n.updatedAt:new Date,editRequests:h})}o.sort((e,s)=>s.createdAt.getTime()-e.createdAt.getTime()),S(o)}catch(x){n.error(z("quiz.loadError","Lá»—i khi táº£i danh sÃ¡ch quiz"))}finally{D(!1)}}},F=e=>{const s={pending:x.jsx(m,{className:"w-3 h-3"}),approved:x.jsx(o,{className:"w-3 h-3"}),rejected:x.jsx(q,{className:"w-3 h-3"}),draft:x.jsx(w,{className:"w-3 h-3"})};return x.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",draft:"bg-gray-100 text-gray-800"}[e]}`,children:[s[e],{pending:"Chá» duyá»‡t",approved:"ÄÃ£ duyá»‡t",rejected:"Bá»‹ tá»« chá»‘i",draft:"Báº£n nhÃ¡p"}[e]]})},G=A.filter(e=>{const s=e.title.toLowerCase().includes(R.toLowerCase())||e.description.toLowerCase().includes(R.toLowerCase()),t="all"===L||e.status===L;return s&&t});return!C||"creator"!==C.role&&"admin"!==C.role?x.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:x.jsxs("div",{className:"text-center",children:[x.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:z("messages.unauthorized","KhÃ´ng cÃ³ quyá»n truy cáº­p")}),x.jsx("p",{className:"text-gray-600",children:z("creator.roleRequired","Báº¡n cáº§n cÃ³ vai trÃ² Creator hoáº·c Admin Ä‘á»ƒ xem trang nÃ y")})]})}):x.jsx("div",{className:"min-h-screen bg-gray-50",children:x.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[x.jsxs("div",{className:"flex items-center justify-between mb-8",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Quiz cá»§a tÃ´i"}),x.jsx("p",{className:"text-gray-600 mt-2",children:"Quáº£n lÃ½ vÃ  theo dÃµi quiz báº¡n Ä‘Ã£ táº¡o"})]}),x.jsxs("button",{onClick:()=>k("/creator"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition-colors",children:[x.jsx(j,{className:"w-5 h-5"}),"Táº¡o Quiz Má»›i"]})]}),x.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:x.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[x.jsx("div",{className:"flex-1",children:x.jsxs("div",{className:"relative",children:[x.jsx(y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),x.jsx("input",{type:"text",placeholder:"TÃ¬m kiáº¿m quiz...",value:R,onChange:e=>B(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),x.jsx("div",{className:"sm:w-48",children:x.jsxs("select",{value:L,onChange:e=>Q(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[x.jsx("option",{value:"all",children:"Táº¥t cáº£ tráº¡ng thÃ¡i"}),x.jsx("option",{value:"draft",children:"Báº£n nhÃ¡p"}),x.jsx("option",{value:"pending",children:"Chá» duyá»‡t"}),x.jsx("option",{value:"approved",children:"ÄÃ£ duyá»‡t"}),x.jsx("option",{value:"rejected",children:"Bá»‹ tá»« chá»‘i"})]})})]})}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:x.jsx(b,{className:"w-6 h-6 text-blue-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"Tá»•ng quiz"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.length})]})]})}),x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:x.jsx(o,{className:"w-6 h-6 text-green-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"ÄÃ£ duyá»‡t"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.filter(e=>"approved"===e.status).length})]})]})}),x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:x.jsx(m,{className:"w-6 h-6 text-yellow-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"Chá» duyá»‡t"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.filter(e=>"pending"===e.status).length})]})]})}),x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:x.jsx(h,{className:"w-6 h-6 text-purple-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"Tá»•ng lÆ°á»£t xem"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.reduce((e,s)=>e+(s.views||0),0)})]})]})}),x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:x.jsx(u,{className:"w-6 h-6 text-blue-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"Tá»•ng lÆ°á»£t thá»­"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.reduce((e,s)=>e+(s.attempts||0),0)})]})]})}),x.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:x.jsx(o,{className:"w-6 h-6 text-green-600"})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("p",{className:"text-sm text-gray-600",children:"HoÃ n thÃ nh"}),x.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A.reduce((e,s)=>e+(s.completions||0),0)})]})]})})]}),x.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:T?x.jsx("div",{className:"flex items-center justify-center py-12",children:x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===G.length?x.jsxs("div",{className:"text-center py-12",children:[x.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),x.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ChÆ°a cÃ³ quiz nÃ o"}),x.jsx("p",{className:"text-gray-600 mb-4",children:R||"all"!==L?"KhÃ´ng tÃ¬m tháº¥y quiz phÃ¹ há»£p vá»›i bá»™ lá»c":"Báº¡n chÆ°a táº¡o quiz nÃ o. HÃ£y táº¡o quiz Ä‘áº§u tiÃªn!"}),!R&&"all"===L&&x.jsxs("button",{onClick:()=>k("/creator"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold inline-flex items-center gap-2",children:[x.jsx(j,{className:"w-5 h-5"}),"Táº¡o Quiz Äáº§u TiÃªn"]})]}):x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[x.jsx("thead",{className:"bg-gray-50",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quiz"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Danh má»¥c & Äá»™ khÃ³"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tráº¡ng thÃ¡i"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thá»‘ng kÃª"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"NgÃ y táº¡o"}),x.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"HÃ nh Ä‘á»™ng"})]})}),x.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:G.map(e=>{var s,t;return x.jsxs("tr",{className:"hover:bg-gray-50",children:[x.jsx("td",{className:"px-6 py-4",children:x.jsxs("div",{children:[x.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.title}),x.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:e.description}),x.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[(null==(s=e.questions)?void 0:s.length)||0," cÃ¢u há»i"]})]})}),x.jsx("td",{className:"px-6 py-4",children:x.jsxs("div",{className:"space-y-1",children:[x.jsx("div",{className:"text-sm text-gray-900",children:e.category}),(t=e.difficulty,x.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${{easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-red-100 text-red-800"}[t]}`,children:{easy:"ğŸŸ¢ Dá»…",medium:"ğŸŸ¡ Trung bÃ¬nh",hard:"ğŸ”´ KhÃ³"}[t]}))]})}),x.jsx("td",{className:"px-6 py-4",children:x.jsxs("div",{className:"space-y-2",children:[F(e.status),e.editRequests&&e.editRequests.length>0&&x.jsx("div",{className:"text-xs text-gray-500",children:e.editRequests.filter(e=>"pending"===e.status).length>0&&x.jsx("span",{className:"text-yellow-600",children:"CÃ³ yÃªu cáº§u chá»‰nh sá»­a"})})]})}),x.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:x.jsxs("div",{className:"space-y-1",children:[x.jsxs("div",{children:["ğŸ‘ï¸ ",e.views||0," lÆ°á»£t xem"]}),x.jsxs("div",{children:["ğŸ¯ ",e.attempts||0," lÆ°á»£t thá»­"]}),x.jsxs("div",{children:["âœ… ",e.completions||0," hoÃ n thÃ nh"]}),void 0!==e.averageScore&&x.jsxs("div",{children:["ğŸ“Š ",e.averageScore,"% Ä‘iá»ƒm TB"]}),e.avgRating&&x.jsxs("div",{children:["â­ ",e.avgRating.toFixed(1),"/5"]})]})}),x.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.createdAt.toLocaleDateString("vi-VN")}),x.jsx("td",{className:"px-6 py-4 text-right text-sm font-medium",children:x.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[x.jsx("button",{onClick:()=>k(`/quiz/${e.id}/preview`),className:"text-blue-600 hover:text-blue-900 p-1",title:"Xem trÆ°á»›c",children:x.jsx(h,{className:"w-4 h-4"})}),x.jsx("button",{onClick:()=>(e=>{const s=(e=>{var s;return(null==(s=e.editRequests)?void 0:s.find(e=>"pending"===e.status))?{allowed:!1,reason:"CÃ³ yÃªu cáº§u chá»‰nh sá»­a Ä‘ang chá» duyá»‡t"}:"approved"===e.status?{allowed:!1,reason:"Quiz Ä‘Ã£ Ä‘Æ°á»£c duyá»‡t, cáº§n xin phÃ©p admin Ä‘á»ƒ chá»‰nh sá»­a"}:{allowed:!0}})(e);s.allowed?k(`/quiz/${e.id}/edit`):"approved"===e.status?(K(e),H(!0)):n.warning(s.reason)})(e),className:"text-green-600 hover:text-green-900 p-1",title:"Chá»‰nh sá»­a",children:x.jsx(v,{className:"w-4 h-4"})}),"draft"===e.status&&x.jsx("button",{onClick:()=>{window.confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a quiz nÃ y?")},className:"text-red-600 hover:text-red-900 p-1",title:"XÃ³a",children:x.jsx(N,{className:"w-4 h-4"})})]})})]},e.id)})})]})})}),E&&$&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:x.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full",children:[x.jsxs("div",{className:"p-6 border-b border-gray-200",children:[x.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"YÃªu cáº§u chá»‰nh sá»­a quiz"}),x.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Quiz: ",$.title]})]}),x.jsxs("div",{className:"p-6",children:[x.jsxs("div",{className:"mb-4",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"LÃ½ do chá»‰nh sá»­a *"}),x.jsx("textarea",{value:V,onChange:e=>Y(e.target.value),placeholder:"Vui lÃ²ng mÃ´ táº£ lÃ½ do báº¡n muá»‘n chá»‰nh sá»­a quiz nÃ y...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4})]}),x.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:x.jsx("p",{className:"text-sm text-yellow-800",children:"âš ï¸ Quiz Ä‘Ã£ Ä‘Æ°á»£c duyá»‡t. YÃªu cáº§u chá»‰nh sá»­a sáº½ Ä‘Æ°á»£c gá»­i tá»›i admin Ä‘á»ƒ xÃ©t duyá»‡t. Sau khi Ä‘Æ°á»£c phÃ©p chá»‰nh sá»­a, báº¡n cáº§n gá»­i láº¡i Ä‘á»ƒ admin duyá»‡t ná»™i dung má»›i."})})]}),x.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3",children:[x.jsx("button",{onClick:()=>{H(!1),Y(""),K(null)},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Há»§y"}),x.jsxs("button",{onClick:async()=>{if($&&V.trim()){M(!0);try{await g(l(d,"editRequests"),{quizId:$.id,requestedBy:null==C?void 0:C.uid,requestedAt:p(),reason:V.trim(),status:"pending"}),n.success("YÃªu cáº§u chá»‰nh sá»­a Ä‘Ã£ Ä‘Æ°á»£c gá»­i, chá» admin phÃª duyá»‡t"),H(!1),Y(""),K(null),X()}catch(e){n.error(z("quiz.editRequestError","Lá»—i khi gá»­i yÃªu cáº§u chá»‰nh sá»­a"))}finally{M(!1)}}else n.error(z("quiz.editReasonRequired","Vui lÃ²ng nháº­p lÃ½ do chá»‰nh sá»­a"))},disabled:!V.trim()||I,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[I?x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):x.jsx(f,{className:"w-4 h-4"}),"Gá»­i yÃªu cáº§u"]})]})]})})]})})};export{z as default};

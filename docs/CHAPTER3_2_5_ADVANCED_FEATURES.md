# 3.2.5. Hiá»‡n thá»±c hÃ³a TÃ­nh nÄƒng nÃ¢ng cao (PWA Offline, RAG Chatbot)

> **Pháº§n nÃ y trÃ¬nh bÃ y chi tiáº¿t viá»‡c xÃ¢y dá»±ng Progressive Web App vá»›i Service Worker, IndexedDB offline sync, há»‡ thá»‘ng RAG Chatbot vá»›i Hybrid Search.**

---

## A. Progressive Web App (PWA) Implementation

### PWA Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PWA ARCHITECTURE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    USER DEVICE                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚                    BROWSER                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚             QuizTrivia PWA                  â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ React   â”‚  â”‚ Redux   â”‚  â”‚ i18next     â”‚  â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ App     â”‚  â”‚ Store   â”‚  â”‚ Translationsâ”‚  â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚       â”‚            â”‚              â”‚         â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚       â–¼            â–¼              â–¼         â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚          SERVICE WORKER              â”‚   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚ Workbox (Cache Strategies)     â”‚  â”‚   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Precache (App Shell)        â”‚  â”‚   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Runtime Cache (API)         â”‚  â”‚   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Stale-While-Revalidate      â”‚  â”‚   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                     â”‚                       â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                        â”‚                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                        â–¼                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚              CACHE STORAGE                   â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ quiz-app-precache-v1                    â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚   (HTML, JS, CSS, fonts, icons)           â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ quiz-api-cache                          â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”‚   (Quiz data, user profile)               â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€ quiz-images-cache                       â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚      (Quiz thumbnails, avatars)              â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                        â”‚                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                        â–¼                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚               IndexedDB                      â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ offline-quizzes (full quiz data)        â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ pending-results (to sync later)         â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€ flashcard-decks (local study)           â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€ user-preferences                        â”‚ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Web App Manifest

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MANIFEST.JSON                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  {                                                              â”‚
â”‚    "name": "QuizTrivia - á»¨ng dá»¥ng Quiz Trá»±c tuyáº¿n",            â”‚
â”‚    "short_name": "QuizTrivia",                                  â”‚
â”‚    "description": "Táº¡o vÃ  chÆ¡i quiz vá»›i AI há»— trá»£",            â”‚
â”‚    "theme_color": "#6366f1",                                    â”‚
â”‚    "background_color": "#ffffff",                               â”‚
â”‚    "display": "standalone",                                     â”‚
â”‚    "start_url": "/",                                            â”‚
â”‚    "scope": "/",                                                â”‚
â”‚    "orientation": "portrait-primary",                           â”‚
â”‚    "icons": [                                                   â”‚
â”‚      {                                                          â”‚
â”‚        "src": "/icons/icon-72x72.png",                          â”‚
â”‚        "sizes": "72x72",                                        â”‚
â”‚        "type": "image/png",                                     â”‚
â”‚        "purpose": "maskable any"                                â”‚
â”‚      },                                                         â”‚
â”‚      {                                                          â”‚
â”‚        "src": "/icons/icon-192x192.png",                        â”‚
â”‚        "sizes": "192x192",                                      â”‚
â”‚        "type": "image/png",                                     â”‚
â”‚        "purpose": "maskable any"                                â”‚
â”‚      },                                                         â”‚
â”‚      {                                                          â”‚
â”‚        "src": "/icons/icon-512x512.png",                        â”‚
â”‚        "sizes": "512x512",                                      â”‚
â”‚        "type": "image/png",                                     â”‚
â”‚        "purpose": "maskable any"                                â”‚
â”‚      }                                                          â”‚
â”‚    ],                                                           â”‚
â”‚    "categories": ["education", "games"],                        â”‚
â”‚    "screenshots": [                                             â”‚
â”‚      {                                                          â”‚
â”‚        "src": "/screenshots/home.png",                          â”‚
â”‚        "sizes": "1280x720",                                     â”‚
â”‚        "type": "image/png",                                     â”‚
â”‚        "form_factor": "wide"                                    â”‚
â”‚      },                                                         â”‚
â”‚      {                                                          â”‚
â”‚        "src": "/screenshots/mobile.png",                        â”‚
â”‚        "sizes": "750x1334",                                     â”‚
â”‚        "type": "image/png",                                     â”‚
â”‚        "form_factor": "narrow"                                  â”‚
â”‚      }                                                          â”‚
â”‚    ]                                                            â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Service Worker vá»›i Workbox

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVICE WORKER STRATEGIES                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Vite PWA Plugin Configuration:                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  // vite.config.ts                                      â”‚    â”‚
â”‚  â”‚  import { VitePWA } from 'vite-plugin-pwa';             â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  export default defineConfig({                          â”‚    â”‚
â”‚  â”‚    plugins: [                                           â”‚    â”‚
â”‚  â”‚      VitePWA({                                          â”‚    â”‚
â”‚  â”‚        registerType: 'autoUpdate',                      â”‚    â”‚
â”‚  â”‚        includeAssets: ['favicon.ico', 'robots.txt'],    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚        workbox: {                                       â”‚    â”‚
â”‚  â”‚          // Precache app shell                          â”‚    â”‚
â”‚  â”‚          globPatterns: [                                â”‚    â”‚
â”‚  â”‚            '**/*.{js,css,html,ico,png,svg,woff2}'       â”‚    â”‚
â”‚  â”‚          ],                                             â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚          // Runtime caching strategies                  â”‚    â”‚
â”‚  â”‚          runtimeCaching: [                              â”‚    â”‚
â”‚  â”‚            // Firebase API calls                        â”‚    â”‚
â”‚  â”‚            {                                            â”‚    â”‚
â”‚  â”‚              urlPattern: /firestore\.googleapis\.com/,  â”‚    â”‚
â”‚  â”‚              handler: 'NetworkFirst',                   â”‚    â”‚
â”‚  â”‚              options: {                                 â”‚    â”‚
â”‚  â”‚                cacheName: 'firebase-api',               â”‚    â”‚
â”‚  â”‚                expiration: {                            â”‚    â”‚
â”‚  â”‚                  maxEntries: 100,                       â”‚    â”‚
â”‚  â”‚                  maxAgeSeconds: 86400 // 1 day          â”‚    â”‚
â”‚  â”‚                }                                        â”‚    â”‚
â”‚  â”‚              }                                          â”‚    â”‚
â”‚  â”‚            },                                           â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚            // Images (avatars, thumbnails)              â”‚    â”‚
â”‚  â”‚            {                                            â”‚    â”‚
â”‚  â”‚              urlPattern: /\.(?:png|jpg|jpeg|svg|gif)$/, â”‚    â”‚
â”‚  â”‚              handler: 'CacheFirst',                     â”‚    â”‚
â”‚  â”‚              options: {                                 â”‚    â”‚
â”‚  â”‚                cacheName: 'images',                     â”‚    â”‚
â”‚  â”‚                expiration: {                            â”‚    â”‚
â”‚  â”‚                  maxEntries: 200,                       â”‚    â”‚
â”‚  â”‚                  maxAgeSeconds: 604800 // 7 days        â”‚    â”‚
â”‚  â”‚                }                                        â”‚    â”‚
â”‚  â”‚              }                                          â”‚    â”‚
â”‚  â”‚            }                                            â”‚    â”‚
â”‚  â”‚          ]                                              â”‚    â”‚
â”‚  â”‚        }                                                â”‚    â”‚
â”‚  â”‚      })                                                 â”‚    â”‚
â”‚  â”‚    ]                                                    â”‚    â”‚
â”‚  â”‚  });                                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Cache Strategies:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  1. Precache (App Shell):                               â”‚    â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Install    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚     â”‚ Build   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ Cache   â”‚               â”‚    â”‚
â”‚  â”‚     â”‚ Files   â”‚              â”‚ Storage â”‚               â”‚    â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â”‚     - HTML, JS, CSS bundles                             â”‚    â”‚
â”‚  â”‚     - Fonts, icons, static images                       â”‚    â”‚
â”‚  â”‚     - Cached during SW install                          â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  2. NetworkFirst (API calls):                           â”‚    â”‚
â”‚  â”‚     Request â”€â”€> Network â”€â”€> Response                    â”‚    â”‚
â”‚  â”‚                    â”‚            â”‚                       â”‚    â”‚
â”‚  â”‚                    â”œâ”€â”€Successâ”€â”€>â”‚â”€â”€> Update Cache       â”‚    â”‚
â”‚  â”‚                    â”‚            â”‚                       â”‚    â”‚
â”‚  â”‚                    â””â”€â”€Failâ”€â”€â”€â”€â”€>â”‚ Fallback to Cache     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  3. CacheFirst (Images):                                â”‚    â”‚
â”‚  â”‚     Request â”€â”€> Cache â”€â”€> Hit? â”€â”€Yesâ”€â”€> Response        â”‚    â”‚
â”‚  â”‚                   â”‚                                     â”‚    â”‚
â”‚  â”‚                   â””â”€â”€ No â”€â”€> Network â”€â”€> Cache+Response â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  4. StaleWhileRevalidate (Quiz data):                   â”‚    â”‚
â”‚  â”‚     Request â”€â”€> Cache â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Response (fast)   â”‚    â”‚
â”‚  â”‚        â”‚                                                â”‚    â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€> Network â”€â”€> Update Cache (background)   â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## B. IndexedDB Offline Data Storage

### Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INDEXEDDB SCHEMA                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Database: "quiztrivia-offline"                                 â”‚
â”‚  Version: 1                                                     â”‚
â”‚                                                                 â”‚
â”‚  Object Stores:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  1. offlineQuizzes                                      â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ keyPath: "id"                                   â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ indexes: ["category", "savedAt"]                â”‚    â”‚
â”‚  â”‚     â””â”€â”€ Structure:                                      â”‚    â”‚
â”‚  â”‚         {                                               â”‚    â”‚
â”‚  â”‚           id: "quiz_abc123",                            â”‚    â”‚
â”‚  â”‚           title: "JavaScript Basics",                   â”‚    â”‚
â”‚  â”‚           description: "...",                           â”‚    â”‚
â”‚  â”‚           questions: [...],  // Full question data      â”‚    â”‚
â”‚  â”‚           category: "Programming",                      â”‚    â”‚
â”‚  â”‚           savedAt: timestamp,                           â”‚    â”‚
â”‚  â”‚           syncStatus: "synced" | "pending"              â”‚    â”‚
â”‚  â”‚         }                                               â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  2. pendingResults                                      â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ keyPath: "id" (auto-increment)                  â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ indexes: ["quizId", "createdAt"]                â”‚    â”‚
â”‚  â”‚     â””â”€â”€ Structure:                                      â”‚    â”‚
â”‚  â”‚         {                                               â”‚    â”‚
â”‚  â”‚           id: 1,                                        â”‚    â”‚
â”‚  â”‚           quizId: "quiz_abc123",                        â”‚    â”‚
â”‚  â”‚           userId: "user_xyz",                           â”‚    â”‚
â”‚  â”‚           score: 85,                                    â”‚    â”‚
â”‚  â”‚           answers: [...],                               â”‚    â”‚
â”‚  â”‚           createdAt: timestamp,                         â”‚    â”‚
â”‚  â”‚           syncAttempts: 0                               â”‚    â”‚
â”‚  â”‚         }                                               â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  3. flashcardDecks                                      â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ keyPath: "id"                                   â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ indexes: ["quizId", "lastStudied"]              â”‚    â”‚
â”‚  â”‚     â””â”€â”€ Structure:                                      â”‚    â”‚
â”‚  â”‚         {                                               â”‚    â”‚
â”‚  â”‚           id: "deck_xyz",                               â”‚    â”‚
â”‚  â”‚           quizId: "quiz_abc123",                        â”‚    â”‚
â”‚  â”‚           cards: [...],                                 â”‚    â”‚
â”‚  â”‚           progress: {...},                              â”‚    â”‚
â”‚  â”‚           lastStudied: timestamp                        â”‚    â”‚
â”‚  â”‚         }                                               â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  4. userPreferences                                     â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ keyPath: "key"                                  â”‚    â”‚
â”‚  â”‚     â””â”€â”€ Structure:                                      â”‚    â”‚
â”‚  â”‚         {                                               â”‚    â”‚
â”‚  â”‚           key: "theme",                                 â”‚    â”‚
â”‚  â”‚           value: "dark"                                 â”‚    â”‚
â”‚  â”‚         }                                               â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Offline-First Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OFFLINE-FIRST PATTERN                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Save Quiz for Offline:                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  User clicks "Save Offline"                             â”‚    â”‚
â”‚  â”‚         â”‚                                               â”‚    â”‚
â”‚  â”‚         â–¼                                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚    â”‚
â”‚  â”‚  â”‚ Fetch full  â”‚â”€â”€â”€â”€>â”‚ Save to     â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚ quiz data   â”‚     â”‚ IndexedDB   â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚ (Firestore) â”‚     â”‚             â”‚                    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â”‚    â”‚
â”‚  â”‚                             â”‚                           â”‚    â”‚
â”‚  â”‚                             â–¼                           â”‚    â”‚
â”‚  â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚    â”‚
â”‚  â”‚                      â”‚ Download    â”‚                    â”‚    â”‚
â”‚  â”‚                      â”‚ images to   â”‚                    â”‚    â”‚
â”‚  â”‚                      â”‚ Cache API   â”‚                    â”‚    â”‚
â”‚  â”‚                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â”‚    â”‚
â”‚  â”‚                             â”‚                           â”‚    â”‚
â”‚  â”‚                             â–¼                           â”‚    â”‚
â”‚  â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚    â”‚
â”‚  â”‚                      â”‚ Show "Saved â”‚                    â”‚    â”‚
â”‚  â”‚                      â”‚ for Offline"â”‚                    â”‚    â”‚
â”‚  â”‚                      â”‚ badge       â”‚                    â”‚    â”‚
â”‚  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Play Offline Quiz:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  User opens saved quiz (offline)                        â”‚    â”‚
â”‚  â”‚         â”‚                                               â”‚    â”‚
â”‚  â”‚         â–¼                                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚    â”‚
â”‚  â”‚  â”‚ Load quiz   â”‚â”€â”€â”€â”€>â”‚ Render quiz â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚ from        â”‚     â”‚ normally    â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚ IndexedDB   â”‚     â”‚             â”‚                    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â”‚    â”‚
â”‚  â”‚                             â”‚                           â”‚    â”‚
â”‚  â”‚  User completes quiz        â”‚                           â”‚    â”‚
â”‚  â”‚         â”‚                   â”‚                           â”‚    â”‚
â”‚  â”‚         â–¼                   â”‚                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚                           â”‚    â”‚
â”‚  â”‚  â”‚ Calculate   â”‚            â”‚                           â”‚    â”‚
â”‚  â”‚  â”‚ score       â”‚            â”‚                           â”‚    â”‚
â”‚  â”‚  â”‚ locally     â”‚            â”‚                           â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚                           â”‚    â”‚
â”‚  â”‚         â”‚                   â”‚                           â”‚    â”‚
â”‚  â”‚         â–¼                   â”‚                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚                           â”‚    â”‚
â”‚  â”‚  â”‚ Save to     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚    â”‚
â”‚  â”‚  â”‚ pending     â”‚                                        â”‚    â”‚
â”‚  â”‚  â”‚ Results     â”‚                                        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                        â”‚    â”‚
â”‚  â”‚         â”‚                                               â”‚    â”‚
â”‚  â”‚         â”‚  When online again...                         â”‚    â”‚
â”‚  â”‚         â–¼                                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚    â”‚
â”‚  â”‚  â”‚ Background  â”‚                                        â”‚    â”‚
â”‚  â”‚  â”‚ Sync to     â”‚                                        â”‚    â”‚
â”‚  â”‚  â”‚ Firestore   â”‚                                        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Background Sync Implementation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKGROUND SYNC                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // Register sync when result saved offline             â”‚    â”‚
â”‚  â”‚  const saveResultOffline = async (result) => {          â”‚    â”‚
â”‚  â”‚    // Save to IndexedDB                                 â”‚    â”‚
â”‚  â”‚    await idb.add('pendingResults', {                    â”‚    â”‚
â”‚  â”‚      ...result,                                         â”‚    â”‚
â”‚  â”‚      createdAt: Date.now(),                             â”‚    â”‚
â”‚  â”‚      syncAttempts: 0                                    â”‚    â”‚
â”‚  â”‚    });                                                  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    // Register background sync                          â”‚    â”‚
â”‚  â”‚    if ('serviceWorker' in navigator &&                  â”‚    â”‚
â”‚  â”‚        'SyncManager' in window) {                       â”‚    â”‚
â”‚  â”‚      const reg = await navigator.serviceWorker.ready;   â”‚    â”‚
â”‚  â”‚      await reg.sync.register('sync-results');           â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚  };                                                     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Service Worker Sync Handler:                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // sw.js                                               â”‚    â”‚
â”‚  â”‚  self.addEventListener('sync', (event) => {             â”‚    â”‚
â”‚  â”‚    if (event.tag === 'sync-results') {                  â”‚    â”‚
â”‚  â”‚      event.waitUntil(syncPendingResults());             â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚  });                                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  async function syncPendingResults() {                  â”‚    â”‚
â”‚  â”‚    const db = await openDB('quiztrivia-offline');       â”‚    â”‚
â”‚  â”‚    const pending = await db.getAll('pendingResults');   â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    for (const result of pending) {                      â”‚    â”‚
â”‚  â”‚      try {                                              â”‚    â”‚
â”‚  â”‚        // Try to sync to Firestore                      â”‚    â”‚
â”‚  â”‚        await fetch('/api/sync-result', {                â”‚    â”‚
â”‚  â”‚          method: 'POST',                                â”‚    â”‚
â”‚  â”‚          body: JSON.stringify(result)                   â”‚    â”‚
â”‚  â”‚        });                                              â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚        // Remove from pending on success                â”‚    â”‚
â”‚  â”‚        await db.delete('pendingResults', result.id);    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚      } catch (error) {                                  â”‚    â”‚
â”‚  â”‚        // Increment attempt counter                     â”‚    â”‚
â”‚  â”‚        result.syncAttempts++;                           â”‚    â”‚
â”‚  â”‚        await db.put('pendingResults', result);          â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚        // Give up after 5 attempts                      â”‚    â”‚
â”‚  â”‚        if (result.syncAttempts >= 5) {                  â”‚    â”‚
â”‚  â”‚          await db.delete('pendingResults', result.id);  â”‚    â”‚
â”‚  â”‚          console.error('Sync failed permanently');      â”‚    â”‚
â”‚  â”‚        }                                                â”‚    â”‚
â”‚  â”‚      }                                                  â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚  }                                                      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Sync Flow:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Offline â”€â”€> Save Result â”€â”€> IndexedDB â”€â”€> Register Syncâ”‚    â”‚
â”‚  â”‚                                     â”‚                   â”‚    â”‚
â”‚  â”‚                                     â”‚ Network restored  â”‚    â”‚
â”‚  â”‚                                     â–¼                   â”‚    â”‚
â”‚  â”‚  Online â”€â”€> SW sync event â”€â”€> Process Queue â”€â”€> Firestoreâ”‚   â”‚
â”‚  â”‚                                     â”‚                   â”‚    â”‚
â”‚  â”‚                                     â–¼                   â”‚    â”‚
â”‚  â”‚                              Clear from IDB             â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## C. RAG Chatbot Implementation

### RAG Architecture (Retrieval-Augmented Generation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAG CHATBOT ARCHITECTURE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    USER INTERFACE                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ’¬ QuizTrivia AI Assistant                       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  User: "Giáº£i thÃ­ch Ä‘Ã¡p Ã¡n cÃ¢u há»i vá» async/await" â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Bot: "Async/await lÃ  cÃº phÃ¡p trong JavaScript..."â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  [Type your question...]           [Send]         â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 RAG PIPELINE                            â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Step 1: Query Processing                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  User Query â”€â”€> Extract Keywords â”€â”€> Normalize    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  "async/await" â”€â”€> ["async", "await", "javascript"]â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                          â”‚                              â”‚    â”‚
â”‚  â”‚                          â–¼                              â”‚    â”‚
â”‚  â”‚  Step 2: Hybrid Search (Retrieval)                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Keyword      â”‚    â”‚ Semantic     â”‚             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Search       â”‚    â”‚ Search       â”‚             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ (Firestore)  â”‚    â”‚ (Embeddings) â”‚             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚         â”‚                   â”‚                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                   â–¼                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚         â”‚ Reciprocal Rank  â”‚                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚         â”‚ Fusion (RRF)     â”‚                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                  â”‚                                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                  â–¼                                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚         Top K relevant chunks                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                          â”‚                              â”‚    â”‚
â”‚  â”‚                          â–¼                              â”‚    â”‚
â”‚  â”‚  Step 3: Context Assembly + Generation                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  System Prompt + Retrieved Chunks + User Query    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚              â”‚                                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚              â–¼                                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”‚ Gemini 2.5 Flash â”‚                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â”‚ (Generation)     â”‚                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚              â”‚                                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚              â–¼                                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     Contextual Response                           â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Hybrid Search Implementation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HYBRID SEARCH                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Why Hybrid? Combining Keyword + Semantic Search                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Keyword Search (BM25-like):                            â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Fast, exact matches                                â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Good for specific terms                            â”‚    â”‚
â”‚  â”‚  â””â”€â”€ Misses synonyms and related concepts               â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Semantic Search (Embeddings):                          â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Understands meaning                                â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Finds related content                              â”‚    â”‚
â”‚  â”‚  â””â”€â”€ Can miss exact keyword matches                     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Hybrid (Best of both):                                 â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ Exact matches + semantic relevance                 â”‚    â”‚
â”‚  â”‚  â””â”€â”€ More robust retrieval                              â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Implementation:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // Cloud Function: hybridSearch                        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  async function hybridSearch(query, userId) {           â”‚    â”‚
â”‚  â”‚    // 1. Keyword Search (Firestore full-text)           â”‚    â”‚
â”‚  â”‚    const keywordResults = await firestore               â”‚    â”‚
â”‚  â”‚      .collection('quiz_chunks')                         â”‚    â”‚
â”‚  â”‚      .where('keywords', 'array-contains-any',           â”‚    â”‚
â”‚  â”‚             extractKeywords(query))                     â”‚    â”‚
â”‚  â”‚      .limit(20)                                         â”‚    â”‚
â”‚  â”‚      .get();                                            â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    // 2. Semantic Search (Vector similarity)            â”‚    â”‚
â”‚  â”‚    const queryEmbedding = await generateEmbedding(query);â”‚   â”‚
â”‚  â”‚    const semanticResults = await firestore              â”‚    â”‚
â”‚  â”‚      .collection('quiz_chunks')                         â”‚    â”‚
â”‚  â”‚      .findNearest({                                     â”‚    â”‚
â”‚  â”‚        vectorField: 'embedding',                        â”‚    â”‚
â”‚  â”‚        queryVector: queryEmbedding,                     â”‚    â”‚
â”‚  â”‚        limit: 20,                                       â”‚    â”‚
â”‚  â”‚        distanceMeasure: 'COSINE'                        â”‚    â”‚
â”‚  â”‚      });                                                â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    // 3. Reciprocal Rank Fusion                         â”‚    â”‚
â”‚  â”‚    const fusedResults = reciprocalRankFusion(           â”‚    â”‚
â”‚  â”‚      keywordResults,                                    â”‚    â”‚
â”‚  â”‚      semanticResults,                                   â”‚    â”‚
â”‚  â”‚      k = 60  // RRF constant                            â”‚    â”‚
â”‚  â”‚    );                                                   â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    return fusedResults.slice(0, 5); // Top 5 chunks     â”‚    â”‚
â”‚  â”‚  }                                                      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  RRF Formula:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  RRF_score(d) = Î£  1 / (k + rank_i(d))                  â”‚    â”‚
â”‚  â”‚                iâˆˆR                                      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Where:                                                 â”‚    â”‚
â”‚  â”‚  - d = document                                         â”‚    â”‚
â”‚  â”‚  - R = set of rankers (keyword, semantic)               â”‚    â”‚
â”‚  â”‚  - k = constant (60 is common)                          â”‚    â”‚
â”‚  â”‚  - rank_i(d) = rank of d in ranker i                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Example:                                               â”‚    â”‚
â”‚  â”‚  Document A: Rank 1 in keyword, Rank 5 in semantic      â”‚    â”‚
â”‚  â”‚  RRF(A) = 1/(60+1) + 1/(60+5) = 0.0164 + 0.0154 = 0.032 â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Knowledge Base Indexing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KNOWLEDGE BASE INDEXING                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Document Chunking:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Quiz Document                  Chunks                  â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚ Question 1  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Chunk 1     â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ Answer A âœ“  â”‚               â”‚ Q1 + Answer â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ Explanation â”‚               â”‚ + Explain   â”‚          â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚    â”‚
â”‚  â”‚  â”‚ Question 2  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Chunk 2     â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ Answer C âœ“  â”‚               â”‚ Q2 + Answer â”‚          â”‚    â”‚
â”‚  â”‚  â”‚ Explanation â”‚               â”‚ + Explain   â”‚          â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚    â”‚
â”‚  â”‚  â”‚ ...         â”‚               â”‚ ...         â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Chunk Size: ~500 tokens (optimal for retrieval)        â”‚    â”‚
â”‚  â”‚  Overlap: 50 tokens (maintain context)                  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Embedding Generation:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // When quiz is created/updated                        â”‚    â”‚
â”‚  â”‚  async function indexQuizForRAG(quiz) {                 â”‚    â”‚
â”‚  â”‚    const chunks = chunkQuizContent(quiz);               â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    for (const chunk of chunks) {                        â”‚    â”‚
â”‚  â”‚      // Generate embedding via Gemini Embedding API     â”‚    â”‚
â”‚  â”‚      const embedding = await generateEmbedding(         â”‚    â”‚
â”‚  â”‚        chunk.text                                       â”‚    â”‚
â”‚  â”‚      );                                                 â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚      // Extract keywords for keyword search             â”‚    â”‚
â”‚  â”‚      const keywords = extractKeywords(chunk.text);      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚      // Store in Firestore                              â”‚    â”‚
â”‚  â”‚      await firestore.collection('quiz_chunks').add({    â”‚    â”‚
â”‚  â”‚        quizId: quiz.id,                                 â”‚    â”‚
â”‚  â”‚        text: chunk.text,                                â”‚    â”‚
â”‚  â”‚        embedding: FieldValue.vector(embedding),         â”‚    â”‚
â”‚  â”‚        keywords: keywords,                              â”‚    â”‚
â”‚  â”‚        questionIndex: chunk.questionIndex,              â”‚    â”‚
â”‚  â”‚        createdAt: FieldValue.serverTimestamp()          â”‚    â”‚
â”‚  â”‚      });                                                â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚  }                                                      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chatbot Response Generation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RESPONSE GENERATION                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Prompt Engineering:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  const systemPrompt = `                                 â”‚    â”‚
â”‚  â”‚  Báº¡n lÃ  trá»£ lÃ½ AI cho á»©ng dá»¥ng QuizTrivia.             â”‚    â”‚
â”‚  â”‚  Nhiá»‡m vá»¥: GiÃºp ngÆ°á»i dÃ¹ng hiá»ƒu cÃ¢u há»i quiz vÃ  giáº£i  â”‚    â”‚
â”‚  â”‚  thÃ­ch Ä‘Ã¡p Ã¡n.                                          â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  HÆ°á»›ng dáº«n:                                             â”‚    â”‚
â”‚  â”‚  1. Tráº£ lá»i báº±ng tiáº¿ng Viá»‡t (hoáº·c ngÃ´n ngá»¯ user dÃ¹ng)  â”‚    â”‚
â”‚  â”‚  2. Giáº£i thÃ­ch ngáº¯n gá»n, dá»… hiá»ƒu                       â”‚    â”‚
â”‚  â”‚  3. Náº¿u cÃ³ thÃ´ng tin tá»« quiz, trÃ­ch dáº«n cá»¥ thá»ƒ        â”‚    â”‚
â”‚  â”‚  4. Náº¿u khÃ´ng biáº¿t, thá»«a nháº­n vÃ  Ä‘á» xuáº¥t tÃ¬m hiá»ƒu thÃªmâ”‚    â”‚
â”‚  â”‚  5. KhÃ´ng Ä‘Æ°a ra Ä‘Ã¡p Ã¡n trá»±c tiáº¿p náº¿u user Ä‘ang lÃ m quizâ”‚   â”‚
â”‚  â”‚  `;                                                     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  const buildPrompt = (query, retrievedChunks, context) =>â”‚   â”‚
â”‚  â”‚  `                                                      â”‚    â”‚
â”‚  â”‚  ${systemPrompt}                                        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  CONTEXT tá»« quiz (sá»­ dá»¥ng náº¿u liÃªn quan):              â”‚    â”‚
â”‚  â”‚  ---                                                    â”‚    â”‚
â”‚  â”‚  ${retrievedChunks.map(c => c.text).join('\n\n')}       â”‚    â”‚
â”‚  â”‚  ---                                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Lá»‹ch sá»­ chat gáº§n Ä‘Ã¢y:                                  â”‚    â”‚
â”‚  â”‚  ${context.recentMessages.join('\n')}                   â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  CÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng: ${query}                       â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Tráº£ lá»i:                                               â”‚    â”‚
â”‚  â”‚  `;                                                     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Streaming Response:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // Client-side streaming handler                       â”‚    â”‚
â”‚  â”‚  const streamChatResponse = async (query) => {          â”‚    â”‚
â”‚  â”‚    const response = await fetch('/api/chat', {          â”‚    â”‚
â”‚  â”‚      method: 'POST',                                    â”‚    â”‚
â”‚  â”‚      body: JSON.stringify({ query, sessionId }),        â”‚    â”‚
â”‚  â”‚      headers: { 'Accept': 'text/event-stream' }         â”‚    â”‚
â”‚  â”‚    });                                                  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    const reader = response.body.getReader();            â”‚    â”‚
â”‚  â”‚    const decoder = new TextDecoder();                   â”‚    â”‚
â”‚  â”‚    let fullResponse = '';                               â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    while (true) {                                       â”‚    â”‚
â”‚  â”‚      const { done, value } = await reader.read();       â”‚    â”‚
â”‚  â”‚      if (done) break;                                   â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚      const chunk = decoder.decode(value);               â”‚    â”‚
â”‚  â”‚      fullResponse += chunk;                             â”‚    â”‚
â”‚  â”‚      updateChatUI(fullResponse); // Real-time update    â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    return fullResponse;                                 â”‚    â”‚
â”‚  â”‚  };                                                     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chatbot UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CHATBOT INTERFACE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ¤– QuizTrivia AI Assistant              [â”€] [Ã—]  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ‘¤ User                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Táº¡i sao cÃ¢u "typeof null" láº¡i tráº£ vá»       â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ "object"?                                   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ¤– Assistant                                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ ÄÃ¢y lÃ  má»™t quirk ná»•i tiáº¿ng trong JavaScript!â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ **LÃ½ do lá»‹ch sá»­:**                          â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Trong phiÃªn báº£n Ä‘áº§u tiÃªn cá»§a JS, giÃ¡ trá»‹   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Ä‘Æ°á»£c lÆ°u trá»¯ vá»›i type tag. `null` cÃ³ tag   â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ lÃ  0, giá»‘ng vá»›i object.                     â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ“š *Tá»« quiz "JavaScript Quirks" - Q5*       â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ [Gá»£i Ã½] [Giáº£i thÃ­ch thÃªm] [Quiz liÃªn quan]       â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ Nháº­p cÃ¢u há»i cá»§a báº¡n...                    [ğŸ“¤]  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Features:                                                      â”‚
â”‚  â”œâ”€â”€ Floating widget (bottom-right corner)                      â”‚
â”‚  â”œâ”€â”€ Expandable/collapsible                                     â”‚
â”‚  â”œâ”€â”€ Markdown rendering in responses                            â”‚
â”‚  â”œâ”€â”€ Source citations from quiz content                         â”‚
â”‚  â”œâ”€â”€ Quick action buttons (suggestions)                         â”‚
â”‚  â””â”€â”€ Persistent chat history per session                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## D. PWA Install Prompt

### Custom Install UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INSTALL PROMPT                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚                    ğŸ“±                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚           Install QuizTrivia                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  CÃ i Ä‘áº·t app Ä‘á»ƒ:                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  âœ“ Truy cáº­p nhanh tá»« mÃ n hÃ¬nh chÃ­nh              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  âœ“ ChÆ¡i quiz offline                              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  âœ“ Nháº­n thÃ´ng bÃ¡o                                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   CÃ i Ä‘áº·t      â”‚  â”‚   Äá»ƒ sau        â”‚         â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Implementation:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // Capture install prompt                              â”‚    â”‚
â”‚  â”‚  let deferredPrompt = null;                             â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  window.addEventListener('beforeinstallprompt', (e) => {â”‚    â”‚
â”‚  â”‚    e.preventDefault();                                  â”‚    â”‚
â”‚  â”‚    deferredPrompt = e;                                  â”‚    â”‚
â”‚  â”‚    showInstallButton();                                 â”‚    â”‚
â”‚  â”‚  });                                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // Trigger install                                     â”‚    â”‚
â”‚  â”‚  const handleInstall = async () => {                    â”‚    â”‚
â”‚  â”‚    if (!deferredPrompt) return;                         â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    deferredPrompt.prompt();                             â”‚    â”‚
â”‚  â”‚    const { outcome } = await deferredPrompt.userChoice; â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    if (outcome === 'accepted') {                        â”‚    â”‚
â”‚  â”‚      console.log('PWA installed');                      â”‚    â”‚
â”‚  â”‚      hideInstallButton();                               â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    deferredPrompt = null;                               â”‚    â”‚
â”‚  â”‚  };                                                     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // Detect if already installed                         â”‚    â”‚
â”‚  â”‚  if (window.matchMedia('(display-mode: standalone)')    â”‚    â”‚
â”‚  â”‚      .matches) {                                        â”‚    â”‚
â”‚  â”‚    console.log('Running as PWA');                       â”‚    â”‚
â”‚  â”‚  }                                                      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Tá»•ng káº¿t pháº§n 3.2.5

Pháº§n 3.2.5 Ä‘Ã£ trÃ¬nh bÃ y chi tiáº¿t **TÃ­nh nÄƒng nÃ¢ng cao**:

| TÃ­nh nÄƒng | CÃ´ng nghá»‡ | Káº¿t quáº£ |
|-----------|-----------|---------|
| **PWA** | Vite PWA Plugin + Workbox | Lighthouse PWA 100/100 |
| **Service Worker** | Cache strategies | Offline app shell |
| **IndexedDB** | idb wrapper | Offline quiz storage |
| **Background Sync** | SW sync events | Auto-sync when online |
| **RAG Chatbot** | Gemini + Vector Search | Context-aware responses |
| **Hybrid Search** | Keyword + Semantic + RRF | High relevance retrieval |

**Káº¿t quáº£ Ä‘áº¡t Ä‘Æ°á»£c:**
- âœ… PWA installable trÃªn mobile/desktop
- âœ… Offline quiz playing vá»›i local scoring
- âœ… Auto-sync results khi cÃ³ máº¡ng
- âœ… AI chatbot giáº£i thÃ­ch quiz answers
- âœ… Hybrid search cho retrieval chÃ­nh xÃ¡c

---

*Tiáº¿p theo: [3.3. Giao diá»‡n ngÆ°á»i dÃ¹ng](CHAPTER3_3_USER_INTERFACE.md)*

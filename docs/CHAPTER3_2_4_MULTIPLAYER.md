# 3.2.4. Hiá»‡n thá»±c hÃ³a Cháº¿ Ä‘á»™ Multiplayer Thá»i gian thá»±c

> **Pháº§n nÃ y trÃ¬nh bÃ y chi tiáº¿t viá»‡c xÃ¢y dá»±ng há»‡ thá»‘ng multiplayer sá»­ dá»¥ng Firebase Realtime Database, Ä‘á»“ng bá»™ hÃ³a room, xá»­ lÃ½ Ä‘á»™ trá»… máº¡ng, vÃ  live leaderboard.**

---

## A. Kiáº¿n trÃºc Multiplayer Room

### Táº¡i sao chá»n Realtime Database thay vÃ¬ Firestore?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE COMPARISON                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  TiÃªu chÃ­              â”‚ Firestore       â”‚ Realtime Database    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Latency               â”‚ ~100-300ms      â”‚ ~10-100ms âœ“          â”‚
â”‚  Real-time sync        â”‚ Good            â”‚ Excellent âœ“          â”‚
â”‚  Complex queries       â”‚ Excellent âœ“     â”‚ Limited              â”‚
â”‚  Offline support       â”‚ Excellent       â”‚ Good                 â”‚
â”‚  Cost (frequent reads) â”‚ Higher          â”‚ Lower âœ“              â”‚
â”‚  Data structure        â”‚ Document-based  â”‚ JSON tree            â”‚
â”‚                                                                 â”‚
â”‚  Káº¿t luáº­n: Multiplayer cáº§n Realtime Database vÃ¬:               â”‚
â”‚  â€¢ Latency cá»±c tháº¥p (~10ms) cho game real-time                 â”‚
â”‚  â€¢ Sync listener hiá»‡u quáº£ hÆ¡n cho updates liÃªn tá»¥c             â”‚
â”‚  â€¢ Chi phÃ­ tháº¥p hÆ¡n cho high-frequency reads/writes            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Room Data Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REALTIME DATABASE SCHEMA                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  /multiplayer_rooms/{roomCode}                                  â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”œâ”€â”€ metadata/                                                  â”‚
â”‚  â”‚   â”œâ”€â”€ roomCode: "ABC123"                                     â”‚
â”‚  â”‚   â”œâ”€â”€ hostId: "user_abc"                                     â”‚
â”‚  â”‚   â”œâ”€â”€ quizId: "quiz_xyz"                                     â”‚
â”‚  â”‚   â”œâ”€â”€ status: "waiting" | "playing" | "finished"             â”‚
â”‚  â”‚   â”œâ”€â”€ maxPlayers: 10                                         â”‚
â”‚  â”‚   â”œâ”€â”€ createdAt: timestamp                                   â”‚
â”‚  â”‚   â”œâ”€â”€ settings: {                                            â”‚
â”‚  â”‚   â”‚   questionTime: 30,                                      â”‚
â”‚  â”‚   â”‚   showLeaderboard: true,                                 â”‚
â”‚  â”‚   â”‚   allowLateJoin: false                                   â”‚
â”‚  â”‚   }                                                          â”‚
â”‚  â”‚   â””â”€â”€ currentQuestion: 0                                     â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”œâ”€â”€ players/                                                   â”‚
â”‚  â”‚   â”œâ”€â”€ {playerId_1}/                                          â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ name: "Player 1"                                   â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ avatar: "https://..."                              â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ score: 150                                         â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ streak: 3                                          â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ isReady: true                                      â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ isOnline: true                                     â”‚
â”‚  â”‚   â”‚   â””â”€â”€ lastSeen: timestamp                                â”‚
â”‚  â”‚   â”‚                                                          â”‚
â”‚  â”‚   â””â”€â”€ {playerId_2}/                                          â”‚
â”‚  â”‚       â””â”€â”€ ...                                                â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”œâ”€â”€ gameState/                                                 â”‚
â”‚  â”‚   â”œâ”€â”€ phase: "question" | "answer" | "leaderboard"           â”‚
â”‚  â”‚   â”œâ”€â”€ questionIndex: 5                                       â”‚
â”‚  â”‚   â”œâ”€â”€ questionStartTime: timestamp                           â”‚
â”‚  â”‚   â”œâ”€â”€ timeRemaining: 25                                      â”‚
â”‚  â”‚   â””â”€â”€ answeredPlayers: ["player1", "player2"]                â”‚
â”‚  â”‚                                                              â”‚
â”‚  â””â”€â”€ answers/                                                   â”‚
â”‚      â””â”€â”€ {questionIndex}/                                       â”‚
â”‚          â””â”€â”€ {playerId}/                                        â”‚
â”‚              â”œâ”€â”€ answer: 2                                      â”‚
â”‚              â”œâ”€â”€ timeSpent: 8500  (ms)                          â”‚
â”‚              â”œâ”€â”€ isCorrect: true                                â”‚
â”‚              â””â”€â”€ points: 15                                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## B. Room Lifecycle Management

### Room State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ROOM STATE MACHINE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                        â”‚   CREATING   â”‚                         â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                               â”‚ Room created                    â”‚
â”‚                               â–¼                                 â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚   WAITING    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚               â”‚
â”‚              â”‚                â”‚                 â”‚               â”‚
â”‚         Player left      All ready          New player          â”‚
â”‚         (if < 2)         (Host starts)       joins              â”‚
â”‚              â”‚                â”‚                 â”‚               â”‚
â”‚              â”‚                â–¼                 â”‚               â”‚
â”‚              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚               â”‚
â”‚              â”‚         â”‚   STARTING   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚              â”‚                â”‚ Countdown done                  â”‚
â”‚              â”‚                â–¼                                 â”‚
â”‚              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚              â”‚    â”Œâ”€â”€â”€>â”‚   PLAYING    â”‚<â”€â”€â”€â”                    â”‚
â”‚              â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                    â”‚
â”‚              â”‚    â”‚           â”‚            â”‚                    â”‚
â”‚              â”‚  Next Q    All answered   Timeout                â”‚
â”‚              â”‚    â”‚     or timer ends      â”‚                    â”‚
â”‚              â”‚    â”‚           â–¼            â”‚                    â”‚
â”‚              â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                    â”‚
â”‚              â”‚    â”‚    â”‚  REVEALING   â”‚â”€â”€â”€â”€â”˜                    â”‚
â”‚              â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚              â”‚    â”‚           â”‚                                 â”‚
â”‚              â”‚    â”‚    Show leaderboard                         â”‚
â”‚              â”‚    â”‚           â–¼                                 â”‚
â”‚              â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚              â”‚    â””â”€â”€â”€â”€â”‚ LEADERBOARD  â”‚                         â”‚
â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚              â”‚                â”‚ Last question                   â”‚
â”‚              â”‚                â–¼                                 â”‚
â”‚              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   FINISHED   â”‚                         â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                               â”‚ Auto cleanup (5 min)            â”‚
â”‚                               â–¼                                 â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                        â”‚   DELETED    â”‚                         â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Room Creation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CREATE ROOM FLOW                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Host User                    Firebase                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚  1. Select Quiz           â”‚                             â”‚
â”‚      â”‚  2. Click "Create Room"    â”‚                             â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚  â”€â”€â”€â”€ Create Room â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                             â”‚
â”‚      â”‚       {quizId, settings}   â”‚                             â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚                            â”‚  3. Generate unique         â”‚
â”‚      â”‚                            â”‚     room code (6 chars)     â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚                            â”‚  4. Create room in RTDB     â”‚
â”‚      â”‚                            â”‚     /multiplayer_rooms/{code}â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚  <â”€â”€â”€ Room Created â”€â”€â”€â”€â”€â”€â”€â”€â”‚                             â”‚
â”‚      â”‚       {roomCode: "ABC123"} â”‚                             â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚  5. Navigate to lobby      â”‚                             â”‚
â”‚      â”‚     Show room code         â”‚                             â”‚
â”‚      â”‚     Wait for players       â”‚                             â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â–¼                            â–¼                             â”‚
â”‚                                                                 â”‚
â”‚  Room Code Generation:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  // 6-character alphanumeric (no confusing chars)       â”‚    â”‚
â”‚  â”‚  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  function generateRoomCode() {                          â”‚    â”‚
â”‚  â”‚    let code = '';                                       â”‚    â”‚
â”‚  â”‚    for (let i = 0; i < 6; i++) {                        â”‚    â”‚
â”‚  â”‚      code += chars[Math.floor(Math.random() *          â”‚    â”‚
â”‚  â”‚              chars.length)];                            â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚    return code;                                         â”‚    â”‚
â”‚  â”‚  }                                                      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // Excluded: 0, O, 1, I, L (confusing chars)           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Join Room Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JOIN ROOM FLOW                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Guest User                   Firebase                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚  1. Enter room code        â”‚                             â”‚
â”‚      â”‚     "ABC123"               â”‚                             â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚  â”€â”€â”€â”€ Validate Room â”€â”€â”€â”€â”€â”€>â”‚                             â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚                            â”‚  2. Check room exists       â”‚
â”‚      â”‚                            â”‚     Status = "waiting"      â”‚
â”‚      â”‚                            â”‚     Players < maxPlayers    â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚  <â”€â”€â”€ Room Valid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                             â”‚
â”‚      â”‚       {quizTitle, players} â”‚                             â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚  3. Enter display name     â”‚                             â”‚
â”‚      â”‚     (if guest)             â”‚                             â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚  â”€â”€â”€â”€ Join Room â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                             â”‚
â”‚      â”‚       {name, avatar}       â”‚                             â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚                            â”‚  4. Add to /players/{id}    â”‚
â”‚      â”‚                            â”‚     Set presence listener   â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚  <â”€â”€â”€ Joined â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                             â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â”‚  5. Navigate to lobby      â”‚                             â”‚
â”‚      â”‚     See other players      â”‚                             â”‚
â”‚      â”‚     Wait for host          â”‚                             â”‚
â”‚      â”‚                            â”‚                             â”‚
â”‚      â–¼                            â–¼                             â”‚
â”‚                                                                 â”‚
â”‚  Validation Errors:                                             â”‚
â”‚  â”œâ”€â”€ "ROOM_NOT_FOUND": Room code doesn't exist                  â”‚
â”‚  â”œâ”€â”€ "ROOM_FULL": Max players reached                           â”‚
â”‚  â”œâ”€â”€ "GAME_IN_PROGRESS": Room already playing                   â”‚
â”‚  â””â”€â”€ "ROOM_CLOSED": Room has finished                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## C. Real-time Synchronization

### Player Presence System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRESENCE SYSTEM                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Firebase Realtime Database Presence:                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // On player connect                                   â”‚    â”‚
â”‚  â”‚  const playerRef = ref(rtdb, `rooms/${code}/players/${uid}`);â”‚
â”‚  â”‚  const connectedRef = ref(rtdb, '.info/connected');     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  onValue(connectedRef, (snap) => {                      â”‚    â”‚
â”‚  â”‚    if (snap.val() === true) {                           â”‚    â”‚
â”‚  â”‚      // Set presence to true                            â”‚    â”‚
â”‚  â”‚      set(child(playerRef, 'isOnline'), true);           â”‚    â”‚
â”‚  â”‚      set(child(playerRef, 'lastSeen'), serverTimestamp());â”‚   â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚      // On disconnect, set to false                     â”‚    â”‚
â”‚  â”‚      onDisconnect(child(playerRef, 'isOnline'))         â”‚    â”‚
â”‚  â”‚        .set(false);                                     â”‚    â”‚
â”‚  â”‚      onDisconnect(child(playerRef, 'lastSeen'))         â”‚    â”‚
â”‚  â”‚        .set(serverTimestamp());                         â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚  });                                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Presence Flow:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Player A connects:                                     â”‚    â”‚
â”‚  â”‚  /players/A/isOnline: true  â”€â”€â”€> All clients notified  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Player A disconnects (close tab, network drop):        â”‚    â”‚
â”‚  â”‚  /players/A/isOnline: false â”€â”€â”€> Automatic via         â”‚    â”‚
â”‚  â”‚  /players/A/lastSeen: now       onDisconnect()         â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Other players see "Player A left" immediately          â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Game State Synchronization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GAME STATE SYNC                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Question Phase Sync:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚       Host                     All Players              â”‚    â”‚
â”‚  â”‚        â”‚                           â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚  gameState.phase =        â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚  "question"               â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚  gameState.questionIndex  â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚  = 5                      â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚  gameState.startTime =    â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚  serverTimestamp          â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚           â”‚               â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚           â”‚    Firebase   â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚           â”‚    RTDB       â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚           â–¼               â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚      â”‚ Sync to â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  All receive      â”‚    â”‚
â”‚  â”‚        â”‚      â”‚  all    â”‚          â”‚  within ~50ms     â”‚    â”‚
â”‚  â”‚        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚                           â”‚                    â”‚    â”‚
â”‚  â”‚        â”‚                           â”‚  Show question 5   â”‚    â”‚
â”‚  â”‚        â”‚                           â”‚  Start timer       â”‚    â”‚
â”‚  â”‚        â”‚                           â”‚  (synced start)    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Listener Setup:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // Listen to game state changes                        â”‚    â”‚
â”‚  â”‚  const gameStateRef = ref(rtdb, `rooms/${code}/gameState`);â”‚  â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  onValue(gameStateRef, (snapshot) => {                  â”‚    â”‚
â”‚  â”‚    const state = snapshot.val();                        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    switch (state.phase) {                               â”‚    â”‚
â”‚  â”‚      case 'question':                                   â”‚    â”‚
â”‚  â”‚        showQuestion(state.questionIndex);               â”‚    â”‚
â”‚  â”‚        startTimer(state.startTime);                     â”‚    â”‚
â”‚  â”‚        break;                                           â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚      case 'revealing':                                  â”‚    â”‚
â”‚  â”‚        showCorrectAnswer();                             â”‚    â”‚
â”‚  â”‚        break;                                           â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚      case 'leaderboard':                                â”‚    â”‚
â”‚  â”‚        showLeaderboard();                               â”‚    â”‚
â”‚  â”‚        break;                                           â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚      case 'finished':                                   â”‚    â”‚
â”‚  â”‚        showFinalResults();                              â”‚    â”‚
â”‚  â”‚        break;                                           â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚  });                                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## D. Xá»­ lÃ½ Ä‘á»™ trá»… máº¡ng (Latency Handling)

### Server-time Based Timer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LATENCY COMPENSATION                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Problem: Different clients have different clocks               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  Client A clock: 10:00:05                                       â”‚
â”‚  Client B clock: 10:00:03 (2 seconds behind)                    â”‚
â”‚  Server clock:   10:00:04                                       â”‚
â”‚                                                                 â”‚
â”‚  If timer starts at "10:00:00", Client A sees 5s passed,        â”‚
â”‚  Client B sees 3s passed - UNFAIR!                              â”‚
â”‚                                                                 â”‚
â”‚  Solution: Use Firebase Server Timestamp                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // 1. Calculate server time offset at connection       â”‚    â”‚
â”‚  â”‚  const offsetRef = ref(rtdb, '.info/serverTimeOffset'); â”‚    â”‚
â”‚  â”‚  let serverOffset = 0;                                  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  onValue(offsetRef, (snap) => {                         â”‚    â”‚
â”‚  â”‚    serverOffset = snap.val() || 0;                      â”‚    â”‚
â”‚  â”‚  });                                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // 2. Get estimated server time                        â”‚    â”‚
â”‚  â”‚  const getServerTime = () => Date.now() + serverOffset; â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  // 3. Calculate remaining time from server timestamp   â”‚    â”‚
â”‚  â”‚  const calculateTimeLeft = (startTime, duration) => {   â”‚    â”‚
â”‚  â”‚    const elapsed = getServerTime() - startTime;         â”‚    â”‚
â”‚  â”‚    return Math.max(0, duration - elapsed);              â”‚    â”‚
â”‚  â”‚  };                                                     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Result: All clients show same time (Â±50ms accuracy)            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Answer Submission with Timestamp

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FAIR ANSWER TIMING                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Submit Answer Flow:                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  1. Player clicks answer                                â”‚    â”‚
â”‚  â”‚     â”‚                                                   â”‚    â”‚
â”‚  â”‚     â–¼                                                   â”‚    â”‚
â”‚  â”‚  2. Calculate time spent (using server time)            â”‚    â”‚
â”‚  â”‚     timeSpent = getServerTime() - questionStartTime     â”‚    â”‚
â”‚  â”‚     â”‚                                                   â”‚    â”‚
â”‚  â”‚     â–¼                                                   â”‚    â”‚
â”‚  â”‚  3. Submit to Firebase                                  â”‚    â”‚
â”‚  â”‚     /answers/{questionIndex}/{playerId} = {             â”‚    â”‚
â”‚  â”‚       answer: selectedAnswer,                           â”‚    â”‚
â”‚  â”‚       timeSpent: timeSpent,                             â”‚    â”‚
â”‚  â”‚       submittedAt: serverTimestamp()  â† Server time!    â”‚    â”‚
â”‚  â”‚     }                                                   â”‚    â”‚
â”‚  â”‚     â”‚                                                   â”‚    â”‚
â”‚  â”‚     â–¼                                                   â”‚    â”‚
â”‚  â”‚  4. Firebase Security Rule validates:                   â”‚    â”‚
â”‚  â”‚     - submittedAt <= questionStartTime + duration       â”‚    â”‚
â”‚  â”‚     - Only one answer per question per player           â”‚    â”‚
â”‚  â”‚     â”‚                                                   â”‚    â”‚
â”‚  â”‚     â–¼                                                   â”‚    â”‚
â”‚  â”‚  5. Score calculation uses server timestamp             â”‚    â”‚
â”‚  â”‚     for fair time bonus                                 â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Security Rule (Anti-cheat):                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  {                                                      â”‚    â”‚
â”‚  â”‚    "answers": {                                         â”‚    â”‚
â”‚  â”‚      "$questionIndex": {                                â”‚    â”‚
â”‚  â”‚        "$playerId": {                                   â”‚    â”‚
â”‚  â”‚          ".write": "                                    â”‚    â”‚
â”‚  â”‚            auth.uid == $playerId &&                     â”‚    â”‚
â”‚  â”‚            !data.exists() &&  // No overwrite           â”‚    â”‚
â”‚  â”‚            newData.child('submittedAt').val()           â”‚    â”‚
â”‚  â”‚              <= root.child('gameState/startTime').val() â”‚    â”‚
â”‚  â”‚              + root.child('metadata/settings/time').val()â”‚   â”‚
â”‚  â”‚          "                                              â”‚    â”‚
â”‚  â”‚        }                                                â”‚    â”‚
â”‚  â”‚      }                                                  â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚  }                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Reconnection Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RECONNECTION FLOW                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Player disconnects mid-game:                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  1. Disconnect detected (onDisconnect fires)            â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ isOnline = false                                â”‚    â”‚
â”‚  â”‚     â””â”€â”€ lastSeen = serverTimestamp                      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  2. Grace period (30 seconds)                           â”‚    â”‚
â”‚  â”‚     â””â”€â”€ Player shown as "Reconnecting..."               â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  3a. Player reconnects within grace period:             â”‚    â”‚
â”‚  â”‚      â”œâ”€â”€ isOnline = true                                â”‚    â”‚
â”‚  â”‚      â”œâ”€â”€ Fetch current game state                       â”‚    â”‚
â”‚  â”‚      â”œâ”€â”€ Jump to current question                       â”‚    â”‚
â”‚  â”‚      â””â”€â”€ Score preserved                                â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  3b. Grace period expires:                              â”‚    â”‚
â”‚  â”‚      â”œâ”€â”€ Player marked as "Disconnected"                â”‚    â”‚
â”‚  â”‚      â”œâ”€â”€ Skips remaining questions (0 points)           â”‚    â”‚
â”‚  â”‚      â””â”€â”€ Still shown in final leaderboard               â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Reconnection Code:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  const handleReconnect = async (roomCode, playerId) => {â”‚    â”‚
â”‚  â”‚    // Verify room still exists                          â”‚    â”‚
â”‚  â”‚    const roomSnap = await get(ref(rtdb, `rooms/${code}`));â”‚   â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    if (!roomSnap.exists()) {                            â”‚    â”‚
â”‚  â”‚      return { error: 'ROOM_CLOSED' };                   â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    // Check player still in room                        â”‚    â”‚
â”‚  â”‚    const playerSnap = await get(                        â”‚    â”‚
â”‚  â”‚      ref(rtdb, `rooms/${code}/players/${playerId}`)     â”‚    â”‚
â”‚  â”‚    );                                                   â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    if (!playerSnap.exists()) {                          â”‚    â”‚
â”‚  â”‚      return { error: 'KICKED_OR_TIMEOUT' };             â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    // Restore connection                                â”‚    â”‚
â”‚  â”‚    await update(playerSnap.ref, {                       â”‚    â”‚
â”‚  â”‚      isOnline: true,                                    â”‚    â”‚
â”‚  â”‚      lastSeen: serverTimestamp()                        â”‚    â”‚
â”‚  â”‚    });                                                  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    // Get current game state                            â”‚    â”‚
â”‚  â”‚    const gameState = roomSnap.val().gameState;          â”‚    â”‚
â”‚  â”‚    return { success: true, gameState };                 â”‚    â”‚
â”‚  â”‚  };                                                     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## E. Live Leaderboard

### Real-time Score Updates

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LIVE LEADERBOARD                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  ğŸ† LEADERBOARD                         â”‚    â”‚
â”‚  â”‚                  Question 5 of 10                       â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ Rank â”‚ Player        â”‚ Score â”‚ Streak â”‚ Change â”‚    â”‚    â”‚
â”‚  â”‚  â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ¥‡  â”‚ ğŸŸ¢ NguyenA    â”‚  150  â”‚  ğŸ”¥5   â”‚  â”€     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ¥ˆ  â”‚ ğŸŸ¢ TranB      â”‚  135  â”‚  ğŸ”¥3   â”‚  â†‘1    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ¥‰  â”‚ ğŸŸ¢ LeC        â”‚  130  â”‚        â”‚  â†“1    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚   4  â”‚ â­ YOU        â”‚  125  â”‚  ğŸ”¥2   â”‚  â”€     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚   5  â”‚ ğŸŸ¡ PhamD      â”‚  100  â”‚        â”‚  â†‘2    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚   6  â”‚ ğŸ”´ HoangE     â”‚   90  â”‚        â”‚  â†“2    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  ğŸŸ¢ Online   ğŸŸ¡ Reconnecting   ğŸ”´ Disconnected          â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Next question in: 5 seconds...                         â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Animation Effects:                                             â”‚
â”‚  â”œâ”€â”€ Score increment: Number counter animation                  â”‚
â”‚  â”œâ”€â”€ Rank change: Slide up/down with position swap             â”‚
â”‚  â”œâ”€â”€ Streak: Fire emoji pulse animation                         â”‚
â”‚  â””â”€â”€ Your row: Highlighted background                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Leaderboard Calculation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SCORE AGGREGATION                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  After Each Question:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  const calculateLeaderboard = (roomData) => {           â”‚    â”‚
â”‚  â”‚    const players = Object.entries(roomData.players);    â”‚    â”‚
â”‚  â”‚    const answers = roomData.answers;                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    // Calculate total score per player                  â”‚    â”‚
â”‚  â”‚    const scores = players.map(([id, player]) => {       â”‚    â”‚
â”‚  â”‚      let totalScore = 0;                                â”‚    â”‚
â”‚  â”‚      let streak = 0;                                    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚      // Sum all answered questions                      â”‚    â”‚
â”‚  â”‚      Object.values(answers).forEach((question) => {     â”‚    â”‚
â”‚  â”‚        const answer = question[id];                     â”‚    â”‚
â”‚  â”‚        if (answer) {                                    â”‚    â”‚
â”‚  â”‚          totalScore += answer.points;                   â”‚    â”‚
â”‚  â”‚          if (answer.isCorrect) streak++;                â”‚    â”‚
â”‚  â”‚          else streak = 0;                               â”‚    â”‚
â”‚  â”‚        }                                                â”‚    â”‚
â”‚  â”‚      });                                                â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚      return {                                           â”‚    â”‚
â”‚  â”‚        id,                                              â”‚    â”‚
â”‚  â”‚        name: player.name,                               â”‚    â”‚
â”‚  â”‚        avatar: player.avatar,                           â”‚    â”‚
â”‚  â”‚        score: totalScore,                               â”‚    â”‚
â”‚  â”‚        streak,                                          â”‚    â”‚
â”‚  â”‚        isOnline: player.isOnline                        â”‚    â”‚
â”‚  â”‚      };                                                 â”‚    â”‚
â”‚  â”‚    });                                                  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚    // Sort by score (desc), then by time (asc)          â”‚    â”‚
â”‚  â”‚    return scores.sort((a, b) =>                         â”‚    â”‚
â”‚  â”‚      b.score - a.score ||                               â”‚    â”‚
â”‚  â”‚      a.totalTime - b.totalTime                          â”‚    â”‚
â”‚  â”‚    );                                                   â”‚    â”‚
â”‚  â”‚  };                                                     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Tiebreaker Rules:                                              â”‚
â”‚  1. Higher score wins                                           â”‚
â”‚  2. Same score: Faster total time wins                          â”‚
â”‚  3. Same time: Earlier submission wins                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## F. Multiplayer UI Components

### Lobby Screen

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MULTIPLAYER LOBBY                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚              Room Code: ABC123                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚              [ğŸ“‹ Copy]  [ğŸ“¤ Share]                â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Quiz: "JavaScript Fundamentals"                        â”‚    â”‚
â”‚  â”‚  Questions: 10  â”‚  Time: 30s each  â”‚  Host: NguyenA     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚              PLAYERS (4/10)                       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ‘¤   â”‚  â”‚ ğŸ‘¤   â”‚  â”‚ ğŸ‘¤   â”‚  â”‚ ğŸ‘¤   â”‚          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚Playerâ”‚  â”‚Playerâ”‚  â”‚Playerâ”‚  â”‚Playerâ”‚          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  1   â”‚  â”‚  2   â”‚  â”‚  3   â”‚  â”‚  4   â”‚          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ‘‘   â”‚  â”‚ âœ“    â”‚  â”‚ âœ“    â”‚  â”‚ ...  â”‚          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚HOST  â”‚  â”‚READY â”‚  â”‚READY â”‚  â”‚WAIT  â”‚          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  +   â”‚  â”‚  +   â”‚  â”‚  +   â”‚  â”‚  +   â”‚          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚Empty â”‚  â”‚Empty â”‚  â”‚Empty â”‚  â”‚Empty â”‚          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  [âœ“ Ready]        [ğŸšª Leave Room]                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  (Host only)                                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  [â–¶ï¸ START GAME]  (3/4 players ready)             â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Game Screen (Multiplayer Mode)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MULTIPLAYER GAME                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Question 5/10          â±ï¸ 15s          Players: 4/4   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ 15s           â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  What does 'DOM' stand for?                             â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  A. Document Object Model                       â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  B. Data Object Management                      â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  C. Digital Output Module                       â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  D. Document Oriented Markup                    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Players answered: 2/4  [â—â—â—‹â—‹]                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ ğŸŸ¢ NguyenA âœ“   ğŸŸ¢ TranB âœ“   ğŸŸ¢ LeC ...   ğŸŸ¢ You ...â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Tá»•ng káº¿t pháº§n 3.2.4

Pháº§n 3.2.4 Ä‘Ã£ trÃ¬nh bÃ y chi tiáº¿t **Cháº¿ Ä‘á»™ Multiplayer Thá»i gian thá»±c**:

| ThÃ nh pháº§n | CÃ´ng nghá»‡ | Káº¿t quáº£ |
|------------|-----------|---------|
| **Database** | Firebase RTDB | Latency ~10-50ms |
| **Room System** | State machine | 6 tráº¡ng thÃ¡i lifecycle |
| **Presence** | onDisconnect() | Real-time online status |
| **Timer Sync** | Server timestamp | Â±50ms accuracy |
| **Leaderboard** | Real-time listeners | Instant score updates |

**Káº¿t quáº£ Ä‘áº¡t Ä‘Æ°á»£c:**
- âœ… 10+ players Ä‘á»“ng thá»i trÃªn 1 room
- âœ… Latency compensation vá»›i server timestamp
- âœ… Reconnection handling vá»›i grace period
- âœ… Anti-cheat validation via security rules
- âœ… Live leaderboard vá»›i animations

---

*Tiáº¿p theo: [3.2.5. Hiá»‡n thá»±c hÃ³a TÃ­nh nÄƒng nÃ¢ng cao (PWA, Chatbot)](CHAPTER3_2_5_ADVANCED_FEATURES.md)*

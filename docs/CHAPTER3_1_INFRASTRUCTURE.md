# CHÆ¯Æ NG 3: CÃ€I Äáº¶T VÃ€ THá»¬ NGHIá»†M Há»† THá»NG

## 3.1. XÃ‚Y Dá»°NG MÃ”I TRÆ¯á»œNG VÃ€ Cáº¤U HÃŒNH Háº  Táº¦NG (INFRASTRUCTURE SETUP)

> **Pháº§n nÃ y trÃ¬nh bÃ y chi tiáº¿t quÃ¡ trÃ¬nh thiáº¿t láº­p mÃ´i trÆ°á»ng phÃ¡t triá»ƒn, cáº¥u hÃ¬nh há»‡ sinh thÃ¡i Firebase Backend vÃ  tÃ­ch há»£p SDK vÃ o á»©ng dá»¥ng Client.**

---

## 3.1.1. Cáº¥u hÃ¬nh MÃ´i trÆ°á»ng PhÃ¡t triá»ƒn (Development Environment)

### a) Cáº¥u hÃ¬nh pháº§n cá»©ng vÃ  há»‡ Ä‘iá»u hÃ nh

#### YÃªu cáº§u pháº§n cá»©ng tá»‘i thiá»ƒu

Äá»ƒ phÃ¡t triá»ƒn á»©ng dá»¥ng QuizTrivia má»™t cÃ¡ch hiá»‡u quáº£, há»‡ thá»‘ng cáº§n Ä‘Ã¡p á»©ng cÃ¡c yÃªu cáº§u pháº§n cá»©ng sau:

| ThÃ nh pháº§n | YÃªu cáº§u tá»‘i thiá»ƒu | Khuyáº¿n nghá»‹ |
|------------|-------------------|-------------|
| **CPU** | Intel Core i5 Gen 8 / AMD Ryzen 5 | Intel Core i7 Gen 11+ / AMD Ryzen 7 |
| **RAM** | 8 GB | 16 GB trá»Ÿ lÃªn |
| **á»” cá»©ng** | SSD 256 GB | NVMe SSD 512 GB |
| **MÃ n hÃ¬nh** | Full HD 1920x1080 | 2K hoáº·c Dual Monitor |

#### Há»‡ Ä‘iá»u hÃ nh Ä‘Æ°á»£c há»— trá»£

| Há»‡ Ä‘iá»u hÃ nh | PhiÃªn báº£n | Ghi chÃº |
|--------------|-----------|---------|
| **Windows** | Windows 10/11 (64-bit) | Khuyáº¿n nghá»‹ Windows 11 |
| **macOS** | macOS Monterey 12+ | Apple Silicon Ä‘Æ°á»£c há»— trá»£ |
| **Linux** | Ubuntu 20.04 LTS+ | Hoáº·c cÃ¡c distro tÆ°Æ¡ng Ä‘Æ°Æ¡ng |

#### Cáº¥u hÃ¬nh thá»±c táº¿ sá»­ dá»¥ng trong dá»± Ã¡n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cáº¤U HÃŒNH MÃY PHÃT TRIá»‚N                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Há»‡ Ä‘iá»u hÃ nh    : Windows 11 Pro 64-bit                        â”‚
â”‚  CPU             : Intel Core i5-1135G7 @ 2.40GHz               â”‚
â”‚  RAM             : 16 GB DDR4                                   â”‚
â”‚  á»” cá»©ng          : SSD NVMe 512 GB                              â”‚
â”‚  GPU             : Intel Iris Xe Graphics (Integrated)          â”‚
â”‚  MÃ n hÃ¬nh        : 15.6" Full HD 1920x1080                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### b) Cáº¥u hÃ¬nh mÃ´i trÆ°á»ng Runtime (Node.js, npm/yarn)

#### CÃ i Ä‘áº·t Node.js

Node.js lÃ  ná»n táº£ng runtime JavaScript phÃ­a server, Ä‘Æ°á»£c sá»­ dá»¥ng cho cáº£ Frontend build tools (Vite) vÃ  Backend (Firebase Cloud Functions).

**PhiÃªn báº£n Node.js sá»­ dá»¥ng:**

| Component | Node.js Version | LÃ½ do lá»±a chá»n |
|-----------|-----------------|----------------|
| **Frontend (Vite)** | v20.x LTS | Há»— trá»£ ESM native, performance tá»‘i Æ°u |
| **Cloud Functions** | v20.x | YÃªu cáº§u tá»« Firebase Functions Gen 2 |

**Quy trÃ¬nh cÃ i Ä‘áº·t Node.js:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 QUY TRÃŒNH CÃ€I Äáº¶T NODE.JS                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Táº£i Node.js LTS tá»« https://nodejs.org                       â”‚
â”‚                    â†“                                            â”‚
â”‚  2. Cháº¡y installer vÃ  chá»n "Add to PATH"                        â”‚
â”‚                    â†“                                            â”‚
â”‚  3. Khá»Ÿi Ä‘á»™ng láº¡i Terminal/CMD                                  â”‚
â”‚                    â†“                                            â”‚
â”‚  4. XÃ¡c nháº­n cÃ i Ä‘áº·t: node --version                            â”‚
â”‚                    â†“                                            â”‚
â”‚  5. XÃ¡c nháº­n npm: npm --version                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Káº¿t quáº£ xÃ¡c nháº­n:**

```bash
# Kiá»ƒm tra phiÃªn báº£n Node.js
$ node --version
v20.18.0

# Kiá»ƒm tra phiÃªn báº£n npm
$ npm --version
10.8.2
```

#### Cáº¥u hÃ¬nh npm Registry

Äá»ƒ tÄƒng tá»‘c Ä‘á»™ táº£i packages, cáº¥u hÃ¬nh npm sá»­ dá»¥ng registry gáº§n nháº¥t:

```bash
# Kiá»ƒm tra registry hiá»‡n táº¡i
npm config get registry

# Káº¿t quáº£ máº·c Ä‘á»‹nh
https://registry.npmjs.org/
```

#### Quáº£n lÃ½ phiÃªn báº£n Node.js vá»›i NVM (TÃ¹y chá»n)

Äá»‘i vá»›i dá»± Ã¡n phá»©c táº¡p cáº§n nhiá»u phiÃªn báº£n Node.js, sá»­ dá»¥ng Node Version Manager:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NVM - NODE VERSION MANAGER                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  CÃ i Ä‘áº·t NVM (Windows):                                         â”‚
â”‚  â†’ nvm-windows: https://github.com/coreybutler/nvm-windows      â”‚
â”‚                                                                 â”‚
â”‚  CÃ¡c lá»‡nh cÆ¡ báº£n:                                               â”‚
â”‚  â”œâ”€â”€ nvm list              : Liá»‡t kÃª cÃ¡c version Ä‘Ã£ cÃ i         â”‚
â”‚  â”œâ”€â”€ nvm install 20        : CÃ i Ä‘áº·t Node.js 20.x               â”‚
â”‚  â”œâ”€â”€ nvm use 20            : Chuyá»ƒn sang Node.js 20.x           â”‚
â”‚  â””â”€â”€ nvm alias default 20  : Äáº·t máº·c Ä‘á»‹nh                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### c) Bá»™ cÃ´ng cá»¥ láº­p trÃ¬nh vÃ  quáº£n lÃ½ mÃ£ nguá»“n (IDE, Git)

#### Visual Studio Code - IDE chÃ­nh

Visual Studio Code Ä‘Æ°á»£c chá»n lÃ m IDE chÃ­nh vÃ¬ tÃ­nh nÄƒng máº¡nh máº½ vÃ  há»‡ sinh thÃ¡i extensions phong phÃº.

**Extensions cáº§n thiáº¿t cho dá»± Ã¡n:**

| Extension | Chá»©c nÄƒng | Má»©c Ä‘á»™ cáº§n thiáº¿t |
|-----------|-----------|------------------|
| **ESLint** | Kiá»ƒm tra lá»—i JavaScript/TypeScript | â­â­â­ Báº¯t buá»™c |
| **Prettier** | Format code tá»± Ä‘á»™ng | â­â­â­ Báº¯t buá»™c |
| **Tailwind CSS IntelliSense** | Gá»£i Ã½ class Tailwind | â­â­â­ Báº¯t buá»™c |
| **ES7+ React Snippets** | Code snippets cho React | â­â­ Khuyáº¿n nghá»‹ |
| **Firebase Explorer** | Quáº£n lÃ½ Firebase trá»±c tiáº¿p | â­â­ Khuyáº¿n nghá»‹ |
| **GitLens** | Xem lá»‹ch sá»­ Git chi tiáº¿t | â­â­ Khuyáº¿n nghá»‹ |
| **Thunder Client** | Test API nhanh | â­ TÃ¹y chá»n |

**Cáº¥u hÃ¬nh VS Code Settings (`.vscode/settings.json`):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cáº¤U HÃŒNH VS CODE CHO Dá»° ÃN                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Editor Settings:                                               â”‚
â”‚  â”œâ”€â”€ Format On Save          : Enabled                          â”‚
â”‚  â”œâ”€â”€ Default Formatter       : Prettier                         â”‚
â”‚  â”œâ”€â”€ Tab Size                : 2 spaces                         â”‚
â”‚  â””â”€â”€ Word Wrap               : On                               â”‚
â”‚                                                                 â”‚
â”‚  TypeScript Settings:                                           â”‚
â”‚  â”œâ”€â”€ Strict Mode             : Enabled                          â”‚
â”‚  â”œâ”€â”€ Check JS                : Enabled                          â”‚
â”‚  â””â”€â”€ Import Module Specifier : Relative                         â”‚
â”‚                                                                 â”‚
â”‚  Tailwind Settings:                                             â”‚
â”‚  â”œâ”€â”€ Class Attributes        : className, class                 â”‚
â”‚  â””â”€â”€ Experimental Regex      : Enabled                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Git - Há»‡ thá»‘ng quáº£n lÃ½ phiÃªn báº£n

Git Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ quáº£n lÃ½ mÃ£ nguá»“n vÃ  cá»™ng tÃ¡c trong nhÃ³m phÃ¡t triá»ƒn.

**Cáº¥u hÃ¬nh Git cÆ¡ báº£n:**

```bash
# Cáº¥u hÃ¬nh thÃ´ng tin ngÆ°á»i dÃ¹ng
git config --global user.name "Developer Name"
git config --global user.email "developer@email.com"

# Cáº¥u hÃ¬nh editor máº·c Ä‘á»‹nh
git config --global core.editor "code --wait"

# Cáº¥u hÃ¬nh line endings (Windows)
git config --global core.autocrlf true
```

**Cáº¥u trÃºc Git Workflow:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GIT BRANCHING STRATEGY                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                         main (production)                        â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â†“                                  â”‚
â”‚                    develop (integration)                         â”‚
â”‚                    /         â”‚         \                        â”‚
â”‚                   â†“          â†“          â†“                       â”‚
â”‚              feature/    feature/    feature/                   â”‚
â”‚              auth        quiz        multiplayer                â”‚
â”‚                                                                 â”‚
â”‚  Quy táº¯c Ä‘áº·t tÃªn branch:                                        â”‚
â”‚  â”œâ”€â”€ feature/[tÃªn-tÃ­nh-nÄƒng]  : PhÃ¡t triá»ƒn tÃ­nh nÄƒng má»›i        â”‚
â”‚  â”œâ”€â”€ bugfix/[mÃ´-táº£-lá»—i]       : Sá»­a lá»—i                         â”‚
â”‚  â”œâ”€â”€ hotfix/[mÃ´-táº£]           : Sá»­a lá»—i kháº©n cáº¥p                â”‚
â”‚  â””â”€â”€ release/[version]        : Chuáº©n bá»‹ release                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**File `.gitignore` cho dá»± Ã¡n:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cáº¤U HÃŒNH .GITIGNORE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Dependencies:                                                  â”‚
â”‚  â”œâ”€â”€ node_modules/                                              â”‚
â”‚  â””â”€â”€ .pnp.*                                                     â”‚
â”‚                                                                 â”‚
â”‚  Build Output:                                                  â”‚
â”‚  â”œâ”€â”€ dist/                                                      â”‚
â”‚  â”œâ”€â”€ build/                                                     â”‚
â”‚  â””â”€â”€ .vite/                                                     â”‚
â”‚                                                                 â”‚
â”‚  Environment & Secrets:                                         â”‚
â”‚  â”œâ”€â”€ .env                                                       â”‚
â”‚  â”œâ”€â”€ .env.local                                                 â”‚
â”‚  â”œâ”€â”€ .env.production                                            â”‚
â”‚  â””â”€â”€ *.pem                                                      â”‚
â”‚                                                                 â”‚
â”‚  Firebase:                                                      â”‚
â”‚  â”œâ”€â”€ .firebase/                                                 â”‚
â”‚  â”œâ”€â”€ firebase-debug.log                                         â”‚
â”‚  â””â”€â”€ serviceAccountKey.json                                     â”‚
â”‚                                                                 â”‚
â”‚  IDE:                                                           â”‚
â”‚  â”œâ”€â”€ .idea/                                                     â”‚
â”‚  â””â”€â”€ *.swp                                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3.1.2. Khá»Ÿi táº¡o vÃ  Cáº¥u hÃ¬nh Há»‡ sinh thÃ¡i Firebase (Backend Implementation)

### a) Khá»Ÿi táº¡o Dá»± Ã¡n vÃ  Chiáº¿n lÆ°á»£c chá»n Khu vá»±c (Region Strategy)

#### Táº¡o Firebase Project

Firebase Console Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ khá»Ÿi táº¡o vÃ  quáº£n lÃ½ project backend.

**Quy trÃ¬nh khá»Ÿi táº¡o Firebase Project:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              QUY TRÃŒNH Táº O FIREBASE PROJECT                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  BÆ°á»›c 1: Truy cáº­p Firebase Console                              â”‚
â”‚  â””â”€â”€ https://console.firebase.google.com                        â”‚
â”‚                    â†“                                            â”‚
â”‚  BÆ°á»›c 2: Click "Add Project"                                    â”‚
â”‚  â””â”€â”€ Nháº­p tÃªn project: "datn-quizapp"                           â”‚
â”‚                    â†“                                            â”‚
â”‚  BÆ°á»›c 3: Cáº¥u hÃ¬nh Google Analytics                              â”‚
â”‚  â””â”€â”€ Enable Google Analytics cho tracking                       â”‚
â”‚                    â†“                                            â”‚
â”‚  BÆ°á»›c 4: Chá»n Analytics Account                                 â”‚
â”‚  â””â”€â”€ Táº¡o má»›i hoáº·c chá»n account cÃ³ sáºµn                           â”‚
â”‚                    â†“                                            â”‚
â”‚  BÆ°á»›c 5: HoÃ n táº¥t                                               â”‚
â”‚  â””â”€â”€ Project ID: datn-quizapp                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ThÃ´ng tin Project sau khi táº¡o:**

| Thuá»™c tÃ­nh | GiÃ¡ trá»‹ |
|------------|---------|
| **Project Name** | DATN QuizApp |
| **Project ID** | datn-quizapp |
| **Project Number** | 741975099365 |
| **Default GCP Resource Location** | us-central |

#### Chiáº¿n lÆ°á»£c chá»n Region

Viá»‡c chá»n Region áº£nh hÆ°á»Ÿng trá»±c tiáº¿p Ä‘áº¿n latency vÃ  chi phÃ­ váº­n hÃ nh.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REGION SELECTION STRATEGY                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  TiÃªu chÃ­ lá»±a chá»n:                                             â”‚
â”‚  â”œâ”€â”€ ğŸ¯ Target Users      : Viá»‡t Nam, ÄÃ´ng Nam Ã                â”‚
â”‚  â”œâ”€â”€ âš¡ Latency           : < 100ms cho real-time features       â”‚
â”‚  â”œâ”€â”€ ğŸ’° Cost              : Tá»‘i Æ°u chi phÃ­ bandwidth             â”‚
â”‚  â””â”€â”€ ğŸ”’ Compliance        : GDPR khÃ´ng yÃªu cáº§u (non-EU users)    â”‚
â”‚                                                                 â”‚
â”‚  Region Ä‘Æ°á»£c chá»n:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Service              â”‚  Region           â”‚  LÃ½ do      â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  Cloud Functions      â”‚  us-central1      â”‚  Cheapest   â”‚    â”‚
â”‚  â”‚  Firestore            â”‚  us-central       â”‚  Auto       â”‚    â”‚
â”‚  â”‚  Realtime Database    â”‚  us-central1      â”‚  Multiplayerâ”‚    â”‚
â”‚  â”‚  Cloud Storage        â”‚  us                â”‚  Default    â”‚    â”‚
â”‚  â”‚  Hosting              â”‚  Global CDN       â”‚  Auto       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ Ghi chÃº: us-central Ä‘Æ°á»£c chá»n vÃ¬:                           â”‚
â”‚  - Chi phÃ­ tháº¥p nháº¥t cho Cloud Functions                        â”‚
â”‚  - Firebase Hosting tá»± Ä‘á»™ng CDN Ä‘áº¿n client gáº§n nháº¥t             â”‚
â”‚  - Realtime Database cÃ³ latency cháº¥p nháº­n Ä‘Æ°á»£c (150-200ms)      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### b) Cáº¥u hÃ¬nh Dá»‹ch vá»¥ Authentication (Email/Password, Google OAuth)

#### KÃ­ch hoáº¡t Authentication Providers

Firebase Authentication cung cáº¥p giáº£i phÃ¡p xÃ¡c thá»±c ngÆ°á»i dÃ¹ng toÃ n diá»‡n.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AUTHENTICATION PROVIDERS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âœ… Email/Password Authentication                                â”‚
â”‚  â”œâ”€â”€ Status: Enabled                                            â”‚
â”‚  â”œâ”€â”€ Email Verification: Required                               â”‚
â”‚  â”œâ”€â”€ Password Reset: Email Link                                 â”‚
â”‚  â””â”€â”€ OTP Verification: Custom Cloud Function                    â”‚
â”‚                                                                 â”‚
â”‚  âœ… Google OAuth 2.0                                             â”‚
â”‚  â”œâ”€â”€ Status: Enabled                                            â”‚
â”‚  â”œâ”€â”€ Client ID: [Auto-generated]                                â”‚
â”‚  â”œâ”€â”€ Scopes: email, profile                                     â”‚
â”‚  â””â”€â”€ Redirect URI: https://datn-quizapp.firebaseapp.com         â”‚
â”‚                                                                 â”‚
â”‚  âŒ Facebook Login: Disabled (Not required)                      â”‚
â”‚  âŒ Apple Sign-In: Disabled (Not required for web)               â”‚
â”‚  âŒ Phone Authentication: Disabled (Cost consideration)          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Luá»“ng xÃ¡c thá»±c Email/Password vá»›i OTP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           LUá»’NG XÃC THá»°C EMAIL/PASSWORD Vá»šI OTP                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   User                    Client                    Server       â”‚
â”‚    â”‚                        â”‚                          â”‚         â”‚
â”‚    â”‚  1. Nháº­p email/pass    â”‚                          â”‚         â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚         â”‚
â”‚    â”‚                        â”‚  2. Validate input       â”‚         â”‚
â”‚    â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚        â”‚
â”‚    â”‚                        â”‚                          â”‚         â”‚
â”‚    â”‚                        â”‚  3. Generate OTP (6 digit)â”‚        â”‚
â”‚    â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚
â”‚    â”‚                        â”‚                          â”‚         â”‚
â”‚    â”‚  4. Gá»­i email OTP      â”‚                          â”‚         â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚         â”‚
â”‚    â”‚                        â”‚                          â”‚         â”‚
â”‚    â”‚  5. Nháº­p OTP           â”‚                          â”‚         â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚         â”‚
â”‚    â”‚                        â”‚  6. Verify OTP           â”‚         â”‚
â”‚    â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚        â”‚
â”‚    â”‚                        â”‚                          â”‚         â”‚
â”‚    â”‚                        â”‚  7. Create Auth User     â”‚         â”‚
â”‚    â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚
â”‚    â”‚                        â”‚                          â”‚         â”‚
â”‚    â”‚  8. Redirect Dashboard â”‚                          â”‚         â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Template Email OTP

Email OTP Ä‘Æ°á»£c gá»­i qua Cloud Function sá»­ dá»¥ng Nodemailer vÃ  Gmail SMTP:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OTP EMAIL TEMPLATE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚           ğŸ§  Quiz App                              â”‚       â”‚
â”‚    â”‚                                                    â”‚       â”‚
â”‚    â”‚        MÃ£ XÃ¡c Thá»±c OTP                             â”‚       â”‚
â”‚    â”‚                                                    â”‚       â”‚
â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚       â”‚
â”‚    â”‚    â”‚                                      â”‚        â”‚       â”‚
â”‚    â”‚    â”‚        MÃƒ XÃC THá»°C Cá»¦A Báº N           â”‚        â”‚       â”‚
â”‚    â”‚    â”‚                                      â”‚        â”‚       â”‚
â”‚    â”‚    â”‚           1 2 3 4 5 6                â”‚        â”‚       â”‚
â”‚    â”‚    â”‚                                      â”‚        â”‚       â”‚
â”‚    â”‚    â”‚      CÃ³ hiá»‡u lá»±c trong 10 phÃºt       â”‚        â”‚       â”‚
â”‚    â”‚    â”‚                                      â”‚        â”‚       â”‚
â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚       â”‚
â”‚    â”‚                                                    â”‚       â”‚
â”‚    â”‚    âš ï¸ LÆ°u Ã½ quan trá»ng:                            â”‚       â”‚
â”‚    â”‚    â€¢ MÃ£ OTP chá»‰ cÃ³ hiá»‡u lá»±c trong 10 phÃºt          â”‚       â”‚
â”‚    â”‚    â€¢ KHÃ”NG chia sáº» mÃ£ nÃ y vá»›i báº¥t ká»³ ai            â”‚       â”‚
â”‚    â”‚                                                    â”‚       â”‚
â”‚    â”‚    Â© 2025 Quiz App. All rights reserved.           â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### c) Cáº¥u hÃ¬nh Cloud Firestore (NoSQL Database, Indexing)

#### Kiáº¿n trÃºc Database Schema

Cloud Firestore Ä‘Æ°á»£c sá»­ dá»¥ng lÃ m cÆ¡ sá»Ÿ dá»¯ liá»‡u NoSQL chÃ­nh cho á»©ng dá»¥ng.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FIRESTORE SCHEMA DESIGN                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“ users/{userId}                                              â”‚
â”‚  â”œâ”€â”€ email: string                                              â”‚
â”‚  â”œâ”€â”€ displayName: string                                        â”‚
â”‚  â”œâ”€â”€ photoURL: string                                           â”‚
â”‚  â”œâ”€â”€ role: "admin" | "creator" | "user"                         â”‚
â”‚  â”œâ”€â”€ status: "active" | "banned" | "deleted"                    â”‚
â”‚  â”œâ”€â”€ createdAt: timestamp                                       â”‚
â”‚  â”œâ”€â”€ lastLoginAt: timestamp                                     â”‚
â”‚  â””â”€â”€ ğŸ“ settings/{settingId}                                    â”‚
â”‚      â”œâ”€â”€ theme: "light" | "dark" | "system"                     â”‚
â”‚      â””â”€â”€ language: "vi" | "en"                                  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ quizzes/{quizId}                                            â”‚
â”‚  â”œâ”€â”€ title: string                                              â”‚
â”‚  â”œâ”€â”€ description: string                                        â”‚
â”‚  â”œâ”€â”€ category: string                                           â”‚
â”‚  â”œâ”€â”€ difficulty: "easy" | "medium" | "hard"                     â”‚
â”‚  â”œâ”€â”€ status: "draft" | "pending" | "approved" | "rejected"      â”‚
â”‚  â”œâ”€â”€ isPublic: boolean                                          â”‚
â”‚  â”œâ”€â”€ password?: string (hashed)                                 â”‚
â”‚  â”œâ”€â”€ createdBy: string (userId)                                 â”‚
â”‚  â”œâ”€â”€ createdAt: timestamp                                       â”‚
â”‚  â”œâ”€â”€ updatedAt: timestamp                                       â”‚
â”‚  â”œâ”€â”€ playCount: number                                          â”‚
â”‚  â”œâ”€â”€ avgRating: number                                          â”‚
â”‚  â”œâ”€â”€ ğŸ“ questions/{questionId}                                  â”‚
â”‚  â”‚   â”œâ”€â”€ type: "multiple" | "checkbox" | "fill" | ...           â”‚
â”‚  â”‚   â”œâ”€â”€ question: string                                       â”‚
â”‚  â”‚   â”œâ”€â”€ options: array                                         â”‚
â”‚  â”‚   â”œâ”€â”€ correctAnswer: any                                     â”‚
â”‚  â”‚   â”œâ”€â”€ points: number                                         â”‚
â”‚  â”‚   â”œâ”€â”€ timeLimit: number                                      â”‚
â”‚  â”‚   â””â”€â”€ media?: { type, url }                                  â”‚
â”‚  â”œâ”€â”€ ğŸ“ results/{resultId}                                      â”‚
â”‚  â”‚   â”œâ”€â”€ userId: string                                         â”‚
â”‚  â”‚   â”œâ”€â”€ score: number                                          â”‚
â”‚  â”‚   â”œâ”€â”€ totalQuestions: number                                 â”‚
â”‚  â”‚   â”œâ”€â”€ correctAnswers: number                                 â”‚
â”‚  â”‚   â”œâ”€â”€ timeSpent: number                                      â”‚
â”‚  â”‚   â””â”€â”€ completedAt: timestamp                                 â”‚
â”‚  â””â”€â”€ ğŸ“ reviews/{reviewId}                                      â”‚
â”‚      â”œâ”€â”€ userId: string                                         â”‚
â”‚      â”œâ”€â”€ rating: number (1-5)                                   â”‚
â”‚      â”œâ”€â”€ comment: string                                        â”‚
â”‚      â””â”€â”€ createdAt: timestamp                                   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ categories/{categoryId}                                     â”‚
â”‚  â”œâ”€â”€ name: string                                               â”‚
â”‚  â”œâ”€â”€ icon: string                                               â”‚
â”‚  â”œâ”€â”€ color: string                                              â”‚
â”‚  â””â”€â”€ quizCount: number                                          â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ notifications/{notificationId}                              â”‚
â”‚  â”œâ”€â”€ userId: string                                             â”‚
â”‚  â”œâ”€â”€ type: "system" | "quiz" | "achievement"                    â”‚
â”‚  â”œâ”€â”€ title: string                                              â”‚
â”‚  â”œâ”€â”€ message: string                                            â”‚
â”‚  â”œâ”€â”€ isRead: boolean                                            â”‚
â”‚  â””â”€â”€ createdAt: timestamp                                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Cáº¥u hÃ¬nh Composite Indexes

Firestore yÃªu cáº§u táº¡o index cho cÃ¡c query phá»©c táº¡p. File `firestore.indexes.json`:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FIRESTORE INDEXES                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Index 1: Quiz Listing (Public, Approved, Ordered by Date)      â”‚
â”‚  â”œâ”€â”€ Collection: quizzes                                        â”‚
â”‚  â”œâ”€â”€ Fields:                                                    â”‚
â”‚  â”‚   â”œâ”€â”€ isPublic (Ascending)                                   â”‚
â”‚  â”‚   â”œâ”€â”€ status (Ascending)                                     â”‚
â”‚  â”‚   â””â”€â”€ createdAt (Descending)                                 â”‚
â”‚  â””â”€â”€ Query Scope: Collection                                    â”‚
â”‚                                                                 â”‚
â”‚  Index 2: Quiz by Category                                      â”‚
â”‚  â”œâ”€â”€ Collection: quizzes                                        â”‚
â”‚  â”œâ”€â”€ Fields:                                                    â”‚
â”‚  â”‚   â”œâ”€â”€ category (Ascending)                                   â”‚
â”‚  â”‚   â”œâ”€â”€ status (Ascending)                                     â”‚
â”‚  â”‚   â””â”€â”€ playCount (Descending)                                 â”‚
â”‚  â””â”€â”€ Query Scope: Collection                                    â”‚
â”‚                                                                 â”‚
â”‚  Index 3: User Results History                                  â”‚
â”‚  â”œâ”€â”€ Collection: results (subcollection)                        â”‚
â”‚  â”œâ”€â”€ Fields:                                                    â”‚
â”‚  â”‚   â”œâ”€â”€ userId (Ascending)                                     â”‚
â”‚  â”‚   â””â”€â”€ completedAt (Descending)                               â”‚
â”‚  â””â”€â”€ Query Scope: Collection Group                              â”‚
â”‚                                                                 â”‚
â”‚  Index 4: Leaderboard                                           â”‚
â”‚  â”œâ”€â”€ Collection: results (subcollection)                        â”‚
â”‚  â”œâ”€â”€ Fields:                                                    â”‚
â”‚  â”‚   â””â”€â”€ score (Descending)                                     â”‚
â”‚  â””â”€â”€ Query Scope: Collection Group                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### d) Cáº¥u hÃ¬nh Realtime Database (RTDB cho Multiplayer)

#### Kiáº¿n trÃºc RTDB cho Real-time Features

Realtime Database Ä‘Æ°á»£c sá»­ dá»¥ng cho cÃ¡c tÃ­nh nÄƒng cáº§n Ä‘á»“ng bá»™ tá»©c thÃ¬ nhÆ° Multiplayer vÃ  Presence.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REALTIME DATABASE SCHEMA                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“ rooms/{roomId}                                              â”‚
â”‚  â”œâ”€â”€ code: string (6-char unique)                               â”‚
â”‚  â”œâ”€â”€ name: string                                               â”‚
â”‚  â”œâ”€â”€ hostId: string                                             â”‚
â”‚  â”œâ”€â”€ ownerId: string (permanent creator)                        â”‚
â”‚  â”œâ”€â”€ quizId: string                                             â”‚
â”‚  â”œâ”€â”€ maxPlayers: number                                         â”‚
â”‚  â”œâ”€â”€ isPrivate: boolean                                         â”‚
â”‚  â”œâ”€â”€ password?: string (hashed SHA-256)                         â”‚
â”‚  â”œâ”€â”€ createdAt: number (timestamp)                              â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”œâ”€â”€ ğŸ“ players/{playerId}                                      â”‚
â”‚  â”‚   â”œâ”€â”€ id: string                                             â”‚
â”‚  â”‚   â”œâ”€â”€ name: string                                           â”‚
â”‚  â”‚   â”œâ”€â”€ avatar: string                                         â”‚
â”‚  â”‚   â”œâ”€â”€ score: number                                          â”‚
â”‚  â”‚   â”œâ”€â”€ isReady: boolean                                       â”‚
â”‚  â”‚   â”œâ”€â”€ isOnline: boolean                                      â”‚
â”‚  â”‚   â”œâ”€â”€ role: "host" | "player" | "spectator"                  â”‚
â”‚  â”‚   â”œâ”€â”€ joinedAt: number                                       â”‚
â”‚  â”‚   â””â”€â”€ lastActive: number                                     â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”œâ”€â”€ ğŸ“ gameState                                               â”‚
â”‚  â”‚   â”œâ”€â”€ status: "waiting" | "playing" | "paused" | "finished"  â”‚
â”‚  â”‚   â”œâ”€â”€ currentQuestion: number                                â”‚
â”‚  â”‚   â”œâ”€â”€ timeLeft: number                                       â”‚
â”‚  â”‚   â”œâ”€â”€ questionStartTime: number                              â”‚
â”‚  â”‚   â””â”€â”€ pausedAt?: number                                      â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”œâ”€â”€ ğŸ“ answers/{oderId}/{playerId}                             â”‚
â”‚  â”‚   â”œâ”€â”€ answer: any                                            â”‚
â”‚  â”‚   â”œâ”€â”€ timeSpent: number                                      â”‚
â”‚  â”‚   â””â”€â”€ submittedAt: number                                    â”‚
â”‚  â”‚                                                              â”‚
â”‚  â””â”€â”€ ğŸ“ chat/{messageId}                                        â”‚
â”‚      â”œâ”€â”€ senderId: string                                       â”‚
â”‚      â”œâ”€â”€ senderName: string                                     â”‚
â”‚      â”œâ”€â”€ message: string                                        â”‚
â”‚      â””â”€â”€ timestamp: number                                      â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ status/{userId}                                             â”‚
â”‚  â”œâ”€â”€ state: "online" | "offline" | "idle"                       â”‚
â”‚  â”œâ”€â”€ lastChanged: number (timestamp)                            â”‚
â”‚  â””â”€â”€ connections: { [connectionId]: boolean }                   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ quizPresence/{quizId}/users/{userId}                        â”‚
â”‚  â”œâ”€â”€ joinedAt: number                                           â”‚
â”‚  â””â”€â”€ isActive: boolean                                          â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ rateLimits/rag/{userId}                                     â”‚
â”‚  â”œâ”€â”€ count: number                                              â”‚
â”‚  â”œâ”€â”€ resetTime: number                                          â”‚
â”‚  â””â”€â”€ lastRequest: number                                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### So sÃ¡nh Firestore vs Realtime Database

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FIRESTORE VS REALTIME DATABASE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  TiÃªu chÃ­           â”‚  Firestore      â”‚  Realtime DB            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Data Model         â”‚  Document       â”‚  JSON Tree              â”‚
â”‚  Query              â”‚  Complex        â”‚  Simple                 â”‚
â”‚  Offline Support    â”‚  Excellent      â”‚  Good                   â”‚
â”‚  Real-time Latency  â”‚  ~1-2 seconds   â”‚  ~10-100ms âš¡           â”‚
â”‚  Pricing            â”‚  Per operation  â”‚  Per bandwidth          â”‚
â”‚  Scaling            â”‚  Automatic      â”‚  Manual sharding        â”‚
â”‚                                                                 â”‚
â”‚  Sá»­ dá»¥ng trong QuizTrivia:                                      â”‚
â”‚  â”œâ”€â”€ Firestore: Quiz data, User profiles, Results, Reviews      â”‚
â”‚  â””â”€â”€ RTDB: Multiplayer rooms, Presence, Live chat, Rate limits  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### e) Cáº¥u hÃ¬nh Cloud Storage (LÆ°u trá»¯ media)

#### Cáº¥u trÃºc thÆ° má»¥c Storage

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLOUD STORAGE STRUCTURE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“ gs://datn-quizapp.appspot.com/                              â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”œâ”€â”€ ğŸ“ user-avatars/{userId}/                                  â”‚
â”‚  â”‚   â””â”€â”€ avatar.jpg (max 5MB, image only)                       â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”œâ”€â”€ ğŸ“ quiz-media/{quizId}/                                    â”‚
â”‚  â”‚   â”œâ”€â”€ ğŸ“ images/                                             â”‚
â”‚  â”‚   â”‚   â””â”€â”€ {questionId}.jpg (max 10MB)                        â”‚
â”‚  â”‚   â”œâ”€â”€ ğŸ“ audio/                                              â”‚
â”‚  â”‚   â”‚   â””â”€â”€ {questionId}.mp3 (max 50MB)                        â”‚
â”‚  â”‚   â””â”€â”€ ğŸ“ video/                                              â”‚
â”‚  â”‚       â””â”€â”€ {questionId}.mp4 (max 100MB)                       â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”œâ”€â”€ ğŸ“ learning-materials/{quizId}/                            â”‚
â”‚  â”‚   â”œâ”€â”€ {materialId}.pdf (max 50MB)                            â”‚
â”‚  â”‚   â””â”€â”€ {materialId}.docx (max 20MB)                           â”‚
â”‚  â”‚                                                              â”‚
â”‚  â””â”€â”€ ğŸ“ temp-uploads/{userId}/                                  â”‚
â”‚      â””â”€â”€ {timestamp}_{filename} (auto-delete after 24h)         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Giá»›i háº¡n File Upload

| Loáº¡i file | Äá»‹nh dáº¡ng cho phÃ©p | Dung lÆ°á»£ng tá»‘i Ä‘a |
|-----------|-------------------|-------------------|
| **Avatar** | JPEG, PNG, WebP, GIF | 5 MB |
| **Quiz Image** | JPEG, PNG, WebP, GIF, TIFF | 10 MB |
| **Quiz Audio** | MP3, WAV, OGG, M4A | 50 MB |
| **Quiz Video** | MP4, WebM, OGG, MOV, AVI | 100 MB |
| **PDF Documents** | PDF | 50 MB |
| **Word Documents** | DOCX, DOC | 20 MB |

---

## 3.1.3. Thiáº¿t láº­p Báº£o máº­t vÃ  PhÃ¢n quyá»n (Security & Authorization)

### a) XÃ¢y dá»±ng Firestore Security Rules (RBAC - Role Based Access Control)

#### MÃ´ hÃ¬nh phÃ¢n quyá»n RBAC

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ROLE-BASED ACCESS CONTROL                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                        â”‚  ADMIN   â”‚                             â”‚
â”‚                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                             â”‚ Inherits                          â”‚
â”‚                        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                             â”‚
â”‚                        â”‚ CREATOR  â”‚                             â”‚
â”‚                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                             â”‚ Inherits                          â”‚
â”‚                        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                             â”‚
â”‚                        â”‚   USER   â”‚                             â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                 â”‚
â”‚  Quyá»n háº¡n theo Role:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Role    â”‚ Read Quiz â”‚ Create â”‚ Approve â”‚ Ban User â”‚ Adminâ”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ User    â”‚    âœ…     â”‚   âœ…   â”‚    âŒ   â”‚    âŒ    â”‚  âŒ  â”‚   â”‚
â”‚  â”‚ Creator â”‚    âœ…     â”‚   âœ…   â”‚    âŒ   â”‚    âŒ    â”‚  âŒ  â”‚   â”‚
â”‚  â”‚ Admin   â”‚    âœ…     â”‚   âœ…   â”‚    âœ…   â”‚    âœ…    â”‚  âœ…  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Firestore Security Rules Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FIRESTORE SECURITY RULES                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Helper Functions:                                              â”‚
â”‚  â”œâ”€â”€ signedIn()     : Kiá»ƒm tra user Ä‘Ã£ Ä‘Äƒng nháº­p                â”‚
â”‚  â”œâ”€â”€ isAdmin()      : Kiá»ƒm tra role admin                       â”‚
â”‚  â”œâ”€â”€ isCreator()    : Kiá»ƒm tra role creator                     â”‚
â”‚  â”œâ”€â”€ isOwner()      : Kiá»ƒm tra ownership cá»§a resource           â”‚
â”‚  â””â”€â”€ hasAccess()    : Kiá»ƒm tra quyá»n truy cáº­p quiz private      â”‚
â”‚                                                                 â”‚
â”‚  Users Collection Rules:                                        â”‚
â”‚  â”œâ”€â”€ Read: Authenticated users                                  â”‚
â”‚  â”œâ”€â”€ Create: Anyone (registration)                              â”‚
â”‚  â”œâ”€â”€ Update: Owner only OR Admin                                â”‚
â”‚  â””â”€â”€ Delete: Admin only                                         â”‚
â”‚                                                                 â”‚
â”‚  Quizzes Collection Rules:                                      â”‚
â”‚  â”œâ”€â”€ Read: Public quizzes OR Owner OR Admin                     â”‚
â”‚  â”œâ”€â”€ Create: Authenticated users                                â”‚
â”‚  â”œâ”€â”€ Update: Owner OR Admin                                     â”‚
â”‚  â””â”€â”€ Delete: Owner OR Admin                                     â”‚
â”‚                                                                 â”‚
â”‚  Questions Subcollection Rules:                                 â”‚
â”‚  â”œâ”€â”€ Read: If can read parent quiz                              â”‚
â”‚  â”œâ”€â”€ Create: Quiz owner only                                    â”‚
â”‚  â”œâ”€â”€ Update: Quiz owner only                                    â”‚
â”‚  â””â”€â”€ Delete: Quiz owner only                                    â”‚
â”‚                                                                 â”‚
â”‚  Results Subcollection Rules:                                   â”‚
â”‚  â”œâ”€â”€ Read: Result owner OR Quiz owner OR Admin                  â”‚
â”‚  â”œâ”€â”€ Create: Authenticated (after quiz completion)              â”‚
â”‚  â””â”€â”€ Update/Delete: Not allowed (immutable)                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Validation Rules cho Multiplayer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MULTIPLAYER VALIDATION RULES                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Room Name Validation:                                          â”‚
â”‚  â”œâ”€â”€ Type: String                                               â”‚
â”‚  â”œâ”€â”€ Min Length: 3 characters                                   â”‚
â”‚  â”œâ”€â”€ Max Length: 50 characters                                  â”‚
â”‚  â””â”€â”€ Forbidden: HTML special chars (<, >, ", ', &)              â”‚
â”‚                                                                 â”‚
â”‚  Max Players Validation:                                        â”‚
â”‚  â”œâ”€â”€ Type: Integer                                              â”‚
â”‚  â”œâ”€â”€ Min: 2 players                                             â”‚
â”‚  â””â”€â”€ Max: 20 players                                            â”‚
â”‚                                                                 â”‚
â”‚  Password Validation (if set):                                  â”‚
â”‚  â”œâ”€â”€ Type: String (SHA-256 hashed)                              â”‚
â”‚  â”œâ”€â”€ Min Length: 64 characters (hash length)                    â”‚
â”‚  â””â”€â”€ Max Length: 128 characters                                 â”‚
â”‚                                                                 â”‚
â”‚  Room Status Validation:                                        â”‚
â”‚  â””â”€â”€ Enum: ["waiting", "starting", "playing", "finished"]       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### b) XÃ¢y dá»±ng Realtime Database Rules (Validation & Integrity)

#### RTDB Rules Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RTDB SECURITY RULES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Room Access Rules:                                             â”‚
â”‚  â”œâ”€â”€ Read: Authenticated users                                  â”‚
â”‚  â””â”€â”€ Write: Authenticated AND (                                 â”‚
â”‚      â”œâ”€â”€ Room doesn't exist (creating) OR                       â”‚
â”‚      â”œâ”€â”€ User is owner OR                                       â”‚
â”‚      â”œâ”€â”€ User is current host OR                                â”‚
â”‚      â””â”€â”€ User is player AND host is offline (host migration)    â”‚
â”‚      )                                                          â”‚
â”‚                                                                 â”‚
â”‚  Player Node Rules:                                             â”‚
â”‚  â”œâ”€â”€ Read: Authenticated                                        â”‚
â”‚  â”œâ”€â”€ Write: Own player node OR Host                             â”‚
â”‚  â””â”€â”€ Validate: Required fields (id, name, score, isReady...)    â”‚
â”‚                                                                 â”‚
â”‚  GameState Rules:                                               â”‚
â”‚  â”œâ”€â”€ Read: Authenticated                                        â”‚
â”‚  â”œâ”€â”€ Write: Host OR Player in room                              â”‚
â”‚  â””â”€â”€ Validate: Status enum, currentQuestion range               â”‚
â”‚                                                                 â”‚
â”‚  Chat Rules:                                                    â”‚
â”‚  â”œâ”€â”€ Read: Players in room                                      â”‚
â”‚  â”œâ”€â”€ Write: Players in room                                     â”‚
â”‚  â””â”€â”€ Validate: Message length < 500 chars                       â”‚
â”‚                                                                 â”‚
â”‚  Presence (Status) Rules:                                       â”‚
â”‚  â”œâ”€â”€ Read: Authenticated                                        â”‚
â”‚  â”œâ”€â”€ Write: Own status only                                     â”‚
â”‚  â””â”€â”€ Validate: State enum (online/offline/idle)                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Host Migration Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HOST MIGRATION FLOW                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Scenario: Host disconnects unexpectedly                       â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚  1. Host connection lost                                â”‚   â”‚
â”‚   â”‚        â”‚                                                â”‚   â”‚
â”‚   â”‚        â–¼                                                â”‚   â”‚
â”‚   â”‚  2. onDisconnect triggers                               â”‚   â”‚
â”‚   â”‚     â””â”€â”€ Set host.isOnline = false                       â”‚   â”‚
â”‚   â”‚        â”‚                                                â”‚   â”‚
â”‚   â”‚        â–¼                                                â”‚   â”‚
â”‚   â”‚  3. Other players detect host offline                   â”‚   â”‚
â”‚   â”‚        â”‚                                                â”‚   â”‚
â”‚   â”‚        â–¼                                                â”‚   â”‚
â”‚   â”‚  4. Eligible player initiates migration                 â”‚   â”‚
â”‚   â”‚     â””â”€â”€ Condition: player.isOnline = true               â”‚   â”‚
â”‚   â”‚     â””â”€â”€ Priority: Earliest joinedAt                     â”‚   â”‚
â”‚   â”‚        â”‚                                                â”‚   â”‚
â”‚   â”‚        â–¼                                                â”‚   â”‚
â”‚   â”‚  5. Update hostId via RTDB transaction                  â”‚   â”‚
â”‚   â”‚        â”‚                                                â”‚   â”‚
â”‚   â”‚        â–¼                                                â”‚   â”‚
â”‚   â”‚  6. New host takes control                              â”‚   â”‚
â”‚   â”‚     â””â”€â”€ Can start/pause/end game                        â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### c) Quáº£n lÃ½ biáº¿n mÃ´i trÆ°á»ng vÃ  API Keys (Google Secret Manager)

#### Cáº¥u trÃºc Environment Variables

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ENVIRONMENT VARIABLES                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“ Client-side (.env.production):                              â”‚
â”‚  â”œâ”€â”€ VITE_FIREBASE_API_KEY          : Firebase Web API Key      â”‚
â”‚  â”œâ”€â”€ VITE_FIREBASE_AUTH_DOMAIN      : Auth Domain               â”‚
â”‚  â”œâ”€â”€ VITE_FIREBASE_PROJECT_ID       : Project ID                â”‚
â”‚  â”œâ”€â”€ VITE_FIREBASE_STORAGE_BUCKET   : Storage Bucket            â”‚
â”‚  â”œâ”€â”€ VITE_FIREBASE_MESSAGING_ID     : FCM Sender ID             â”‚
â”‚  â”œâ”€â”€ VITE_FIREBASE_APP_ID           : Firebase App ID           â”‚
â”‚  â”œâ”€â”€ VITE_FIREBASE_MEASUREMENT_ID   : Analytics ID              â”‚
â”‚  â””â”€â”€ VITE_FIREBASE_DATABASE_URL     : RTDB URL                  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ Server-side (Firebase Secrets):                             â”‚
â”‚  â”œâ”€â”€ GOOGLE_AI_API_KEY              : Gemini AI API Key         â”‚
â”‚  â”œâ”€â”€ EMAIL_USER                     : Gmail sender              â”‚
â”‚  â””â”€â”€ EMAIL_PASSWORD                 : Gmail app password        â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Security Notes:                                             â”‚
â”‚  â”œâ”€â”€ Client keys are restricted by domain (Firebase Console)    â”‚
â”‚  â”œâ”€â”€ Server keys are stored in Google Secret Manager            â”‚
â”‚  â””â”€â”€ .env files are in .gitignore (never committed)             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Firebase Secrets Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FIREBASE SECRETS SETUP                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  BÆ°á»›c 1: Táº¡o Secret trong Google Cloud Console                  â”‚
â”‚  â””â”€â”€ gcloud secrets create GOOGLE_AI_API_KEY                    â”‚
â”‚                                                                 â”‚
â”‚  BÆ°á»›c 2: ThÃªm giÃ¡ trá»‹ vÃ o Secret                                â”‚
â”‚  â””â”€â”€ echo "AIza..." | gcloud secrets versions add \             â”‚
â”‚      GOOGLE_AI_API_KEY --data-file=-                            â”‚
â”‚                                                                 â”‚
â”‚  BÆ°á»›c 3: Cáº¥p quyá»n cho Cloud Functions                          â”‚
â”‚  â””â”€â”€ Service Account: xxx@appspot.gserviceaccount.com           â”‚
â”‚  â””â”€â”€ Role: Secret Manager Secret Accessor                       â”‚
â”‚                                                                 â”‚
â”‚  BÆ°á»›c 4: Reference trong Cloud Function                         â”‚
â”‚  â””â”€â”€ functions.runWith({ secrets: ['GOOGLE_AI_API_KEY'] })      â”‚
â”‚                                                                 â”‚
â”‚  BÆ°á»›c 5: Access trong code                                      â”‚
â”‚  â””â”€â”€ const apiKey = process.env.GOOGLE_AI_API_KEY;              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3.1.4. Káº¿t ná»‘i Client vá»›i Firebase (SDK Integration)

### a) CÃ i Ä‘áº·t vÃ  khá»Ÿi táº¡o Firebase SDK

#### CÃ i Ä‘áº·t Firebase packages

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FIREBASE SDK PACKAGES                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Core Package:                                                  â”‚
â”‚  â””â”€â”€ firebase@10.14.1                                           â”‚
â”‚                                                                 â”‚
â”‚  Included Services:                                             â”‚
â”‚  â”œâ”€â”€ firebase/app          : Core initialization                â”‚
â”‚  â”œâ”€â”€ firebase/auth         : Authentication                     â”‚
â”‚  â”œâ”€â”€ firebase/firestore    : Cloud Firestore                    â”‚
â”‚  â”œâ”€â”€ firebase/database     : Realtime Database                  â”‚
â”‚  â”œâ”€â”€ firebase/storage      : Cloud Storage                      â”‚
â”‚  â”œâ”€â”€ firebase/functions    : Cloud Functions client             â”‚
â”‚  â””â”€â”€ firebase/analytics    : Google Analytics                   â”‚
â”‚                                                                 â”‚
â”‚  Installation Command:                                          â”‚
â”‚  â””â”€â”€ npm install firebase@10.14.1                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### b) Cáº¥u hÃ¬nh biáº¿n mÃ´i trÆ°á»ng phÃ­a Client (.env)

#### File `.env.production`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENT ENVIRONMENT FILE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  # Firebase Configuration                                       â”‚
â”‚  VITE_FIREBASE_API_KEY=AIzaSy...                                â”‚
â”‚  VITE_FIREBASE_AUTH_DOMAIN=datn-quizapp.firebaseapp.com         â”‚
â”‚  VITE_FIREBASE_PROJECT_ID=datn-quizapp                          â”‚
â”‚  VITE_FIREBASE_STORAGE_BUCKET=datn-quizapp.appspot.com          â”‚
â”‚  VITE_FIREBASE_MESSAGING_SENDER_ID=741975099365                 â”‚
â”‚  VITE_FIREBASE_APP_ID=1:741975099365:web:75a1d1eb4b6d89f0f7110c â”‚
â”‚  VITE_FIREBASE_MEASUREMENT_ID=G-6Y1VQMBGJ0                      â”‚
â”‚  VITE_FIREBASE_DATABASE_URL=https://datn-quizapp-default-rtdb...â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ LÆ°u Ã½:                                                      â”‚
â”‚  - Prefix VITE_ báº¯t buá»™c Ä‘á»ƒ Vite expose ra client               â”‚
â”‚  - File nÃ y KHÃ”NG Ä‘Æ°á»£c commit vÃ o Git                           â”‚
â”‚  - Sá»­ dá»¥ng .env.example lÃ m template                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### c) Thiáº¿t láº­p Service Singleton cho Auth, DB, Storage

#### Firebase Config Module Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FIREBASE CONFIG MODULE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“ src/lib/firebase/config.ts                                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  1. Firebase Configuration Object                       â”‚    â”‚
â”‚  â”‚     â””â”€â”€ Load from import.meta.env (Vite)                â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  2. Singleton Initialization                            â”‚    â”‚
â”‚  â”‚     â””â”€â”€ getApps().length check prevents re-init         â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  3. Service Exports:                                    â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ auth     : Firebase Auth instance               â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ db       : Firestore with offline cache         â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ rtdb     : Realtime Database instance           â”‚    â”‚
â”‚  â”‚     â”œâ”€â”€ storage  : Cloud Storage instance               â”‚    â”‚
â”‚  â”‚     â””â”€â”€ analytics: Optional (disabled on localhost)     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  4. Auth Persistence                                    â”‚    â”‚
â”‚  â”‚     â””â”€â”€ browserLocalPersistence (remember login)        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  5. Firestore Offline Cache                             â”‚    â”‚
â”‚  â”‚     â””â”€â”€ persistentLocalCache with multi-tab support     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Firestore Offline Persistence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FIRESTORE OFFLINE PERSISTENCE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Configuration:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  initializeFirestore(app, {                             â”‚    â”‚
â”‚  â”‚    localCache: persistentLocalCache({                   â”‚    â”‚
â”‚  â”‚      tabManager: persistentMultipleTabManager()         â”‚    â”‚
â”‚  â”‚    })                                                   â”‚    â”‚
â”‚  â”‚  });                                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  Features:                                                      â”‚
â”‚  â”œâ”€â”€ âœ… Data cached in IndexedDB                                â”‚
â”‚  â”œâ”€â”€ âœ… Works offline after first load                          â”‚
â”‚  â”œâ”€â”€ âœ… Multi-tab synchronization                               â”‚
â”‚  â”œâ”€â”€ âœ… Automatic conflict resolution                           â”‚
â”‚  â””â”€â”€ âœ… Background sync when online                             â”‚
â”‚                                                                 â”‚
â”‚  Storage Structure:                                             â”‚
â”‚  â””â”€â”€ IndexedDB > firestore > [projectId] > main                 â”‚
â”‚      â”œâ”€â”€ remoteDocuments    : Cached server data                â”‚
â”‚      â”œâ”€â”€ documentMutations  : Pending writes                    â”‚
â”‚      â””â”€â”€ targets            : Query caching                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Tá»•ng káº¿t pháº§n 3.1

Pháº§n 3.1 Ä‘Ã£ trÃ¬nh bÃ y chi tiáº¿t quÃ¡ trÃ¬nh **XÃ¢y dá»±ng MÃ´i trÆ°á»ng vÃ  Cáº¥u hÃ¬nh Háº¡ táº§ng** cho há»‡ thá»‘ng QuizTrivia, bao gá»“m:

| Má»¥c | Ná»™i dung chÃ­nh | Tráº¡ng thÃ¡i |
|-----|---------------|------------|
| **3.1.1** | Cáº¥u hÃ¬nh mÃ´i trÆ°á»ng phÃ¡t triá»ƒn (Hardware, Node.js, IDE, Git) | âœ… HoÃ n thÃ nh |
| **3.1.2** | Khá»Ÿi táº¡o Firebase (Project, Auth, Firestore, RTDB, Storage) | âœ… HoÃ n thÃ nh |
| **3.1.3** | Thiáº¿t láº­p báº£o máº­t (Security Rules, RBAC, Secrets) | âœ… HoÃ n thÃ nh |
| **3.1.4** | Káº¿t ná»‘i Client vá»›i Firebase (SDK, Config, Services) | âœ… HoÃ n thÃ nh |

**Káº¿t quáº£ Ä‘áº¡t Ä‘Æ°á»£c:**
- âœ… MÃ´i trÆ°á»ng phÃ¡t triá»ƒn hoÃ n chá»‰nh vá»›i Node.js 20.x, VS Code
- âœ… Firebase project `datn-quizapp` vá»›i Ä‘áº§y Ä‘á»§ services
- âœ… Security Rules cho Firestore vÃ  RTDB theo mÃ´ hÃ¬nh RBAC
- âœ… Firebase SDK tÃ­ch há»£p vá»›i offline persistence

---

*TÃ i liá»‡u Ä‘Æ°á»£c táº¡o: ThÃ¡ng 12/2025*  
*DÃ¹ng cho: ChÆ°Æ¡ng 3 - CÃ i Ä‘áº·t vÃ  Thá»­ nghiá»‡m Há»‡ thá»‘ng*  
*Äá»“ Ã¡n Tá»‘t nghiá»‡p: á»¨ng dá»¥ng Quiz Trá»±c tuyáº¿n QuizTrivia*

[{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\scripts\\buildVectorIndex.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'db' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":40,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'storage' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":41,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Script to build the vector index for RAG chatbot\r\n * This will:\r\n * 1. Extract data from Firestore (quizzes)\r\n * 2. Generate embeddings for each chunk\r\n * 3. Save the index to data/vector-index.json\r\n * \r\n * Usage: \r\n *   npx tsx scripts/buildVectorIndex.ts\r\n * Or:\r\n *   npm run build:index (add to package.json scripts)\r\n */\r\n\r\nimport { initializeApp, getApps } from 'firebase/app';\r\nimport { getFirestore } from 'firebase/firestore';\r\nimport { getStorage } from 'firebase/storage';\r\nimport { buildIndex, saveIndexToFile } from '../src/lib/genkit/indexing';\r\n\r\n// Firebase config (same as in your app)\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyDtBzTHNPQ5PxKhVb-si89kgr5T_3ppwj8\",\r\n  authDomain: \"datn-quizapp.firebaseapp.com\",\r\n  projectId: \"datn-quizapp\",\r\n  storageBucket: \"datn-quizapp.firebasestorage.app\",\r\n  messagingSenderId: \"741975099365\",\r\n  appId: \"1:741975099365:web:75a1d1eb4b6d89f0f7110c\",\r\n  measurementId: \"G-6Y1VQMBGJ0\",\r\n  databaseURL: \"https://datn-quizapp-default-rtdb.firebaseio.com\"\r\n};\r\n\r\nasync function main() {\r\n  console.log('üöÄ Starting vector index build...\\n');\r\n\r\n  try {\r\n    // Initialize Firebase (avoid duplicate initialization)\r\n    console.log('üì± Initializing Firebase...');\r\n    const app = getApps().length === 0 \r\n      ? initializeApp(firebaseConfig) \r\n      : getApps()[0];\r\n    const db = getFirestore(app);\r\n    const storage = getStorage(app);\r\n    console.log('‚úÖ Firebase initialized\\n');\r\n\r\n    // Build the index\r\n    console.log('üî® Building vector index...');\r\n    console.log('   This may take a few minutes depending on data size...\\n');\r\n    \r\n    const startTime = Date.now();\r\n    const index = await buildIndex();\r\n    const endTime = Date.now();\r\n    \r\n    const duration = ((endTime - startTime) / 1000).toFixed(2);\r\n    \r\n    console.log('\\n‚úÖ Index built successfully!\\n');\r\n    console.log('üìä Index Statistics:');\r\n    console.log(`   Total chunks: ${index.chunks.length}`);\r\n    console.log(`   Quiz chunks: ${index.sources.quiz || 0}`);\r\n    console.log(`   PDF chunks: ${index.sources.pdf || 0}`);\r\n    console.log(`   Web chunks: ${index.sources.web || 0}`);\r\n    console.log(`   Note chunks: ${index.sources.note || 0}`);\r\n    console.log(`   Build time: ${duration}s`);\r\n    console.log(`   Created: ${new Date(index.createdAt).toLocaleString()}\\n`);\r\n\r\n    // Verify embeddings\r\n    if (index.chunks.length > 0) {\r\n      const firstChunk = index.chunks[0];\r\n      console.log('üîç Sample chunk:');\r\n      console.log(`   ID: ${firstChunk.chunkId}`);\r\n      console.log(`   Title: ${firstChunk.title}`);\r\n      console.log(`   Source: ${firstChunk.sourceType}`);\r\n      console.log(`   Visibility: ${firstChunk.visibility}`);\r\n      console.log(`   Text preview: ${firstChunk.text.substring(0, 100)}...`);\r\n      console.log(`   Embedding dimensions: ${firstChunk.embedding.length}`);\r\n      console.log(`   Embedding sample: [${firstChunk.embedding.slice(0, 5).map(v => v.toFixed(4)).join(', ')}...]\\n`);\r\n    }\r\n\r\n    // Save to file\r\n    const outputPath = 'data/vector-index.json';\r\n    console.log(`üíæ Saving index to ${outputPath}...`);\r\n    await saveIndexToFile(index, 'vector-index.json');\r\n    \r\n    // Check file size\r\n    const fs = await import('fs');\r\n    const path = await import('path');\r\n    const fullPath = path.join(process.cwd(), 'data', 'vector-index.json');\r\n    const stats = fs.statSync(fullPath);\r\n    const fileSizeMB = (stats.size / (1024 * 1024)).toFixed(2);\r\n    console.log(`‚úÖ Index saved! File size: ${fileSizeMB} MB\\n`);\r\n\r\n    console.log('üéâ Build complete! The chatbot is ready to use the index.');\r\n    console.log(`üìÇ Index file: ${fullPath}`);\r\n    \r\n    process.exit(0);\r\n\r\n  } catch (error) {\r\n    console.error('‚ùå Error building index:', error);\r\n    if (error instanceof Error) {\r\n      console.error(error.stack);\r\n    }\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nmain();\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\scripts\\testRAG.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'signInWithEmailAndPassword' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * üß™ RAG Chatbot Testing Script\r\n * \r\n * Comprehensive test suite for RAG functionality\r\n * Tests: Permission control, citation accuracy, latency\r\n * \r\n * Usage: npx tsx scripts/testRAG.ts\r\n */\r\n\r\nimport { initializeApp, getApps } from 'firebase/app';\r\nimport { getAuth, signInWithEmailAndPassword } from 'firebase/auth';\r\nimport { askQuestion } from '../src/lib/genkit/ragFlow';\r\nimport type { RAGResponse } from '../src/lib/genkit/types';\r\n\r\n// Firebase config\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyDtBzTHNPQ5PxKhVb-si89kgr5T_3ppwj8\",\r\n  authDomain: \"datn-quizapp.firebaseapp.com\",\r\n  projectId: \"datn-quizapp\",\r\n  storageBucket: \"datn-quizapp.firebasestorage.app\",\r\n  messagingSenderId: \"741975099365\",\r\n  appId: \"1:741975099365:web:75a1d1eb4b6d89f0f7110c\",\r\n};\r\n\r\n// Test cases\r\ninterface TestCase {\r\n  id: string;\r\n  name: string;\r\n  question: string;\r\n  expectedKeywords?: string[];\r\n  shouldHaveContent: boolean;\r\n  minLatency?: number;\r\n  maxLatency?: number;\r\n}\r\n\r\nconst testCases: TestCase[] = [\r\n  {\r\n    id: 'test-1',\r\n    name: 'Public Quiz Question',\r\n    question: 'C√¥ng th·ª©c t√≠nh di·ªán t√≠ch h√¨nh tr√≤n l√† g√¨?',\r\n    expectedKeywords: ['œÄ', 'b√°n k√≠nh', 'r'],\r\n    shouldHaveContent: true,\r\n    maxLatency: 2500,\r\n  },\r\n  {\r\n    id: 'test-2',\r\n    name: 'General Knowledge',\r\n    question: 'Th·ªß ƒë√¥ c·ªßa Vi·ªát Nam l√† g√¨?',\r\n    expectedKeywords: ['H√† N·ªôi'],\r\n    shouldHaveContent: true,\r\n    maxLatency: 2500,\r\n  },\r\n  {\r\n    id: 'test-3',\r\n    name: 'No Context Available',\r\n    question: 'C√¥ng th·ª©c l∆∞·ª£ng t·ª≠ c∆° b·∫£n l√† g√¨?',\r\n    expectedKeywords: ['kh√¥ng ƒë·ªß d·ªØ li·ªáu', 'kh√¥ng t√¨m th·∫•y'],\r\n    shouldHaveContent: false,\r\n    maxLatency: 2500,\r\n  },\r\n  {\r\n    id: 'test-4',\r\n    name: 'Multi-aspect Question',\r\n    question: 'Gi·∫£i th√≠ch v·ªÅ h√†m s·ªë b·∫≠c hai',\r\n    shouldHaveContent: true,\r\n    maxLatency: 2500,\r\n  },\r\n];\r\n\r\n// Test statistics\r\ninterface TestStats {\r\n  total: number;\r\n  passed: number;\r\n  failed: number;\r\n  averageLatency: number;\r\n  citationAccuracy: number;\r\n}\r\n\r\n/**\r\n * Run a single test case\r\n */\r\nasync function runTest(testCase: TestCase, userId: string): Promise<{ passed: boolean; result: RAGResponse }> {\r\n  console.log(`\\nüß™ Testing: ${testCase.name}`);\r\n  console.log(`   Question: \"${testCase.question}\"`);\r\n\r\n  const startTime = Date.now();\r\n  let result: RAGResponse;\r\n\r\n  try {\r\n    result = await askQuestion({\r\n      userId,\r\n      question: testCase.question,\r\n      targetLang: 'vi',\r\n    });\r\n\r\n    const latency = Date.now() - startTime;\r\n    console.log(`   ‚è±Ô∏è  Latency: ${latency}ms`);\r\n\r\n    // Check latency\r\n    if (testCase.maxLatency && latency > testCase.maxLatency) {\r\n      console.log(`   ‚ùå Latency exceeded (max: ${testCase.maxLatency}ms)`);\r\n      return { passed: false, result };\r\n    }\r\n\r\n    // Check if should have content\r\n    const hasContent = result.usedChunks > 0;\r\n    if (testCase.shouldHaveContent && !hasContent) {\r\n      console.log(`   ‚ùå Expected content but got none`);\r\n      return { passed: false, result };\r\n    }\r\n\r\n    if (!testCase.shouldHaveContent && hasContent) {\r\n      console.log(`   ‚ùå Expected no content but got some`);\r\n      return { passed: false, result };\r\n    }\r\n\r\n    // Check keywords\r\n    if (testCase.expectedKeywords) {\r\n      const answerLower = result.answer.toLowerCase();\r\n      const hasAllKeywords = testCase.expectedKeywords.some(keyword =>\r\n        answerLower.includes(keyword.toLowerCase())\r\n      );\r\n\r\n      if (!hasAllKeywords) {\r\n        console.log(`   ‚ö†Ô∏è  Missing expected keywords: ${testCase.expectedKeywords.join(', ')}`);\r\n      }\r\n    }\r\n\r\n    // Check citations\r\n    console.log(`   üìö Citations: ${result.citations.length}`);\r\n    console.log(`   üìÑ Chunks used: ${result.usedChunks}`);\r\n\r\n    console.log(`   ‚úÖ Test passed`);\r\n    return { passed: true, result };\r\n\r\n  } catch (error) {\r\n    console.log(`   ‚ùå Test failed with error:`, error);\r\n    return {\r\n      passed: false,\r\n      result: {\r\n        answer: '',\r\n        citations: [],\r\n        usedChunks: 0,\r\n        processingTime: 0,\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Calculate citation accuracy\r\n */\r\nfunction calculateCitationAccuracy(results: RAGResponse[]): number {\r\n  let totalCitations = 0;\r\n  let validCitations = 0;\r\n\r\n  results.forEach(result => {\r\n    totalCitations += result.citations.length;\r\n    \r\n    // Check if citations are valid (have title and either quizId or url)\r\n    result.citations.forEach(citation => {\r\n      if (citation.title && (citation.quizId || citation.url)) {\r\n        validCitations++;\r\n      }\r\n    });\r\n  });\r\n\r\n  if (totalCitations === 0) return 0;\r\n  return (validCitations / totalCitations) * 100;\r\n}\r\n\r\n/**\r\n * Main test runner\r\n */\r\nasync function main() {\r\n  console.log('üöÄ Starting RAG Chatbot Test Suite\\n');\r\n  console.log('=' .repeat(60));\r\n\r\n  try {\r\n    // Initialize Firebase\r\n    console.log('üì± Initializing Firebase...');\r\n    const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];\r\n    const auth = getAuth(app);\r\n\r\n    // Sign in (use test account or admin account)\r\n    // For testing, you may need to create a test account first\r\n    console.log('üîê Authenticating...');\r\n    console.log('‚ö†Ô∏è  Note: Using current Firebase auth state');\r\n    console.log('   If not authenticated, some tests may fail\\n');\r\n\r\n    const userId = auth.currentUser?.uid || 'test-user-id';\r\n    if (!auth.currentUser) {\r\n      console.log('‚ö†Ô∏è  Warning: No authenticated user. Tests may not work correctly.\\n');\r\n    }\r\n\r\n    // Run tests\r\n    console.log('=' .repeat(60));\r\n    console.log('Running tests...\\n');\r\n\r\n    const results: Array<{ passed: boolean; result: RAGResponse }> = [];\r\n\r\n    for (const testCase of testCases) {\r\n      const result = await runTest(testCase, userId);\r\n      results.push(result);\r\n      \r\n      // Wait between tests to avoid rate limiting\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n    }\r\n\r\n    // Calculate statistics\r\n    console.log('\\n' + '='.repeat(60));\r\n    console.log('üìä Test Results Summary\\n');\r\n\r\n    const stats: TestStats = {\r\n      total: results.length,\r\n      passed: results.filter(r => r.passed).length,\r\n      failed: results.filter(r => !r.passed).length,\r\n      averageLatency: results.reduce((sum, r) => sum + r.result.processingTime, 0) / results.length,\r\n      citationAccuracy: calculateCitationAccuracy(results.map(r => r.result)),\r\n    };\r\n\r\n    console.log(`Total Tests: ${stats.total}`);\r\n    console.log(`‚úÖ Passed: ${stats.passed}`);\r\n    console.log(`‚ùå Failed: ${stats.failed}`);\r\n    console.log(`‚è±Ô∏è  Average Latency: ${stats.averageLatency.toFixed(0)}ms`);\r\n    console.log(`üìö Citation Accuracy: ${stats.citationAccuracy.toFixed(1)}%`);\r\n    console.log();\r\n\r\n    // Performance evaluation\r\n    console.log('üéØ Performance Evaluation:');\r\n    \r\n    const latencyTarget = 2500;\r\n    const citationTarget = 90;\r\n\r\n    if (stats.averageLatency <= latencyTarget) {\r\n      console.log(`   ‚úÖ Latency: PASS (target: < ${latencyTarget}ms)`);\r\n    } else {\r\n      console.log(`   ‚ùå Latency: FAIL (target: < ${latencyTarget}ms)`);\r\n    }\r\n\r\n    if (stats.citationAccuracy >= citationTarget) {\r\n      console.log(`   ‚úÖ Citation Accuracy: PASS (target: ‚â• ${citationTarget}%)`);\r\n    } else {\r\n      console.log(`   ‚ö†Ô∏è  Citation Accuracy: NEEDS IMPROVEMENT (target: ‚â• ${citationTarget}%)`);\r\n    }\r\n\r\n    console.log('\\n' + '='.repeat(60));\r\n\r\n    // Exit with appropriate code\r\n    if (stats.failed === 0 && stats.averageLatency <= latencyTarget && stats.citationAccuracy >= citationTarget) {\r\n      console.log('üéâ All tests passed! RAG chatbot is production-ready.\\n');\r\n      process.exit(0);\r\n    } else {\r\n      console.log('‚ö†Ô∏è  Some tests failed or performance targets not met. Review the results above.\\n');\r\n      process.exit(1);\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('‚ùå Test suite failed:', error);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nmain();\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\App.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8956,8959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8956,8959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Offline feature coming soon</div>","line":533,"column":20,"nodeType":"JSXText","endLine":533,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, Suspense } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';\r\nimport { Provider, useSelector, useDispatch } from 'react-redux';\r\nimport { store, RootState } from './lib/store';\r\nimport { onAuthStateChanged } from 'firebase/auth';\r\nimport { auth, db } from './lib/firebase/config';\r\nimport { doc, getDoc, setDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { loginSuccess, logout, authCheckComplete } from './features/auth/store';\r\nimport I18nProvider from './shared/components/I18nProvider';\r\n\r\n// Stage 1: Basic Landing & Authentication\r\nimport { LandingPage } from './shared/pages/LandingPage';\r\n\r\n// Stage 2: Authentication Pages\r\nimport AuthPageNew from './features/auth/pages/AuthPageNew';\r\n\r\n// Removed RegisterPage import as the file has been deleted\r\n// Stage 2: Basic User Features - Lazy loaded\r\nconst Dashboard = React.lazy(() => import('./shared/pages/Dashboard'));\r\nconst QuizList = React.lazy(() => import('./features/quiz/pages/QuizList'));\r\nconst QuizPage = React.lazy(() => import('./features/quiz/pages/QuizPage'));\r\nconst QuizPreviewPage = React.lazy(() => import('./features/quiz/pages/QuizPreviewPage'));\r\nconst QuizReviewsPage = React.lazy(() => import('./features/quiz/pages/QuizReviewsPage'));\r\nconst RealQuizListPage = React.lazy(() => import('./features/quiz/pages/RealQuizListPage'));\r\nconst QuizResultViewer = React.lazy(() => import('./features/quiz/pages/QuizResultViewer'));\r\nconst LearningMaterialsPage = React.lazy(() => import('./features/quiz/pages/LearningMaterialsPage'));\r\nconst Profile = React.lazy(() => import('./features/auth/pages/Profile'));\r\nconst FavoritesPage = React.lazy(() => import('./features/quiz/pages/FavoritesPage'));\r\nconst LeaderboardPage = React.lazy(() => import('./features/quiz/pages/LeaderboardPage'));\r\n\r\n// Stage 3: Creator Features (REMOVED - Creator role eliminated)\r\nconst CreateQuizPage = React.lazy(() => import('./features/quiz/pages/CreateQuizPage'));\r\n\r\n// Offline Management\r\n// const OfflineSettingsPage = React.lazy(() => import('./pages/OfflineSettingsPage'));\r\n// import { OfflineStatusIndicator } from './components/OfflineStatusIndicator';\r\nconst EditQuizPageAdvanced = React.lazy(() => import('./features/quiz/pages/EditQuizPageAdvanced'));\r\nconst CreatorLayout = React.lazy(() => import('./features/creator/layouts/CreatorLayout'));\r\n\r\n// Stage 4: New Features - Offline & Multiplayer\r\n// const OfflineQuizManager = React.lazy(() => import('./features/offline/components/OfflineQuizManager'));\r\nconst MultiplayerLobby = React.lazy(() => import('./features/multiplayer/pages/MultiplayerLobby'));\r\nconst MultiplayerPage = React.lazy(() => import('./features/multiplayer/pages/MultiplayerPage'));\r\nconst MyQuizzesPage = React.lazy(() => import('./features/quiz/pages/MyQuizzesPage'));\r\nconst QuizDetailedStats = React.lazy(() => import('./features/quiz/pages/QuizDetailedStats'));\r\n\r\n// Stage 4: Admin Features - All lazy loaded for better performance\r\nconst Admin = React.lazy(() => import('./features/admin/pages/Admin'));\r\nconst AdminQuizManagement = React.lazy(() => import('./features/admin/pages/AdminQuizManagement'));\r\nconst AdminUserManagement = React.lazy(() => import('./features/admin/pages/AdminUserManagement'));\r\nconst BuildIndexPage = React.lazy(() => import('./features/admin/pages/BuildIndexPage'));\r\n\r\n// RAG Chatbot\r\nimport { ChatbotButton } from './components/rag';\r\nconst StatsDashboard = React.lazy(() => import('./features/admin/pages/StatsDashboard'));\r\nconst CategoryManagement = React.lazy(() => import('./features/admin/pages/CategoryManagement'));\r\nconst AdminStats = React.lazy(() => import('./features/admin/components/AdminStats'));\r\nconst AdminUtilities = React.lazy(() => import('./features/admin/components/AdminUtilities'));\r\n\r\n// Stage 5: Advanced Components\r\nimport { Layout } from './shared/components/layout/Layout';\r\nimport { NotFound } from './shared/components/layout/NotFound';\r\nimport ErrorBoundary from './shared/components/ErrorBoundary';\r\nimport RoleSelection from './features/auth/components/RoleSelection';\r\nimport ProtectedRoute from './features/auth/components/ProtectedRoute';\r\nimport AutoLogoutOnBan from './features/auth/components/AutoLogoutOnBan';\r\nimport AdminProtectedRoute from './features/admin/components/AdminProtectedRoute';\r\nimport NotificationBanner from './shared/components/NotificationBanner';\r\nimport RoleBasedRedirect from './shared/components/RoleBasedRedirect';\r\nimport ScrollToTop from './shared/components/ScrollToTop';\r\nimport { ToastContainer } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\n\r\nconst AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    const mounted = true;\r\n    // Set timeout ƒë·ªÉ tr√°nh loading v√¥ h·∫°n\r\n    const timeout = setTimeout(() => {\r\n      if (mounted) {\r\n        dispatch(authCheckComplete());\r\n      }\r\n    }, 5000); // TƒÉng l√™n 5 gi√¢y ƒë·ªÉ ƒë·∫£m b·∫£o ƒë·ªß th·ªùi gian\r\n\r\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n      if (!mounted) return;\r\n      clearTimeout(timeout); // Clear timeout n·∫øu auth check th√†nh c√¥ng\r\n      \r\n      console.log('üîê Auth state changed:', {\r\n        user: user ? {\r\n          uid: user.uid,\r\n          email: user.email,\r\n          displayName: user.displayName,\r\n          emailVerified: user.emailVerified\r\n        } : null,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n      \r\n      if (user) {\r\n        try {\r\n          // Get role from Firestore tr∆∞·ªõc khi check email verification\r\n          const userDocRef = doc(db, 'users', user.uid);\r\n          const userDoc = await getDoc(userDocRef);\r\n          \r\n          let role: 'admin' | 'creator' | 'user' = 'user';\r\n          let userData = null;\r\n          \r\n          if (userDoc.exists()) {\r\n            userData = userDoc.data();\r\n            \r\n            // Check if user is deleted or inactive\r\n            if (userData.isDeleted || userData.isActive === false) {\r\n              console.log('üö´ User account is deleted/inactive, logging out');\r\n              await auth.signOut();\r\n              dispatch(logout());\r\n              dispatch(authCheckComplete());\r\n              return;\r\n            }\r\n            \r\n            role = userData.role || 'user';\r\n            console.log('‚úÖ Found user document:', { uid: user.uid, role, userData });\r\n            \r\n            // Ch·ªâ check email verification cho user th∆∞·ªùng, kh√¥ng ph·∫£i admin\r\n            if (!user.emailVerified && user.email !== 'admin123@gmail.com' && role !== 'admin') {\r\n              console.log('üìß Email not verified for regular user, redirecting to verification');\r\n              // Kh√¥ng sign out ngay, ƒë·ªÉ user c√≥ c∆° h·ªôi verify email\r\n              // await auth.signOut();\r\n              // dispatch(logout());\r\n              // dispatch(authCheckComplete());\r\n              // return;\r\n            }\r\n          } else if (user.email === 'admin123@gmail.com') {\r\n            role = 'admin';\r\n            console.log('üëë Creating admin user document');\r\n            // Create admin document if it doesn't exist\r\n            try {\r\n              await setDoc(userDocRef, {\r\n                email: user.email,\r\n                displayName: user.displayName || 'Admin',\r\n                role: 'admin',\r\n                createdAt: serverTimestamp(), // S·ª≠ d·ª•ng serverTimestamp thay v√¨ Date\r\n                isActive: true,\r\n                emailVerified: true\r\n              });\r\n            } catch (createError) {\r\n              console.error('Error creating admin document:', createError);\r\n            }\r\n          } else {\r\n            // User m·ªõi ch∆∞a c√≥ document trong Firestore - c√≥ th·ªÉ l√† user v·ª´a ƒëƒÉng k√Ω\r\n            console.log('üÜï User document not found for:', user.email);\r\n            \r\n            // Kh√¥ng t·ª± ƒë·ªông t·∫°o document n·ªØa, ƒë·ªÉ LoginPage x·ª≠ l√Ω\r\n            // Ch·ªâ fallback n·∫øu l√† admin email ƒë·∫∑c bi·ªát\r\n            if (user.email === 'admin123@gmail.com') {\r\n              console.log('üëë Creating admin user document');\r\n              try {\r\n                await setDoc(userDocRef, {\r\n                  email: user.email,\r\n                  displayName: user.displayName || 'Admin',\r\n                  role: 'admin',\r\n                  createdAt: serverTimestamp(), // S·ª≠ d·ª•ng serverTimestamp thay v√¨ Date\r\n                  isActive: true\r\n                });\r\n                role = 'admin';\r\n              } catch (createError) {\r\n                console.error('Error creating admin document:', createError);\r\n              }\r\n            } else {\r\n              // User th∆∞·ªùng kh√¥ng c√≥ document - c√≥ th·ªÉ ch∆∞a ho√†n th√†nh ƒëƒÉng k√Ω\r\n              console.log('‚ö†Ô∏è Regular user without document, might need role selection');\r\n              // Kh√¥ng set role, ƒë·ªÉ component x·ª≠ l√Ω\r\n              role = undefined as any;\r\n            }\r\n          }\r\n\r\n          const authUser = {\r\n            uid: user.uid,\r\n            email: user.email,\r\n            displayName: user.displayName,\r\n            photoURL: user.photoURL,\r\n            emailVerified: user.emailVerified,\r\n            role: role,\r\n            needsRoleSelection: userData?.needsRoleSelection || (!role && role !== 'admin'), // Admin kh√¥ng c·∫ßn ch·ªçn role\r\n            createdAt: userData?.createdAt ? \r\n              (userData.createdAt.toDate ? userData.createdAt.toDate().toISOString() : \r\n               userData.createdAt instanceof Date ? userData.createdAt.toISOString() : \r\n               userData.createdAt) : \r\n              new Date().toISOString(), // Convert Date to ISO string\r\n          };\r\n          \r\n          console.log('üìù Dispatching loginSuccess with:', authUser);\r\n          dispatch(loginSuccess(authUser));\r\n          \r\n          // Force re-render ƒë·ªÉ c·∫≠p nh·∫≠t UI ngay l·∫≠p t·ª©c\r\n          setTimeout(() => {\r\n            console.log('üîÑ Force state refresh for UI update');\r\n            dispatch(loginSuccess(authUser));\r\n          }, 100);\r\n        } catch (error) {\r\n          console.error('Error getting user role:', error);\r\n          // Fallback role v·ªõi check admin email ch√≠nh x√°c h∆°n\r\n          const fallbackRole: 'admin' | 'user' = user.email === 'admin123@gmail.com' ? 'admin' : 'user';\r\n          const authUser = {\r\n            uid: user.uid,\r\n            email: user.email,\r\n            displayName: user.displayName,\r\n            photoURL: user.photoURL,\r\n            emailVerified: user.emailVerified,\r\n            role: fallbackRole,\r\n            createdAt: new Date().toISOString(), // Convert Date to ISO string\r\n          };\r\n          \r\n          console.log('üìù Dispatching fallback loginSuccess with:', authUser);\r\n          dispatch(loginSuccess(authUser));\r\n          \r\n          // Force re-render cho fallback c≈©ng c·∫ßn\r\n          setTimeout(() => {\r\n            console.log('üîÑ Force state refresh for fallback user');\r\n            dispatch(loginSuccess(authUser));\r\n          }, 100);\r\n        }\r\n      } else {\r\n        dispatch(logout());\r\n      }\r\n      dispatch(authCheckComplete());\r\n    });\r\n    \r\n    return () => {\r\n      clearTimeout(timeout);\r\n      unsubscribe();\r\n    };\r\n  }, [dispatch]);\r\n\r\n  return <>{children}</>;\r\n};\r\n\r\n// Th√™m LoadingFallback component n·∫øu ch∆∞a c√≥\r\nconst LoadingFallback = () => {\r\n  const { t } = useTranslation();\r\n  return (\r\n    <div className=\"flex items-center justify-center min-h-screen\">\r\n      <div className=\"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin\"></div>\r\n      <span className=\"ml-3 text-lg font-medium text-gray-700\">{t('loading', 'ƒêang t·∫£i...')}</span>\r\n    </div>\r\n  );\r\n};\r\n\r\n// C·∫≠p nh·∫≠t AppContent ƒë·ªÉ ƒë·∫£m b·∫£o m·ªçi lazy component ƒë·ªÅu ƒë∆∞·ª£c b·ªçc trong Suspense\r\nconst AppContent: React.FC = () => {\r\n  const { t } = useTranslation();\r\n  const { user, isLoading, authChecked, isAuthenticated, needsRoleSelection } = useSelector((state: RootState) => state.auth);\r\n\r\n  console.log('üì± AppContent render:', {\r\n    user: user ? { uid: user.uid, email: user.email, role: user.role } : null,\r\n    isLoading,\r\n    authChecked,\r\n    isAuthenticated,\r\n    needsRoleSelection\r\n  });\r\n\r\n  // Show loading while checking authentication\r\n  if (isLoading || !authChecked) {\r\n    console.log('üì± App: Showing loading screen', { isLoading, authChecked });\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600 mb-4\"></div>\r\n          <div className=\"text-xl font-semibold text-gray-700\">{t('loadingData', 'ƒêang t·∫£i d·ªØ li·ªáu...')}</div>\r\n          <div className=\"text-sm text-gray-500 mt-2\">{t('pleaseWait', 'Vui l√≤ng ƒë·ª£i m·ªôt ch√∫t')}</div>\r\n          {isLoading && <div className=\"text-xs text-gray-400 mt-1\">{t('checkingAuth', 'ƒêang ki·ªÉm tra x√°c th·ª±c...')}</div>}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Show role selection if user needs to choose a role\r\n  if (isAuthenticated && user && needsRoleSelection) {\r\n    console.log('üì± App: Showing role selection screen');\r\n    \r\n    const handleRoleSelected = (role: 'user' | 'creator') => {\r\n      console.log('üéØ Role selected:', role);\r\n      \r\n      // Navigate theo role v·ªõi proper redirect\r\n      setTimeout(() => {\r\n        if (role === 'creator') {\r\n          window.location.href = '/creator';\r\n        } else if (role === 'user') {\r\n          window.location.href = '/dashboard';\r\n        }\r\n      }, 1500); // Increase delay ƒë·ªÉ user th·∫•y ƒë∆∞·ª£c toast message\r\n    };\r\n    \r\n    return <RoleSelection user={user} onRoleSelected={handleRoleSelected} />;\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      {/* <OfflineStatusIndicator /> */}\r\n      <Routes>\r\n        {/* Stage 1: Landing Routes */}\r\n        <Route path=\"/landing\" element={<LandingPage />} />\r\n        \r\n        {/* Stage 2: Authentication Routes */}\r\n        <Route path=\"/login\" element={!isAuthenticated ? <AuthPageNew /> : <Navigate to=\"/dashboard\" replace />} />\r\n        \r\n        {/* Stage 2: Basic User Routes - Wrap with Suspense */}\r\n        <Route path=\"/dashboard\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <Dashboard />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/profile\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <Profile />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        {/* <Route path=\"/offline\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <OfflineSettingsPage />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } /> */}\r\n        \r\n        <Route path=\"/quizzes\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <QuizList />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/quiz/:id\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <QuizPage />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/quiz/:id/learn\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <LearningMaterialsPage />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/quiz/:id/preview\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <QuizPreviewPage />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/quiz/:id/reviews\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <QuizReviewsPage />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/real-quizzes\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <RealQuizListPage />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/quiz/:id/edit\" element={\r\n          <ProtectedRoute requiredRole=\"admin\">\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <EditQuizPageAdvanced />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/quiz-result/:resultId\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <QuizResultViewer />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        {/* Stage 3: Creator Routes - NEW NESTED STRUCTURE */}\r\n        \r\n        <Route path=\"/creator\" element={\r\n          <Suspense fallback={<LoadingFallback />}>\r\n            <CreatorLayout />\r\n          </Suspense>\r\n        }>\r\n          {/* Index route redirects to my-quizzes */}\r\n          <Route index element={<Navigate to=\"my\" replace />} />\r\n          \r\n          {/* My Quizzes sub-route */}\r\n          <Route path=\"my\" element={\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <MyQuizzesPage />\r\n            </Suspense>\r\n          } />\r\n          \r\n          {/* Create New Quiz sub-route */}\r\n          <Route path=\"new\" element={\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <CreateQuizPage />\r\n            </Suspense>\r\n          } />\r\n        </Route>\r\n\r\n        {/* Legacy route redirects for backward compatibility */}\r\n        <Route path=\"/create-quiz\" element={<Navigate to=\"/creator/new\" replace />} />\r\n        <Route path=\"/my-quizzes\" element={<Navigate to=\"/creator/my\" replace />} />\r\n\r\n        <Route path=\"/quiz-stats/:id\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <QuizDetailedStats />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        {/* Stage 4: Admin Routes - Wrap with Suspense */}\r\n        <Route path=\"/admin\" element={\r\n          <AdminProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <Admin />\r\n            </Suspense>\r\n          </AdminProtectedRoute>\r\n        } />\r\n        \r\n        {/* Redirect old admin/dashboard to admin/quiz-management */}\r\n        <Route path=\"/admin/dashboard\" element={<Navigate to=\"/admin/quiz-management\" replace />} />\r\n        \r\n        <Route path=\"/admin/quiz-management\" element={\r\n          <AdminProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <AdminQuizManagement />\r\n            </Suspense>\r\n          </AdminProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/admin/users\" element={\r\n          <AdminProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <AdminUserManagement />\r\n            </Suspense>\r\n          </AdminProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/admin/roles\" element={\r\n          <AdminProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <AdminUserManagement />\r\n            </Suspense>\r\n          </AdminProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/admin/quiz-stats\" element={\r\n          <AdminProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <StatsDashboard />\r\n            </Suspense>\r\n          </AdminProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/admin/categories\" element={\r\n          <AdminProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <CategoryManagement />\r\n            </Suspense>\r\n          </AdminProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/admin/stats-test\" element={\r\n          <AdminProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <AdminStats />\r\n            </Suspense>\r\n          </AdminProtectedRoute>\r\n        } />\r\n\r\n        <Route path=\"/admin/utilities\" element={\r\n          <AdminProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <AdminUtilities />\r\n            </Suspense>\r\n          </AdminProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/admin/edit-quiz/:id\" element={\r\n          <AdminProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <EditQuizPageAdvanced />\r\n            </Suspense>\r\n          </AdminProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/admin/build-index\" element={\r\n          <AdminProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <BuildIndexPage />\r\n            </Suspense>\r\n          </AdminProtectedRoute>\r\n        } />\r\n        \r\n        {/* Admin/creators route REMOVED - Creator Management eliminated */}\r\n        \r\n        <Route path=\"/real-quizzes\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <RealQuizListPage />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        {/* Stage 4: New Features - Offline & Multiplayer */}\r\n        <Route path=\"/offline\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              {/* <OfflineQuizManager /> */}\r\n              <div>Offline feature coming soon</div>\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        {/* Multiplayer Routes - Use MultiplayerLobby for quiz selection */}\r\n        <Route path=\"/multiplayer\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <MultiplayerLobby />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/multiplayer/game\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <MultiplayerPage />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        {/* Stage 5: Utility & Error Routes */}\r\n        <Route path=\"/role-selection\" element={\r\n          <ProtectedRoute>\r\n            {user && (\r\n              <RoleSelection \r\n                user={user} \r\n                onRoleSelected={(role) => {\r\n                  if (role === 'creator') {\r\n                    window.location.href = '/creator';\r\n                  } else if (role === 'user') {\r\n                    window.location.href = '/dashboard';\r\n                  }\r\n                }} \r\n              />\r\n            )}\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        <Route path=\"/favorites\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <FavoritesPage />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        <Route path=\"/leaderboard\" element={\r\n          <ProtectedRoute>\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <LeaderboardPage />\r\n            </Suspense>\r\n          </ProtectedRoute>\r\n        } />\r\n        \r\n        {/* Default route - role-based redirect */}\r\n        <Route path=\"/\" element={<RoleBasedRedirect />} />\r\n        <Route path=\"*\" element={<NotFound />} />\r\n      </Routes>\r\n    </div>\r\n  );\r\n};\r\n\r\nfunction App() {\r\n  return (\r\n    <Router>\r\n      <Provider store={store}>\r\n        <I18nProvider>\r\n          <AuthProvider>\r\n            <ErrorBoundary>\r\n              <div className=\"app-container\">\r\n                <NotificationBanner />\r\n                {/* <OfflineStatusIndicator /> */}\r\n                <ScrollToTop />\r\n                <Layout>\r\n                  <AutoLogoutOnBan />\r\n                  <AppContent />\r\n                  <ToastContainer position=\"top-right\" autoClose={3000} hideProgressBar newestOnTop closeOnClick pauseOnFocusLoss draggable pauseOnHover aria-label=\"notification\" />\r\n                </Layout>\r\n                {/* AI Chatbot - Floating button at bottom-right */}\r\n                <ChatbotButton />\r\n              </div>\r\n            </ErrorBoundary>\r\n          </AuthProvider>\r\n        </I18nProvider>\r\n      </Provider>\r\n    </Router>\r\n  );\r\n}\r\n\r\nexport default App;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\components\\ClientSideAIGenerator.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-green-600\">\r\n                      {(uploadedFile.size / 1024 / 1024).toFixed(2)} MB - {t('aiGenerator.processedSuccess')}\r\n                    </p>","line":285,"column":69,"nodeType":"JSXText","endLine":285,"endColumn":75},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12200,12203],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12200,12203],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <>\r\n              <Wand2 className=\"w-5 h-5\" />\r\n              T·∫°o {formData.numQuestions} c√¢u h·ªèi {getDifficultyLabel(formData.difficulty)}\r\n              {formData.useFileContent && ' t·ª´ file'}\r\n            </>","line":359,"column":44,"nodeType":"JSXText","endLine":360,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <>\r\n              <Wand2 className=\"w-5 h-5\" />\r\n              T·∫°o {formData.numQuestions} c√¢u h·ªèi {getDifficultyLabel(formData.difficulty)}\r\n              {formData.useFileContent && ' t·ª´ file'}\r\n            </>","line":360,"column":42,"nodeType":"JSXText","endLine":360,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"text-sm font-medium text-blue-800 mb-2\">üí° Th√¥ng tin:</h4>","line":368,"column":66,"nodeType":"JSXText","endLine":368,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ S·ª≠ d·ª•ng Firebase Cloud Functions + Google Gemini AI</li>","line":370,"column":17,"nodeType":"JSXText","endLine":370,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ Model: gemini-2.0-flash-exp (m·ªõi nh·∫•t)</li>","line":371,"column":17,"nodeType":"JSXText","endLine":371,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ X·ª≠ l√Ω th√¥ng qua server (b·∫£o m·∫≠t API key)</li>","line":372,"column":17,"nodeType":"JSXText","endLine":372,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <strong>M·ªõi:</strong>","line":373,"column":27,"nodeType":"JSXText","endLine":373,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ <strong>M·ªõi:</strong> H·ªó tr·ª£ ƒë·ªçc file ·∫£nh, PDF, Word, Text</li>","line":373,"column":40,"nodeType":"JSXText","endLine":373,"endColumn":77},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ Kh√¥ng gi·ªõi h·∫°n quota client-side</li>","line":374,"column":17,"nodeType":"JSXText","endLine":374,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { toast } from 'react-toastify';\r\nimport { FirebaseAIService } from '../features/quiz/services/firebaseAIService';\r\nimport { FileProcessor } from '../services/fileProcessor';\r\nimport { Sparkles, Wand2, CheckCircle, XCircle, RefreshCw, Upload, File, Image, FileText } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface Question {\r\n  text: string;\r\n  answers: Array<{\r\n    text: string;\r\n    isCorrect: boolean;\r\n  }>;\r\n}\r\n\r\ninterface AIGeneratorProps {\r\n  onQuestionsGenerated: (questions: Question[]) => void;\r\n}\r\n\r\nconst ClientSideAIGenerator: React.FC<AIGeneratorProps> = ({ onQuestionsGenerated }) => {\r\n  const { t } = useTranslation();\r\n  const [isGenerating, setIsGenerating] = useState(false);\r\n  const [isTesting, setIsTesting] = useState(false);\r\n  const [isProcessingFile, setIsProcessingFile] = useState(false);\r\n  const [connectionStatus, setConnectionStatus] = useState<'idle' | 'connected' | 'failed'>('idle');\r\n  const [uploadedFile, setUploadedFile] = useState<File | null>(null);\r\n  const [fileContent, setFileContent] = useState<string>('');\r\n  const [formData, setFormData] = useState({\r\n    topic: '',\r\n    difficulty: 'easy' as 'easy' | 'medium' | 'hard',\r\n    numQuestions: 5,\r\n    useFileContent: false\r\n  });\r\n\r\n  const testConnection = async () => {\r\n    setIsTesting(true);\r\n    try {\r\n      // Test b·∫±ng c√°ch g·ªçi Cloud Function testAI\r\n      const available = await FirebaseAIService.checkAvailability();\r\n      if (available) {\r\n        setConnectionStatus('connected');\r\n        toast.success(t('aiGenerator.cloudConnectionSuccess'));\r\n      } else {\r\n        setConnectionStatus('failed');\r\n        toast.error(t('aiGenerator.cloudConnectionFailed'));\r\n      }\r\n    } catch (error) {\r\n      setConnectionStatus('failed');\r\n      toast.error(t('aiGenerator.cloudConnectionError'));\r\n      console.error('Test connection error:', error);\r\n    } finally {\r\n      setIsTesting(false);\r\n    }\r\n  };\r\n\r\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Validate file extension\r\n    const fileName = file.name.toLowerCase();\r\n    const allowedExtensions = ['.jpg', '.jpeg', '.png', '.pdf', '.doc', '.docx', '.txt'];\r\n    const hasValidExtension = allowedExtensions.some(ext => fileName.endsWith(ext));\r\n    \r\n    if (!hasValidExtension) {\r\n      toast.error(t('aiGenerator.invalidFile', { extensions: allowedExtensions.join(', ') }));\r\n      event.target.value = ''; // Clear input\r\n      return;\r\n    }\r\n\r\n    // Validate file size (max 10MB)\r\n    const maxSize = 10 * 1024 * 1024; // 10MB\r\n    if (file.size > maxSize) {\r\n      toast.error(t('aiGenerator.fileTooLarge'));\r\n      event.target.value = ''; // Clear input\r\n      return;\r\n    }\r\n\r\n    setIsProcessingFile(true);\r\n    try {\r\n      const apiKey = import.meta.env.VITE_GEMINI_API_KEY;\r\n      if (!apiKey) {\r\n        toast.error(t('aiGenerator.apiKeyNotConfigured'));\r\n        return;\r\n      }\r\n\r\n      const fileProcessor = new FileProcessor(apiKey);\r\n      const result = await fileProcessor.processFile(file);\r\n      \r\n      if (result.content && !result.error) {\r\n        setUploadedFile(file);\r\n        setFileContent(result.content);\r\n        setFormData(prev => ({ \r\n          ...prev, \r\n          topic: result.content?.substring(0, 100) + '...' || prev.topic,\r\n          useFileContent: true \r\n        }));\r\n        toast.success(t('aiGenerator.fileProcessedSuccess', { fileName: file.name }));\r\n      } else {\r\n        toast.error(result.error || t('aiGenerator.fileProcessFailed'));\r\n      }\r\n    } catch (error) {\r\n      console.error('File processing error:', error);\r\n      toast.error(t('aiGenerator.fileProcessingError'));\r\n    } finally {\r\n      setIsProcessingFile(false);\r\n    }\r\n  };\r\n\r\n  const removeUploadedFile = () => {\r\n    setUploadedFile(null);\r\n    setFileContent('');\r\n    setFormData(prev => ({ ...prev, useFileContent: false }));\r\n  };\r\n\r\n  const generateQuestions = async () => {\r\n    const topicToUse = formData.useFileContent && fileContent \r\n      ? t('aiGenerator.topicFromFile', { content: fileContent, topic: formData.topic })\r\n      : formData.topic;\r\n\r\n    if (!topicToUse.trim()) {\r\n      toast.error(t('aiGenerator.topicOrFileRequiredShort'));\r\n      return;\r\n    }\r\n\r\n    setIsGenerating(true);\r\n    try {\r\n      // G·ªçi Firebase Cloud Function ƒë·ªÉ generate c√¢u h·ªèi\r\n      const questions = await FirebaseAIService.generateQuestions(\r\n        { \r\n          model: 'gemini-2.0-flash-exp',\r\n          temperature: 0.7 \r\n        },\r\n        {\r\n          content: topicToUse,\r\n          numQuestions: formData.numQuestions,\r\n          difficulty: formData.difficulty,\r\n          language: 'vi'\r\n        }\r\n      );\r\n\r\n      if (questions && questions.length > 0) {\r\n        // Convert to simple format\r\n        const simpleQuestions = questions.map(q => ({\r\n          text: q.text,\r\n          answers: q.answers.map(a => ({\r\n            text: a.text,\r\n            isCorrect: a.isCorrect\r\n          }))\r\n        }));\r\n\r\n        onQuestionsGenerated(simpleQuestions);\r\n        toast.success(t('aiGenerator.generateSuccess', { count: questions.length }));\r\n        \r\n        // Reset form\r\n        setFormData({\r\n          topic: '',\r\n          difficulty: 'easy',\r\n          numQuestions: 5,\r\n          useFileContent: false\r\n        });\r\n        \r\n        // Reset file state\r\n        setUploadedFile(null);\r\n        setFileContent('');\r\n      } else {\r\n        toast.error(t('aiGenerator.generateEmpty'));\r\n      }\r\n    } catch (error) {\r\n      console.error('Generation error:', error);\r\n      const errorMsg = error instanceof Error ? error.message : t('aiGenerator.unknownError');\r\n      toast.error(t('aiGenerator.generateErrorDetailed', { message: errorMsg }));\r\n    } finally {\r\n      setIsGenerating(false);\r\n    }\r\n  };\r\n\r\n  const getDifficultyLabel = (difficulty: string) => {\r\n    switch (difficulty) {\r\n      case 'easy': return t('aiGenerator.difficulty.easy');\r\n      case 'medium': return t('aiGenerator.difficulty.medium');\r\n      case 'hard': return t('aiGenerator.difficulty.hard');\r\n      default: return difficulty;\r\n    }\r\n  };\r\n\r\n  const getConnectionIcon = () => {\r\n    switch (connectionStatus) {\r\n      case 'connected': return <CheckCircle className=\"w-4 h-4 text-green-500\" />;\r\n      case 'failed': return <XCircle className=\"w-4 h-4 text-red-500\" />;\r\n      default: return <Sparkles className=\"w-4 h-4 text-gray-400\" />;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-6\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <div className=\"w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center\">\r\n            <Wand2 className=\"w-5 h-5 text-white\" />\r\n          </div>\r\n          <div>\r\n            <h3 className=\"text-lg font-bold text-gray-900\">ü§ñ {t('aiGenerator.title')}</h3>\r\n            <p className=\"text-sm text-gray-600\">{t('aiGenerator.subtitle')}</p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center gap-2\">\r\n          {getConnectionIcon()}\r\n          <button\r\n            onClick={testConnection}\r\n            disabled={isTesting}\r\n            className=\"px-3 py-1.5 text-xs bg-white border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 flex items-center gap-2\"\r\n          >\r\n            {isTesting ? (\r\n              <RefreshCw className=\"w-3 h-3 animate-spin\" />\r\n            ) : (\r\n              <Sparkles className=\"w-3 h-3\" />\r\n            )}\r\n            {t('aiGenerator.testConnection')}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-4\">\r\n        {/* Topic Input */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n            üìö {t('aiGenerator.topic')}\r\n          </label>\r\n          <input\r\n            type=\"text\"\r\n            value={formData.topic}\r\n            onChange={(e) => setFormData({ ...formData, topic: e.target.value })}\r\n            placeholder={t('aiGenerator.topicPlaceholder')}\r\n            className=\"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500\"\r\n          />\r\n        </div>\r\n\r\n        {/* File Upload Section */}\r\n        <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-purple-400 transition-colors\">\r\n          <div className=\"text-center\">\r\n            <Upload className=\"mx-auto h-12 w-12 text-gray-400\" />\r\n            <div className=\"mt-4\">\r\n              <label htmlFor=\"file-upload\" className=\"cursor-pointer\">\r\n                <span className=\"mt-2 block text-sm font-medium text-gray-900\">\r\n                  üìé {t('aiGenerator.uploadFile')}\r\n                </span>\r\n                <span className=\"mt-1 block text-xs text-gray-500\">\r\n                  {t('aiGenerator.supportedFormats')}\r\n                </span>\r\n                <span className=\"mt-2 inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\">\r\n                  <Upload className=\"w-4 h-4 mr-2\" />\r\n                  {t('aiGenerator.chooseFile')}\r\n                </span>\r\n              </label>\r\n              <input\r\n                id=\"file-upload\"\r\n                type=\"file\"\r\n                className=\"sr-only\"\r\n                accept=\".jpg,.jpeg,.png,.pdf,.doc,.docx,.txt\"\r\n                onChange={handleFileUpload}\r\n                disabled={isProcessingFile}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Display uploaded file */}\r\n          {uploadedFile && (\r\n            <div className=\"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center space-x-2\">\r\n                  {uploadedFile.type.startsWith('image/') ? (\r\n                    <Image className=\"w-5 h-5 text-green-600\" />\r\n                  ) : uploadedFile.type === 'application/pdf' ? (\r\n                    <FileText className=\"w-5 h-5 text-red-600\" />\r\n                  ) : uploadedFile.type.includes('document') || uploadedFile.type.includes('word') ? (\r\n                    <File className=\"w-5 h-5 text-blue-600\" />\r\n                  ) : (\r\n                    <FileText className=\"w-5 h-5 text-gray-600\" />\r\n                  )}\r\n                  <div>\r\n                    <p className=\"text-sm font-medium text-green-800\">{uploadedFile.name}</p>\r\n                    <p className=\"text-xs text-green-600\">\r\n                      {(uploadedFile.size / 1024 / 1024).toFixed(2)} MB - {t('aiGenerator.processedSuccess')}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  onClick={removeUploadedFile}\r\n                  className=\"text-green-600 hover:text-green-800\"\r\n                >\r\n                  <XCircle className=\"w-5 h-5\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Processing indicator */}\r\n          {isProcessingFile && (\r\n            <div className=\"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <RefreshCw className=\"w-5 h-5 text-blue-600 animate-spin\" />\r\n                <span className=\"text-sm text-blue-700\">{t('aiGenerator.processingFile')}</span>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          {/* Difficulty Select */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              üéØ {t('aiGenerator.difficulty')}\r\n            </label>\r\n            <select\r\n              value={formData.difficulty}\r\n              onChange={(e) => setFormData({ ...formData, difficulty: e.target.value as any })}\r\n              className=\"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500\"\r\n            >\r\n              <option value=\"easy\">üü¢ {t('aiGenerator.difficultyEasy')}</option>\r\n              <option value=\"medium\">üü° {t('aiGenerator.difficultyMedium')}</option>\r\n              <option value=\"hard\">üî¥ {t('aiGenerator.difficultyHard')}</option>\r\n            </select>\r\n          </div>\r\n\r\n          {/* Number of Questions */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              üî¢ {t('aiGenerator.numQuestions')}\r\n            </label>\r\n            <select\r\n              value={formData.numQuestions}\r\n              onChange={(e) => setFormData({ ...formData, numQuestions: parseInt(e.target.value) })}\r\n              className=\"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500\"\r\n            >\r\n              <option value={3}>3 {t('aiGenerator.questions')}</option>\r\n              <option value={5}>5 {t('aiGenerator.questions')}</option>\r\n              <option value={10}>10 {t('aiGenerator.questions')}</option>\r\n              <option value={15}>15 {t('aiGenerator.questions')}</option>\r\n              <option value={20}>20 {t('aiGenerator.questions')}</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Generate Button */}\r\n        <button\r\n          onClick={generateQuestions}\r\n          disabled={isGenerating || (!formData.topic.trim() && !fileContent)}\r\n          className=\"w-full px-6 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-semibold rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center gap-3\"\r\n        >\r\n          {isGenerating ? (\r\n            <>\r\n              <RefreshCw className=\"w-5 h-5 animate-spin\" />\r\n              ƒêang t·∫°o c√¢u h·ªèi...\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Wand2 className=\"w-5 h-5\" />\r\n              T·∫°o {formData.numQuestions} c√¢u h·ªèi {getDifficultyLabel(formData.difficulty)}\r\n              {formData.useFileContent && ' t·ª´ file'}\r\n            </>\r\n          )}\r\n        </button>\r\n\r\n        {/* Info */}\r\n        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n          <h4 className=\"text-sm font-medium text-blue-800 mb-2\">üí° Th√¥ng tin:</h4>\r\n          <ul className=\"text-sm text-blue-700 space-y-1\">\r\n            <li>‚Ä¢ S·ª≠ d·ª•ng Firebase Cloud Functions + Google Gemini AI</li>\r\n            <li>‚Ä¢ Model: gemini-2.0-flash-exp (m·ªõi nh·∫•t)</li>\r\n            <li>‚Ä¢ X·ª≠ l√Ω th√¥ng qua server (b·∫£o m·∫≠t API key)</li>\r\n            <li>‚Ä¢ <strong>M·ªõi:</strong> H·ªó tr·ª£ ƒë·ªçc file ·∫£nh, PDF, Word, Text</li>\r\n            <li>‚Ä¢ Kh√¥ng gi·ªõi h·∫°n quota client-side</li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ClientSideAIGenerator;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\components\\ImageUploader.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3789,3792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3789,3792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5551,5554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5551,5554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6650,6653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6650,6653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm\">\r\n                    {Math.round(progress.bytesTransferred / 1024)}KB / {Math.round(progress.totalBytes / 1024)}KB\r\n                  </p>","line":253,"column":67,"nodeType":"JSXText","endLine":253,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600 mb-2\">K√©o th·∫£ ·∫£nh v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn</p>","line":263,"column":47,"nodeType":"JSXText","endLine":263,"endColumn":85},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-500\">\r\n              K√≠ch th∆∞·ªõc t·ªëi ƒëa: {options.maxSizeKB || 5120}KB\r\n            </p>","line":264,"column":50,"nodeType":"JSXText","endLine":265,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n              onClick={() => fileInputRef.current?.click()}\r\n              className=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n            >\r\n              Ch·ªçn ·∫£nh\r\n            </button>","line":277,"column":14,"nodeType":"JSXText","endLine":279,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <>\r\n              <Upload className=\"w-5 h-5 mr-2\" />\r\n              Upload ·∫£nh\r\n            </>","line":298,"column":50,"nodeType":"JSXText","endLine":300,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-semibold text-green-800\">Thumbnails ƒë√£ t·∫°o</h4>","line":310,"column":58,"nodeType":"JSXText","endLine":310,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-gray-600 mt-1\">200x200</p>","line":316,"column":59,"nodeType":"JSXText","endLine":316,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-gray-600 mt-1\">400x400</p>","line":322,"column":59,"nodeType":"JSXText","endLine":322,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-gray-600 mt-1\">800x800</p>","line":328,"column":59,"nodeType":"JSXText","endLine":328,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>File: {selectedFile.name}</p>","line":338,"column":14,"nodeType":"JSXText","endLine":338,"endColumn":20},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>K√≠ch th∆∞·ªõc: {Math.round(selectedFile.size / 1024)}KB</p>","line":339,"column":14,"nodeType":"JSXText","endLine":339,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Lo·∫°i: {selectedFile.type}</p>","line":340,"column":14,"nodeType":"JSXText","endLine":340,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Image Uploader Component v·ªõi Preview v√† Progress Bar\r\n * T√≠ch h·ª£p v·ªõi Resize Images Extension\r\n */\r\n\r\nimport React, { useState, useRef } from 'react';\r\nimport { Upload, X, CheckCircle, Loader } from 'lucide-react';\r\nimport { uploadImage, compressImage, instantUploadImage, UploadProgress, ImageUploadOptions, ImageUploadResult } from '../services/imageUploadService';\r\nimport { toast } from 'react-toastify';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface ImageUploaderProps {\r\n  onUploadSuccess: (result: ImageUploadResult) => void;\r\n  onUploadError?: (error: string) => void;\r\n  options?: ImageUploadOptions;\r\n  previewUrl?: string;\r\n  className?: string;\r\n  label?: string;\r\n  showThumbnails?: boolean;\r\n  compressBeforeUpload?: boolean;\r\n  instantUpload?: boolean; // üöÄ Upload ngay 1-3s (kh√¥ng compress, kh√¥ng ƒë·ª£i)\r\n  ultraFast?: boolean; // ‚ö° Upload nhanh nh·∫•t c√≥ th·ªÉ\r\n}\r\n\r\nexport const ImageUploader: React.FC<ImageUploaderProps> = ({\r\n  onUploadSuccess,\r\n  onUploadError,\r\n  options = {},\r\n  previewUrl,\r\n  className = '',\r\n  label = 'T·∫£i ·∫£nh l√™n',\r\n  showThumbnails = false,\r\n  compressBeforeUpload = true,\r\n  instantUpload = false, // M·∫∑c ƒë·ªãnh false\r\n  ultraFast = false // ‚ö° Mode c·ª±c nhanh\r\n}) => {\r\n  const { t } = useTranslation();\r\n  const [preview, setPreview] = useState<string | undefined>(previewUrl);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [progress, setProgress] = useState<UploadProgress | null>(null);\r\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\r\n  const [thumbnails, setThumbnails] = useState<{ small?: string; medium?: string; large?: string }>({});\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Validate file type\r\n    const allowedTypes = options.allowedTypes || ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      toast.error(`Ch·ªâ ch·∫•p nh·∫≠n: ${allowedTypes.map(t => t.split('/')[1]).join(', ')}`);\r\n      return;\r\n    }\r\n\r\n    // Validate file size\r\n    const maxSizeKB = options.maxSizeKB || 5120;\r\n    const fileSizeKB = file.size / 1024;\r\n    if (fileSizeKB > maxSizeKB) {\r\n      toast.error(`K√≠ch th∆∞·ªõc file v∆∞·ª£t qu√° ${maxSizeKB}KB`);\r\n      return;\r\n    }\r\n\r\n    setSelectedFile(file);\r\n\r\n    // Show preview\r\n    const reader = new FileReader();\r\n    reader.onload = (event) => {\r\n      setPreview(event.target?.result as string);\r\n    };\r\n    reader.readAsDataURL(file);\r\n\r\n    // ‚ö° ULTRA FAST MODE: Upload ngay l·∫≠p t·ª©c (1-3s)\r\n    if (ultraFast || instantUpload) {\r\n      handleInstantUpload(file);\r\n    }\r\n  };\r\n\r\n  const handleInstantUpload = async (file: File) => {\r\n    setUploading(true);\r\n    setProgress(null);\r\n    setThumbnails({});\r\n\r\n    try {\r\n      toast.info(t('imageUploader.uploading'), { autoClose: 1000 });\r\n\r\n      // üöÄ Upload ngay - KH√îNG compress, KH√îNG ƒë·ª£i\r\n      const result = await instantUploadImage(\r\n        file,\r\n        options,\r\n        (uploadProgress: UploadProgress) => {\r\n          setProgress(uploadProgress);\r\n        }\r\n      );\r\n\r\n      if (result.success) {\r\n        toast.success(t('imageUploader.uploadFast'), { autoClose: 2000 });\r\n        \r\n        if (result.thumbnailUrls && Object.keys(result.thumbnailUrls).length > 0) {\r\n          setThumbnails(result.thumbnailUrls);\r\n          toast.info(t('imageUploader.thumbnailsReady'), { autoClose: 1500 });\r\n        }\r\n        \r\n        onUploadSuccess(result);\r\n      } else {\r\n        toast.error(result.error || 'Upload th·∫•t b·∫°i');\r\n        if (onUploadError) {\r\n          onUploadError(result.error || 'Upload failed');\r\n        }\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Instant upload error:', error);\r\n      toast.error(t('imageUploader.uploadError'));\r\n      if (onUploadError) {\r\n        onUploadError(error.message);\r\n      }\r\n    } finally {\r\n      setUploading(false);\r\n      setProgress(null);\r\n    }\r\n  };\r\n\r\n  const handleUpload = async () => {\r\n    if (!selectedFile) {\r\n      toast.error(t('imageUploader.selectImageFirst'));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    setProgress(null);\r\n    setThumbnails({});\r\n\r\n    try {\r\n      let fileToUpload = selectedFile;\r\n\r\n      // Compress image if enabled\r\n      if (compressBeforeUpload && selectedFile.type !== 'image/gif') {\r\n        toast.info(t('imageUploader.compressing'), { autoClose: 1000 });\r\n        fileToUpload = await compressImage(selectedFile, 1920, 1080, 0.85, true); // WebP\r\n        toast.success(`ƒê√£ n√©n: ${Math.round(selectedFile.size / 1024)}KB ‚Üí ${Math.round(fileToUpload.size / 1024)}KB`, { autoClose: 1500 });\r\n      }\r\n\r\n      // Upload with progress callback\r\n      const result = await uploadImage(\r\n        fileToUpload,\r\n        options,\r\n        (uploadProgress) => {\r\n          setProgress(uploadProgress);\r\n        }\r\n      );\r\n\r\n      if (result.success) {\r\n        toast.success(t('imageUploader.uploadSuccess'));\r\n        \r\n        if (result.thumbnailUrls && Object.keys(result.thumbnailUrls).length > 0) {\r\n          setThumbnails(result.thumbnailUrls);\r\n          toast.info(t('imageUploader.thumbnailsGenerated'), { autoClose: 2000 });\r\n        }\r\n        \r\n        onUploadSuccess(result);\r\n      } else {\r\n        toast.error(result.error || 'Upload th·∫•t b·∫°i');\r\n        if (onUploadError) {\r\n          onUploadError(result.error || 'Upload failed');\r\n        }\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Upload error:', error);\r\n      toast.error(t('imageUploader.uploadErrorDetailed'));\r\n      if (onUploadError) {\r\n        onUploadError(error.message);\r\n      }\r\n    } finally {\r\n      setUploading(false);\r\n      setProgress(null);\r\n    }\r\n  };\r\n\r\n  const handleRemove = () => {\r\n    setPreview(undefined);\r\n    setSelectedFile(null);\r\n    setProgress(null);\r\n    setThumbnails({});\r\n    if (fileInputRef.current) {\r\n      fileInputRef.current.value = '';\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  };\r\n\r\n  const handleDrop = async (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    const file = e.dataTransfer.files?.[0];\r\n    if (file && file.type.startsWith('image/')) {\r\n      // Simulate file input change\r\n      const dataTransfer = new DataTransfer();\r\n      dataTransfer.items.add(file);\r\n      if (fileInputRef.current) {\r\n        fileInputRef.current.files = dataTransfer.files;\r\n        handleFileSelect({ target: { files: dataTransfer.files } } as any);\r\n      }\r\n    } else {\r\n      toast.error('Vui l√≤ng ch·ªçn file ·∫£nh');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`image-uploader ${className}`}>\r\n      {/* Label */}\r\n      {label && (\r\n        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n          {label}\r\n        </label>\r\n      )}\r\n\r\n      {/* Upload Area */}\r\n      <div\r\n        className={`relative border-2 border-dashed rounded-lg transition-colors ${\r\n          preview ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-blue-400'\r\n        }`}\r\n        onDragOver={handleDragOver}\r\n        onDrop={handleDrop}\r\n      >\r\n        {/* Preview */}\r\n        {preview ? (\r\n          <div className=\"relative\">\r\n            <img\r\n              src={preview}\r\n              alt=\"Preview\"\r\n              className=\"w-full h-64 object-cover rounded-lg\"\r\n            />\r\n            {!uploading && (\r\n              <button\r\n                onClick={handleRemove}\r\n                className=\"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors\"\r\n              >\r\n                <X className=\"w-4 h-4\" />\r\n              </button>\r\n            )}\r\n            \r\n            {/* Progress Overlay */}\r\n            {uploading && progress && (\r\n              <div className=\"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg\">\r\n                <div className=\"text-white text-center\">\r\n                  <Loader className=\"w-8 h-8 animate-spin mx-auto mb-2\" />\r\n                  <p className=\"text-lg font-semibold\">{progress.progress}%</p>\r\n                  <p className=\"text-sm\">\r\n                    {Math.round(progress.bytesTransferred / 1024)}KB / {Math.round(progress.totalBytes / 1024)}KB\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          // Upload Prompt\r\n          <div className=\"p-8 text-center\">\r\n            <Upload className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\r\n            <p className=\"text-gray-600 mb-2\">K√©o th·∫£ ·∫£nh v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn</p>\r\n            <p className=\"text-sm text-gray-500\">\r\n              K√≠ch th∆∞·ªõc t·ªëi ƒëa: {options.maxSizeKB || 5120}KB\r\n            </p>\r\n            <input\r\n              ref={fileInputRef}\r\n              type=\"file\"\r\n              accept={options.allowedTypes?.join(',') || 'image/*'}\r\n              onChange={handleFileSelect}\r\n              className=\"hidden\"\r\n            />\r\n            <button\r\n              onClick={() => fileInputRef.current?.click()}\r\n              className=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n            >\r\n              Ch·ªçn ·∫£nh\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Upload Button */}\r\n      {selectedFile && !uploading && (\r\n        <button\r\n          onClick={handleUpload}\r\n          disabled={uploading}\r\n          className=\"mt-4 w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\r\n        >\r\n          {uploading ? (\r\n            <>\r\n              <Loader className=\"w-5 h-5 animate-spin mr-2\" />\r\n              ƒêang upload...\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Upload className=\"w-5 h-5 mr-2\" />\r\n              Upload ·∫£nh\r\n            </>\r\n          )}\r\n        </button>\r\n      )}\r\n\r\n      {/* Thumbnails Preview */}\r\n      {showThumbnails && Object.keys(thumbnails).length > 0 && (\r\n        <div className=\"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg\">\r\n          <div className=\"flex items-center mb-2\">\r\n            <CheckCircle className=\"w-5 h-5 text-green-600 mr-2\" />\r\n            <h4 className=\"font-semibold text-green-800\">Thumbnails ƒë√£ t·∫°o</h4>\r\n          </div>\r\n          <div className=\"grid grid-cols-3 gap-2\">\r\n            {thumbnails.small && (\r\n              <div className=\"text-center\">\r\n                <img src={thumbnails.small} alt=\"Small\" className=\"w-full h-20 object-cover rounded border\" />\r\n                <p className=\"text-xs text-gray-600 mt-1\">200x200</p>\r\n              </div>\r\n            )}\r\n            {thumbnails.medium && (\r\n              <div className=\"text-center\">\r\n                <img src={thumbnails.medium} alt=\"Medium\" className=\"w-full h-20 object-cover rounded border\" />\r\n                <p className=\"text-xs text-gray-600 mt-1\">400x400</p>\r\n              </div>\r\n            )}\r\n            {thumbnails.large && (\r\n              <div className=\"text-center\">\r\n                <img src={thumbnails.large} alt=\"Large\" className=\"w-full h-20 object-cover rounded border\" />\r\n                <p className=\"text-xs text-gray-600 mt-1\">800x800</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* File Info */}\r\n      {selectedFile && (\r\n        <div className=\"mt-2 text-sm text-gray-600\">\r\n          <p>File: {selectedFile.name}</p>\r\n          <p>K√≠ch th∆∞·ªõc: {Math.round(selectedFile.size / 1024)}KB</p>\r\n          <p>Lo·∫°i: {selectedFile.type}</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImageUploader;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\components\\rag\\ChatbotButton.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <motion.div\r\n          initial={{ opacity: 0, x: 10 }}\r\n          animate={{ opacity: 1, x: 0 }}\r\n          className=\"fixed bottom-6 z-40 px-4 py-2 bg-gray-900 text-white text-sm rounded-lg shadow-lg whitespace-nowrap\"\r\n          style={{\r\n            position: 'fixed',\r\n            bottom: '24px',\r\n            right: '168px', // 96px (button right) + 56px (button width) + 16px (gap)\r\n          }}\r\n        >\r\n          H·ªèi AI Learning Assistant\r\n          <div className=\"absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 rotate-45 w-2 h-2 bg-gray-900\" />\r\n        </motion.div>","line":84,"column":10,"nodeType":"JSXText","endLine":86,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * üéØ Floating Chatbot Button\r\n * \r\n * Floating action button to open the AI chatbot\r\n * Positioned in bottom-right corner\r\n * Only visible for authenticated users\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { MessageCircle, X, Sparkles } from 'lucide-react';\r\nimport { ChatbotModal } from './ChatbotModal';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../lib/store';\r\n\r\nexport function ChatbotButton() {\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isHovered, setIsHovered] = useState(false);\r\n\r\n  // Don't render if user is not authenticated\r\n  if (!user) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {/* Floating Button - Positioned at bottom-left of scroll button */}\r\n      <motion.button\r\n        initial={{ scale: 0 }}\r\n        animate={{ scale: 1 }}\r\n        transition={{ type: 'spring', stiffness: 260, damping: 20 }}\r\n        onClick={() => setIsOpen(!isOpen)}\r\n        onMouseEnter={() => setIsHovered(true)}\r\n        onMouseLeave={() => setIsHovered(false)}\r\n        className=\"fixed bottom-6 right-24 z-40 w-14 h-14 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full shadow-2xl hover:shadow-purple-500/50 transition-all flex items-center justify-center group\"\r\n        aria-label=\"Open AI Chatbot\"\r\n        style={{ \r\n          position: 'fixed',\r\n          bottom: '24px',\r\n          right: '96px', // 24px (right) + 56px (scroll button width) + 16px (gap) = 96px\r\n        }}\r\n      >\r\n        <motion.div\r\n          animate={{ rotate: isOpen ? 90 : 0 }}\r\n          transition={{ duration: 0.3 }}\r\n        >\r\n          {isOpen ? (\r\n            <X className=\"w-6 h-6 text-white\" />\r\n          ) : (\r\n            <MessageCircle className=\"w-6 h-6 text-white\" />\r\n          )}\r\n        </motion.div>\r\n\r\n        {/* Sparkle effect on hover */}\r\n        {isHovered && !isOpen && (\r\n          <motion.div\r\n            initial={{ opacity: 0, scale: 0.5 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            exit={{ opacity: 0, scale: 0.5 }}\r\n            className=\"absolute -top-1 -right-1\"\r\n          >\r\n            <Sparkles className=\"w-4 h-4 text-yellow-400\" />\r\n          </motion.div>\r\n        )}\r\n\r\n        {/* Pulse animation */}\r\n        {!isOpen && (\r\n          <span className=\"absolute inset-0 rounded-full bg-purple-600 animate-ping opacity-20\" />\r\n        )}\r\n      </motion.button>\r\n\r\n      {/* Tooltip */}\r\n      {isHovered && !isOpen && (\r\n        <motion.div\r\n          initial={{ opacity: 0, x: 10 }}\r\n          animate={{ opacity: 1, x: 0 }}\r\n          className=\"fixed bottom-6 z-40 px-4 py-2 bg-gray-900 text-white text-sm rounded-lg shadow-lg whitespace-nowrap\"\r\n          style={{\r\n            position: 'fixed',\r\n            bottom: '24px',\r\n            right: '168px', // 96px (button right) + 56px (button width) + 16px (gap)\r\n          }}\r\n        >\r\n          H·ªèi AI Learning Assistant\r\n          <div className=\"absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 rotate-45 w-2 h-2 bg-gray-900\" />\r\n        </motion.div>\r\n      )}\r\n\r\n      {/* Chatbot Modal */}\r\n      <ChatbotModal isOpen={isOpen} onClose={() => setIsOpen(false)} />\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\components\\rag\\ChatbotModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2736,2739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2736,2739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-lg font-bold text-white flex items-center gap-2\">\r\n                  AI Learning Assistant\r\n                  <span className=\"px-2 py-0.5 bg-white/20 backdrop-blur-sm rounded-full text-xs font-normal border border-white/30\">\r\n                    Beta\r\n                  </span>\r\n                </h2>","line":167,"column":86,"nodeType":"JSXText","endLine":169,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"px-2 py-0.5 bg-white/20 backdrop-blur-sm rounded-full text-xs font-normal border border-white/30\">\r\n                    Beta\r\n                  </span>","line":169,"column":134,"nodeType":"JSXText","endLine":171,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-white/90\">Tr·ª£ l√Ω h·ªçc t·∫≠p th√¥ng minh ƒë∆∞·ª£c h·ªó tr·ª£ b·ªüi Google AI</p>","line":173,"column":54,"nodeType":"JSXText","endLine":173,"endColumn":105},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\r\n                    Ch√†o m·ª´ng ƒë·∫øn v·ªõi AI Learning Assistant! üëã\r\n                  </h3>","line":201,"column":89,"nodeType":"JSXText","endLine":203,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600 dark:text-gray-400 max-w-md mb-6\">\r\n                    H·ªèi t√¥i b·∫•t c·ª© ƒëi·ªÅu g√¨ v·ªÅ c√°c quiz b·∫°n ƒë√£ h·ªçc.\r\n                    T√¥i s·∫Ω tr·∫£ l·ªùi chi ti·∫øt v√† g·ª£i √Ω quiz ph√π h·ª£p cho b·∫°n.\r\n                  </p>","line":204,"column":81,"nodeType":"JSXText","endLine":207,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"font-medium text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400\">\r\n                          Gi·∫£i th√≠ch kh√°i ni·ªám\r\n                        </div>","line":222,"column":145,"nodeType":"JSXText","endLine":224,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                          T√¨m hi·ªÉu chi ti·∫øt v·ªÅ ch·ªß ƒë·ªÅ b·∫°n quan t√¢m\r\n                        </div>","line":225,"column":88,"nodeType":"JSXText","endLine":227,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"font-medium text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400\">\r\n                          T√≥m t·∫Øt n·ªôi dung\r\n                        </div>","line":239,"column":141,"nodeType":"JSXText","endLine":241,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                          Xem t·ªïng quan ki·∫øn th·ª©c quan tr·ªçng\r\n                        </div>","line":242,"column":88,"nodeType":"JSXText","endLine":244,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"font-medium text-gray-900 dark:text-white group-hover:text-green-600 dark:group-hover:text-green-400\">\r\n                          V√≠ d·ª• th·ª±c t·∫ø\r\n                        </div>","line":256,"column":143,"nodeType":"JSXText","endLine":258,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                          H·ªçc qua c√°c tr∆∞·ªùng h·ª£p c·ª• th·ªÉ\r\n                        </div>","line":259,"column":88,"nodeType":"JSXText","endLine":261,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"font-medium text-gray-900 dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400\">\r\n                          G·ª£i √Ω quiz\r\n                        </div>","line":273,"column":145,"nodeType":"JSXText","endLine":275,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                          T√¨m quiz ph√π h·ª£p ƒë·ªÉ th·ª±c h√†nh\r\n                        </div>","line":276,"column":88,"nodeType":"JSXText","endLine":278,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium text-red-900 dark:text-red-200\">\r\n                    ƒê√£ x·∫£y ra l·ªói\r\n                  </p>","line":294,"column":85,"nodeType":"JSXText","endLine":296,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                onClick={handleSendMessage}\r\n                disabled={!input.trim() || isLoading}\r\n                className=\"px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 font-medium\"\r\n              >\r\n                <Send className=\"w-5 h-5\" />\r\n                G·ª≠i\r\n              </button>","line":325,"column":45,"nodeType":"JSXText","endLine":327,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              üí° Tip: H·ªèi v·ªÅ n·ªôi dung b·∫°n ƒë√£ h·ªçc trong c√°c quiz ƒë√£ m·ªü kh√≥a\r\n            </p>","line":329,"column":74,"nodeType":"JSXText","endLine":331,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * ü§ñ AI Chatbot Modal Component\r\n * \r\n * Modern full-screen chatbot interface similar to ChatGPT\r\n * Features:\r\n * - Full-screen overlay\r\n * - Message history\r\n * - Streaming-style typing animation\r\n * - Citation badges\r\n * - Mobile responsive\r\n * - Dark mode support\r\n */\r\n\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, Send, Sparkles, Book, AlertCircle } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { auth } from '../../lib/firebase/config';\r\nimport { MessageList } from './MessageList';\r\nimport { TypingIndicator } from './TypingIndicator';\r\nimport type { RAGResponse, QuizRecommendation } from '../../lib/genkit/types';\r\n\r\ninterface Message {\r\n  id: string;\r\n  role: 'user' | 'assistant';\r\n  content: string;\r\n  citations?: RAGResponse['citations'];\r\n  quizRecommendations?: QuizRecommendation[];\r\n  timestamp: number;\r\n  usedChunks?: number;\r\n  processingTime?: number;\r\n}\r\n\r\ninterface ChatbotModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport function ChatbotModal({ isOpen, onClose }: ChatbotModalProps) {\r\n  const { t } = useTranslation();\r\n  const currentUser = auth.currentUser;\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [input, setInput] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const inputRef = useRef<HTMLTextAreaElement>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Auto-scroll to bottom when new messages arrive\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  // Focus input when modal opens\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setTimeout(() => inputRef.current?.focus(), 100);\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Handle send message\r\n  const handleSendMessage = async () => {\r\n    if (!input.trim() || isLoading || !currentUser) return;\r\n\r\n    const userMessage: Message = {\r\n      id: Date.now().toString(),\r\n      role: 'user',\r\n      content: input.trim(),\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    setMessages(prev => [...prev, userMessage]);\r\n    setInput('');\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // Call Cloud Function\r\n      const { getFunctions, httpsCallable } = await import('firebase/functions');\r\n      const functions = getFunctions();\r\n      const askRAG = httpsCallable(functions, 'askRAG');\r\n      \r\n      const result = await askRAG({\r\n        question: userMessage.content,\r\n        topK: 4,\r\n        targetLang: 'vi'\r\n      });\r\n      \r\n      const responseData = result.data as { success: boolean; data: any };\r\n      \r\n      if (!responseData.success) {\r\n        throw new Error('Failed to get response from AI');\r\n      }\r\n      \r\n      const aiResponse = responseData.data;\r\n      \r\n      // Debug logging\r\n      console.log('ü§ñ AI Response:', aiResponse);\r\n      console.log('üìä Quiz Recommendations:', aiResponse.quizRecommendations);\r\n      \r\n      const assistantMessage: Message = {\r\n        id: (Date.now() + 1).toString(),\r\n        role: 'assistant',\r\n        content: aiResponse.answer,\r\n        citations: aiResponse.citations || [],\r\n        quizRecommendations: aiResponse.quizRecommendations || [],\r\n        timestamp: Date.now(),\r\n        usedChunks: aiResponse.usedChunks || 0,\r\n        processingTime: aiResponse.processingTime || 0,\r\n      };\r\n\r\n      setMessages(prev => [...prev, assistantMessage]);\r\n\r\n    } catch (err) {\r\n      console.error('Error sending message:', err);\r\n      setError('ƒê√£ x·∫£y ra l·ªói. Vui l√≤ng th·ª≠ l·∫°i sau.');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle Enter key\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSendMessage();\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        exit={{ opacity: 0 }}\r\n        className=\"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm\"\r\n        onClick={onClose}\r\n      >\r\n        <motion.div\r\n          initial={{ scale: 0.95, opacity: 0 }}\r\n          animate={{ scale: 1, opacity: 1 }}\r\n          exit={{ scale: 0.95, opacity: 0 }}\r\n          transition={{ type: 'spring', duration: 0.3 }}\r\n          className=\"fixed inset-4 md:inset-8 lg:inset-16 bg-white dark:bg-gray-900 rounded-2xl shadow-2xl flex flex-col overflow-hidden\"\r\n          onClick={(e) => e.stopPropagation()}\r\n        >\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 relative overflow-hidden\">\r\n            {/* Animated background pattern */}\r\n            <div className=\"absolute inset-0 opacity-10\">\r\n              <div className=\"absolute inset-0\" style={{\r\n                backgroundImage: `url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")`,\r\n              }} />\r\n            </div>\r\n            \r\n            <div className=\"flex items-center gap-3 relative z-10\">\r\n              <motion.div\r\n                animate={{ rotate: 360 }}\r\n                transition={{ duration: 20, repeat: Infinity, ease: \"linear\" }}\r\n                className=\"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center border border-white/30\"\r\n              >\r\n                <Sparkles className=\"w-6 h-6 text-white\" />\r\n              </motion.div>\r\n              <div>\r\n                <h2 className=\"text-lg font-bold text-white flex items-center gap-2\">\r\n                  AI Learning Assistant\r\n                  <span className=\"px-2 py-0.5 bg-white/20 backdrop-blur-sm rounded-full text-xs font-normal border border-white/30\">\r\n                    Beta\r\n                  </span>\r\n                </h2>\r\n                <p className=\"text-xs text-white/90\">Tr·ª£ l√Ω h·ªçc t·∫≠p th√¥ng minh ƒë∆∞·ª£c h·ªó tr·ª£ b·ªüi Google AI</p>\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"p-2 hover:bg-white/20 rounded-lg transition-colors backdrop-blur-sm relative z-10\"\r\n            >\r\n              <X className=\"w-6 h-6 text-white\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Messages Area */}\r\n          <div className=\"flex-1 overflow-y-auto p-6 space-y-4 bg-gradient-to-br from-gray-50 to-white dark:from-gray-900 dark:to-gray-800\">\r\n            {messages.length === 0 && (\r\n              <div className=\"flex flex-col items-center justify-center h-full text-center space-y-6\">\r\n                <motion.div\r\n                  initial={{ scale: 0 }}\r\n                  animate={{ scale: 1 }}\r\n                  transition={{ type: 'spring', duration: 0.6 }}\r\n                  className=\"w-24 h-24 bg-gradient-to-br from-purple-500 via-blue-500 to-indigo-500 rounded-3xl flex items-center justify-center shadow-2xl\"\r\n                >\r\n                  <Book className=\"w-12 h-12 text-white\" />\r\n                </motion.div>\r\n                <motion.div\r\n                  initial={{ opacity: 0, y: 20 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  transition={{ delay: 0.2 }}\r\n                >\r\n                  <h3 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\r\n                    Ch√†o m·ª´ng ƒë·∫øn v·ªõi AI Learning Assistant! üëã\r\n                  </h3>\r\n                  <p className=\"text-gray-600 dark:text-gray-400 max-w-md mb-6\">\r\n                    H·ªèi t√¥i b·∫•t c·ª© ƒëi·ªÅu g√¨ v·ªÅ c√°c quiz b·∫°n ƒë√£ h·ªçc.\r\n                    T√¥i s·∫Ω tr·∫£ l·ªùi chi ti·∫øt v√† g·ª£i √Ω quiz ph√π h·ª£p cho b·∫°n.\r\n                  </p>\r\n                </motion.div>\r\n                <motion.div\r\n                  initial={{ opacity: 0, y: 20 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  transition={{ delay: 0.3 }}\r\n                  className=\"grid grid-cols-1 md:grid-cols-2 gap-3 w-full max-w-2xl\"\r\n                >\r\n                  <button\r\n                    onClick={() => setInput('Gi·∫£i th√≠ch cho t√¥i v·ªÅ ch·ªß ƒë·ªÅ n√†y')}\r\n                    className=\"group px-4 py-3 bg-white dark:bg-gray-800 rounded-xl hover:shadow-lg transition-all text-left border border-gray-200 dark:border-gray-700 hover:border-purple-500 dark:hover:border-purple-500\"\r\n                  >\r\n                    <div className=\"flex items-start gap-3\">\r\n                      <div className=\"text-2xl\">üí°</div>\r\n                      <div>\r\n                        <div className=\"font-medium text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400\">\r\n                          Gi·∫£i th√≠ch kh√°i ni·ªám\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                          T√¨m hi·ªÉu chi ti·∫øt v·ªÅ ch·ªß ƒë·ªÅ b·∫°n quan t√¢m\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                  \r\n                  <button\r\n                    onClick={() => setInput('T√≥m t·∫Øt n·ªôi dung v·ªÅ ch·ªß ƒë·ªÅ n√†y')}\r\n                    className=\"group px-4 py-3 bg-white dark:bg-gray-800 rounded-xl hover:shadow-lg transition-all text-left border border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500\"\r\n                  >\r\n                    <div className=\"flex items-start gap-3\">\r\n                      <div className=\"text-2xl\">üìù</div>\r\n                      <div>\r\n                        <div className=\"font-medium text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400\">\r\n                          T√≥m t·∫Øt n·ªôi dung\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                          Xem t·ªïng quan ki·∫øn th·ª©c quan tr·ªçng\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                  \r\n                  <button\r\n                    onClick={() => setInput('Cho t√¥i v√≠ d·ª• th·ª±c t·∫ø v·ªÅ ch·ªß ƒë·ªÅ n√†y')}\r\n                    className=\"group px-4 py-3 bg-white dark:bg-gray-800 rounded-xl hover:shadow-lg transition-all text-left border border-gray-200 dark:border-gray-700 hover:border-green-500 dark:hover:border-green-500\"\r\n                  >\r\n                    <div className=\"flex items-start gap-3\">\r\n                      <div className=\"text-2xl\">üéØ</div>\r\n                      <div>\r\n                        <div className=\"font-medium text-gray-900 dark:text-white group-hover:text-green-600 dark:group-hover:text-green-400\">\r\n                          V√≠ d·ª• th·ª±c t·∫ø\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                          H·ªçc qua c√°c tr∆∞·ªùng h·ª£p c·ª• th·ªÉ\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                  \r\n                  <button\r\n                    onClick={() => setInput('G·ª£i √Ω quiz ƒë·ªÉ t√¥i luy·ªán t·∫≠p')}\r\n                    className=\"group px-4 py-3 bg-white dark:bg-gray-800 rounded-xl hover:shadow-lg transition-all text-left border border-gray-200 dark:border-gray-700 hover:border-indigo-500 dark:hover:border-indigo-500\"\r\n                  >\r\n                    <div className=\"flex items-start gap-3\">\r\n                      <div className=\"text-2xl\">üéì</div>\r\n                      <div>\r\n                        <div className=\"font-medium text-gray-900 dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400\">\r\n                          G·ª£i √Ω quiz\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                          T√¨m quiz ph√π h·ª£p ƒë·ªÉ th·ª±c h√†nh\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                </motion.div>\r\n              </div>\r\n            )}\r\n\r\n            <MessageList messages={messages} onQuizClick={onClose} />\r\n\r\n            {isLoading && <TypingIndicator />}\r\n\r\n            {error && (\r\n              <div className=\"flex items-start gap-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\r\n                <AlertCircle className=\"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5\" />\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-red-900 dark:text-red-200\">\r\n                    ƒê√£ x·∫£y ra l·ªói\r\n                  </p>\r\n                  <p className=\"text-sm text-red-700 dark:text-red-300 mt-1\">\r\n                    {error}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <div ref={messagesEndRef} />\r\n          </div>\r\n\r\n          {/* Input Area */}\r\n          <div className=\"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50\">\r\n            <div className=\"flex gap-3\">\r\n              <textarea\r\n                ref={inputRef}\r\n                value={input}\r\n                onChange={(e) => setInput(e.target.value)}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder={t('placeholders.askQuestion')}\r\n                className=\"flex-1 resize-none px-4 py-3 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 dark:text-white\"\r\n                rows={1}\r\n                style={{ maxHeight: '120px' }}\r\n              />\r\n              <button\r\n                onClick={handleSendMessage}\r\n                disabled={!input.trim() || isLoading}\r\n                className=\"px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 font-medium\"\r\n              >\r\n                <Send className=\"w-5 h-5\" />\r\n                G·ª≠i\r\n              </button>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              üí° Tip: H·ªèi v·ªÅ n·ªôi dung b·∫°n ƒë√£ h·ªçc trong c√°c quiz ƒë√£ m·ªü kh√≥a\r\n            </p>\r\n          </div>\r\n        </motion.div>\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\components\\rag\\CitationBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\components\\rag\\MessageList.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs font-medium mb-2 text-gray-600 dark:text-gray-400\">\r\n                      üìö Ngu·ªìn tham kh·∫£o:\r\n                    </p>","line":70,"column":94,"nodeType":"JSXText","endLine":72,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>‚ö° {message.processingTime}ms</span>","line":84,"column":53,"nodeType":"JSXText","endLine":84,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>üìÑ {message.usedChunks} chunks</span>","line":88,"column":54,"nodeType":"JSXText","endLine":88,"endColumn":61},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-bold text-purple-900 dark:text-purple-100\">\r\n                    üéØ Quiz g·ª£i √Ω cho b·∫°n\r\n                  </h4>","line":117,"column":82,"nodeType":"JSXText","endLine":119,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-purple-700 dark:text-purple-300 mb-4\">\r\n                  Click v√†o quiz ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m b√†i ngay! üëá\r\n                </p>","line":121,"column":82,"nodeType":"JSXText","endLine":123,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * üí¨ Message List Component\r\n * \r\n * Displays chat messages with citations and quiz recommendations\r\n */\r\n\r\nimport { motion } from 'framer-motion';\r\nimport { User, Sparkles, BookOpen } from 'lucide-react';\r\nimport { CitationBadge } from './CitationBadge';\r\nimport { QuizRecommendationCard } from './QuizRecommendationCard';\r\nimport type { Citation, QuizRecommendation } from '../../lib/genkit/types';\r\n\r\ninterface Message {\r\n  id: string;\r\n  role: 'user' | 'assistant';\r\n  content: string;\r\n  citations?: Citation[];\r\n  quizRecommendations?: QuizRecommendation[];\r\n  timestamp: number;\r\n  usedChunks?: number;\r\n  processingTime?: number;\r\n}\r\n\r\ninterface MessageListProps {\r\n  messages: Message[];\r\n  onQuizClick?: () => void;\r\n}\r\n\r\nexport function MessageList({ messages, onQuizClick }: MessageListProps) {\r\n  return (\r\n    <>\r\n      {messages.map((message, index) => (\r\n        <motion.div\r\n          key={message.id}\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ delay: index * 0.05 }}\r\n          className={`flex gap-3 ${\r\n            message.role === 'user' ? 'justify-end' : 'justify-start'\r\n          }`}\r\n        >\r\n          {message.role === 'assistant' && (\r\n            <motion.div\r\n              initial={{ scale: 0 }}\r\n              animate={{ scale: 1 }}\r\n              transition={{ delay: index * 0.05 + 0.1, type: 'spring' }}\r\n              className=\"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 via-blue-500 to-indigo-500 flex items-center justify-center flex-shrink-0 shadow-lg\"\r\n            >\r\n              <Sparkles className=\"w-5 h-5 text-white\" />\r\n            </motion.div>\r\n          )}\r\n\r\n          <div\r\n            className={`max-w-[85%] ${\r\n              message.role === 'user'\r\n                ? 'bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 text-white shadow-lg rounded-2xl px-4 py-3'\r\n                : ''\r\n            }`}\r\n          >\r\n            {/* AI Message Answer */}\r\n            {message.role === 'assistant' && (\r\n              <div className=\"bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-850 text-gray-900 dark:text-white border border-gray-200 dark:border-gray-700 shadow-md rounded-2xl px-4 py-3\">\r\n                <div className=\"prose prose-sm dark:prose-invert max-w-none\">\r\n                  <p className=\"whitespace-pre-wrap leading-relaxed\">{message.content}</p>\r\n                </div>\r\n\r\n                {/* Citations */}\r\n                {message.citations && message.citations.length > 0 && (\r\n                  <div className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\r\n                    <p className=\"text-xs font-medium mb-2 text-gray-600 dark:text-gray-400\">\r\n                      üìö Ngu·ªìn tham kh·∫£o:\r\n                    </p>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {message.citations.map((citation, i) => (\r\n                        <CitationBadge key={i} citation={citation} index={i + 1} />\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Metadata */}\r\n                {message.processingTime && (\r\n                  <div className=\"mt-2 flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400\">\r\n                    <span>‚ö° {message.processingTime}ms</span>\r\n                    {message.usedChunks && message.usedChunks > 0 && (\r\n                      <>\r\n                        <span>‚Ä¢</span>\r\n                        <span>üìÑ {message.usedChunks} chunks</span>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/* User Message */}\r\n            {message.role === 'user' && (\r\n              <div className=\"prose prose-sm dark:prose-invert max-w-none\">\r\n                <p className=\"whitespace-pre-wrap leading-relaxed\">{message.content}</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Quiz Recommendations - Separate Block */}\r\n          {message.role === 'assistant' && message.quizRecommendations && message.quizRecommendations.length > 0 && (\r\n            <motion.div\r\n              initial={{ opacity: 0, y: 10 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              transition={{ delay: 0.3 }}\r\n              className=\"max-w-[85%] mt-3\"\r\n            >\r\n              <div className=\"bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 border-2 border-purple-200 dark:border-purple-800 rounded-2xl p-4\">\r\n                <div className=\"flex items-center gap-2 mb-3\">\r\n                  <div className=\"w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-500 rounded-lg flex items-center justify-center\">\r\n                    <BookOpen className=\"w-5 h-5 text-white\" />\r\n                  </div>\r\n                  <h4 className=\"font-bold text-purple-900 dark:text-purple-100\">\r\n                    üéØ Quiz g·ª£i √Ω cho b·∫°n\r\n                  </h4>\r\n                </div>\r\n                <p className=\"text-sm text-purple-700 dark:text-purple-300 mb-4\">\r\n                  Click v√†o quiz ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m b√†i ngay! üëá\r\n                </p>\r\n                <div className=\"space-y-3\">\r\n                  {message.quizRecommendations.map((quiz, i) => (\r\n                    <QuizRecommendationCard \r\n                      key={quiz.quizId} \r\n                      quiz={quiz} \r\n                      index={i} \r\n                      onNavigate={onQuizClick}\r\n                    />\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n\r\n          {message.role === 'user' && (\r\n            <motion.div\r\n              initial={{ scale: 0 }}\r\n              animate={{ scale: 1 }}\r\n              transition={{ delay: index * 0.05 + 0.1, type: 'spring' }}\r\n              className=\"w-8 h-8 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 dark:from-gray-600 dark:to-gray-700 flex items-center justify-center flex-shrink-0 shadow-lg\"\r\n            >\r\n              <User className=\"w-5 h-5 text-white\" />\r\n            </motion.div>\r\n          )}\r\n        </motion.div>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\components\\rag\\QuizRecommendationCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\components\\rag\\TypingIndicator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\components\\rag\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\config\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\config\\gemini.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\config\\routes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\components\\AdminLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\components\\AdminLogin.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\components\\AdminProtectedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\components\\AdminSetup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\components\\AdminSidebar.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"mr-3\">‚úèÔ∏è</span>","line":94,"column":38,"nodeType":"JSXText","endLine":94,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"Ôªøimport React from 'react';\r\nimport { Link, useLocation } from 'react-router-dom';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nconst AdminSidebar: React.FC = () => {\r\n  const location = useLocation();\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const { t } = useTranslation();\r\n\r\n  if (user?.role !== 'admin') {\r\n    return null;\r\n  }\r\n\r\n  const navigation = [\r\n    {\r\n      name: t('admin.sidebar.nav.dashboard'),\r\n      href: '/admin',\r\n      icon: 'üè†',\r\n      current: location.pathname === '/admin'\r\n    },\r\n    {\r\n      name: t('admin.sidebar.nav.quizManagement'),\r\n      href: '/admin/quiz-management',\r\n      icon: 'üìù',\r\n      current: location.pathname === '/admin/quiz-management'\r\n    },\r\n    {\r\n      name: t('admin.sidebar.nav.categories'),\r\n      href: '/admin/categories',\r\n      icon: 'üè∑Ô∏è',\r\n      current: location.pathname === '/admin/categories'\r\n    },\r\n    {\r\n      name: t('admin.sidebar.nav.users'),\r\n      href: '/admin/users',\r\n      icon: 'üë•',\r\n      current: location.pathname === '/admin/users'\r\n    },\r\n    {\r\n      name: t('admin.sidebar.nav.utilities'),\r\n      href: '/admin/utilities',\r\n      icon: 'ÔøΩÔ∏è',\r\n      current: location.pathname === '/admin/utilities'\r\n    },\r\n    {\r\n      name: t('admin.sidebar.nav.roles'),\r\n      href: '/admin/roles',\r\n      icon: 'üîê',\r\n      current: location.pathname === '/admin/roles'\r\n    }\r\n  ];\r\n\r\n  return (\r\n    <div className=\"fixed inset-y-0 left-0 z-50 w-64 bg-gray-900 transform transition-transform duration-300 ease-in-out lg:translate-x-0\">\r\n      <div className=\"flex items-center justify-center h-16 bg-gray-800\">\r\n        <h1 className=\"text-white text-xl font-bold\">{t('admin.sidebar.title')}</h1>\r\n      </div>\r\n      \r\n      <nav className=\"mt-8\">\r\n        <div className=\"px-3 mb-6\">\r\n          <p className=\"text-gray-400 text-xs uppercase tracking-wider font-semibold\">\r\n            {t('admin.sidebar.sectionAdmin')}\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"space-y-1\">\r\n          {navigation.map((item) => (\r\n            <Link\r\n              key={item.name}\r\n              to={item.href}\r\n              className={`group flex items-center px-3 py-2 mx-3 text-sm font-medium rounded-md transition-colors ${\r\n                item.current\r\n                  ? 'bg-gray-800 text-white'\r\n                  : 'text-gray-300 hover:bg-gray-700 hover:text-white'\r\n              }`}\r\n            >\r\n              <span className=\"mr-3 text-lg\">{item.icon}</span>\r\n              {item.name}\r\n            </Link>\r\n          ))}\r\n        </div>\r\n        \r\n        <div className=\"mt-8 px-3\">\r\n          <p className=\"text-gray-400 text-xs uppercase tracking-wider font-semibold mb-4\">\r\n            {t('admin.sidebar.quickActions')}\r\n          </p>\r\n          <div className=\"space-y-2\">\r\n            <Link\r\n              to=\"/creator\"\r\n              className=\"group flex items-center px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white rounded-md\"\r\n            >\r\n              <span className=\"mr-3\">‚úèÔ∏è</span>\r\n              {t('admin.sidebar.createQuiz')}\r\n            </Link>\r\n            <Link\r\n              to=\"/dashboard\"\r\n              className=\"group flex items-center px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white rounded-md\"\r\n            >\r\n              <span className=\"mr-3\">üè†</span>\r\n              {t('admin.sidebar.backToDashboard')}\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n      \r\n      <div className=\"absolute bottom-0 w-full p-4\">\r\n        <div className=\"bg-gray-800 rounded-lg p-3\">\r\n          <div className=\"flex items-center\">\r\n            <div className=\"flex-shrink-0\">\r\n              <div className=\"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center\">\r\n                <span className=\"text-white text-sm font-medium\">\r\n                  {user?.displayName?.charAt(0) || user?.email?.charAt(0) || 'A'}\r\n                </span>\r\n              </div>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-white text-sm font-medium\">\r\n                {user?.displayName || t('ui.admin')}\r\n              </p>\r\n              <p className=\"text-gray-400 text-xs\">{t('ui.admin')}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminSidebar;\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\components\\AdminStats.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[807,810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[807,810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2268,2271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2268,2271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2380,2383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2380,2383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2492,2495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2492,2495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3512,3515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3512,3515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7081,7084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7081,7084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":271,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11951,11954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11951,11954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12344,12347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12344,12347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":324,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15188,15191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15188,15191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":367,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":367,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17445,17448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17445,17448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":531,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":531,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24559,24562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24559,24562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { \r\n  BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, \r\n  PieChart, Pie, Cell, Legend, LineChart, Line, AreaChart, Area \r\n} from 'recharts';\r\nimport { \r\n  TrendingUp, TrendingDown, Users, BookOpen, Target, Award, RefreshCw, \r\n  Eye, MessageSquare, Edit, Download\r\n} from 'lucide-react';\r\nimport { getRealQuizData, getRealUserData, getRealReviewData, getRealCategoryData } from '../../quiz/services/realDataService';\r\nimport { toast } from 'react-toastify';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst AdminStats: React.FC = () => {\r\n  const { t } = useTranslation();\r\n  const [loading, setLoading] = useState(true);\r\n  const [realData, setRealData] = useState<any>(null);\r\n  const [activeTab, setActiveTab] = useState<'overview' | 'users' | 'quizzes' | 'performance'>('overview');\r\n  const [timeRange, setTimeRange] = useState<'7d' | '30d' | '90d' | '1y'>('30d');\r\n  const navigate = useNavigate();\r\n\r\n  const loadRealData = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const [quizzes, users, reviews, categories] = await Promise.all([\r\n        getRealQuizData(),\r\n        getRealUserData(), \r\n        getRealReviewData(),\r\n        getRealCategoryData()\r\n      ]);\r\n\r\n      setRealData({\r\n        quizzes: quizzes || [],\r\n        users: users || [],\r\n        reviews: reviews || [],\r\n        categories: categories || []\r\n      });\r\n\r\n      toast.success(t('admin.dataLoadSuccess'));\r\n    } catch (error) {\r\n      console.error('Error loading real data:', error);\r\n      toast.error(t('admin.realDataLoadError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [t]);\r\n\r\n  useEffect(() => {\r\n    loadRealData();\r\n  }, [loadRealData]);\r\n\r\n  const refreshData = () => {\r\n    loadRealData();\r\n  };\r\n\r\n  const exportData = () => {\r\n    console.log('Exporting data...');\r\n    toast.info(t('admin.exportDataDevelopment'));\r\n  };\r\n\r\n  // Calculate enhanced stats from real data\r\n  const getEnhancedStats = () => {\r\n    if (!realData) return null;\r\n\r\n    const { quizzes, users, reviews } = realData;\r\n    \r\n    // Calculate more accurate statistics\r\n    const publishedQuizzes = quizzes.filter((q: any) => q.status === 'published' || q.status === 'approved').length;\r\n    const creatorUsers = users.filter((u: any) => u.role === 'creator' || u.role === 'admin').length;\r\n    const quizCreatorIds = new Set(quizzes.map((q: any) => q.createdBy).filter(Boolean));\r\n    const totalCreators = Math.max(creatorUsers, quizCreatorIds.size);\r\n    \r\n    // More realistic completion estimates based on actual quiz count\r\n    const estimatedCompletions = Math.floor(publishedQuizzes * 2.5); // Average 2.5 attempts per published quiz\r\n    \r\n    return {\r\n      totalUsers: users.length,\r\n      activeUsers: Math.floor(users.length * 0.65), // More conservative estimate\r\n      totalQuizzes: quizzes.length,\r\n      publishedQuizzes: publishedQuizzes, // Quizzes available to users\r\n      totalCreators: totalCreators, // Users who have created quizzes\r\n      completedQuizzes: estimatedCompletions, // Quiz completion attempts\r\n      averageScore: 78.5, // Keep mock for now\r\n      completionRate: 85.2, // Keep mock for now  \r\n      userGrowthRate: 12.5, // Keep mock for now\r\n      quizCompletionGrowth: 8.3, // Keep mock for now\r\n      totalReviews: reviews.length,\r\n      averageRating: reviews.length > 0 ? \r\n        reviews.reduce((sum: number, r: any) => sum + (r.rating || 0), 0) / reviews.length : 0\r\n    };\r\n  };\r\n\r\n  const enhancedStats = getEnhancedStats();\r\n\r\n  const StatCard: React.FC<{\r\n    title: string;\r\n    value: string | number;\r\n    icon: React.ReactNode;\r\n    change: number;\r\n    color: string;\r\n    onClick?: () => void;\r\n  }> = ({ title, value, icon, change, color, onClick }) => (\r\n    <div \r\n      className={`bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-all duration-200 ${onClick ? 'cursor-pointer' : ''}`}\r\n      onClick={onClick}\r\n    >\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <p className=\"text-sm font-medium text-gray-600\">{title}</p>\r\n          <p className=\"text-2xl font-bold text-gray-900 mt-1\">{value}</p>\r\n        </div>\r\n        <div className={`p-3 rounded-full bg-${color}-100`}>\r\n          {icon}\r\n        </div>\r\n      </div>\r\n      <div className=\"mt-4 flex items-center\">\r\n        {change >= 0 ? (\r\n          <TrendingUp className=\"w-4 h-4 text-green-500 mr-1\" />\r\n        ) : (\r\n          <TrendingDown className=\"w-4 h-4 text-red-500 mr-1\" />\r\n        )}\r\n        <span className={`text-sm font-medium ${change >= 0 ? 'text-green-600' : 'text-red-600'}`}>\r\n          {change >= 0 ? '+' : ''}{change}%\r\n        </span>\r\n        <span className=\"text-sm text-gray-500 ml-1\">{t('admin.vsLastMonth')}</span>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderOverview = () => {\r\n    if (!enhancedStats) return <div>{t('loading')}</div>;\r\n\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        {/* Main Stats Grid */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n          <StatCard\r\n            title={t('admin.stats.totalUsers')}\r\n            value={enhancedStats.totalUsers.toLocaleString()}\r\n            icon={<Users className=\"w-6 h-6 text-blue-600\" />}\r\n            change={enhancedStats.userGrowthRate}\r\n            color=\"blue\"\r\n            onClick={() => setActiveTab('users')}\r\n          />\r\n          <StatCard\r\n            title={t('admin.stats.publishedQuizzes')}\r\n            value={enhancedStats.publishedQuizzes.toLocaleString()}\r\n            icon={<BookOpen className=\"w-6 h-6 text-green-600\" />}\r\n            change={15.3}\r\n            color=\"green\"\r\n            onClick={() => setActiveTab('quizzes')}\r\n          />\r\n          <StatCard\r\n            title={t('admin.stats.completionAttempts')}\r\n            value={enhancedStats.completedQuizzes.toLocaleString()}\r\n            icon={<Target className=\"w-6 h-6 text-purple-600\" />}\r\n            change={enhancedStats.quizCompletionGrowth}\r\n            color=\"purple\"\r\n          />\r\n          <StatCard\r\n            title={t('admin.stats.totalCreators')}\r\n            value={enhancedStats.totalCreators.toLocaleString()}\r\n            icon={<Award className=\"w-6 h-6 text-orange-600\" />}\r\n            change={8.2}\r\n            color=\"orange\"\r\n          />\r\n        </div>\r\n\r\n        {/* Charts Row */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n          {/* User Growth Chart */}\r\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900\">{t('admin.stats.userGrowth')}</h3>\r\n              <div className=\"flex space-x-2\">\r\n                {['7d', '30d', '90d', '1y'].map((range) => (\r\n                  <button\r\n                    key={range}\r\n                    onClick={() => setTimeRange(range as any)}\r\n                    className={`px-3 py-1 text-xs rounded-full ${\r\n                      timeRange === range\r\n                        ? 'bg-blue-100 text-blue-600'\r\n                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n                    }`}\r\n                  >\r\n                    {range}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            <ResponsiveContainer width=\"100%\" height={300}>\r\n              <AreaChart data={[\r\n                { date: 'T1', users: Math.floor(enhancedStats.totalUsers * 0.7) },\r\n                { date: 'T2', users: Math.floor(enhancedStats.totalUsers * 0.8) },\r\n                { date: 'T3', users: Math.floor(enhancedStats.totalUsers * 0.9) },\r\n                { date: 'T4', users: enhancedStats.totalUsers }\r\n              ]}>\r\n                <defs>\r\n                  <linearGradient id=\"colorUsers\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                    <stop offset=\"5%\" stopColor=\"#3B82F6\" stopOpacity={0.3}/>\r\n                    <stop offset=\"95%\" stopColor=\"#3B82F6\" stopOpacity={0}/>\r\n                  </linearGradient>\r\n                </defs>\r\n                <XAxis dataKey=\"date\" />\r\n                <YAxis />\r\n                <Tooltip />\r\n                <Area \r\n                  type=\"monotone\" \r\n                  dataKey=\"users\" \r\n                  stroke=\"#3B82F6\" \r\n                  fillOpacity={1} \r\n                  fill=\"url(#colorUsers)\" \r\n                />\r\n              </AreaChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n\r\n          {/* Quiz Activity Chart */}\r\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-6\">{t('admin.stats.quizActivity')}</h3>\r\n            <ResponsiveContainer width=\"100%\" height={300}>\r\n              <BarChart data={[\r\n                { date: 'T1', created: Math.floor(enhancedStats.totalQuizzes * 0.2), completed: Math.floor(enhancedStats.completedQuizzes * 0.2) },\r\n                { date: 'T2', created: Math.floor(enhancedStats.totalQuizzes * 0.3), completed: Math.floor(enhancedStats.completedQuizzes * 0.3) },\r\n                { date: 'T3', created: Math.floor(enhancedStats.totalQuizzes * 0.4), completed: Math.floor(enhancedStats.completedQuizzes * 0.5) },\r\n                { date: 'T4', created: Math.floor(enhancedStats.totalQuizzes * 0.1), completed: Math.floor(enhancedStats.completedQuizzes * 0.3) }\r\n              ]}>\r\n                <XAxis dataKey=\"date\" />\r\n                <YAxis />\r\n                <Tooltip />\r\n                <Legend />\r\n                <Bar dataKey=\"created\" fill=\"#10B981\" name={t('admin.stats.createdQuizzes')} />\r\n                <Bar dataKey=\"completed\" fill=\"#3B82F6\" name={t('admin.stats.completedAttempts')} />\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Additional Stats Row */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          {/* Performance Overview */}\r\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">{t('admin.stats.performanceOverview')}</h3>\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className=\"text-gray-600\">{t('admin.stats.averageScore')}</span>\r\n                <span className=\"font-semibold text-green-600\">{enhancedStats.averageScore}%</span>\r\n              </div>\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className=\"text-gray-600\">{t('admin.stats.completionRate')}</span>\r\n                <span className=\"font-semibold text-blue-600\">{enhancedStats.completionRate}%</span>\r\n              </div>\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className=\"text-gray-600\">{t('admin.stats.totalReviews')}</span>\r\n                <span className=\"font-semibold text-purple-600\">{enhancedStats.totalReviews}</span>\r\n              </div>\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className=\"text-gray-600\">{t('admin.stats.averageRating')}</span>\r\n                <span className=\"font-semibold text-yellow-600\">\r\n                  {enhancedStats.averageRating.toFixed(1)} ‚≠ê\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Top Categories */}\r\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">{t('admin.stats.topCategories')}</h3>\r\n            <div className=\"space-y-3\">\r\n              {realData?.categories?.slice(0, 5).map((category: any, index: number) => (\r\n                <div key={category.id} className=\"flex items-center justify-between\">\r\n                  <span className=\"text-gray-600\">{category.name || t('admin.stats.unnamedCategory', {n: index + 1, defaultValue: `Category ${index + 1}`})}</span>\r\n                  <span className=\"font-semibold text-blue-600\">\r\n                    {realData.quizzes.filter((q: any) => q.category === category.id).length}\r\n                  </span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Recent Activity */}\r\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">{t('admin.stats.recentActivity')}</h3>\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\r\n                <span className=\"text-sm text-gray-600\">{t('admin.stats.availableQuizzes', {count: enhancedStats.totalQuizzes, defaultValue: `${enhancedStats.totalQuizzes} quizzes available`})}</span>\r\n              </div>\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\r\n                <span className=\"text-sm text-gray-600\">{t('admin.stats.registeredUsers', {count: enhancedStats.totalUsers, defaultValue: `${enhancedStats.totalUsers} users registered`})}</span>\r\n              </div>\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"w-2 h-2 bg-purple-500 rounded-full\"></div>\r\n                <span className=\"text-sm text-gray-600\">{t('admin.stats.reviews', {count: enhancedStats.totalReviews, defaultValue: `${enhancedStats.totalReviews} reviews`})}</span>\r\n              </div>\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"w-2 h-2 bg-orange-500 rounded-full\"></div>\r\n                <span className=\"text-sm text-gray-600\">{t('admin.stats.completions', {count: enhancedStats.completedQuizzes, defaultValue: `${enhancedStats.completedQuizzes} completions`})}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderUsers = () => (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">{t('admin.userManagement')}</h3>\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full\">\r\n            <thead>\r\n              <tr className=\"border-b border-gray-200\">\r\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">ID</th>\r\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">{t(\"auth.email\")}</th>\r\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">{t('ui.user')}</th>\r\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">{t('status.active')}</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {realData?.users?.slice(0, 10).map((user: any) => (\r\n                <tr key={user.id} className=\"border-b border-gray-100\">\r\n                  <td className=\"py-3 px-4 text-sm text-gray-900\">{user.id}</td>\r\n                  <td className=\"py-3 px-4 text-sm text-gray-600\">{user.email || 'N/A'}</td>\r\n                  <td className=\"py-3 px-4 text-sm text-gray-600\">{user.role || 'user'}</td>\r\n                  <td className=\"py-3 px-4\">\r\n                    <span className=\"inline-flex px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full\">\r\n                      {t('status.active')}\r\n                    </span>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderQuizzes = () => (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">{t('admin.quizManagement.label')}</h3>\r\n          <button\r\n            onClick={() => navigate('/admin/quiz-management')}\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n          >\r\n            {t('viewDetails')}\r\n          </button>\r\n        </div>\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full\">\r\n            <thead>\r\n              <tr className=\"border-b border-gray-200\">\r\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">{t('admin.quizManagement.table.title')}</th>\r\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">{t('admin.quizManagement.table.category')}</th>\r\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">{t('admin.quizManagement.table.creator')}</th>\r\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">{t('admin.quizManagement.table.createdAt')}</th>\r\n                <th className=\"text-left py-3 px-4 font-medium text-gray-600\">{t('admin.quizManagement.table.actions')}</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {realData?.quizzes?.slice(0, 10).map((quiz: any) => (\r\n                <tr key={quiz.id} className=\"border-b border-gray-100\">\r\n                  <td className=\"py-3 px-4 text-sm font-medium text-gray-900\">\r\n                    {quiz.title || t('quiz.untitled')}\r\n                  </td>\r\n                  <td className=\"py-3 px-4 text-sm text-gray-600\">\r\n                    {quiz.category || t('admin.quizManagement.table.uncategorized')}\r\n                  </td>\r\n                  <td className=\"py-3 px-4 text-sm text-gray-600\">\r\n                    {quiz.createdBy || 'N/A'}\r\n                  </td>\r\n                  <td className=\"py-3 px-4 text-sm text-gray-600\">\r\n                    {quiz.createdAt ? new Date(quiz.createdAt.seconds * 1000).toLocaleDateString() : 'N/A'}\r\n                  </td>\r\n                  <td className=\"py-3 px-4\">\r\n                    <div className=\"flex space-x-2\">\r\n                      <button\r\n                        onClick={() => navigate(`/quiz/${quiz.id}`)}\r\n                        className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\r\n                        title={t('admin.quizManagement.tooltips.preview')}\r\n                      >\r\n                        <Eye className=\"w-4 h-4\" />\r\n                      </button>\r\n                      <button\r\n                        onClick={() => navigate(`/admin/edit-quiz/${quiz.id}`)}\r\n                        className=\"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors\"\r\n                        title={t('admin.quizManagement.tooltips.edit')}\r\n                      >\r\n                        <Edit className=\"w-4 h-4\" />\r\n                      </button>\r\n                      <button\r\n                        onClick={() => navigate(`/quiz/${quiz.id}/reviews`)}\r\n                        className=\"p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors\"\r\n                        title={t('admin.quizManagement.tooltips.viewReviews')}\r\n                      >\r\n                        <MessageSquare className=\"w-4 h-4\" />\r\n                      </button>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderPerformance = () => (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Performance Metrics */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">{t('admin.stats.performanceMetrics')}</h3>\r\n          <ResponsiveContainer width=\"100%\" height={300}>\r\n            <LineChart data={[\r\n              { month: 'T1', score: 75, completion: 80 },\r\n              { month: 'T2', score: 78, completion: 82 },\r\n              { month: 'T3', score: 76, completion: 85 },\r\n              { month: 'T4', score: 79, completion: 87 }\r\n            ]}>\r\n              <XAxis dataKey=\"month\" />\r\n              <YAxis />\r\n              <Tooltip />\r\n              <Legend />\r\n              <Line type=\"monotone\" dataKey=\"score\" stroke=\"#10B981\" name={t('admin.stats.averageScore')} />\r\n              <Line type=\"monotone\" dataKey=\"completion\" stroke=\"#3B82F6\" name={t('admin.stats.completionRate')} />\r\n            </LineChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n\r\n        {/* Quiz Rating Distribution */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">{t('admin.stats.ratingDistribution')}</h3>\r\n          <ResponsiveContainer width=\"100%\" height={300}>\r\n            <PieChart>\r\n              <Pie\r\n                data={[\r\n                  { name: '5‚òÖ', value: 35, color: '#10B981' },\r\n                  { name: '4‚òÖ', value: 28, color: '#3B82F6' },\r\n                  { name: '3‚òÖ', value: 20, color: '#F59E0B' },\r\n                  { name: '2‚òÖ', value: 12, color: '#EF4444' },\r\n                  { name: '1‚òÖ', value: 5, color: '#6B7280' }\r\n                ]}\r\n                cx=\"50%\"\r\n                cy=\"50%\"\r\n                outerRadius={100}\r\n                dataKey=\"value\"\r\n              >\r\n                {[\r\n                  { color: '#10B981' },\r\n                  { color: '#3B82F6' },\r\n                  { color: '#F59E0B' },\r\n                  { color: '#EF4444' },\r\n                  { color: '#6B7280' }\r\n                ].map((entry, index) => (\r\n                  <Cell key={`cell-${index}`} fill={entry.color} />\r\n                ))}\r\n              </Pie>\r\n              <Tooltip />\r\n              <Legend />\r\n            </PieChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{t('admin.loadingRealData')}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const tabs = [\r\n    { id: 'overview', label: t('admin.tabs.overview'), icon: Target },\r\n    { id: 'users', label: t('admin.tabs.users'), icon: Users },\r\n    { id: 'quizzes', label: t('admin.tabs.quizzes'), icon: BookOpen },\r\n    { id: 'performance', label: t('admin.tabs.performance'), icon: Award }\r\n  ];\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 py-8\">\r\n      <div className=\"max-w-7xl mx-auto px-4\">\r\n        {/* Header */}\r\n        <div className=\"mb-8\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">üìä {t('admin.header.title')}</h1>\r\n              <p className=\"text-gray-600\">{t('admin.header.subtitle')}</p>\r\n            </div>\r\n            <div className=\"flex space-x-3\">\r\n              <button\r\n                onClick={refreshData}\r\n                disabled={loading}\r\n                className=\"flex items-center px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors\"\r\n              >\r\n                <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n                {t('refresh')}\r\n              </button>\r\n              <button\r\n                onClick={exportData}\r\n                className=\"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n              >\r\n                <Download className=\"w-4 h-4 mr-2\" />\r\n                {t('admin.exportData')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Navigation Tabs */}\r\n        <div className=\"mb-8\">\r\n          <nav className=\"flex space-x-1 bg-white rounded-lg p-1 shadow-sm border border-gray-200\">\r\n            {tabs.map((tab) => {\r\n              const Icon = tab.icon;\r\n              return (\r\n                <button\r\n                  key={tab.id}\r\n                  onClick={() => setActiveTab(tab.id as any)}\r\n                  className={`flex items-center px-6 py-3 rounded-md font-medium transition-all duration-200 ${\r\n                    activeTab === tab.id\r\n                      ? 'bg-blue-600 text-white shadow-sm'\r\n                      : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\r\n                  }`}\r\n                >\r\n                  <Icon className=\"w-5 h-5 mr-2\" />\r\n                   {tab.label}\r\n                </button>\r\n              );\r\n            })}\r\n          </nav>\r\n        </div>\r\n\r\n        {/* Tab Content */}\r\n        <div className=\"mb-8\">\r\n          {activeTab === 'overview' && renderOverview()}\r\n          {activeTab === 'users' && renderUsers()}\r\n          {activeTab === 'quizzes' && renderQuizzes()}\r\n          {activeTab === 'performance' && renderPerformance()}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminStats;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\components\\AdminUtilities.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\components\\BulkActions.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1271,1274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1271,1274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-blue-800 font-medium\">\r\n          ƒê√£ ch·ªçn {selectedItems.length} {itemType}\r\n        </span>","line":68,"column":53,"nodeType":"JSXText","endLine":69,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { toast } from 'react-toastify';\r\nimport { doc, updateDoc, deleteDoc } from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\n\r\nimport { useTranslation } from 'react-i18next';\r\ninterface BulkActionsProps {\r\n  selectedItems: string[];\r\n  itemType: 'users' | 'quizzes';\r\n  onClearSelection: () => void;\r\n  onRefresh: () => void;\r\n}\r\n\r\nconst BulkActions: React.FC<BulkActionsProps> = ({ \r\n  selectedItems, \r\n  itemType, \r\n  onClearSelection, \r\n  onRefresh \r\n}) => {\r\n  const { t } = useTranslation();\r\n\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  if (selectedItems.length === 0) return null;\r\n\r\n  const bulkDelete = async () => {\r\n    if (!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ${selectedItems.length} ${itemType}?`)) return;\r\n    \r\n    setLoading(true);\r\n    try {\r\n      const promises = selectedItems.map(id => \r\n        deleteDoc(doc(db, itemType, id))\r\n      );\r\n      await Promise.all(promises);\r\n      \r\n      toast.success(`ƒê√£ x√≥a ${selectedItems.length} ${itemType}!`);\r\n      onClearSelection();\r\n      onRefresh();\r\n    } catch (error) {\r\n      toast.error('L·ªói khi x√≥a h√†ng lo·∫°t!');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const bulkUpdateStatus = async (status: any) => {\r\n    setLoading(true);\r\n    try {\r\n      const field = itemType === 'users' ? 'isActive' : 'status';\r\n      const promises = selectedItems.map(id => \r\n        updateDoc(doc(db, itemType, id), { [field]: status })\r\n      );\r\n      await Promise.all(promises);\r\n      \r\n      toast.success(`ƒê√£ c·∫≠p nh·∫≠t ${selectedItems.length} ${itemType}!`);\r\n      onClearSelection();\r\n      onRefresh();\r\n    } catch (error) {\r\n      toast.error('L·ªói khi c·∫≠p nh·∫≠t h√†ng lo·∫°t!');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <span className=\"text-blue-800 font-medium\">\r\n          ƒê√£ ch·ªçn {selectedItems.length} {itemType}\r\n        </span>\r\n        \r\n        <div className=\"flex gap-2\">\r\n          {itemType === 'users' && (\r\n            <>\r\n              <button\r\n                onClick={() => bulkUpdateStatus(true)}\r\n                disabled={loading}\r\n                className=\"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700\"\r\n              >{t(\"action.activate\")}\r\n              </button>\r\n              <button\r\n                onClick={() => bulkUpdateStatus(false)}\r\n                disabled={loading}\r\n                className=\"px-3 py-1 bg-yellow-600 text-white rounded text-sm hover:bg-yellow-700\"\r\n              >{t(\"action.deactivate\")}\r\n              </button>\r\n            </>\r\n          )}\r\n          \r\n          {itemType === 'quizzes' && (\r\n            <>\r\n              <button\r\n                onClick={() => bulkUpdateStatus('approved')}\r\n                disabled={loading}\r\n                className=\"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700\"\r\n              >{t(\"admin.editRequests.approve\")}\r\n              </button>\r\n              <button\r\n                onClick={() => bulkUpdateStatus('rejected')}\r\n                disabled={loading}\r\n                className=\"px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700\"\r\n              >{t(\"admin.editRequests.reject\")}\r\n              </button>\r\n            </>\r\n          )}\r\n          \r\n          <button\r\n            onClick={bulkDelete}\r\n            disabled={loading}\r\n            className=\"px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700\"\r\n          >{t(\"action.clear\")}\r\n          </button>\r\n          \r\n          <button\r\n            onClick={onClearSelection}\r\n            className=\"px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700\"\r\n          >{t(\"common.cancel\")}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BulkActions;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\components\\QuickActions.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2498,2501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2498,2501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11045,11048],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11045,11048],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":297,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12062,12065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12062,12065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { toast } from 'react-toastify';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { collection, addDoc, getDocs, updateDoc, doc } from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\n\r\ninterface QuickActionsProps {\r\n  onRefreshData: () => void;\r\n  stats: {\r\n    totalUsers: number;\r\n    totalQuizzes: number;\r\n    completedQuizzes: number;\r\n    totalCreators: number;\r\n  };\r\n}\r\n\r\nconst QuickActions: React.FC<QuickActionsProps> = ({ onRefreshData, stats }) => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [showNotificationModal, setShowNotificationModal] = useState(false);\r\n  const [notificationData, setNotificationData] = useState({\r\n    message: '',\r\n    type: 'info' as 'info' | 'warning' | 'success' | 'error',\r\n    targetRole: 'all' as 'all' | 'user' | 'creator'\r\n  });\r\n  const [showBanner, setShowBanner] = useState(false);\r\n  const [bannerData, setBannerData] = useState<{message:string,type:string}|null>(null);\r\n\r\n  const { t } = useTranslation();\r\n\r\n  // 1. T·∫°o th√¥ng b√°o h·ªá th·ªëng\r\n  const createSystemNotification = async () => {\r\n    if (!notificationData.message.trim()) {\r\n      toast.error(t('admin.quickActions.toasts.enterMessage'));\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      await addDoc(collection(db, 'system_notifications'), {\r\n        message: notificationData.message,\r\n        type: notificationData.type,\r\n        createdAt: new Date(),\r\n        isActive: true,\r\n        targetRole: notificationData.targetRole\r\n      });\r\n      \r\n      // Reset form\r\n      setNotificationData({\r\n        message: '',\r\n        type: 'info',\r\n        targetRole: 'all'\r\n      });\r\n      setShowNotificationModal(false);\r\n      setBannerData({ message: notificationData.message, type: notificationData.type });\r\n      setShowBanner(true);\r\n      setTimeout(() => setShowBanner(false), 5000);\r\n      \r\n      toast.success(t('admin.quickActions.toasts.createSuccess'));\r\n    } catch (error) {\r\n      console.error('Error creating notification:', error);\r\n      toast.error(t('admin.quickActions.toasts.createError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const openNotificationModal = () => {\r\n    setShowNotificationModal(true);\r\n  };\r\n\r\n  // 2. Backup d·ªØ li·ªáu\r\n  const backupData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const collections = ['users', 'quizzes', 'categories', 'quiz_results'];\r\n      const backup: any = {};\r\n      \r\n      for (const collectionName of collections) {\r\n        const snapshot = await getDocs(collection(db, collectionName));\r\n        backup[collectionName] = snapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        }));\r\n      }\r\n\r\n      // T·∫°o file backup\r\n      const dataStr = JSON.stringify(backup, null, 2);\r\n      const dataBlob = new Blob([dataStr], { type: 'application/json' });\r\n      const url = URL.createObjectURL(dataBlob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.download = `quiz-app-backup-${new Date().toISOString().split('T')[0]}.json`;\r\n      link.click();\r\n      \r\n      toast.success(t('admin.quickActions.toasts.backupSuccess'));\r\n    } catch (error) {\r\n      toast.error(t('admin.quickActions.toasts.backupError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // 3. X√≥a th√¥ng b√°o h·ªá th·ªëng\r\n  const deleteNotifications = async () => {\r\n    if (!confirm(t('admin.quickActions.toasts.confirmDeleteAll'))) return;\r\n    \r\n    setLoading(true);\r\n    try {\r\n      // L·∫•y t·∫•t c·∫£ th√¥ng b√°o ƒëang active\r\n      const notificationsSnapshot = await getDocs(collection(db, 'system_notifications'));\r\n      const deletePromises = notificationsSnapshot.docs.map(doc => \r\n        updateDoc(doc.ref, { isActive: false })\r\n      );\r\n      \r\n      await Promise.all(deletePromises);\r\n      toast.success(t('admin.quickActions.toasts.deleteSuccess'));\r\n      onRefreshData();\r\n    } catch (error) {\r\n      console.error('Error deleting notifications:', error);\r\n      toast.error(t('admin.quickActions.toasts.deleteError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // 4. D·ªçn d·∫πp d·ªØ li·ªáu ƒë√£ x√≥a\r\n  const cleanupDeletedData = async () => {\r\n    if (!confirm(t('admin.quickActions.toasts.confirmCleanup'))) return;\r\n    setLoading(true);\r\n    try {\r\n      // X√≥a quiz ƒë√£ b·ªã ƒë√°nh d·∫•u deleted=true\r\n      const quizzesSnapshot = await getDocs(collection(db, 'quizzes'));\r\n      const deletedQuizzes = quizzesSnapshot.docs.filter(doc => doc.data().deleted === true);\r\n      const quizDeletePromises = deletedQuizzes.map(q => updateDoc(doc(db, 'quizzes', q.id), { isPurged: true }));\r\n\r\n      // X√≥a user ƒë√£ b·ªã ƒë√°nh d·∫•u deleted=true\r\n      const usersSnapshot = await getDocs(collection(db, 'users'));\r\n      const deletedUsers = usersSnapshot.docs.filter(doc => doc.data().deleted === true);\r\n      const userDeletePromises = deletedUsers.map(u => updateDoc(doc(db, 'users', u.id), { isPurged: true }));\r\n\r\n      await Promise.all([...quizDeletePromises, ...userDeletePromises]);\r\n      toast.success(t('admin.quickActions.toasts.cleanupSuccess'));\r\n      onRefreshData();\r\n    } catch (error) {\r\n      toast.error(t('admin.quickActions.toasts.cleanupError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const quickActions = [\r\n    // Updated actions as requested\r\n    {\r\n      icon: 'üì¢',\r\n      title: t('admin.quickActions.items.notify.title'),\r\n      description: t('admin.quickActions.items.notify.desc'),\r\n      action: openNotificationModal,\r\n      color: 'blue'\r\n    },\r\n    {\r\n      icon: '‚ùå',\r\n      title: t('admin.quickActions.items.deleteNotifications.title'),\r\n      description: t('admin.quickActions.items.deleteNotifications.desc'),\r\n      action: deleteNotifications,\r\n      color: 'red'\r\n    },\r\n    {\r\n      icon: 'üóÇÔ∏è',\r\n      title: t('admin.quickActions.items.backup.title'),\r\n      description: t('admin.quickActions.items.backup.desc'),\r\n      action: backupData,\r\n      color: 'green'\r\n    },\r\n    {\r\n      icon: 'üóëÔ∏è',\r\n      title: t('admin.quickActions.items.cleanup.title'),\r\n      description: t('admin.quickActions.items.cleanup.desc'),\r\n      action: cleanupDeletedData,\r\n      color: 'orange'\r\n    }\r\n  ];\r\n\r\n  // Banner notification UI\r\n  useEffect(() => {\r\n    if (showBanner && bannerData) {\r\n      document.body.classList.add('overflow-x-hidden');\r\n    } else {\r\n      document.body.classList.remove('overflow-x-hidden');\r\n    }\r\n  }, [showBanner, bannerData]);\r\n\r\n  return (\r\n    <div className=\"bg-white p-6 rounded-lg shadow relative\">\r\n      {/* Banner notification */}\r\n      {showBanner && bannerData && (\r\n        <div className={`fixed top-4 left-1/2 transform -translate-x-1/2 z-[9999] px-6 py-4 rounded-full shadow-lg flex items-center gap-4 animate-slide-in\r\n          ${bannerData.type === 'info' ? 'bg-blue-500 text-white' : ''}\r\n          ${bannerData.type === 'success' ? 'bg-green-500 text-white' : ''}\r\n          ${bannerData.type === 'warning' ? 'bg-yellow-400 text-gray-900' : ''}\r\n          ${bannerData.type === 'error' ? 'bg-red-500 text-white' : ''}\r\n        `} style={{ minWidth: 320, maxWidth: '90vw' }}>\r\n          <span className=\"font-semibold text-lg truncate flex-1\">{bannerData.message}</span>\r\n          <button onClick={()=>setShowBanner(false)} className=\"ml-4 text-xl font-bold focus:outline-none\">√ó</button>\r\n        </div>\r\n      )}\r\n      <h3 className=\"text-lg font-semibold mb-4 flex items-center\">\r\n        <span className=\"text-2xl mr-2\">‚ö°</span>\r\n        {t('admin.quickActions.title')}\r\n      </h3>\r\n      \r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n        {quickActions.map((action, index) => (\r\n          <button\r\n            key={index}\r\n            onClick={action.action}\r\n            disabled={loading}\r\n            className={`p-4 border-2 rounded-lg transition-all duration-200 text-left\r\n              border-${action.color}-200 hover:border-${action.color}-500 hover:bg-${action.color}-50\r\n              ${loading ? 'opacity-50 cursor-wait' : ''}\r\n            `}\r\n          >\r\n            <div className=\"text-3xl mb-2\">{action.icon}</div>\r\n            <div className=\"font-medium mb-1\">{action.title}</div>\r\n            <div className=\"text-sm text-gray-600\">{action.description}</div>\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Th·ªëng k√™ nhanh hi·ªÉn th·ªã */}\r\n      <div className=\"mt-6 p-4 bg-gray-50 rounded-lg\">\r\n        <h4 className=\"font-medium mb-2\">üìä {t('admin.quickActions.systemStatus')}</h4>\r\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\r\n          <div>\r\n            <div className=\"text-gray-600\">{t('admin.quickActions.stats.users')}</div>\r\n            <div className=\"font-bold text-blue-600\">{stats.totalUsers}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"text-gray-600\">{t('admin.quickActions.stats.totalQuizzes')}</div>\r\n            <div className=\"font-bold text-yellow-600\">{stats.totalQuizzes}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"text-gray-600\">{t('admin.quickActions.stats.completions')}</div>\r\n            <div className=\"font-bold text-green-600\">{stats.completedQuizzes}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"text-gray-600\">{t('admin.quickActions.stats.creators')}</div>\r\n            <div className=\"font-bold text-purple-600\">{stats.totalCreators}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modal g·ª≠i th√¥ng b√°o */}\r\n      {showNotificationModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-md mx-4\">\r\n            <h2 className=\"text-xl font-semibold mb-4\">{t('admin.quickActions.modal.title')}</h2>\r\n            \r\n            <div className=\"space-y-4\">\r\n              {/* N·ªôi dung th√¥ng b√°o */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('admin.quickActions.modal.contentLabel')}\r\n                </label>\r\n                <textarea\r\n                  value={notificationData.message}\r\n                  onChange={(e) => setNotificationData(prev => ({ ...prev, message: e.target.value }))}\r\n                  placeholder={t('admin.quickActions.modal.contentPlaceholder')}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                  rows={4}\r\n                />\r\n              </div>\r\n\r\n              {/* Lo·∫°i th√¥ng b√°o */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('admin.quickActions.modal.typeLabel')}\r\n                </label>\r\n                <select\r\n                  value={notificationData.type}\r\n                  onChange={(e) => setNotificationData(prev => ({ ...prev, type: e.target.value as any }))}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                >\r\n                  <option value=\"info\">{t('admin.quickActions.modal.type.info')}</option>\r\n                  <option value=\"warning\">{t('admin.quickActions.modal.type.warning')}</option>\r\n                  <option value=\"success\">{t('admin.quickActions.modal.type.success')}</option>\r\n                  <option value=\"error\">{t('admin.quickActions.modal.type.error')}</option>\r\n                </select>\r\n              </div>\r\n\r\n              {/* ƒê·ªëi t∆∞·ª£ng nh·∫≠n th√¥ng b√°o */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('admin.quickActions.modal.targetLabel')}\r\n                </label>\r\n                <select\r\n                  value={notificationData.targetRole}\r\n                  onChange={(e) => setNotificationData(prev => ({ ...prev, targetRole: e.target.value as any }))}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                >\r\n                  <option value=\"all\">{t('admin.quickActions.modal.target.all')}</option>\r\n                  <option value=\"user\">{t('admin.quickActions.modal.target.user')}</option>\r\n                  <option value=\"creator\">{t('admin.quickActions.modal.target.creator')}</option>\r\n                </select>\r\n              </div>\r\n\r\n              {/* Buttons */}\r\n              <div className=\"flex justify-end space-x-3 pt-4\">\r\n                <button\r\n                  onClick={() => setShowNotificationModal(false)}\r\n                  className=\"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors\"\r\n                  disabled={loading}\r\n                >\r\n                  {t('cancel')}\r\n                </button>\r\n                <button\r\n                  onClick={createSystemNotification}\r\n                  disabled={loading || !notificationData.message.trim()}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                  {loading ? t('admin.quickActions.modal.sending') : t('admin.quickActions.modal.send')}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuickActions;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\components\\QuizPreview.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-2 text-green-600 text-xl\">‚úì</span>","line":114,"column":69,"nodeType":"JSXText","endLine":114,"endColumn":70},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5551,5554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5551,5554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-green-600 text-xl\">‚úì</span>","line":132,"column":68,"nodeType":"JSXText","endLine":132,"endColumn":69}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Quiz, Question } from '../../quiz/types';\r\nimport RichTextViewer from '../../../shared/components/ui/RichTextViewer';\r\nimport { useTranslation } from 'react-i18next';\r\nimport SafeHTML from '../../../shared/components/ui/SafeHTML';\r\n\r\n\r\ninterface QuizPreviewProps {\r\n  quiz: Quiz | null;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\n// Modal component v·ªõi kh·∫£ nƒÉng cu·ªôn t·ªët h∆°n\r\nconst Modal: React.FC<{ isOpen: boolean; onClose: () => void; children: React.ReactNode }> = ({ isOpen, children }) => {\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-lg max-w-5xl w-full max-h-[95vh] overflow-y-auto shadow-2xl\">\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst QuizPreview: React.FC<QuizPreviewProps> = ({ quiz, isOpen, onClose }) => {\r\n  const { t } = useTranslation();\r\n  // Guard clause to prevent null quiz errors\r\n  if (!quiz) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Modal isOpen={isOpen} onClose={onClose}>\r\n      {/* Header - Sticky */}\r\n      <div className=\"sticky top-0 bg-white z-10 p-6 border-b border-gray-200 rounded-t-lg\">\r\n        <div className=\"flex justify-between items-start\">\r\n          <div className=\"flex-1 pr-4\">\r\n            <h2 className=\"text-2xl font-bold text-gray-900\">{quiz.title}</h2>\r\n            <RichTextViewer content={quiz.description || ''} className=\"text-gray-600 mt-2\" />\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition-colors flex-shrink-0\"\r\n          >\r\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Quiz Info - Sticky */}\r\n      <div className=\"sticky top-[120px] bg-gray-50 p-6 border-b border-gray-200 z-10\">\r\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n          <div className=\"text-center\">\r\n            <div className=\"text-2xl font-bold text-blue-600\">{quiz.questions.length}</div>\r\n            <div className=\"text-sm text-gray-600\">{t('quiz.questions')}</div>\r\n          </div>\r\n          <div className=\"text-center\">\r\n            <div className=\"text-2xl font-bold text-green-600\">{quiz.duration}</div>\r\n            <div className=\"text-sm text-gray-600\">{t('minutes')}</div>\r\n          </div>\r\n          <div className=\"text-center\">\r\n            <div className=\"text-2xl font-bold text-purple-600\">{quiz.difficulty}</div>\r\n            <div className=\"text-sm text-gray-600\">{t('quiz.difficulty')}</div>\r\n          </div>\r\n          <div className=\"text-center\">\r\n            <div className={`text-2xl font-bold ${\r\n              quiz.status === 'approved' ? 'text-green-600' : \r\n              quiz.status === 'rejected' ? 'text-red-600' : 'text-yellow-600'\r\n            }`}>\r\n              {quiz.status === 'approved' ? t('status.approved') : \r\n               quiz.status === 'rejected' ? t('status.rejected') : t('status.pending')}\r\n            </div>\r\n            <div className=\"text-sm text-gray-600\">{t('status.label')}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Scrollable Content */}\r\n      <div className=\"p-6\">\r\n        <h3 className=\"text-lg font-semibold mb-6 text-gray-900\">{t('admin.preview.questionList')}</h3>\r\n        \r\n        <div className=\"space-y-6\">\r\n          {quiz.questions.map((question: Question, index: number) => (\r\n            <div key={index} className=\"border border-gray-200 rounded-lg p-6 bg-white shadow-sm\">\r\n              <div className=\"flex justify-between items-start mb-4\">\r\n                <h4 className=\"font-semibold text-gray-900 text-lg\">\r\n                  {t('quiz.question')} {index + 1}: {question.text}\r\n                </h4>\r\n                <span className={`px-3 py-1 rounded-full text-xs font-medium ${\r\n                  question.type === 'multiple' ? 'bg-blue-100 text-blue-800' :\r\n                  question.type === 'checkbox' ? 'bg-green-100 text-green-800' :\r\n                  question.type === 'boolean' ? 'bg-purple-100 text-purple-800' :\r\n                  'bg-yellow-100 text-yellow-800'\r\n                }`}>\r\n                  {question.type === 'multiple' ? t('quiz.questionTypes.multiple') :\r\n                   question.type === 'checkbox' ? t('quiz.questionTypes.checkbox') :\r\n                   question.type === 'boolean' ? t('quiz.questionTypes.boolean') :\r\n                   question.type === 'short_answer' ? t('quiz.questionTypes.short_answer') :\r\n                   t('quiz.questionTypes.image')}\r\n                </span>\r\n              </div>\r\n\r\n              {/* Answers */}\r\n              <div className=\"space-y-3\">\r\n                {question.type === 'short_answer' ? (\r\n                    <div className=\"p-4 bg-green-50 border-2 border-green-300 rounded-lg\">\r\n                    <div className=\"flex items-center\">\r\n                        <span className=\"font-medium text-green-800\">{t('quiz.correctAnswer')}: </span>\r\n                      <span className=\"ml-2 text-green-700 font-semibold\">{question.correctAnswer}</span>\r\n                      <span className=\"ml-2 text-green-600 text-xl\">‚úì</span>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  question.answers?.map((answer: any, answerIndex: number) => (\r\n                    <div\r\n                      key={answerIndex}\r\n                      className={`p-4 rounded-lg border-2 ${\r\n                        answer.isCorrect\r\n                          ? 'bg-green-50 border-green-300 text-green-800'\r\n                          : 'bg-gray-50 border-gray-200 text-gray-700'\r\n                      }`}\r\n                    >\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <span className=\"font-medium\">\r\n                          {String.fromCharCode(65 + answerIndex)}. {answer.text}\r\n                        </span>\r\n                        {answer.isCorrect && (\r\n                          <span className=\"text-green-600 text-xl\">‚úì</span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  ))\r\n                )}\r\n              </div>\r\n\r\n              {/* Question Details */}\r\n              <div className=\"mt-4 pt-4 border-t border-gray-200\">\r\n                <div className=\"flex justify-between items-center text-sm\">\r\n                  <span className=\"text-gray-600\">\r\n                    <span className=\"font-medium\">{t('common.points')}: </span>\r\n                    <span className=\"text-blue-600 font-semibold\">{question.points}</span>\r\n                  </span>\r\n                  {question.explanation && (\r\n                    <span className=\"text-gray-600\">\r\n                      <span className=\"font-medium\">{t('quiz.explanation')}: </span>\r\n                      <SafeHTML content={question.explanation} className=\"text-gray-700\" />\r\n                    </span>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Footer Actions */}\r\n        <div className=\"mt-8 pt-6 border-t border-gray-200 bg-gray-50 -mx-6 px-6 pb-6\">\r\n          <div className=\"flex justify-between items-center\">\r\n            <div className=\"text-sm text-gray-600\">\r\n              {t('quiz.questions')}: <span className=\"font-semibold\">{quiz.questions.length}</span> - \r\n              <span className=\"font-semibold ml-1\">{t('quiz.points', {points: quiz.questions.reduce((sum, q) => sum + (q.points || 0), 0),\r\n                defaultValue: `Points: ${quiz.questions.reduce((sum, q) => sum + (q.points || 0), 0)}`})}</span>\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium\"\r\n            >\r\n              {t('close')}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default QuizPreview;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\pages\\Admin.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1299,1302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1299,1302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3494,3497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3494,3497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-2xl\">‚úèÔ∏è</span>","line":230,"column":42,"nodeType":"JSXText","endLine":230,"endColumn":44},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Link \r\n              to=\"/admin/quiz-management\" \r\n              className=\"w-full text-left p-2 md:p-3 hover:bg-gray-50 rounded border block text-sm md:text-base\"\r\n            >\r\n              ‚óÜ {t('admin.tabs.quizManagement')}\r\n            </Link>","line":248,"column":14,"nodeType":"JSXText","endLine":249,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-2xl group-hover:scale-110 transition-transform\">üóëÔ∏è</span>","line":335,"column":85,"nodeType":"JSXText","endLine":335,"endColumn":88},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":366,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15988,15991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15988,15991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":381,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":381,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16988,16991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16988,16991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { Link } from 'react-router-dom';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { RootState } from '../../../lib/store';\r\nimport AdminLayout from '../components/AdminLayout';\r\nimport { toast } from 'react-toastify';\r\nimport { collection, addDoc, getDocs, updateDoc, doc } from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\n\r\nconst Admin: React.FC = () => {\r\n  const { t } = useTranslation();\r\n  // State cho th·ªëng k√™\r\n  const [stats, setStats] = useState({\r\n    totalQuizzes: 0,\r\n    totalUsers: 0,\r\n    completedQuizzes: 0,\r\n    totalCreators: 0,\r\n  });\r\n\r\n  useEffect(() => {\r\n    const fetchStats = async () => {\r\n      try {\r\n        // ƒê·ªìng b·ªô logic v·ªõi /home: d√πng d·ªØ li·ªáu th·ª±c, ƒë·∫øm to√†n b·ªô quiz v√† ng∆∞·ªùi d√πng ƒëang ho·∫°t ƒë·ªông\r\n        const [quizzesSnap, usersSnap] = await Promise.all([\r\n          getDocs(collection(db, 'quizzes')),\r\n          getDocs(collection(db, 'users'))\r\n        ]);\r\n\r\n        // T·ªïng s·ªë quiz = t·∫•t c·∫£ document trong 'quizzes'\r\n        const totalQuizzes = quizzesSnap.size;\r\n\r\n        // Ch·ªâ ƒë·∫øm ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông (isActive !== false v√† isDeleted !== true)\r\n        const users = usersSnap.docs.map(doc => doc.data() as any);\r\n        const activeUsers = users.filter(u => u?.isActive !== false && u?.isDeleted !== true);\r\n        const totalUsers = activeUsers.length;\r\n\r\n        // Ng∆∞·ªùi t·∫°o: role 'creator' ho·∫∑c 'admin' trong nh√≥m active\r\n        const totalCreators = activeUsers.filter(u => u?.role === 'creator' || u?.role === 'admin').length;\r\n\r\n        // Ch∆∞a c√≥ d·ªØ li·ªáu quiz results => ƒë·ªÉ 0 cho kh·ªõp v·ªõi /home\r\n        const completedQuizzes = 0;\r\n\r\n        setStats({\r\n          totalQuizzes,\r\n          totalUsers,\r\n          completedQuizzes,\r\n          totalCreators,\r\n        });\r\n      } catch (_) {\r\n        // silent\r\n      }\r\n    };\r\n    fetchStats();\r\n  }, []);\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const [showNotificationModal, setShowNotificationModal] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [notificationData, setNotificationData] = useState({\r\n    message: '',\r\n    type: 'info' as 'info' | 'warning' | 'success' | 'error',\r\n    targetRole: 'all' as 'all' | 'user' | 'creator'\r\n  });\r\n\r\n  const createSystemNotification = async () => {\r\n    if (!notificationData.message.trim()) {\r\n      toast.error(t('admin.quickActions.toasts.enterMessage'));\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      await addDoc(collection(db, 'system_notifications'), {\r\n        message: notificationData.message,\r\n        type: notificationData.type,\r\n        createdAt: new Date(),\r\n        isActive: true,\r\n        targetRole: notificationData.targetRole\r\n      });\r\n      \r\n      // Reset form\r\n      setNotificationData({\r\n        message: '',\r\n        type: 'info',\r\n        targetRole: 'all'\r\n      });\r\n      setShowNotificationModal(false);\r\n      \r\n      toast.success(t('admin.quickActions.toasts.createSuccess'));\r\n    } catch (error) {\r\n      console.error('Error creating notification:', error);\r\n      toast.error(t('admin.quickActions.toasts.createError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Backup d·ªØ li·ªáu\r\n  const backupData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const collections = ['users', 'quizzes', 'categories', 'quiz_results'];\r\n      const backup: any = {};\r\n      \r\n      for (const collectionName of collections) {\r\n        const snapshot = await getDocs(collection(db, collectionName));\r\n        backup[collectionName] = snapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        }));\r\n      }\r\n\r\n      // T·∫°o file backup\r\n      const dataStr = JSON.stringify(backup, null, 2);\r\n      const dataBlob = new Blob([dataStr], { type: 'application/json' });\r\n      const url = URL.createObjectURL(dataBlob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.download = `quiz-app-backup-${new Date().toISOString().split('T')[0]}.json`;\r\n      link.click();\r\n      \r\n      toast.success(t('admin.quickActions.toasts.backupSuccess'));\r\n    } catch (error) {\r\n      toast.error(t('admin.quickActions.toasts.backupError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // X√≥a th√¥ng b√°o h·ªá th·ªëng\r\n  const deleteNotifications = async () => {\r\n    if (!confirm(t('admin.quickActions.toasts.confirmDeleteAll'))) return;\r\n    \r\n    setLoading(true);\r\n    try {\r\n      const notificationsSnapshot = await getDocs(collection(db, 'system_notifications'));\r\n      const deletePromises = notificationsSnapshot.docs.map(doc => \r\n        updateDoc(doc.ref, { isActive: false })\r\n      );\r\n      \r\n      await Promise.all(deletePromises);\r\n      toast.success(t('admin.quickActions.toasts.deleteSuccess'));\r\n    } catch (error) {\r\n      console.error('Error deleting notifications:', error);\r\n      toast.error(t('admin.quickActions.toasts.deleteError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // D·ªçn d·∫πp d·ªØ li·ªáu ƒë√£ x√≥a\r\n  const cleanupDeletedData = async () => {\r\n    if (!confirm(t('admin.quickActions.toasts.confirmCleanup'))) return;\r\n    setLoading(true);\r\n    try {\r\n      const quizzesSnapshot = await getDocs(collection(db, 'quizzes'));\r\n      const deletedQuizzes = quizzesSnapshot.docs.filter(doc => doc.data().deleted === true);\r\n      const quizDeletePromises = deletedQuizzes.map(q => updateDoc(doc(db, 'quizzes', q.id), { isPurged: true }));\r\n\r\n      const usersSnapshot = await getDocs(collection(db, 'users'));\r\n      const deletedUsers = usersSnapshot.docs.filter(doc => doc.data().deleted === true);\r\n      const userDeletePromises = deletedUsers.map(u => updateDoc(doc(db, 'users', u.id), { isPurged: true }));\r\n\r\n      await Promise.all([...quizDeletePromises, ...userDeletePromises]);\r\n      toast.success(t('admin.quickActions.toasts.cleanupSuccess'));\r\n    } catch (error) {\r\n      toast.error(t('admin.quickActions.toasts.cleanupError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (user?.role !== 'admin') {\r\n    return (\r\n      <div className=\"text-center py-12\">\r\n        <p className=\"text-gray-600\">{t('admin.loginAsAdmin')}</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <AdminLayout title={t(\"admin.sidebar.nav.dashboard\")}>\r\n      {/* Welcome Section */}\r\n      <div className=\"bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg shadow-lg p-6 mb-8 text-white\">\r\n        <h1 className=\"text-2xl md:text-3xl font-bold mb-2\">{t('admin.greeting')}</h1>\r\n        <p className=\"text-blue-100\">{t('admin.dashboardSubtitle')}</p>\r\n      </div>\r\n\r\n      {/* Stats Grid - Responsive */}\r\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8\">\r\n        <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6 border border-gray-200\">\r\n          <div className=\"flex items-center\">\r\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\r\n              <span className=\"text-2xl\">üìö</span>\r\n            </div>\r\n            <div className=\"ml-4\">\r\n              <h3 className=\"text-sm md:text-base font-semibold text-gray-900\">{t('dashboard.totalQuizzes')}</h3>\r\n              <div className=\"text-xl md:text-3xl font-bold text-blue-600\">{stats.totalQuizzes}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6 border border-gray-200\">\r\n          <div className=\"flex items-center\">\r\n            <div className=\"p-2 bg-green-100 rounded-lg\">\r\n              <span className=\"text-2xl\">üë•</span>\r\n            </div>\r\n            <div className=\"ml-4\">\r\n              <h3 className=\"text-sm md:text-base font-semibold text-gray-900\">{t('dashboard.totalUsers')}</h3>\r\n              <div className=\"text-xl md:text-3xl font-bold text-green-600\">{stats.totalUsers}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6 border border-gray-200\">\r\n          <div className=\"flex items-center\">\r\n            <div className=\"p-2 bg-purple-100 rounded-lg\">\r\n              <span className=\"text-2xl\">‚úÖ</span>\r\n            </div>\r\n            <div className=\"ml-4\">\r\n              <h3 className=\"text-sm md:text-base font-semibold text-gray-900\">{t('dashboard.completedQuizzes')}</h3>\r\n              <div className=\"text-xl md:text-3xl font-bold text-purple-600\">{stats.completedQuizzes}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6 border border-gray-200\">\r\n          <div className=\"flex items-center\">\r\n            <div className=\"p-2 bg-orange-100 rounded-lg\">\r\n              <span className=\"text-2xl\">‚úèÔ∏è</span>\r\n            </div>\r\n            <div className=\"ml-4\">\r\n              <h3 className=\"text-sm md:text-base font-semibold text-gray-900\">{t('dashboard.totalCreators')}</h3>\r\n              <div className=\"text-xl md:text-3xl font-bold text-orange-600\">{stats.totalCreators}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Management Grid - Responsive */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6\">\r\n        <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6\">\r\n          <h3 className=\"text-base md:text-lg font-semibold text-gray-900 mb-3 md:mb-4\">{t('admin.tabs.quizManagement')}</h3>\r\n          <div className=\"space-y-2\">\r\n            <Link \r\n              to=\"/admin/quiz-management\" \r\n              className=\"w-full text-left p-2 md:p-3 hover:bg-gray-50 rounded border block text-sm md:text-base\"\r\n            >\r\n              ‚óÜ {t('admin.tabs.quizManagement')}\r\n            </Link>\r\n            <Link \r\n              to=\"/admin/categories\" \r\n              className=\"w-full text-left p-2 md:p-3 hover:bg-gray-50 rounded border block text-sm md:text-base\"\r\n            >\r\n              üìÇ {t('admin.tabs.categoryManagement')}\r\n            </Link>\r\n            <Link \r\n              to=\"/admin/quiz-stats\" \r\n              className=\"w-full text-left p-2 md:p-3 hover:bg-gray-50 rounded border block text-sm md:text-base\"\r\n            >\r\n              üìä {t('admin.stats.quizActivity')}\r\n            </Link>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6\">\r\n          <h3 className=\"text-base md:text-lg font-semibold text-gray-900 mb-3 md:mb-4\">{t('admin.tabs.userManagement')}</h3>\r\n          <div className=\"space-y-2\">\r\n            <Link \r\n              to=\"/admin/users\" \r\n              className=\"w-full text-left p-2 md:p-3 hover:bg-gray-50 rounded border block text-sm md:text-base\"\r\n            >\r\n              üë• {t('admin.tabs.users')}\r\n            </Link>\r\n            <Link \r\n              to=\"/admin/roles\" \r\n              className=\"w-full text-left p-2 md:p-3 hover:bg-gray-50 rounded border block text-sm md:text-base\"\r\n            >\r\n              üîê {t('admin.roles')}\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Quick Actions - Enhanced Design */}\r\n      <div className=\"bg-white rounded-lg shadow-md p-4 md:p-6 border border-gray-200\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n            <h2 className=\"text-lg md:text-xl font-semibold text-gray-900 flex items-center\">\r\n            <span className=\"bg-blue-100 p-2 rounded-lg mr-3\">‚ö°</span>\r\n              {t('admin.quickActions.title')}\r\n          </h2>\r\n          <span className=\"text-sm text-gray-500\">{t('admin.quickActions.important')}</span>\r\n        </div>\r\n        \r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4\">\r\n          <button \r\n            onClick={() => setShowNotificationModal(true)}\r\n            className=\"group bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-md hover:shadow-lg\"\r\n            disabled={loading}\r\n          >\r\n            <div className=\"flex flex-col items-center space-y-2\">\r\n              <span className=\"text-2xl group-hover:scale-110 transition-transform\">üì¢</span>\r\n              <span className=\"text-sm font-medium\">{t('admin.quickActions.items.notify.title')}</span>\r\n            </div>\r\n          </button>\r\n          \r\n          <button \r\n            onClick={deleteNotifications}\r\n            className=\"group bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white p-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-md hover:shadow-lg\"\r\n            disabled={loading}\r\n          >\r\n            <div className=\"flex flex-col items-center space-y-2\">\r\n              <span className=\"text-2xl group-hover:scale-110 transition-transform\">‚ùå</span>\r\n              <span className=\"text-sm font-medium\">{t('admin.quickActions.items.deleteNotifications.title')}</span>\r\n            </div>\r\n          </button>\r\n          \r\n          <button \r\n            onClick={backupData}\r\n            className=\"group bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white p-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-md hover:shadow-lg\"\r\n            disabled={loading}\r\n          >\r\n            <div className=\"flex flex-col items-center space-y-2\">\r\n              <span className=\"text-2xl group-hover:scale-110 transition-transform\">üíæ</span>\r\n              <span className=\"text-sm font-medium\">{t('admin.quickActions.items.backup.title')}</span>\r\n            </div>\r\n          </button>\r\n          \r\n          <button \r\n            onClick={cleanupDeletedData}\r\n            className=\"group bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white p-4 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 shadow-md hover:shadow-lg\"\r\n            disabled={loading}\r\n          >\r\n            <div className=\"flex flex-col items-center space-y-2\">\r\n              <span className=\"text-2xl group-hover:scale-110 transition-transform\">üóëÔ∏è</span>\r\n              <span className=\"text-sm font-medium\">{t('admin.quickActions.items.cleanup.title')}</span>\r\n            </div>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modal g·ª≠i th√¥ng b√°o - Responsive */}\r\n      {showNotificationModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white rounded-lg p-4 md:p-6 w-full max-w-md mx-4\">\r\n            <h2 className=\"text-lg md:text-xl font-semibold mb-4\">{t('admin.quickActions.modal.title')}</h2>\r\n            \r\n            <div className=\"space-y-4\">\r\n              {/* N·ªôi dung th√¥ng b√°o */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('admin.quickActions.modal.contentLabel')}</label>\r\n                <textarea\r\n                  value={notificationData.message}\r\n                  onChange={(e) => setNotificationData(prev => ({ ...prev, message: e.target.value }))}\r\n                  placeholder={t('admin.quickActions.modal.contentPlaceholder')}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base\"\r\n                  rows={4}\r\n                />\r\n              </div>\r\n\r\n              {/* Lo·∫°i th√¥ng b√°o */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('admin.quickActions.modal.typeLabel')}</label>\r\n                <select\r\n                  value={notificationData.type}\r\n                  onChange={(e) => setNotificationData(prev => ({ ...prev, type: e.target.value as any }))}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base\"\r\n                >\r\n                  <option value=\"info\">{t('admin.quickActions.modal.type.info')}</option>\r\n                  <option value=\"warning\">{t('admin.quickActions.modal.type.warning')}</option>\r\n                  <option value=\"success\">{t('admin.quickActions.modal.type.success')}</option>\r\n                  <option value=\"error\">{t('admin.quickActions.modal.type.error')}</option>\r\n                </select>\r\n              </div>\r\n\r\n              {/* ƒê·ªëi t∆∞·ª£ng nh·∫≠n th√¥ng b√°o */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t('admin.quickActions.modal.targetLabel')}</label>\r\n                <select\r\n                  value={notificationData.targetRole}\r\n                  onChange={(e) => setNotificationData(prev => ({ ...prev, targetRole: e.target.value as any }))}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base\"\r\n                >\r\n                  <option value=\"all\">{t('admin.quickActions.modal.target.all')}</option>\r\n                  <option value=\"user\">{t('admin.quickActions.modal.target.user')}</option>\r\n                  <option value=\"creator\">{t('admin.quickActions.modal.target.creator')}</option>\r\n                </select>\r\n              </div>\r\n\r\n              {/* Buttons */}\r\n              <div className=\"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 pt-4\">\r\n                <button\r\n                  onClick={() => setShowNotificationModal(false)}\r\n                  className=\"w-full sm:w-auto px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors text-sm md:text-base\"\r\n                  disabled={loading}\r\n                >\r\n                  {t('cancel')}\r\n                </button>\r\n                <button\r\n                  onClick={createSystemNotification}\r\n                  disabled={loading || !notificationData.message.trim()}\r\n                  className=\"w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm md:text-base\"\r\n                >\r\n                  {loading ? t('admin.quickActions.modal.sending') : t('admin.quickActions.modal.send')}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </AdminLayout>\r\n  );\r\n};\r\n\r\nexport default Admin;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\pages\\AdminDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[835,838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[835,838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1050,1053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1050,1053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1099,1102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1099,1102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1794,1797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1794,1797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4004,4007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4004,4007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                Role\r\n              </th>","line":402,"column":110,"nodeType":"JSXText","endLine":404,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                Thao t√°c\r\n              </th>","line":407,"column":110,"nodeType":"JSXText","endLine":409,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":426,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":426,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14509,14512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14509,14512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"user\">User</option>","line":429,"column":42,"nodeType":"JSXText","endLine":429,"endColumn":46},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"inline-flex items-center gap-1 px-1.5 py-0.5 bg-emerald-50 rounded\">\r\n                            üìö {quiz.learningResources.length} t√†i li·ªáu\r\n                          </span>","line":509,"column":63,"nodeType":"JSXText","endLine":510,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":511,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":511,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19106,19109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19106,19109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-red-600\">‚ö†Ô∏è</span>","line":512,"column":60,"nodeType":"JSXText","endLine":512,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <a href=\"/admin/quiz-stats\" className=\"underline font-bold ml-1 hover:text-white\">\r\n                    ‚û§ {t('admin.dashboard.viewSeparateStatsPage')}\r\n                  </a>","line":704,"column":101,"nodeType":"JSXText","endLine":705,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-xl font-bold text-gray-900\">Admin Dashboard</h1>","line":726,"column":63,"nodeType":"JSXText","endLine":726,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-gray-500\">\r\n                  C·∫≠p nh·∫≠t: {lastUpdate.toLocaleTimeString()}\r\n                </div>","line":761,"column":56,"nodeType":"JSXText","endLine":762,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"bg-blue-100 p-2 text-xs text-blue-800 border-b\">\r\n            üîß Debug: activeTab = \"{activeTab}\" | T·∫•t c·∫£ tabs: dashboard, users, quizzes, categories\r\n          </div>","line":777,"column":75,"nodeType":"JSXText","endLine":778,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"bg-blue-100 p-2 text-xs text-blue-800 border-b\">\r\n            üîß Debug: activeTab = \"{activeTab}\" | T·∫•t c·∫£ tabs: dashboard, users, quizzes, categories\r\n          </div>","line":778,"column":47,"nodeType":"JSXText","endLine":779,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\n// import { useSelector, useDispatch } from 'react-redux';\r\nimport { useTranslation } from 'react-i18next';\r\n// import { RootState } from '../../../lib/store';\r\n// import { logout } from '../../auth/store';\r\n// import { signOut } from 'firebase/auth';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { \r\n  collection, \r\n  getDocs, \r\n  doc, \r\n  updateDoc, \r\n  deleteDoc, \r\n  addDoc,\r\n  query,\r\n  orderBy\r\n} from 'firebase/firestore';\r\nimport Modal from '../../../shared/components/ui/Modal';\r\nimport QuickActions from '../components/QuickActions';\r\nimport AdminStats from '../components/AdminStats';\r\nimport { toast } from 'react-toastify';\r\n\r\ninterface User {\r\n  id: string;\r\n  email: string;\r\n  displayName: string;\r\n  role: 'user' | 'admin' | 'creator';\r\n  createdAt: any;\r\n  isActive: boolean;\r\n}\r\n\r\ninterface Quiz {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  createdBy: string;\r\n  status: 'pending' | 'approved' | 'rejected' | 'draft' | 'published';\r\n  createdAt: any;\r\n  category: string;\r\n  learningResources?: any[]; // T√†i li·ªáu h·ªçc t·∫≠p\r\n}\r\n\r\ninterface Category {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  quizCount: number;\r\n}\r\n\r\nconst AdminDashboard: React.FC = () => {\r\n  const { t } = useTranslation();\r\n  // const navigate = useNavigate();\r\n  // const { user } = useSelector((state: RootState) => state.auth);\r\n  // const dispatch = useDispatch();\r\n  \r\n  // States\r\n  const [activeTab, setActiveTab] = useState('dashboard');\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [quizzes, setQuizzes] = useState<Quiz[]>([]);\r\n  const [categories, setCategories] = useState<Category[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [stats, setStats] = useState<any>(null);\r\n\r\n  // Function to calculate and update stats from actual data\r\n  const updateStatsFromData = (users: User[], quizzes: Quiz[]) => {\r\n    // Count ALL users (including admins for admin dashboard)\r\n    const totalUsers = users.length;\r\n    \r\n    // Count ALL quizzes regardless of status\r\n    const totalQuizzes = quizzes.length;\r\n    \r\n    // Count quizzes by status for meaningful metrics\r\n    const approvedQuizzes = quizzes.filter(q => q.status === 'approved').length;\r\n    const publishedQuizzes = quizzes.filter(q => q.status === 'published').length;\r\n    const pendingQuizzes = quizzes.filter(q => q.status === 'pending').length;\r\n    const completedQuizzes = approvedQuizzes + publishedQuizzes; // Available for users\r\n    \r\n    // Calculate creators more accurately\r\n    const creatorRoleUsers = users.filter(u => u.role === 'creator').length;\r\n    const quizCreatorIds = new Set(quizzes.map(q => q.createdBy).filter(Boolean));\r\n    const totalCreators = Math.max(creatorRoleUsers, quizCreatorIds.size);\r\n    \r\n    const newStats = {\r\n      totalUsers: totalUsers,\r\n      totalQuizzes: totalQuizzes,\r\n      completedQuizzes: completedQuizzes,\r\n      totalCreators: totalCreators\r\n    };\r\n    \r\n    setStats(newStats);\r\n    \r\n    console.log('üìä DETAILED Stats calculation:', {\r\n      totalUsersInDB: users.length,\r\n      adminUsers: users.filter(u => u.role === 'admin').length,\r\n      creatorUsers: users.filter(u => u.role === 'creator').length,\r\n      normalUsers: users.filter(u => u.role === 'user').length,\r\n      totalQuizzesInDB: quizzes.length,\r\n      approvedQuizzes: approvedQuizzes,\r\n      publishedQuizzes: publishedQuizzes,\r\n      pendingQuizzes: pendingQuizzes,\r\n      creatorRoleUsers: creatorRoleUsers,\r\n      quizCreatorIds: quizCreatorIds.size,\r\n      finalStats: newStats\r\n    });\r\n  };\r\n\r\n  // New category form\r\n  const [newCategory, setNewCategory] = useState({ name: '', description: '' });\r\n  const [showAddCategory, setShowAddCategory] = useState(false);\r\n\r\n  // State cho modal x√°c nh·∫≠n\r\n  const [confirmModal, setConfirmModal] = useState<{\r\n    open: boolean;\r\n    type: null | 'deleteUser' | 'deleteQuiz' | 'deleteCategory' | 'toggleUserStatus';\r\n    payload?: any;\r\n    message?: string;\r\n  }>({ open: false, type: null });\r\n\r\n  // State for last update time\r\n  const [lastUpdate, setLastUpdate] = useState<Date | null>(null);\r\n\r\n  useEffect(() => {\r\n    const loadRealData = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const [usersData, quizzesData, categoriesData] = await Promise.all([\r\n          loadUsersData(),\r\n          loadQuizzesData(),\r\n          loadCategoriesData(),\r\n        ]);\r\n        setUsers(usersData);\r\n        setQuizzes(quizzesData);\r\n        setCategories(categoriesData);\r\n        updateStatsFromData(usersData, quizzesData);\r\n        setLastUpdate(new Date());\r\n      } catch (error) {\r\n        console.error('Error loading data:', error);\r\n        toast.error(t('admin.dataLoadError'));\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadRealData();\r\n\r\n    const interval = setInterval(loadRealData, 30000);\r\n    return () => clearInterval(interval);\r\n  }, [t]);\r\n\r\n  // Data loading functions that return data instead of updating state\r\n  const loadUsersData = async (): Promise<User[]> => {\r\n    try {\r\n      const usersQuery = query(collection(db, 'users'), orderBy('createdAt', 'desc'));\r\n      const snapshot = await getDocs(usersQuery);\r\n      const usersData = snapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      } as User));\r\n      console.log('Loaded users:', usersData.length);\r\n      return usersData;\r\n    } catch (error) {\r\n      console.error('Error loading users:', error);\r\n      return []; // Return empty array on error\r\n    }\r\n  };\r\n\r\n  const loadQuizzesData = async (): Promise<Quiz[]> => {\r\n    try {\r\n      const quizzesQuery = query(collection(db, 'quizzes'), orderBy('createdAt', 'desc'));\r\n      const snapshot = await getDocs(quizzesQuery);\r\n      const quizzesData = snapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      } as Quiz));\r\n      console.log('Loaded quizzes:', quizzesData.length);\r\n      return quizzesData;\r\n    } catch (error) {\r\n      console.error('Error loading quizzes:', error);\r\n      return []; // Return empty array on error\r\n    }\r\n  };\r\n\r\n  const loadCategoriesData = async (): Promise<Category[]> => {\r\n    try {\r\n      const categoriesQuery = query(collection(db, 'categories'), orderBy('name'));\r\n      const snapshot = await getDocs(categoriesQuery);\r\n      const categoriesData = snapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      } as Category));\r\n      console.log('Loaded categories:', categoriesData.length);\r\n      return categoriesData;\r\n    } catch (error) {\r\n      console.error('Error loading categories:', error);\r\n      return []; // Return empty array on error\r\n    }\r\n  };\r\n\r\n  const loadData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      // Load all data concurrently\r\n      const [usersData, quizzesData, categoriesData] = await Promise.all([\r\n        loadUsersData(),\r\n        loadQuizzesData(),\r\n        loadCategoriesData()\r\n      ]);\r\n      \r\n      // Update state with actual data\r\n      setUsers(usersData);\r\n      setQuizzes(quizzesData);\r\n      setCategories(categoriesData);\r\n      \r\n      // Update stats from actual data\r\n      updateStatsFromData(usersData, quizzesData);\r\n      \r\n      setLastUpdate(new Date());\r\n      console.log('Data refreshed at:', new Date().toLocaleTimeString());\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n      toast.error(t('admin.dataLoadError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const updateUserRole = async (userId: string, newRole: 'user' | 'admin') => {\r\n    try {\r\n      await updateDoc(doc(db, 'users', userId), { role: newRole });\r\n      await loadData();\r\n      toast.success(t('admin.roleUpdateSuccess'));\r\n    } catch (error) {\r\n      console.error('Error updating user role:', error);\r\n      toast.error(t('admin.roleUpdateError'));\r\n    }\r\n  };\r\n\r\n  const toggleUserStatus = async (userId: string, currentStatus: boolean) => {\r\n    setLoading(true);\r\n    try {\r\n      await updateDoc(doc(db, 'users', userId), { isActive: !currentStatus });\r\n      await loadData();\r\n      toast.success(t('admin.userStatusUpdateSuccess', {action: !currentStatus ? t('admin.activated') : t('admin.deactivated')}));\r\n    } catch (error) {\r\n      console.error('Error updating user status:', error);\r\n      toast.error(t('admin.statusUpdateError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const deleteUser = async (userId: string) => {\r\n    setLoading(true);\r\n    try {\r\n      await deleteDoc(doc(db, 'users', userId));\r\n      await loadData();\r\n      toast.success(t('admin.userDeleteSuccess'));\r\n    } catch (error) {\r\n      console.error('Error deleting user:', error);\r\n      toast.error(t('admin.userDeleteError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const approveQuiz = async (quizId: string) => {\r\n    setLoading(true);\r\n    try {\r\n      await updateDoc(doc(db, 'quizzes', quizId), { status: 'approved' });\r\n      await loadData();\r\n      toast.success(t('admin.quizApproved'));\r\n    } catch (error) {\r\n      console.error('Error approving quiz:', error);\r\n      toast.error(t('admin.quizApprovalError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const rejectQuiz = async (quizId: string) => {\r\n    setLoading(true);\r\n    try {\r\n      await updateDoc(doc(db, 'quizzes', quizId), { status: 'rejected' });\r\n      await loadData();\r\n      toast.success(t('admin.quizRejected'));\r\n    } catch (error) {\r\n      console.error('Error rejecting quiz:', error);\r\n      toast.error(t('admin.quizRejectionError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const reopenQuiz = async (quizId: string) => {\r\n    setLoading(true);\r\n    try {\r\n      await updateDoc(doc(db, 'quizzes', quizId), { status: 'pending' });\r\n      await loadData();\r\n      toast.success(t('admin.quizReopened'));\r\n    } catch (error) {\r\n      console.error('Error reopening quiz:', error);\r\n      toast.error(t('admin.quizReopenError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const deleteQuiz = async (quizId: string) => {\r\n    setLoading(true);\r\n    try {\r\n      await deleteDoc(doc(db, 'quizzes', quizId));\r\n      await loadData();\r\n      toast.success(t('quiz.deleteSuccess'));\r\n    } catch (error) {\r\n      console.error('Error deleting quiz:', error);\r\n      toast.error(t('quiz.deleteError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const addCategory = async () => {\r\n    if (!newCategory.name.trim()) {\r\n      toast.error(t('admin.categories.enterName'));\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      await addDoc(collection(db, 'categories'), {\r\n        name: newCategory.name,\r\n        description: newCategory.description,\r\n        createdAt: new Date()\r\n      });\r\n      \r\n      setNewCategory({ name: '', description: '' });\r\n      setShowAddCategory(false);\r\n      await loadData();\r\n      toast.success(t('admin.categories.addSuccess'));\r\n    } catch (error) {\r\n      console.error('Error adding category:', error);\r\n      toast.error(t('admin.categories.addError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const deleteCategory = async (categoryId: string) => {\r\n    setLoading(true);\r\n    try {\r\n      await deleteDoc(doc(db, 'categories', categoryId));\r\n      await loadData();\r\n      toast.success(t('admin.categories.deleteSuccess'));\r\n    } catch (error) {\r\n      console.error('Error deleting category:', error);\r\n      toast.error(t('admin.categories.deleteError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const renderDashboard = () => {\r\n    console.log('Rendering dashboard with stats:', stats);\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        {/* Alert */}\r\n        <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center\">\r\n            <span className=\"text-2xl mr-3\">‚úÖ</span>\r\n            <div>\r\n              <h3 className=\"font-semibold text-green-800\">{t('admin.viewingStatsSection')}</h3>\r\n              <p className=\"text-green-700 text-sm\">{t('admin.advancedStatsDescription')}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Advanced Stats synced with real data */}\r\n        <AdminStats key={lastUpdate?.getTime() || 'initial'} />\r\n        \r\n        {/* Quick Actions */}\r\n        <QuickActions \r\n          onRefreshData={loadData}\r\n          stats={stats}\r\n        />\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderUsers = () => (\r\n    <div className=\"bg-white rounded-lg shadow overflow-hidden\">\r\n      <div className=\"px-6 py-4 border-b border-gray-200\">\r\n        <h3 className=\"text-lg font-semibold\">{t('admin.userManagement')}</h3>\r\n      </div>\r\n      \r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full divide-y divide-gray-200\">\r\n          <thead className=\"bg-gray-50\">\r\n            <tr>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">{t(\"admin.tabs.users\")}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">{t(\"auth.email\")}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                Role\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">{t(\"admin.preview.status\")}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                Thao t√°c\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"bg-white divide-y divide-gray-200\">\r\n            {users.map((user) => (\r\n              <tr key={user.id}>\r\n                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                  <div className=\"font-medium text-gray-900\">\r\n                    {user.displayName || 'Ch∆∞a c√≥ t√™n'}\r\n                  </div>\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\r\n                  {user.email}\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                  <select\r\n                    value={user.role}\r\n                    onChange={(e) => updateUserRole(user.id, e.target.value as any)}\r\n                    className=\"border border-gray-300 rounded px-2 py-1 text-sm\"\r\n                  >\r\n                    <option value=\"user\">User</option>\r\n                    <option value=\"admin\">{t(\"admin.quizManagement.adminBadge\")}</option>\r\n                  </select>\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                  <span className={`px-2 py-1 text-xs rounded-full ${\r\n                    user.isActive !== false ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'\r\n                  }`}>\r\n                    {user.isActive !== false ? t('admin.userStatus.active') : t('admin.userStatus.blocked')}\r\n                  </span>\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2\">\r\n                  <button\r\n                    onClick={() => setConfirmModal({ open: true, type: 'toggleUserStatus', payload: { userId: user.id, currentStatus: user.isActive !== false }, message: user.isActive !== false ? t('admin.confirmations.lockUser') : t('admin.confirmations.unlockUser') })}\r\n                    className={`px-3 py-1 rounded text-xs ${user.isActive !== false ? 'bg-red-100 text-red-600 hover:bg-red-200' : 'bg-green-100 text-green-600 hover:bg-green-200'}`}\r\n                  >\r\n                    {user.isActive !== false ? t('admin.userStatus.lockButton') : t('admin.userStatus.unlockButton')}\r\n                  </button>\r\n                  \r\n                  {user.email !== 'admin123@gmail.com' && (\r\n                    <button\r\n                      onClick={() => setConfirmModal({ open: true, type: 'deleteUser', payload: { userId: user.id }, message: t('admin.confirmations.deleteUser') })}\r\n                      className=\"px-3 py-1 bg-red-100 text-red-600 rounded text-xs hover:bg-red-200\"\r\n                    >{t(\"action.clear\")}\r\n                    </button>\r\n                  )}\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderQuizzes = () => (\r\n    <div className=\"space-y-6\" data-testid=\"quiz-review-system\">\r\n        {/* Alert */}\r\n      <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\r\n        <div className=\"flex items-center\">\r\n          <span className=\"text-2xl mr-3\">üìù</span>\r\n          <div>\r\n            <h3 className=\"font-semibold text-yellow-800\">{t('admin.quizManagement.label')}</h3>\r\n            <p className=\"text-yellow-700 text-sm\">{t('admin.tabs.quizzes')}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"bg-white rounded-lg shadow overflow-hidden\">\r\n        <div className=\"px-6 py-4 border-b border-gray-200\">\r\n          <h3 className=\"text-lg font-semibold\">{t('admin.quizManagement.label')}</h3>\r\n        </div>\r\n        \r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full divide-y divide-gray-200\">\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  {t('admin.quizManagement.table.title')}\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  {t('quiz.description')}\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  {t('status.pending')}\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  {t('action.action')}\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n              {quizzes.map((quiz) => (\r\n                <tr key={quiz.id}>\r\n                  <td className=\"px-6 py-4 font-medium text-gray-900\">\r\n                    <div>\r\n                      <div className=\"font-medium\">{quiz.title}</div>\r\n                      {quiz.learningResources && quiz.learningResources.length > 0 && (\r\n                        <div className=\"flex items-center gap-1.5 mt-1 text-xs text-emerald-600\">\r\n                          <span className=\"inline-flex items-center gap-1 px-1.5 py-0.5 bg-emerald-50 rounded\">\r\n                            üìö {quiz.learningResources.length} t√†i li·ªáu\r\n                          </span>\r\n                          {quiz.learningResources.some((r: any) => r.required) && (\r\n                            <span className=\"text-red-600\">‚ö†Ô∏è</span>\r\n                          )}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"px-6 py-4 text-sm text-gray-600 max-w-xs truncate\">\r\n                    {quiz.description}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                    <span className={`px-2 py-1 text-xs rounded-full ${\r\n                      quiz.status === 'approved' ? 'bg-green-100 text-green-800' :\r\n                      quiz.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :\r\n                      'bg-red-100 text-red-800'\r\n                    }`}>\r\n                       {quiz.status === 'approved' ? t('status.approved') :\r\n                        quiz.status === 'pending' ? t('status.pending') : t('status.rejected')}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2\">\r\n                    {quiz.status === 'pending' && (\r\n                      <>\r\n                        <button\r\n                          onClick={() => approveQuiz(quiz.id)}\r\n                          className=\"px-3 py-1 bg-green-100 text-green-600 rounded text-xs hover:bg-green-200\"\r\n                        >\r\n                          {t('action.approve')}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => rejectQuiz(quiz.id)}\r\n                          className=\"px-3 py-1 bg-yellow-100 text-yellow-600 rounded text-xs hover:bg-yellow-200\"\r\n                        >\r\n                          {t('action.reject')}\r\n                        </button>\r\n                      </>\r\n                    )}\r\n                    \r\n                    {quiz.status === 'rejected' && (\r\n                      <button\r\n                        onClick={() => reopenQuiz(quiz.id)}\r\n                        className=\"px-3 py-1 bg-blue-100 text-blue-600 rounded text-xs hover:bg-blue-200\"\r\n                      >\r\n                         {t('admin.quizManagement.tooltips.reopen')}\r\n                      </button>\r\n                    )}\r\n                    \r\n                    <button\r\n                       onClick={() => setConfirmModal({ open: true, type: 'deleteQuiz', payload: { quizId: quiz.id }, message: t('quiz.confirmDelete') })}\r\n                      className=\"px-3 py-1 bg-red-100 text-red-600 rounded text-xs hover:bg-red-200\"\r\n                    >\r\n                      {t('delete')}\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderCategories = () => (\r\n    <div className=\"space-y-6\">\r\n      {/* Add Category Button */}\r\n      <div className=\"bg-white p-6 rounded-lg shadow\">\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <h3 className=\"text-lg font-semibold\">{t('admin.categoryManagement')}</h3>\r\n          <button\r\n            onClick={() => setShowAddCategory(!showAddCategory)}\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n          >\r\n            {t('categories.add')}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Add Category Form */}\r\n        {showAddCategory && (\r\n          <div className=\"border-t pt-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder={t('categories.name')}\r\n                value={newCategory.name}\r\n                onChange={(e) => setNewCategory(prev => ({ ...prev, name: e.target.value }))}\r\n                className=\"border border-gray-300 rounded px-3 py-2\"\r\n              />\r\n              <input\r\n                type=\"text\"\r\n                placeholder={t('categories.description')}\r\n                value={newCategory.description}\r\n                onChange={(e) => setNewCategory(prev => ({ ...prev, description: e.target.value }))}\r\n                className=\"border border-gray-300 rounded px-3 py-2\"\r\n              />\r\n            </div>\r\n            <div className=\"mt-4 space-x-2\">\r\n              <button\r\n                onClick={addCategory}\r\n                className=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700\"\r\n              >\r\n                {t('save')}\r\n              </button>\r\n              <button\r\n                onClick={() => {\r\n                  setShowAddCategory(false);\r\n                  setNewCategory({ name: '', description: '' });\r\n                }}\r\n                className=\"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n              >\r\n                {t('cancel')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Categories List */}\r\n      <div className=\"bg-white rounded-lg shadow overflow-hidden\">\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full divide-y divide-gray-200\">\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  {t('categories.name')}\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  {t('categories.description')}\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  {t('categories.quizCount')}\r\n                </th>\r\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                  {t('action.action')}\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n              {categories.map((category) => (\r\n                <tr key={category.id}>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap font-medium text-gray-900\">\r\n                    {category.name}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 text-sm text-gray-600\">\r\n                    {category.description}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\r\n                    {category.quizCount || 0}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                    <button\r\n                       onClick={() => setConfirmModal({ open: true, type: 'deleteCategory', payload: { categoryId: category.id }, message: t('categories.confirmDelete') })}\r\n                      className=\"px-3 py-1 bg-red-100 text-red-600 rounded text-xs hover:bg-red-200\"\r\n                    >\r\n                      {t('delete')}\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  /*\r\n  const handleLogout = async () => {\r\n    try {\r\n      await auth.signOut();\r\n      navigate('/admin/login');\r\n    } catch (err)      console.error(\"Logout failed\", err);\r\n    }\r\n  };\r\n  */\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center h-screen\">\r\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-red-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">{/* Notice Banner */}\r\n      <div className=\"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-4\">\r\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between\">            <div className=\"flex items-center gap-3\">\r\n              <span className=\"text-2xl\">üìä</span>\r\n              <div>\r\n                <h3 className=\"font-bold\">{t('admin.dashboard.viewStatsChart')}</h3>\r\n                <p className=\"text-blue-100 text-sm\">\r\n                  {t('admin.dashboard.clickOverviewTab')}{' '}\r\n                  <a href=\"/admin/quiz-stats\" className=\"underline font-bold ml-1 hover:text-white\">\r\n                    ‚û§ {t('admin.dashboard.viewSeparateStatsPage')}\r\n                  </a>\r\n                </p>\r\n              </div>\r\n            </div>\r\n          <div className=\"text-right\">\r\n            <p className=\"text-sm text-blue-100\">{t('admin.currentTab')}: <span className=\"font-bold text-white\">{activeTab}</span></p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Header */}\r\n      <header className=\"bg-white shadow-sm border-b border-gray-200\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"flex justify-between items-center h-16\">\r\n            <div className=\"flex items-center\">\r\n              <div className=\"h-8 w-8 bg-gradient-to-r from-red-500 to-red-600 rounded-lg flex items-center justify-center mr-3\">\r\n                <svg className=\"w-5 h-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\" />\r\n                </svg>\r\n              </div>\r\n              <h1 className=\"text-xl font-bold text-gray-900\">Admin Dashboard</h1>\r\n            </div>\r\n            \r\n            <div className=\"flex items-center space-x-4\">\r\n              <a\r\n                href=\"/admin/quiz-stats\"\r\n                className=\"bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-purple-700 transition-colors duration-200 flex items-center space-x-2\"\r\n                title={t('admin.dashboard.viewSeparateStatsPageTitle')}\r\n              >\r\n                <span>üìä</span>\r\n                <span>{t('admin.dashboard.separateStats')}</span>\r\n              </a>\r\n              <button\r\n                onClick={() => {\r\n                  console.log('Force switching to dashboard');\r\n                  setActiveTab('dashboard');\r\n                }}\r\n                className=\"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors duration-200 flex items-center space-x-2\"\r\n                title={t('admin.dashboard.forceOverviewTab')}\r\n              >\r\n                <span>üìä</span>\r\n                <span>{t(\"admin.tabs.overview\")}</span>\r\n              </button>\r\n              <button\r\n                onClick={loadData}\r\n                disabled={loading}\r\n                className=\"bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-green-700 transition-colors duration-200 disabled:opacity-50 flex items-center space-x-2\"\r\n                title=\"C·∫≠p nh·∫≠t d·ªØ li·ªáu\"\r\n              >\r\n                <svg className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\r\n                </svg>\r\n                <span>{t(\"refresh\")}</span>\r\n              </button>\r\n              {lastUpdate && (\r\n                <div className=\"text-xs text-gray-500\">\r\n                  C·∫≠p nh·∫≠t: {lastUpdate.toLocaleTimeString()}\r\n                </div>\r\n              )}\r\n              <div className=\"text-sm text-gray-600\">\r\n                {t('admin.greeting')}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Navigation Tabs */}\r\n      <div className=\"bg-white border-b border-gray-200\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          {/* Debug Panel */}\r\n          <div className=\"bg-blue-100 p-2 text-xs text-blue-800 border-b\">\r\n            üîß Debug: activeTab = \"{activeTab}\" | T·∫•t c·∫£ tabs: dashboard, users, quizzes, categories\r\n          </div>\r\n          \r\n          <nav className=\"flex space-x-8\">\r\n            {[\r\n              { id: 'dashboard', label: t('admin.tabs.overview'), icon: 'üìä' },\r\n              { id: 'users', label: t('admin.tabs.users'), icon: 'üë•' },\r\n              { id: 'quizzes', label: t('admin.tabs.quizzes'), icon: 'üìù' },\r\n              { id: 'categories', label: t('admin.tabs.categories'), icon: 'üìÇ' }\r\n            ].map((tab) => (\r\n              <button\r\n                key={tab.id}\r\n                onClick={() => {\r\n                  setActiveTab(tab.id);\r\n                }}\r\n                className={`py-4 px-3 border-b-2 font-medium text-sm transition-colors duration-200 ${\r\n                  activeTab === tab.id\r\n                    ? 'border-red-500 text-red-600 bg-red-50'\r\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50'\r\n                } ${tab.id === 'dashboard' ? 'ring-2 ring-blue-300' : ''}`}\r\n                title={`Chuy·ªÉn ƒë·∫øn tab ${tab.label}`}\r\n              >\r\n                <span className=\"mr-2 text-lg\">{tab.icon}</span>\r\n                <span className=\"font-semibold\">{tab.label}</span>\r\n              </button>\r\n            ))}\r\n          </nav>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        {/* Tab Banner */}\r\n        <div className=\"mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h2 className=\"text-xl font-semibold text-blue-900\">\r\n              {activeTab === 'dashboard' && `üìä ${t('admin.tabs.overviewStats')}`}\r\n              {activeTab === 'users' && `üë• ${t('admin.tabs.userManagement')}`}\r\n              {activeTab === 'quizzes' && `üìù ${t('admin.tabs.quizManagement')}`}\r\n              {activeTab === 'categories' && `üìÇ ${t('admin.tabs.categoryManagement')}`}\r\n            </h2>\r\n            <div className=\"flex items-center gap-3\">\r\n              <span className=\"text-sm text-blue-600 bg-blue-100 px-3 py-1 rounded-full\">\r\n                {t('admin.currentTab')}\r\n              </span>\r\n              {activeTab !== 'dashboard' && (\r\n                <button\r\n                  onClick={() => setActiveTab('dashboard')}\r\n                  className=\"text-sm bg-blue-600 text-white px-3 py-1 rounded-full hover:bg-blue-700\"\r\n                >\r\n                  {t('admin.backToOverview')}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"flex justify-center items-center h-64\">\r\n            <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-red-600\"></div>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {console.log('Current active tab:', activeTab)}\r\n            {activeTab === 'dashboard' && renderDashboard()}\r\n            {activeTab === 'users' && renderUsers()}\r\n            {activeTab === 'quizzes' && renderQuizzes()}\r\n            {activeTab === 'categories' && renderCategories()}\r\n          </>\r\n        )}\r\n      </main>\r\n\r\n      {/* Modal x√°c nh·∫≠n thao t√°c */}\r\n      <Modal\r\n        isOpen={confirmModal.open}\r\n        onClose={() => setConfirmModal({ open: false, type: null })}\r\n        title={t('action.confirm')}\r\n      >\r\n        <div className=\"mb-4\">{confirmModal.message}</div>\r\n        <div className=\"flex justify-end space-x-2\">\r\n          <button\r\n            onClick={() => setConfirmModal({ open: false, type: null })}\r\n            className=\"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400\"\r\n            disabled={loading}\r\n          >\r\n            {t('cancel')}\r\n          </button>\r\n          <button\r\n            onClick={async () => {\r\n              if (confirmModal.type === 'deleteUser') await deleteUser(confirmModal.payload.userId);\r\n              if (confirmModal.type === 'deleteQuiz') await deleteQuiz(confirmModal.payload.quizId);\r\n              if (confirmModal.type === 'deleteCategory') await deleteCategory(confirmModal.payload.categoryId);\r\n              if (confirmModal.type === 'toggleUserStatus') await toggleUserStatus(confirmModal.payload.userId, confirmModal.payload.currentStatus);\r\n              setConfirmModal({ open: false, type: null });\r\n            }}\r\n            className=\"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700\"\r\n            disabled={loading}\r\n          >\r\n            {t('action.confirm')}\r\n          </button>\r\n        </div>\r\n      </Modal>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminDashboard;\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\pages\\AdminQuizManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1083,1086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1083,1086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1258,1261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1258,1261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1785,1788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1785,1788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2371,2374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2371,2374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6068,6071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6068,6071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7133,7136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7133,7136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":817,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":817,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32423,32426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32423,32426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs px-2 py-1 bg-red-100 text-red-700 rounded-full font-medium\">\r\n                            ‚ö†Ô∏è {t('admin.quizManagement.hasRequiredResources')}\r\n                          </span>","line":818,"column":112,"nodeType":"JSXText","endLine":819,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"font-medium text-gray-900 mb-2\">\r\n                            üìù Quiz: {request.quizTitle || t('admin.quizManagement.unknownQuiz')}\r\n                          </h5>","line":930,"column":74,"nodeType":"JSXText","endLine":931,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1028,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1028,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43757,43760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43757,43760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"px-2 py-0.5 bg-red-100 text-red-700 rounded-full font-medium\">\r\n                                    ‚ö†Ô∏è {t('admin.quizManagement.requiredBadge')}\r\n                                  </span>","line":1054,"column":114,"nodeType":"JSXText","endLine":1055,"endColumn":40},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>‚è±Ô∏è {t('admin.quizManagement.estimatedTime', { time: resource.estimatedTime })}</span>","line":1059,"column":41,"nodeType":"JSXText","endLine":1059,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1084,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1084,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47036,47039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47036,47039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1089,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1089,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47429,47432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47429,47432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { toast } from 'react-toastify';\r\nimport { useSelector } from 'react-redux';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { ROUTES } from '../../../config/routes';\r\nimport { \r\n  collection, \r\n  getDocs, \r\n  doc, \r\n  updateDoc, \r\n  deleteDoc, \r\n  addDoc,\r\n  query, \r\n  orderBy,\r\n  where,\r\n  serverTimestamp\r\n} from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { RootState } from '../../../lib/store';\r\nimport { \r\n  Search, \r\n  Eye, \r\n  Check, \r\n  X, \r\n  Trash2, \r\n  User,\r\n  BookOpen,\r\n  Clock,\r\n  BarChart3,\r\n  RotateCcw,\r\n  Edit3,\r\n  AlertCircle,\r\n  FileText,\r\n  Video,\r\n  Image as ImageIcon,\r\n  Music,\r\n  Link as LinkIcon,\r\n  Presentation\r\n} from 'lucide-react';\r\nimport SafeHTML from '../../../shared/components/ui/SafeHTML';\r\n\r\n\r\ninterface Quiz {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  status: 'pending' | 'approved' | 'rejected';\r\n  createdBy: string;\r\n  createdAt: Date;\r\n  questions: any[];\r\n  difficulty: 'easy' | 'medium' | 'hard';\r\n  category: string;\r\n  isPublic: boolean;\r\n  isPublished?: boolean;\r\n  editRequests?: EditRequest[];\r\n  learningResources?: any[]; // T√†i li·ªáu h·ªçc t·∫≠p\r\n}\r\n\r\ninterface EditRequest {\r\n  id: string;\r\n  requestedBy: string;\r\n  requestedAt: Date;\r\n  reason: string;\r\n  status: 'pending' | 'approved' | 'rejected';\r\n  reviewedBy?: string;\r\n  reviewedAt?: Date;\r\n}\r\n\r\nconst AdminQuizManagement: React.FC = () => {\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation();\r\n  const [quizzes, setQuizzes] = useState<Quiz[]>([]);\r\n  const [editRequests, setEditRequests] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [filterStatus, setFilterStatus] = useState<'all' | 'pending' | 'approved' | 'rejected'>('all');\r\n  const [activeTab, setActiveTab] = useState<'quizzes' | 'editRequests'>('quizzes');\r\n  const [showPreview, setShowPreview] = useState(false);\r\n  const [previewQuiz, setPreviewQuiz] = useState<Quiz | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n\r\n  // Helper function ƒë·ªÉ x·ª≠ l√Ω date t·ª´ Firestore\r\n  const parseFirestoreDate = (dateValue: any): Date => {\r\n    if (!dateValue) {\r\n      return new Date();\r\n    }\r\n    \r\n    // N·∫øu l√† Firestore Timestamp\r\n    if (dateValue && typeof dateValue.toDate === 'function') {\r\n      return dateValue.toDate();\r\n    }\r\n    \r\n    // N·∫øu l√† Date object\r\n    if (dateValue instanceof Date) {\r\n      return dateValue;\r\n    }\r\n    \r\n    // N·∫øu l√† string ho·∫∑c number\r\n    if (typeof dateValue === 'string' || typeof dateValue === 'number') {\r\n      const date = new Date(dateValue);\r\n      return isNaN(date.getTime()) ? new Date() : date;\r\n    }\r\n    \r\n    // N·∫øu l√† object c√≥ seconds (Firestore server timestamp)\r\n    if (dateValue && typeof dateValue === 'object' && dateValue.seconds) {\r\n      return new Date(dateValue.seconds * 1000);\r\n    }\r\n    \r\n    // Fallback\r\n    console.warn('Unknown date format:', dateValue);\r\n    return new Date();\r\n  };\r\n\r\n  const loadQuizzes = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      console.log('üîç Loading quizzes from Firestore (excluding drafts)...');\r\n      // üìù Filter out drafts - Admin should only see pending/approved/rejected quizzes\r\n      const q = query(\r\n        collection(db, 'quizzes'),\r\n        where('status', 'in', ['pending', 'approved', 'rejected']),\r\n        orderBy('createdAt', 'desc')\r\n      );\r\n      const querySnapshot = await getDocs(q);\r\n      \r\n      console.log('üìä Firestore response:', {\r\n        empty: querySnapshot.empty,\r\n        size: querySnapshot.size,\r\n        docs: querySnapshot.docs.length\r\n      });\r\n      \r\n      const loadedQuizzes: Quiz[] = [];\r\n      querySnapshot.forEach((doc) => {\r\n        const data = doc.data();\r\n        console.log('üìù Quiz data raw:', { \r\n          id: doc.id, \r\n          title: data.title, \r\n          status: data.status, \r\n          createdAt: data.createdAt,\r\n          createdAtType: typeof data.createdAt \r\n        });\r\n        \r\n        try {\r\n          loadedQuizzes.push({\r\n            id: doc.id,\r\n            title: data.title || 'Untitled Quiz',\r\n            description: data.description || '',\r\n            status: data.status || 'pending',\r\n            createdBy: data.createdBy || 'unknown',\r\n            createdAt: parseFirestoreDate(data.createdAt),\r\n            questions: data.questions || [],\r\n            difficulty: data.difficulty || 'easy',\r\n            category: data.category || 'general',\r\n            isPublic: data.isPublic || false,\r\n            isPublished: data.isPublished || false\r\n          });\r\n        } catch (error) {\r\n          console.error('Error parsing quiz:', doc.id, error);\r\n          // Skip invalid quiz\r\n        }\r\n      });\r\n      \r\n      console.log('‚úÖ Loaded quizzes:', loadedQuizzes.length);\r\n      setQuizzes(loadedQuizzes);\r\n      \r\n      // N·∫øu kh√¥ng c√≥ quiz, hi·ªÉn th·ªã empty state\r\n      if (loadedQuizzes.length === 0) {\r\n        console.log('‚ö†Ô∏è No quizzes found, showing empty state');\r\n        toast.info(t('admin.quizManagement.empty.noQuizzesInSystem'));\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå Error loading quizzes:', error);\r\n      setError(t('admin.quizManagement.errors.loadFailed'));\r\n      toast.error(t('admin.quizManagement.errors.loadFailed') + ': ' + error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [t]);\r\n\r\n  const loadEditRequests = useCallback(async () => {\r\n    try {\r\n      console.log('üîç Loading edit requests...');\r\n      \r\n      // First approach: Try with simple query and client-side filtering/sorting\r\n      const q = query(\r\n        collection(db, 'editRequests'),\r\n        where('status', '==', 'pending')\r\n      );\r\n      const querySnapshot = await getDocs(q);\r\n      \r\n      const loadedRequests: any[] = [];\r\n      querySnapshot.forEach((doc) => {\r\n        const data = doc.data();\r\n        loadedRequests.push({\r\n          id: doc.id,\r\n          ...data,\r\n          requestedAt: parseFirestoreDate(data.requestedAt)\r\n        });\r\n      });\r\n      \r\n      // Sort by requestedAt descending on client side\r\n      loadedRequests.sort((a, b) => {\r\n        const aTime = a.requestedAt ? new Date(a.requestedAt).getTime() : 0;\r\n        const bTime = b.requestedAt ? new Date(b.requestedAt).getTime() : 0;\r\n        return bTime - aTime;\r\n      });\r\n      \r\n      console.log('‚úÖ Loaded edit requests:', loadedRequests.length);\r\n      setEditRequests(loadedRequests);\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå Error loading edit requests:', error);\r\n      \r\n      // Fallback: Load all edit requests and filter client-side\r\n      try {\r\n        console.log('üîÑ Trying fallback approach...');\r\n        const fallbackQ = query(collection(db, 'editRequests'));\r\n        const fallbackSnapshot = await getDocs(fallbackQ);\r\n        \r\n        const allRequests: any[] = [];\r\n        fallbackSnapshot.forEach((doc) => {\r\n          const data = doc.data();\r\n          if (data.status === 'pending') {\r\n            allRequests.push({\r\n              id: doc.id,\r\n              ...data,\r\n              requestedAt: parseFirestoreDate(data.requestedAt)\r\n            });\r\n          }\r\n        });\r\n        \r\n        // Sort by requestedAt descending\r\n        allRequests.sort((a, b) => {\r\n          const aTime = a.requestedAt ? new Date(a.requestedAt).getTime() : 0;\r\n          const bTime = b.requestedAt ? new Date(b.requestedAt).getTime() : 0;\r\n          return bTime - aTime;\r\n        });\r\n        \r\n        console.log('‚úÖ Fallback loaded edit requests:', allRequests.length);\r\n        setEditRequests(allRequests);\r\n        \r\n      } catch (fallbackError) {\r\n        console.error('‚ùå Fallback also failed:', fallbackError);\r\n        setEditRequests([]);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadQuizzes();\r\n    loadEditRequests();\r\n  }, [loadQuizzes, loadEditRequests]);\r\n\r\n  const handleEdit = (quizId: string) => {\r\n    navigate(`/admin/edit-quiz/${quizId}`);\r\n  };\r\n\r\n  const handlePreview = (quiz: Quiz) => {\r\n    setPreviewQuiz(quiz);\r\n    setShowPreview(true);\r\n  };\r\n\r\n  const handleApprove = async (quizId: string) => {\r\n    try {\r\n      const quizRef = doc(db, 'quizzes', quizId);\r\n      await updateDoc(quizRef, {\r\n        status: 'approved',\r\n        isPublished: true,\r\n        approvedAt: new Date(),\r\n        approvedBy: user?.uid\r\n      });\r\n      \r\n      setQuizzes(prev => prev.map(quiz => \r\n        quiz.id === quizId \r\n          ? { ...quiz, status: 'approved' as const, isPublished: true }\r\n          : quiz\r\n      ));\r\n      \r\n      toast.success(t('admin.quizManagement.success.approved'));\r\n    } catch (error) {\r\n      console.error('Error approving quiz:', error);\r\n      toast.error(t('admin.quizManagement.errors.approveFailed'));\r\n    }\r\n  };\r\n\r\n  const handleReject = async (quizId: string) => {\r\n    try {\r\n      const quizRef = doc(db, 'quizzes', quizId);\r\n      await updateDoc(quizRef, {\r\n        status: 'rejected',\r\n        isPublished: false,\r\n        rejectedAt: new Date(),\r\n        rejectedBy: user?.uid\r\n      });\r\n      \r\n      setQuizzes(prev => prev.map(quiz => \r\n        quiz.id === quizId \r\n          ? { ...quiz, status: 'rejected' as const, isPublished: false }\r\n          : quiz\r\n      ));\r\n      \r\n      toast.success(t('admin.quizManagement.success.rejected'));\r\n    } catch (error) {\r\n      console.error('Error rejecting quiz:', error);\r\n      toast.error(t('admin.quizManagement.errors.rejectFailed'));\r\n    }\r\n  };\r\n\r\n  const handleApproveEditRequest = async (requestId: string, quizId: string) => {\r\n    try {\r\n      const editRequest = editRequests.find(req => req.id === requestId);\r\n      if (!editRequest) {\r\n        toast.error(t('admin.editRequests.errors.notFound'));\r\n        return;\r\n      }\r\n\r\n      // Update edit request status\r\n      const requestRef = doc(db, 'editRequests', requestId);\r\n      await updateDoc(requestRef, {\r\n        status: 'approved',\r\n        reviewedBy: user?.uid,\r\n        reviewedByName: user?.displayName || 'Admin',\r\n        reviewedAt: new Date()\r\n      });\r\n\r\n      // G·ª† QUIZ XU·ªêNG ƒê·ªÇ S·ª¨A: Set quiz status to draft v√† allow edit\r\n      const quizRef = doc(db, 'quizzes', quizId);\r\n      await updateDoc(quizRef, {\r\n        status: 'draft', // G·ª° quiz xu·ªëng draft ƒë·ªÉ s·ª≠a\r\n        isApproved: false, // B·ªè approved status\r\n        canEdit: true, // Cho ph√©p creator edit\r\n        editRequestApproved: true,\r\n        lastEditRequestApproved: new Date(),\r\n        approvedBy: user?.uid,\r\n        needsReApproval: true // Flag ƒë·ªÉ bi·∫øt quiz n√†y c·∫ßn ƒë∆∞·ª£c duy·ªát l·∫°i sau khi s·ª≠a\r\n      });\r\n\r\n      // Create notification for the creator\r\n      await addDoc(collection(db, 'notifications'), {\r\n        userId: editRequest.requestedBy,\r\n        type: 'edit_request_approved',\r\n        title: t('admin.editRequests.notifications.approvedTitle'),\r\n        message: t('admin.editRequests.notifications.approvedMessage', { \r\n          quizTitle: editRequest.quizTitle \r\n        }),\r\n        quizId: quizId,\r\n        createdAt: serverTimestamp(),\r\n        read: false\r\n      });\r\n\r\n      // Remove from edit requests list\r\n      setEditRequests(prev => prev.filter(req => req.id !== requestId));\r\n      \r\n      toast.success(t('admin.editRequests.success.approved', { \r\n        userName: editRequest.requestedByName || editRequest.requestedByEmail \r\n      }));\r\n    } catch (error) {\r\n      console.error('Error approving edit request:', error);\r\n      toast.error(t('admin.editRequests.errors.approveFailed'));\r\n    }\r\n  };\r\n\r\n  const handleRejectEditRequest = async (requestId: string) => {\r\n    try {\r\n      const editRequest = editRequests.find(req => req.id === requestId);\r\n      if (!editRequest) {\r\n        toast.error(t('admin.editRequests.errors.notFound'));\r\n        return;\r\n      }\r\n\r\n      const requestRef = doc(db, 'editRequests', requestId);\r\n      await updateDoc(requestRef, {\r\n        status: 'rejected',\r\n        reviewedBy: user?.uid,\r\n        reviewedByName: user?.displayName || 'Admin',\r\n        reviewedAt: new Date()\r\n      });\r\n\r\n      // Create notification for the creator\r\n      await addDoc(collection(db, 'notifications'), {\r\n        userId: editRequest.requestedBy,\r\n        type: 'edit_request_rejected', \r\n        title: t('admin.editRequests.notifications.rejectedTitle'),\r\n        message: t('admin.editRequests.notifications.rejectedMessage', { \r\n          quizTitle: editRequest.quizTitle \r\n        }),\r\n        quizId: editRequest.quizId,\r\n        createdAt: serverTimestamp(),\r\n        read: false\r\n      });\r\n\r\n      // Remove from edit requests list\r\n      setEditRequests(prev => prev.filter(req => req.id !== requestId));\r\n      \r\n      toast.success(t('admin.editRequests.success.rejected', { \r\n        userName: editRequest.requestedByName || editRequest.requestedByEmail \r\n      }));\r\n    } catch (error) {\r\n      console.error('Error rejecting edit request:', error);\r\n      toast.error(t('admin.editRequests.errors.rejectFailed'));\r\n    }\r\n  };\r\n\r\n  const handleReopen = async (quizId: string) => {\r\n    try {\r\n      const quizRef = doc(db, 'quizzes', quizId);\r\n      await updateDoc(quizRef, {\r\n        status: 'pending',\r\n        isPublished: false,\r\n        reopenedAt: new Date(),\r\n        reopenedBy: user?.uid\r\n      });\r\n      \r\n      setQuizzes(prev => prev.map(quiz => \r\n        quiz.id === quizId \r\n          ? { ...quiz, status: 'pending' as const, isPublished: false }\r\n          : quiz\r\n      ));\r\n      \r\n      toast.success(t('admin.quizManagement.success.reopened'));\r\n    } catch (error) {\r\n      console.error('Error reopening quiz:', error);\r\n      toast.error(t('admin.quizManagement.errors.reopenFailed'));\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (quizId: string) => {\r\n    if (!window.confirm(t('admin.quizManagement.confirmDelete'))) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      console.log('üóëÔ∏è Deleting quiz from database:', quizId);\r\n      await deleteDoc(doc(db, 'quizzes', quizId));\r\n      console.log('‚úÖ Quiz deleted from database successfully');\r\n      \r\n      setQuizzes(prev => prev.filter(quiz => quiz.id !== quizId));\r\n      toast.success(t('admin.quizManagement.success.deleted'));\r\n    } catch (error) {\r\n      console.error('‚ùå Error deleting quiz:', error);\r\n      toast.error(t('admin.quizManagement.errors.deleteFailed') + ': ' + error);\r\n    }\r\n  };\r\n\r\n  const filteredQuizzes = quizzes.filter(quiz => {\r\n    const matchesFilter = filterStatus === 'all' || quiz.status === filterStatus;\r\n    const matchesSearch = quiz.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                         quiz.description.toLowerCase().includes(searchTerm.toLowerCase());\r\n    return matchesFilter && matchesSearch;\r\n  });\r\n\r\n  const getStatusCounts = () => {\r\n    return {\r\n      all: quizzes.length,\r\n      pending: quizzes.filter(q => q.status === 'pending').length,\r\n      approved: quizzes.filter(q => q.status === 'approved').length,\r\n      rejected: quizzes.filter(q => q.status === 'rejected').length\r\n    };\r\n  };\r\n\r\n  const statusCounts = getStatusCounts();\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case 'approved':\r\n        return <span className=\"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium\">‚úÖ {t('status.approved')}</span>;\r\n      case 'rejected':\r\n        return <span className=\"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium\">‚ùå {t('status.rejected')}</span>;\r\n      default:\r\n        return <span className=\"px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium\">‚è≥ {t('status.pending')}</span>;\r\n    }\r\n  };\r\n\r\n  const getDifficultyBadge = (difficulty: string) => {\r\n    switch (difficulty) {\r\n      case 'easy':\r\n        return <span className=\"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs\">üü¢ {t('quiz.difficulty.easy')}</span>;\r\n      case 'hard':\r\n        return <span className=\"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs\">üî¥ {t('quiz.difficulty.hard')}</span>;\r\n      default:\r\n        return <span className=\"px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs\">üü° {t('quiz.difficulty.medium')}</span>;\r\n    }\r\n  };\r\n\r\n  // Helper ƒë·ªÉ l·∫•y icon theo lo·∫°i t√†i li·ªáu\r\n  const getResourceIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'video': return <Video className=\"w-4 h-4\" />;\r\n      case 'pdf': return <FileText className=\"w-4 h-4\" />;\r\n      case 'image': return <ImageIcon className=\"w-4 h-4\" />;\r\n      case 'audio': return <Music className=\"w-4 h-4\" />;\r\n      case 'link': return <LinkIcon className=\"w-4 h-4\" />;\r\n      case 'slides': return <Presentation className=\"w-4 h-4\" />;\r\n      default: return <FileText className=\"w-4 h-4\" />;\r\n    }\r\n  };\r\n\r\n  // Helper ƒë·ªÉ l·∫•y m√†u badge theo lo·∫°i t√†i li·ªáu\r\n  const getResourceBadgeColor = (type: string) => {\r\n    switch (type) {\r\n      case 'video': return 'bg-blue-100 text-blue-700 border-blue-200';\r\n      case 'pdf': return 'bg-red-100 text-red-700 border-red-200';\r\n      case 'image': return 'bg-purple-100 text-purple-700 border-purple-200';\r\n      case 'audio': return 'bg-green-100 text-green-700 border-green-200';\r\n      case 'link': return 'bg-indigo-100 text-indigo-700 border-indigo-200';\r\n      case 'slides': return 'bg-orange-100 text-orange-700 border-orange-200';\r\n      default: return 'bg-gray-100 text-gray-700 border-gray-200';\r\n    }\r\n  };\r\n\r\n  if (!user || user.role !== 'admin') {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-2xl font-bold text-red-600 mb-4\">‚õî {t('errors.unauthorized')}</h1>\r\n          <p className=\"text-gray-600\">{t('admin.loginAsAdmin')}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{t('loadingData')}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-2xl font-bold text-red-600 mb-4\">‚ùå {t('error')}</h1>\r\n          <p className=\"text-gray-600 mb-4\">{error}</p>\r\n          <button \r\n            onClick={loadQuizzes}\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\r\n          >\r\n            {t('tryAgain')}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n    <div className=\"bg-gradient-to-br from-gray-50 to-blue-50\">\r\n      {/* Modern Responsive Header */}\r\n      <div className=\"bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-800 shadow-xl\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8\">\r\n          <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4\">\r\n            {/* Title Section */}\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className=\"w-12 h-12 lg:w-14 lg:h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center ring-2 ring-white/30 shadow-lg\">\r\n                <BookOpen className=\"w-6 h-6 lg:w-7 lg:h-7 text-white drop-shadow-sm\" />\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-2xl lg:text-3xl font-bold text-white drop-shadow-sm\">{t('admin.quizManagement.label')}</h1>\r\n                <p className=\"text-blue-100 text-sm lg:text-base mt-1\">{t('admin.quizManagement.description')}</p>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Actions & User Info */}\r\n            <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 lg:gap-4\">\r\n              <button\r\n                onClick={() => {loadQuizzes(); loadEditRequests();}}\r\n                className=\"w-full sm:w-auto px-4 py-2.5 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-xl transition-all duration-200 flex items-center justify-center gap-2 border border-white/20 hover:border-white/40 shadow-lg hover:shadow-xl\"\r\n                title=\"L√†m m·ªõi danh s√°ch\"\r\n              >\r\n                <RotateCcw className=\"w-4 h-4\" />\r\n                <span className=\"font-medium\">{t('refresh')}</span>\r\n              </button>\r\n              \r\n              {/* User Badge */}\r\n              <div className=\"flex items-center space-x-3 bg-white/10 backdrop-blur-sm rounded-xl px-4 py-2.5 border border-white/20 shadow-lg\">\r\n                  <User className=\"w-4 h-4 text-white\" />\r\n                </div>\r\n                <div className=\"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3\">\r\n                  <span className=\"text-white text-sm font-medium truncate max-w-32 lg:max-w-none\">{user?.email}</span>\r\n                  <span className=\"px-2 py-1 bg-gradient-to-r from-yellow-400 to-yellow-500 text-yellow-900 rounded-full text-xs font-bold shadow-sm\">\r\n                    {t('admin.quizManagement.adminBadge')}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\r\n        {/* Stats Overview */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6\">\r\n          <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-100\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">{t('admin.quizManagement.cards.totalQuizzes')}</p>\r\n                <p className=\"text-2xl font-bold text-gray-900\">{statusCounts.all}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\r\n                <BarChart3 className=\"w-6 h-6 text-blue-600\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-100\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">{t('status.pending')}</p>\r\n                <p className=\"text-2xl font-bold text-orange-600\">{statusCounts.pending}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center\">\r\n                <Clock className=\"w-6 h-6 text-orange-600\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-100\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">{t('status.approved')}</p>\r\n                <p className=\"text-2xl font-bold text-green-600\">{statusCounts.approved}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\r\n                <Check className=\"w-6 h-6 text-green-600\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-100\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">{t('status.rejected')}</p>\r\n                <p className=\"text-2xl font-bold text-red-600\">{statusCounts.rejected}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center\">\r\n                <X className=\"w-6 h-6 text-red-600\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Tabs */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 mb-8\">\r\n          <div className=\"flex border-b border-gray-200\">\r\n            <button\r\n              onClick={() => setActiveTab('quizzes')}\r\n              className={`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${\r\n                activeTab === 'quizzes'\r\n                  ? 'border-blue-500 text-blue-600 bg-blue-50'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <div className=\"flex items-center gap-2\">\r\n                <BookOpen className=\"w-4 h-4\" />\r\n                {t('admin.quizManagement.tab.quizzes')}\r\n                <span className=\"bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs\">\r\n                  {quizzes.length}\r\n                </span>\r\n              </div>\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('editRequests')}\r\n              className={`px-6 py-4 text-sm font-medium border-b-2 transition-colors ${\r\n                activeTab === 'editRequests'\r\n                  ? 'border-blue-500 text-blue-600 bg-blue-50'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              <div className=\"flex items-center gap-2\">\r\n                <AlertCircle className=\"w-4 h-4\" />\r\n                {t('admin.quizManagement.tab.editRequests')}\r\n                <span className=\"bg-orange-100 text-orange-600 px-2 py-1 rounded-full text-xs\">\r\n                  {editRequests.length}\r\n                </span>\r\n              </div>\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {activeTab === 'quizzes' && (\r\n          <>\r\n        {/* Search and Filter */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8\">\r\n          <div className=\"flex flex-col lg:flex-row gap-4\">\r\n            {/* Search */}\r\n            <div className=\"flex-1\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder={t('admin.quizManagement.searchPlaceholder')}\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  className=\"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Filter Tabs */}\r\n            <div className=\"flex space-x-1 bg-gray-100 p-1 rounded-lg\">\r\n              <button\r\n                onClick={() => setFilterStatus('all')}\r\n                className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${\r\n                  filterStatus === 'all'\r\n                    ? 'bg-blue-600 text-white shadow-sm'\r\n                    : 'text-gray-700 hover:text-gray-900'\r\n                }`}\r\n              >\r\n                {t('common.all')}\r\n              </button>\r\n              <button\r\n                onClick={() => setFilterStatus('pending')}\r\n                className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${\r\n                  filterStatus === 'pending'\r\n                    ? 'bg-orange-600 text-white shadow-sm'\r\n                    : 'text-gray-700 hover:text-gray-900'\r\n                }`}\r\n              >\r\n                {t('status.pending')}\r\n              </button>\r\n              <button\r\n                onClick={() => setFilterStatus('approved')}\r\n                className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${\r\n                  filterStatus === 'approved'\r\n                    ? 'bg-green-600 text-white shadow-sm'\r\n                    : 'text-gray-700 hover:text-gray-900'\r\n                }`}\r\n              >\r\n                {t('status.approved')}\r\n              </button>\r\n              <button\r\n                onClick={() => setFilterStatus('rejected')}\r\n                className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${\r\n                  filterStatus === 'rejected'\r\n                    ? 'bg-red-600 text-white shadow-sm'\r\n                    : 'text-gray-700 hover:text-gray-900'\r\n                }`}\r\n              >\r\n                {t('status.rejected')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Quiz List */}\r\n        {filteredQuizzes.length === 0 ? (\r\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center\">\r\n            <div className=\"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n              <BookOpen className=\"w-10 h-10 text-gray-400\" />\r\n            </div>\r\n            <h3 className=\"text-xl font-semibold text-gray-900 mb-3\">\r\n              {searchTerm ? t('admin.quizManagement.empty.noMatchTitle') : t('admin.quizManagement.empty.noQuizzesTitle')}\r\n            </h3>\r\n            <p className=\"text-gray-600 mb-8 max-w-md mx-auto\">\r\n              {searchTerm \r\n                ? t('admin.quizManagement.empty.noMatchDesc')\r\n                : t('admin.quizManagement.empty.noQuizzesDesc')\r\n              }\r\n            </p>\r\n            {!searchTerm && (\r\n              <div className=\"flex justify-center\">\r\n                <button\r\n                  onClick={() => window.open(ROUTES.CREATOR, '_blank')}\r\n                  className=\"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2\"\r\n                >\r\n                  <BookOpen className=\"w-5 h-5\" />\r\n                  {t('admin.quizManagement.empty.goToCreator')}\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid gap-6\">\r\n            {filteredQuizzes.map((quiz) => (\r\n              <div key={quiz.id} className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow\">\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"flex items-center gap-3 mb-3\">\r\n                      <h3 className=\"text-xl font-bold text-gray-900\">{quiz.title}</h3>\r\n                      {getStatusBadge(quiz.status)}\r\n                      {getDifficultyBadge(quiz.difficulty)}\r\n                    </div>\r\n                    \r\n                    <SafeHTML content={quiz.description} className=\"text-gray-600 mb-4 line-clamp-2\" />\r\n                    \r\n                    <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm text-gray-600 mb-3\">\r\n                      <div>\r\n                        <span className=\"font-medium\">{t('admin.quizManagement.table.category')}:</span> {quiz.category}\r\n                      </div>\r\n                      <div>\r\n                        <span className=\"font-medium\">{t('quiz.questions')}:</span> {quiz.questions.length}\r\n                      </div>\r\n                      <div>\r\n                        <span className=\"font-medium\">{t('admin.quizManagement.table.createdAt')}:</span> {quiz.createdAt.toLocaleDateString()}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Hi·ªÉn th·ªã s·ªë l∆∞·ª£ng t√†i li·ªáu h·ªçc t·∫≠p */}\r\n                    {quiz.learningResources && quiz.learningResources.length > 0 && (\r\n                      <div className=\"flex items-center gap-2 mt-2\">\r\n                        <div className=\"flex items-center gap-1.5 px-3 py-1.5 bg-emerald-50 border border-emerald-200 rounded-lg\">\r\n                          <FileText className=\"w-4 h-4 text-emerald-600\" />\r\n                          <span className=\"text-xs font-medium text-emerald-700\">\r\n                            {t('admin.quizManagement.learningResourcesCount', { count: quiz.learningResources.length })}\r\n                          </span>\r\n                        </div>\r\n                        {quiz.learningResources.some((r: any) => r.required) && (\r\n                          <span className=\"text-xs px-2 py-1 bg-red-100 text-red-700 rounded-full font-medium\">\r\n                            ‚ö†Ô∏è {t('admin.quizManagement.hasRequiredResources')}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  {/* Actions - 6 ch·ª©c nƒÉng: View, Edit, Approve, Reject, Reopen, Delete */}\r\n                  <div className=\"flex items-center gap-2 ml-6\">\r\n                    {/* 1. Xem tr∆∞·ªõc (lu√¥n hi·ªÉn th·ªã) */}\r\n                      <button\r\n                      onClick={() => handlePreview(quiz)}\r\n                      className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\r\n                        title={t('admin.quizManagement.tooltips.preview')}\r\n                    >\r\n                      <Eye className=\"w-5 h-5\" />\r\n                    </button>\r\n\r\n                    {/* 2. Ch·ªânh s·ª≠a (lu√¥n hi·ªÉn th·ªã) */}\r\n                      <button\r\n                      onClick={() => handleEdit(quiz.id)}\r\n                      className=\"p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors\"\r\n                        title={t('admin.quizManagement.tooltips.edit')}\r\n                    >\r\n                      <Edit3 className=\"w-5 h-5\" />\r\n                    </button>\r\n                    \r\n                    {/* 3 & 4. Duy·ªát & T·ª´ ch·ªëi (ch·ªâ hi·ªÉn th·ªã khi pending) */}\r\n                    {quiz.status === 'pending' && (\r\n                      <>\r\n                          <button\r\n                          onClick={() => handleApprove(quiz.id)}\r\n                          className=\"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors\"\r\n                            title={t('admin.quizManagement.tooltips.approve')}\r\n                        >\r\n                          <Check className=\"w-5 h-5\" />\r\n                        </button>\r\n                          <button\r\n                          onClick={() => handleReject(quiz.id)}\r\n                          className=\"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\r\n                            title={t('admin.quizManagement.tooltips.reject')}\r\n                        >\r\n                          <X className=\"w-5 h-5\" />\r\n                        </button>\r\n                      </>\r\n                    )}\r\n\r\n                    {/* 5. M·ªü l·∫°i (hi·ªÉn th·ªã khi ƒë√£ duy·ªát ho·∫∑c t·ª´ ch·ªëi) */}\r\n                      {(quiz.status === 'approved' || quiz.status === 'rejected') && (\r\n                      <button\r\n                        onClick={() => handleReopen(quiz.id)}\r\n                        className=\"p-2 text-orange-600 hover:bg-orange-50 rounded-lg transition-colors\"\r\n                          title={t('admin.quizManagement.tooltips.reopen')}\r\n                      >\r\n                        <RotateCcw className=\"w-5 h-5\" />\r\n                      </button>\r\n                    )}\r\n                    \r\n                    {/* 6. X√≥a (lu√¥n hi·ªÉn th·ªã) */}\r\n                      <button\r\n                      onClick={() => handleDelete(quiz.id)}\r\n                      className=\"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\r\n                        title={t('admin.quizManagement.tooltips.delete')}\r\n                    >\r\n                      <Trash2 className=\"w-5 h-5\" />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n        </>\r\n        )}\r\n\r\n        {activeTab === 'editRequests' && (\r\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n              <h3 className=\"text-lg font-semibold flex items-center gap-2\">\r\n                <AlertCircle className=\"w-5 h-5 text-orange-500\" />\r\n                {t('admin.quizManagement.editRequestsTitle', { count: editRequests.length })}\r\n              </h3>\r\n            </div>\r\n            \r\n            {editRequests.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <AlertCircle className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\r\n                <p className=\"text-gray-500 mb-4\">{t(\"admin.editRequests.emptyTitle\")}</p>\r\n                <p className=\"text-sm text-gray-400\">{t(\"admin.editRequests.emptyDesc\")}</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {editRequests.map((request) => (\r\n                  <div key={request.id} className=\"border border-gray-200 rounded-lg p-6 bg-white shadow-sm\">\r\n                    <div className=\"flex items-start justify-between\">\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center gap-3 mb-3\">\r\n                          <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                            <User className=\"w-5 h-5 text-blue-600\" />\r\n                          </div>\r\n                          <div>\r\n                            <h4 className=\"font-semibold text-gray-900\">\r\n                              {request.requestedByName || request.requestedByEmail || t('admin.quizManagement.unknownUser')}\r\n                            </h4>\r\n                            <p className=\"text-sm text-gray-500\">\r\n                              {request.requestedByEmail || request.requestedBy || t('admin.quizManagement.unknownEmail')}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        <div className=\"bg-gray-50 rounded-lg p-4 mb-3\">\r\n                          <h5 className=\"font-medium text-gray-900 mb-2\">\r\n                            üìù Quiz: {request.quizTitle || t('admin.quizManagement.unknownQuiz')}\r\n                          </h5>\r\n                          <p className=\"text-sm text-gray-700 mb-2\">\r\n                            <strong>{t('admin.quizManagement.requestReason')}:</strong> {request.reason || t('admin.quizManagement.noReason')}\r\n                          </p>\r\n                          {request.description && (\r\n                            <p className=\"text-sm text-gray-600\">\r\n                              <strong>{t('admin.quizManagement.requestDetails')}:</strong> {request.description}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                        \r\n                        <div className=\"flex items-center gap-4 text-sm text-gray-500\">\r\n                          <span className=\"flex items-center gap-1\">\r\n                            <Clock className=\"w-4 h-4\" />\r\n                            {request.requestedAt?.toLocaleDateString('vi-VN', {\r\n                              day: '2-digit',\r\n                              month: '2-digit', \r\n                              year: 'numeric',\r\n                              hour: '2-digit',\r\n                              minute: '2-digit'\r\n                            }) || t('admin.quizManagement.unknownTime')}\r\n                          </span>\r\n                          <span className=\"px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium\">{t(\"admin.editRequests.pending\")}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex gap-2 ml-6\">\r\n                        <button\r\n                          onClick={() => handleApproveEditRequest(request.id, request.quizId)}\r\n                          className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 shadow-sm\"\r\n                          title={t(\"admin.editRequests.approveTitle\")}\r\n                        >\r\n                          <Check className=\"w-4 h-4\" />{t(\"admin.editRequests.approve\")}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleRejectEditRequest(request.id)}\r\n                          className=\"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2 shadow-sm\"\r\n                          title={t(\"admin.editRequests.rejectTitle\")}\r\n                        >\r\n                          <X className=\"w-4 h-4\" />{t(\"admin.editRequests.reject\")}\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n      {/* Preview Modal */}\r\n      {showPreview && previewQuiz && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\r\n          <div className=\"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\r\n            <div className=\"p-6 border-b border-gray-200\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <h2 className=\"text-xl font-bold\">{t('admin.preview.title')}: {previewQuiz.title}</h2>\r\n                <button\r\n                  onClick={() => setShowPreview(false)}\r\n                  className=\"p-2 text-gray-400 hover:text-gray-600 rounded-lg\"\r\n                >\r\n                  <X className=\"w-5 h-5\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"p-6\">\r\n              <div className=\"space-y-6\">\r\n                <div>\r\n                  <h3 className=\"font-semibold mb-2\">{t('admin.preview.description')}:</h3>\r\n                  <SafeHTML content={previewQuiz.description} className=\"text-gray-600\" />\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                  <div>\r\n                    <span className=\"font-semibold\">{t('admin.preview.category')}:</span> {previewQuiz.category}\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"font-semibold\">{t('admin.preview.difficulty')}:</span> {previewQuiz.difficulty}\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"font-semibold\">{t('admin.preview.questions')}:</span> {previewQuiz.questions.length}\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"font-semibold\">{t('admin.preview.status')}:</span> {getStatusBadge(previewQuiz.status || 'pending')}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* T√†i li·ªáu h·ªçc t·∫≠p trong Preview */}\r\n                {previewQuiz.learningResources && previewQuiz.learningResources.length > 0 && (\r\n                  <div className=\"bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200 rounded-lg p-4\">\r\n                    <h3 className=\"font-semibold mb-3 flex items-center gap-2 text-emerald-800\">\r\n                      <FileText className=\"w-5 h-5\" />\r\n                      üìö {t('admin.preview.learningResourcesTitle', { count: previewQuiz.learningResources.length })}\r\n                    </h3>\r\n                    <div className=\"space-y-2\">\r\n                      {previewQuiz.learningResources.map((resource: any, idx: number) => (\r\n                        <div \r\n                          key={resource.id || idx} \r\n                          className=\"bg-white rounded-lg p-3 border border-emerald-100\"\r\n                        >\r\n                          <div className=\"flex items-start gap-3\">\r\n                            {/* Icon & Type Badge */}\r\n                            <div className={`flex items-center justify-center w-10 h-10 rounded-lg border ${getResourceBadgeColor(resource.type)}`}>\r\n                              {getResourceIcon(resource.type)}\r\n                            </div>\r\n                            \r\n                            {/* Content */}\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <div className=\"flex items-start justify-between gap-2\">\r\n                                <h4 className=\"font-semibold text-gray-900 text-sm\">{resource.title}</h4>\r\n                                <span className={`px-2 py-1 rounded-full text-xs font-medium border flex-shrink-0 ${getResourceBadgeColor(resource.type)}`}>\r\n                                  {resource.type.toUpperCase()}\r\n                                </span>\r\n                              </div>\r\n                              \r\n                              {resource.description && (\r\n                                <SafeHTML content={resource.description} className=\"text-xs text-gray-600 mt-1 line-clamp-2\" />\r\n                              )}\r\n                              \r\n                              <div className=\"flex items-center gap-3 mt-2 text-xs text-gray-500\">\r\n                                {resource.required && (\r\n                                  <span className=\"px-2 py-0.5 bg-red-100 text-red-700 rounded-full font-medium\">\r\n                                    ‚ö†Ô∏è {t('admin.quizManagement.requiredBadge')}\r\n                                  </span>\r\n                                )}\r\n                                {resource.estimatedTime && (\r\n                                  <span>‚è±Ô∏è {t('admin.quizManagement.estimatedTime', { time: resource.estimatedTime })}</span>\r\n                                )}\r\n                                {resource.url && (\r\n                                  <a \r\n                                    href={resource.url} \r\n                                    target=\"_blank\" \r\n                                    rel=\"noopener noreferrer\"\r\n                                    className=\"text-blue-600 hover:text-blue-800 hover:underline truncate max-w-xs\"\r\n                                  >\r\n                                    üîó {t('admin.quizManagement.viewResource')}\r\n                                  </a>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {previewQuiz.questions.length > 0 && (\r\n                  <div>\r\n                    <h3 className=\"font-semibold mb-4\">{t('admin.preview.questionList')}</h3>\r\n                    <div className=\"space-y-4\">\r\n                      {previewQuiz.questions.map((question: any, index: number) => (\r\n                        <div key={index} className=\"border rounded-lg p-4\">\r\n                          <h4 className=\"font-medium mb-2\">{index + 1}. {question.text}</h4>\r\n                          {question.answers && (\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n                              {question.answers.map((answer: any, answerIndex: number) => (\r\n                                <div \r\n                                  key={answerIndex} \r\n                                  className={`p-2 rounded ${answer.isCorrect ? 'bg-green-100 text-green-800' : 'bg-gray-100'}`}\r\n                                >\r\n                                  {String.fromCharCode(65 + answerIndex)}. {answer.text}\r\n                                  {answer.isCorrect && ' ‚úì'}\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AdminQuizManagement;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\pages\\AdminUserManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[604,607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[604,607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[646,649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[646,649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1148,1151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1148,1151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1536,1539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1536,1539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5089,5092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5089,5092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"user\">User</option>","line":240,"column":42,"nodeType":"JSXText","endLine":240,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"Ôªøimport React, { useState, useEffect } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\nimport { collection, getDocs, doc, updateDoc } from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport AdminLayout from '../components/AdminLayout';\r\nimport Modal from '../../../shared/components/ui/Modal';\r\nimport { toast } from 'react-toastify';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface User {\r\n  id: string;\r\n  email: string;\r\n  displayName: string;\r\n  role: 'user' | 'creator' | 'admin';\r\n  createdAt: any;\r\n  isActive: boolean;\r\n  lastLogin?: any;\r\n}\r\n\r\nconst AdminUserManagement: React.FC = () => {\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const { t } = useTranslation();\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [filter, setFilter] = useState<'all' | 'user' | 'creator' | 'admin'>('all');\r\n  const [confirmModal, setConfirmModal] = useState<{\r\n    open: boolean;\r\n    type: null | 'deleteUser' | 'toggleUserStatus' | 'roleChange';\r\n    payload?: any;\r\n    message?: string;\r\n  }>({ open: false, type: null });\r\n\r\n  useEffect(() => {\r\n    fetchUsers();\r\n  }, []);\r\n\r\n  const fetchUsers = async () => {\r\n    try {\r\n      const querySnapshot = await getDocs(collection(db, 'users'));\r\n      const usersData = querySnapshot.docs\r\n        .map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        }))\r\n        .filter((user: any) => !user.isDeleted) as User[]; // Filter out deleted users\r\n      setUsers(usersData);\r\n    } catch (error) {\r\n      console.error('Error fetching users:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleRoleChange = async (userId: string, newRole: 'user' | 'creator' | 'admin') => {\r\n    if (userId === user?.uid && newRole !== 'admin') {\r\n      toast.error(t('admin.users.cannotChangeSelfRole'));\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      await updateDoc(doc(db, 'users', userId), { role: newRole });\r\n      setUsers(prev => prev.map(u => u.id === userId ? { ...u, role: newRole } : u));\r\n      toast.success(t('admin.roleUpdateSuccess'));\r\n    } catch (error) {\r\n      console.error('Error updating user role:', error);\r\n      toast.error(t('messages.error'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleStatusToggle = async (userId: string, currentStatus: boolean) => {\r\n    if (userId === user?.uid) {\r\n      toast.error(t('admin.users.cannotDeactivateSelf'));\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      await updateDoc(doc(db, 'users', userId), { isActive: !currentStatus });\r\n      setUsers(prev => prev.map(u => u.id === userId ? { ...u, isActive: !currentStatus } : u));\r\n      toast.success(t('admin.userStatusUpdateSuccess', {action: t(!currentStatus ? 'admin.activated' : 'admin.deactivated')}));\r\n    } catch (error) {\r\n      console.error('Error updating user status:', error);\r\n      toast.error(t('messages.error'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteUser = async (userId: string) => {\r\n    if (userId === user?.uid) {\r\n      toast.error(t('admin.users.cannotDeleteSelf'));\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      // Instead of deleting, mark user as deleted and inactive\r\n      await updateDoc(doc(db, 'users', userId), {\r\n        isActive: false,\r\n        isDeleted: true,\r\n        deletedAt: new Date(),\r\n        deletedBy: user?.uid\r\n      });\r\n      \r\n      setUsers(prev => prev.filter(u => u.id !== userId));\r\n      toast.success(t('admin.userDeleteSuccess'));\r\n    } catch (error) {\r\n      console.error('Error deleting user:', error);\r\n      toast.error(t('admin.userDeleteError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const filteredUsers = filter === 'all' ? users : users.filter(u => u.role === filter);\r\n\r\n  if (user?.role !== 'admin') {\r\n    return (\r\n      <div className=\"text-center py-12\">\r\n        <p className=\"text-gray-600\">{t('admin.loginAsAdmin')}</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-96\">\r\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <AdminLayout title={`üë• ${t('admin.userManagement')}`}>\r\n      {/* Filter Tabs */}\r\n      <div className=\"mb-6\">\r\n        <div className=\"flex space-x-4\">\r\n          {[\r\n            { key: 'all', label: t('common.all'), count: users.length },\r\n            { key: 'admin', label: t('ui.admin'), count: users.filter(u => u.role === 'admin').length },\r\n            { key: 'creator', label: t('ui.creator'), count: users.filter(u => u.role === 'creator').length },\r\n            { key: 'user', label: t('ui.user'), count: users.filter(u => u.role === 'user').length }\r\n          ].map(tab => (\r\n            <button\r\n              key={tab.key}\r\n              onClick={() => setFilter(tab.key as any)}\r\n              className={`px-4 py-2 rounded-lg font-medium transition-colors ${\r\n                filter === tab.key\r\n                  ? 'bg-blue-600 text-white'\r\n                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\r\n              }`}\r\n            >\r\n              {tab.label} ({tab.count})\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Stats Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\r\n        <div className=\"bg-white rounded-lg shadow p-4\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">{t('admin.userManagementCards.totalUsers')}</h3>\r\n          <p className=\"text-3xl font-bold text-blue-600\">{users.length}</p>\r\n        </div>\r\n        <div className=\"bg-white rounded-lg shadow p-4\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">{t('admin.userManagementCards.activeUsers')}</h3>\r\n          <p className=\"text-3xl font-bold text-green-600\">\r\n            {users.filter(u => u.isActive !== false).length}\r\n          </p>\r\n        </div>\r\n        <div className=\"bg-white rounded-lg shadow p-4\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">{t('ui.creator')}</h3>\r\n          <p className=\"text-3xl font-bold text-purple-600\">\r\n            {users.filter(u => u.role === 'creator').length}\r\n          </p>\r\n        </div>\r\n        <div className=\"bg-white rounded-lg shadow p-4\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">{t('ui.admin')}</h3>\r\n          <p className=\"text-3xl font-bold text-red-600\">\r\n            {users.filter(u => u.role === 'admin').length}\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* User List */}\r\n      <div className=\"bg-white rounded-lg shadow overflow-hidden\">\r\n        <table className=\"min-w-full divide-y divide-gray-200\">\r\n          <thead className=\"bg-gray-50\">\r\n            <tr>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                {t('ui.user')}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                {t('ui.role')}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                {t('status.label')}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                {t('common.createdAt')}\r\n              </th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                {t('action.actions')}\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"bg-white divide-y divide-gray-200\">\r\n            {filteredUsers.map(userData => (\r\n              <tr key={userData.id} className={userData.id === user?.uid ? 'bg-blue-50' : ''}>\r\n                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                  <div className=\"flex items-center\">\r\n                    <div className=\"flex-shrink-0 h-10 w-10\">\r\n                      <div className=\"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center\">\r\n                        <span className=\"text-sm font-medium text-gray-700\">\r\n                          {userData.displayName?.charAt(0) || userData.email?.charAt(0) || 'U'}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"ml-4\">\r\n                      <div className=\"text-sm font-medium text-gray-900\">\r\n                        {userData.displayName || t('profile.displayName')}\r\n                        {userData.id === user?.uid && (\r\n                          <span className=\"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded\">\r\n                            ({t('common.you')})\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"text-sm text-gray-500\">{userData.email}</div>\r\n                    </div>\r\n                  </div>\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                  <select\r\n                    value={userData.role}\r\n                    onChange={(e) => setConfirmModal({ open: true, type: 'roleChange', payload: { userId: userData.id, newRole: e.target.value }, message: `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒë·ªïi quy·ªÅn cho ng∆∞·ªùi d√πng n√†y th√†nh ${e.target.value}?` })}\r\n                    disabled={userData.id === user?.uid}\r\n                    className=\"text-sm border border-gray-300 rounded px-2 py-1\"\r\n                  >\r\n                    <option value=\"user\">User</option>\r\n                    <option value=\"creator\">{t(\"nav.creator\")}</option>\r\n                    <option value=\"admin\">{t(\"admin.quizManagement.adminBadge\")}</option>\r\n                  </select>\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\r\n                    userData.isActive !== false \r\n                      ? 'bg-green-100 text-green-800' \r\n                      : 'bg-red-100 text-red-800'\r\n                  }`}>\r\n                      {userData.isActive !== false ? t('status.active') : t('status.inactive')}\r\n                  </span>\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                  {userData.createdAt?.toDate?.()?.toLocaleDateString() || 'N/A'}\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                  <div className=\"flex space-x-2\">\r\n                    {userData.id !== user?.uid && (\r\n                      <>\r\n                        <button\r\n                          onClick={() => setConfirmModal({ open: true, type: 'toggleUserStatus', payload: { userId: userData.id, currentStatus: userData.isActive !== false }, message: userData.isActive !== false ? 'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën kh√≥a t√†i kho·∫£n n√†y?' : 'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën k√≠ch ho·∫°t t√†i kho·∫£n n√†y?' })}\r\n                          className={`px-3 py-1 rounded text-xs ${userData.isActive !== false ? 'bg-red-600 text-white hover:bg-red-700' : 'bg-green-600 text-white hover:bg-green-700'}`}\r\n                          disabled={loading}\r\n                        >\r\n                          {userData.isActive !== false ? t('action.deactivate') : t('action.activate')}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => setConfirmModal({ open: true, type: 'deleteUser', payload: { userId: userData.id }, message: t('users.confirmDelete') })}\r\n                          className=\"px-3 py-1 bg-red-100 text-red-600 rounded text-xs hover:bg-red-200\"\r\n                          disabled={loading}\r\n                        >\r\n                          {t('delete')}\r\n                        </button>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {/* Modal x√°c nh·∫≠n thao t√°c */}\r\n      <Modal\r\n        isOpen={confirmModal.open}\r\n        onClose={() => setConfirmModal({ open: false, type: null })}\r\n        title={t('action.confirm')}\r\n      >\r\n        <div className=\"mb-4\">{confirmModal.message}</div>\r\n        <div className=\"flex justify-end space-x-2\">\r\n          <button\r\n            onClick={() => setConfirmModal({ open: false, type: null })}\r\n            className=\"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400\"\r\n            disabled={loading}\r\n          >\r\n            {t('cancel')}\r\n          </button>\r\n          <button\r\n            onClick={async () => {\r\n              if (confirmModal.type === 'deleteUser') await handleDeleteUser(confirmModal.payload.userId);\r\n              if (confirmModal.type === 'toggleUserStatus') await handleStatusToggle(confirmModal.payload.userId, confirmModal.payload.currentStatus);\r\n              if (confirmModal.type === 'roleChange') await handleRoleChange(confirmModal.payload.userId, confirmModal.payload.newRole);\r\n              setConfirmModal({ open: false, type: null });\r\n            }}\r\n            className=\"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700\"\r\n            disabled={loading}\r\n          >\r\n            {t('action.confirm')}\r\n          </button>\r\n        </div>\r\n      </Modal>\r\n    </AdminLayout>\r\n  );\r\n};\r\n\r\nexport default AdminUserManagement;\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\pages\\BuildIndexPage.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-lg font-semibold text-red-900 dark:text-red-100\">\r\n                  Access Denied\r\n                </h2>","line":45,"column":86,"nodeType":"JSXText","endLine":47,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-red-700 dark:text-red-300 mt-1\">\r\n                  B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n admin ƒë·ªÉ truy c·∫≠p trang n√†y.\r\n                </p>","line":48,"column":68,"nodeType":"JSXText","endLine":50,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                Build Vector Index\r\n              </h1>","line":133,"column":80,"nodeType":"JSXText","endLine":135,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600 dark:text-gray-400\">\r\n                T·∫°o vector index t·ª´ quiz data cho RAG Chatbot\r\n              </p>","line":136,"column":63,"nodeType":"JSXText","endLine":138,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <>\r\n                <PlayCircle className=\"w-5 h-5\" />\r\n                Build Vector Index\r\n              </>","line":159,"column":51,"nodeType":"JSXText","endLine":161,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">\r\n            Status\r\n          </h2>","line":172,"column":84,"nodeType":"JSXText","endLine":174,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-semibold text-green-900 dark:text-green-100\">\r\n                  üìä Index Statistics\r\n                </h3>","line":211,"column":82,"nodeType":"JSXText","endLine":213,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600 dark:text-gray-400\">Total Chunks:</span>","line":216,"column":72,"nodeType":"JSXText","endLine":216,"endColumn":85},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600 dark:text-gray-400\">Quiz Chunks:</span>","line":222,"column":72,"nodeType":"JSXText","endLine":222,"endColumn":84},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600 dark:text-gray-400\">PDF Chunks:</span>","line":228,"column":72,"nodeType":"JSXText","endLine":228,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600 dark:text-gray-400\">Build Time:</span>","line":234,"column":72,"nodeType":"JSXText","endLine":234,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-2 font-semibold text-gray-900 dark:text-white\">\r\n                      {getDuration()}s\r\n                    </span>","line":236,"column":38,"nodeType":"JSXText","endLine":237,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-green-700 dark:text-green-300\">\r\n                    ‚úÖ Index ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o localStorage v√† Firestore\r\n                  </p>","line":241,"column":77,"nodeType":"JSXText","endLine":243,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-green-700 dark:text-green-300\">\r\n                    üìÇ Firestore: system/vector-index\r\n                  </p>","line":244,"column":77,"nodeType":"JSXText","endLine":246,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-green-700 dark:text-green-300\">\r\n                    ü§ñ AI chatbot c√≥ th·ªÉ s·ª≠ d·ª•ng ngay!\r\n                  </p>","line":247,"column":77,"nodeType":"JSXText","endLine":249,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-semibold text-blue-900 dark:text-blue-100 mb-2\">\r\n            üìù H∆∞·ªõng d·∫´n\r\n          </h3>","line":258,"column":79,"nodeType":"JSXText","endLine":260,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>Click \"Build Vector Index\" ƒë·ªÉ b·∫Øt ƒë·∫ßu</li>","line":262,"column":17,"nodeType":"JSXText","endLine":262,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>Ch·ªù h·ªá th·ªëng extract quiz data v√† generate embeddings</li>","line":263,"column":17,"nodeType":"JSXText","endLine":263,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>Index s·∫Ω ƒë∆∞·ª£c l∆∞u v√†o localStorage</li>","line":264,"column":17,"nodeType":"JSXText","endLine":264,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>S·ª≠ d·ª•ng index n√†y ƒë·ªÉ test RAG chatbot</li>","line":265,"column":17,"nodeType":"JSXText","endLine":265,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>Trong production, deploy Cloud Function ƒë·ªÉ build index t·ª± ƒë·ªông</li>","line":266,"column":17,"nodeType":"JSXText","endLine":266,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-semibold text-purple-900 dark:text-purple-100 mb-2\">\r\n              üéâ Next Steps\r\n            </h3>","line":277,"column":85,"nodeType":"JSXText","endLine":279,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>Test RAG chatbot v·ªõi vector index v·ª´a build</li>","line":281,"column":19,"nodeType":"JSXText","endLine":281,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>Deploy Cloud Functions: <code className=\"bg-purple-100 dark:bg-purple-900 px-2 py-0.5 rounded\">firebase deploy --only functions:askRAG</code></li>","line":282,"column":19,"nodeType":"JSXText","endLine":282,"endColumn":43},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <code className=\"bg-purple-100 dark:bg-purple-900 px-2 py-0.5 rounded\">firebase deploy --only functions:askRAG</code>","line":282,"column":114,"nodeType":"JSXText","endLine":282,"endColumn":153},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>Update ChatbotModal ƒë·ªÉ connect v·ªõi backend</li>","line":283,"column":19,"nodeType":"JSXText","endLine":283,"endColumn":61},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>Test end-to-end v·ªõi real questions</li>","line":284,"column":19,"nodeType":"JSXText","endLine":284,"endColumn":53}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":27,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * üî® Build Vector Index - Admin Page\r\n * \r\n * Admin tool to build vector index from browser\r\n * Uses current user's Firebase Auth for permissions\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Database, PlayCircle, CheckCircle, XCircle, Loader, AlertTriangle } from 'lucide-react';\r\nimport { useSelector } from 'react-redux';\r\nimport type { RootState } from '../../../lib/store';\r\nimport { buildIndex } from '../../../lib/genkit/indexing';\r\nimport type { VectorIndex } from '../../../lib/genkit/types';\r\n\r\ninterface BuildStatus {\r\n  status: 'idle' | 'building' | 'success' | 'error';\r\n  message: string;\r\n  index?: VectorIndex;\r\n  error?: string;\r\n  startTime?: number;\r\n  endTime?: number;\r\n}\r\n\r\nexport function BuildIndexPage() {\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const [buildStatus, setBuildStatus] = useState<BuildStatus>({\r\n    status: 'idle',\r\n    message: 'S·∫µn s√†ng build vector index',\r\n  });\r\n\r\n  // Check if user is admin\r\n  if (!user || user.role !== 'admin') {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-6\">\r\n        <div className=\"max-w-4xl mx-auto\">\r\n          <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6\"\r\n          >\r\n            <div className=\"flex items-center gap-3\">\r\n              <AlertTriangle className=\"w-6 h-6 text-red-600\" />\r\n              <div>\r\n                <h2 className=\"text-lg font-semibold text-red-900 dark:text-red-100\">\r\n                  Access Denied\r\n                </h2>\r\n                <p className=\"text-red-700 dark:text-red-300 mt-1\">\r\n                  B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n admin ƒë·ªÉ truy c·∫≠p trang n√†y.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </motion.div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const handleBuildIndex = async () => {\r\n    setBuildStatus({\r\n      status: 'building',\r\n      message: 'ƒêang build vector index...',\r\n      startTime: Date.now(),\r\n    });\r\n\r\n    try {\r\n      // Build index using current user's auth\r\n      const index = await buildIndex();\r\n\r\n      // Save to localStorage first\r\n      localStorage.setItem('vector-index', JSON.stringify(index));\r\n      console.log('‚úÖ Index saved to localStorage');\r\n      \r\n      // Save to Firestore for Cloud Functions\r\n      try {\r\n        // Remove undefined values to avoid Firestore errors\r\n        const sanitizedIndex = JSON.parse(JSON.stringify(index));\r\n        \r\n        const { doc, setDoc } = await import('firebase/firestore');\r\n        const { db } = await import('../../../lib/firebase/config');\r\n        await setDoc(doc(db, 'system', 'vector-index'), sanitizedIndex);\r\n        \r\n        console.log('‚úÖ Index saved to Firestore successfully');\r\n      } catch (firestoreError) {\r\n        console.error('‚ùå Failed to save to Firestore:', firestoreError);\r\n        throw new Error(\r\n          `L·ªói khi l∆∞u v√†o Firestore: ${\r\n            firestoreError instanceof Error ? firestoreError.message : 'Unknown error'\r\n          }. Vui l√≤ng ki·ªÉm tra:\\n` +\r\n          '1. B·∫°n ƒë√£ ƒëƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n admin?\\n' +\r\n          '2. Firestore rules ƒë√£ ƒë∆∞·ª£c deploy?\\n' +\r\n          '3. T√†i kho·∫£n c√≥ role = \"admin\" trong Firestore?'\r\n        );\r\n      }\r\n\r\n      setBuildStatus({\r\n        status: 'success',\r\n        message: 'Build th√†nh c√¥ng!',\r\n        index,\r\n        endTime: Date.now(),\r\n        startTime: buildStatus.startTime,\r\n      });\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå Error building index:', error);\r\n      setBuildStatus({\r\n        status: 'error',\r\n        message: 'L·ªói khi build index',\r\n        error: error instanceof Error ? error.message : String(error),\r\n        endTime: Date.now(),\r\n        startTime: buildStatus.startTime,\r\n      });\r\n    }\r\n  };\r\n\r\n  const getDuration = () => {\r\n    if (buildStatus.startTime && buildStatus.endTime) {\r\n      return ((buildStatus.endTime - buildStatus.startTime) / 1000).toFixed(2);\r\n    }\r\n    return null;\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-6\">\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"w-12 h-12 bg-gradient-to-br from-purple-500 to-blue-500 rounded-lg flex items-center justify-center\">\r\n              <Database className=\"w-6 h-6 text-white\" />\r\n            </div>\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                Build Vector Index\r\n              </h1>\r\n              <p className=\"text-gray-600 dark:text-gray-400\">\r\n                T·∫°o vector index t·ª´ quiz data cho RAG Chatbot\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Build Button */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6\">\r\n          <motion.button\r\n            whileHover={{ scale: 1.02 }}\r\n            whileTap={{ scale: 0.98 }}\r\n            onClick={handleBuildIndex}\r\n            disabled={buildStatus.status === 'building'}\r\n            className=\"w-full py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg font-semibold flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-lg transition-all\"\r\n          >\r\n            {buildStatus.status === 'building' ? (\r\n              <>\r\n                <Loader className=\"w-5 h-5 animate-spin\" />\r\n                ƒêang build...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <PlayCircle className=\"w-5 h-5\" />\r\n                Build Vector Index\r\n              </>\r\n            )}\r\n          </motion.button>\r\n        </div>\r\n\r\n        {/* Status Card */}\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\"\r\n        >\r\n          <h2 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">\r\n            Status\r\n          </h2>\r\n\r\n          <div className=\"space-y-4\">\r\n            {/* Status Message */}\r\n            <div className=\"flex items-start gap-3\">\r\n              {buildStatus.status === 'idle' && (\r\n                <Database className=\"w-6 h-6 text-gray-400 flex-shrink-0 mt-0.5\" />\r\n              )}\r\n              {buildStatus.status === 'building' && (\r\n                <Loader className=\"w-6 h-6 text-blue-500 animate-spin flex-shrink-0 mt-0.5\" />\r\n              )}\r\n              {buildStatus.status === 'success' && (\r\n                <CheckCircle className=\"w-6 h-6 text-green-500 flex-shrink-0 mt-0.5\" />\r\n              )}\r\n              {buildStatus.status === 'error' && (\r\n                <XCircle className=\"w-6 h-6 text-red-500 flex-shrink-0 mt-0.5\" />\r\n              )}\r\n              \r\n              <div className=\"flex-1\">\r\n                <p className=\"font-medium text-gray-900 dark:text-white\">\r\n                  {buildStatus.message}\r\n                </p>\r\n                {buildStatus.error && (\r\n                  <p className=\"text-sm text-red-600 dark:text-red-400 mt-1\">\r\n                    {buildStatus.error}\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Success Details */}\r\n            {buildStatus.status === 'success' && buildStatus.index && (\r\n              <motion.div\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 space-y-2\"\r\n              >\r\n                <h3 className=\"font-semibold text-green-900 dark:text-green-100\">\r\n                  üìä Index Statistics\r\n                </h3>\r\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                  <div>\r\n                    <span className=\"text-gray-600 dark:text-gray-400\">Total Chunks:</span>\r\n                    <span className=\"ml-2 font-semibold text-gray-900 dark:text-white\">\r\n                      {buildStatus.index.totalChunks}\r\n                    </span>\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-gray-600 dark:text-gray-400\">Quiz Chunks:</span>\r\n                    <span className=\"ml-2 font-semibold text-gray-900 dark:text-white\">\r\n                      {buildStatus.index.sources.quiz || 0}\r\n                    </span>\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-gray-600 dark:text-gray-400\">PDF Chunks:</span>\r\n                    <span className=\"ml-2 font-semibold text-gray-900 dark:text-white\">\r\n                      {buildStatus.index.sources.pdf || 0}\r\n                    </span>\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-gray-600 dark:text-gray-400\">Build Time:</span>\r\n                    <span className=\"ml-2 font-semibold text-gray-900 dark:text-white\">\r\n                      {getDuration()}s\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n                <div className=\"pt-2 border-t border-green-200 dark:border-green-800\">\r\n                  <p className=\"text-xs text-green-700 dark:text-green-300\">\r\n                    ‚úÖ Index ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o localStorage v√† Firestore\r\n                  </p>\r\n                  <p className=\"text-xs text-green-700 dark:text-green-300\">\r\n                    üìÇ Firestore: system/vector-index\r\n                  </p>\r\n                  <p className=\"text-xs text-green-700 dark:text-green-300\">\r\n                    ü§ñ AI chatbot c√≥ th·ªÉ s·ª≠ d·ª•ng ngay!\r\n                  </p>\r\n                </div>\r\n              </motion.div>\r\n            )}\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Instructions */}\r\n        <div className=\"mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6\">\r\n          <h3 className=\"font-semibold text-blue-900 dark:text-blue-100 mb-2\">\r\n            üìù H∆∞·ªõng d·∫´n\r\n          </h3>\r\n          <ol className=\"text-sm text-blue-800 dark:text-blue-200 space-y-2 list-decimal list-inside\">\r\n            <li>Click \"Build Vector Index\" ƒë·ªÉ b·∫Øt ƒë·∫ßu</li>\r\n            <li>Ch·ªù h·ªá th·ªëng extract quiz data v√† generate embeddings</li>\r\n            <li>Index s·∫Ω ƒë∆∞·ª£c l∆∞u v√†o localStorage</li>\r\n            <li>S·ª≠ d·ª•ng index n√†y ƒë·ªÉ test RAG chatbot</li>\r\n            <li>Trong production, deploy Cloud Function ƒë·ªÉ build index t·ª± ƒë·ªông</li>\r\n          </ol>\r\n        </div>\r\n\r\n        {/* Next Steps */}\r\n        {buildStatus.status === 'success' && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"mt-6 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-6\"\r\n          >\r\n            <h3 className=\"font-semibold text-purple-900 dark:text-purple-100 mb-2\">\r\n              üéâ Next Steps\r\n            </h3>\r\n            <ul className=\"text-sm text-purple-800 dark:text-purple-200 space-y-2 list-disc list-inside\">\r\n              <li>Test RAG chatbot v·ªõi vector index v·ª´a build</li>\r\n              <li>Deploy Cloud Functions: <code className=\"bg-purple-100 dark:bg-purple-900 px-2 py-0.5 rounded\">firebase deploy --only functions:askRAG</code></li>\r\n              <li>Update ChatbotModal ƒë·ªÉ connect v·ªõi backend</li>\r\n              <li>Test end-to-end v·ªõi real questions</li>\r\n            </ul>\r\n          </motion.div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default BuildIndexPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\pages\\CategoryManagement.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Icon\r\n                </label>","line":455,"column":81,"nodeType":"JSXText","endLine":457,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\nimport { toast } from 'react-toastify';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { \r\n  collection, \r\n  getDocs, \r\n  addDoc, \r\n  updateDoc, \r\n  deleteDoc, \r\n  doc,\r\n  query,\r\n  where\r\n} from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { initializeCategories } from '../../../utils/initializeCategories';\r\nimport {\r\n  Plus,\r\n  Search,\r\n  Edit,\r\n  Trash2,\r\n  Save,\r\n  X,\r\n  FolderOpen,\r\n  BookOpen,\r\n  User,\r\n  BarChart3,\r\n  Eye\r\n} from 'lucide-react';\r\n\r\ninterface Category {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  icon: string;\r\n  color: string;\r\n  createdAt: Date;\r\n  quizCount?: number;\r\n}\r\n\r\nconst CategoryManagement: React.FC = () => {\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const { t } = useTranslation();\r\n  const [categories, setCategories] = useState<Category[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showAddForm, setShowAddForm] = useState(false);\r\n  const [editingCategory, setEditingCategory] = useState<Category | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  \r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    description: '',\r\n    icon: 'üìö',\r\n    color: 'blue'\r\n  });\r\n\r\n  const colors = [\r\n    { value: 'blue', label: t('categories.colors.blue'), class: 'bg-blue-500' },\r\n    { value: 'green', label: t('categories.colors.green'), class: 'bg-green-500' },\r\n    { value: 'purple', label: t('categories.colors.purple'), class: 'bg-purple-500' },\r\n    { value: 'red', label: t('categories.colors.red'), class: 'bg-red-500' },\r\n    { value: 'yellow', label: t('categories.colors.yellow'), class: 'bg-yellow-500' },\r\n    { value: 'pink', label: t('categories.colors.pink'), class: 'bg-pink-500' },\r\n    { value: 'indigo', label: t('categories.colors.indigo'), class: 'bg-indigo-500' },\r\n    { value: 'gray', label: t('categories.colors.gray'), class: 'bg-gray-500' }\r\n  ];\r\n\r\n  const icons = ['üìö', 'üî¨', 'üíª', 'üé®', 'üìä', 'üåç', 'üèÉ‚Äç‚ôÇÔ∏è', 'üéµ', 'üç≥', 'üìà', 'üßÆ', 'üìù'];\r\n\r\n  const loadCategories = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      console.log('üîç Loading categories from Firebase...');\r\n      \r\n      // Initialize default categories if none exist\r\n      await initializeCategories();\r\n      \r\n      const categoriesRef = collection(db, 'categories');\r\n      const snapshot = await getDocs(categoriesRef);\r\n      \r\n      console.log('üìä Found categories in DB:', snapshot.size);\r\n      const loadedCategories: Category[] = [];\r\n      \r\n      for (const doc of snapshot.docs) {\r\n        const data = doc.data();\r\n        console.log('üìù Category data:', { id: doc.id, ...data });\r\n        \r\n        // ƒê·∫øm s·ªë quiz trong danh m·ª•c n√†y\r\n        const quizzesRef = collection(db, 'quizzes');\r\n        const quizzesSnapshot = await getDocs(query(quizzesRef, where('category', '==', data.name)));\r\n        \r\n        loadedCategories.push({\r\n          id: doc.id,\r\n          name: data.name,\r\n          description: data.description,\r\n          icon: data.icon,\r\n          color: data.color,\r\n          createdAt: data.createdAt?.toDate() || new Date(),\r\n          quizCount: quizzesSnapshot.size\r\n        });\r\n      }\r\n      \r\n      console.log('‚úÖ Loaded categories:', loadedCategories);\r\n      setCategories(loadedCategories.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime()));\r\n    } catch (error) {\r\n      console.error('‚ùå Error loading categories:', error);\r\n      toast.error(t('categories.loadError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [t]);\r\n\r\n  // Move useEffect before conditional return - Fix React Hooks rules\r\n  useEffect(() => {\r\n    if (!user || user.role !== 'admin') return;\r\n    loadCategories();\r\n  }, [user, loadCategories]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!formData.name.trim()) {\r\n      toast.error(t('categories.enterName'));\r\n      return;\r\n    }\r\n\r\n    try {\r\n      if (editingCategory) {\r\n        // Update existing category\r\n        const categoryRef = doc(db, 'categories', editingCategory.id);\r\n        await updateDoc(categoryRef, {\r\n          name: formData.name.trim(),\r\n          description: formData.description.trim(),\r\n          icon: formData.icon,\r\n          color: formData.color,\r\n          updatedAt: new Date()\r\n        });\r\n        \r\n        setCategories(prev => prev.map(cat => \r\n          cat.id === editingCategory.id \r\n            ? { ...cat, ...formData, name: formData.name.trim(), description: formData.description.trim() }\r\n            : cat\r\n        ));\r\n        \r\n        toast.success(t('categories.updateSuccess'));\r\n      } else {\r\n        // Add new category\r\n        const docRef = await addDoc(collection(db, 'categories'), {\r\n          name: formData.name.trim(),\r\n          description: formData.description.trim(),\r\n          icon: formData.icon,\r\n          color: formData.color,\r\n          createdAt: new Date()\r\n        });\r\n        \r\n        const newCategory: Category = {\r\n          id: docRef.id,\r\n          name: formData.name.trim(),\r\n          description: formData.description.trim(),\r\n          icon: formData.icon,\r\n          color: formData.color,\r\n          createdAt: new Date(),\r\n          quizCount: 0\r\n        };\r\n        \r\n        setCategories(prev => [newCategory, ...prev]);\r\n        toast.success(t('categories.addSuccess'));\r\n      }\r\n      \r\n      // Reset form\r\n      setFormData({ name: '', description: '', icon: 'üìö', color: 'blue' });\r\n      setShowAddForm(false);\r\n      setEditingCategory(null);\r\n    } catch (error) {\r\n      console.error('Error saving category:', error);\r\n      toast.error(t('categories.saveError'));\r\n    }\r\n  };\r\n\r\n  const handleEdit = (category: Category) => {\r\n    setEditingCategory(category);\r\n    setFormData({\r\n      name: category.name,\r\n      description: category.description,\r\n      icon: category.icon,\r\n      color: category.color\r\n    });\r\n    setShowAddForm(true);\r\n  };\r\n\r\n  const handleDelete = async (categoryId: string, categoryName: string) => {\r\n    if (!confirm(t('categories.confirmDeleteName', {name: categoryName, defaultValue: `Are you sure you want to delete category \"${categoryName}\"?`}))) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await deleteDoc(doc(db, 'categories', categoryId));\r\n      setCategories(prev => prev.filter(cat => cat.id !== categoryId));\r\n      toast.success(t('categories.deleteSuccess'));\r\n    } catch (error) {\r\n      console.error('Error deleting category:', error);\r\n      toast.error(t('categories.deleteError'));\r\n    }\r\n  };\r\n\r\n  const filteredCategories = categories.filter(category =>\r\n    category.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    category.description.toLowerCase().includes(searchTerm.toLowerCase())\r\n  );\r\n\r\n  const getColorClass = (color: string) => {\r\n    const colorMap: { [key: string]: string } = {\r\n      blue: 'bg-blue-500',\r\n      green: 'bg-green-500',\r\n      purple: 'bg-purple-500',\r\n      red: 'bg-red-500',\r\n      yellow: 'bg-yellow-500',\r\n      pink: 'bg-pink-500',\r\n      indigo: 'bg-indigo-500',\r\n      gray: 'bg-gray-500'\r\n    };\r\n    return colorMap[color] || 'bg-blue-500';\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{t('loadingData')}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {/* Modern Header */}\r\n      <div className=\"bg-white border-b border-gray-200\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className=\"w-12 h-12 bg-gradient-to-br from-purple-600 to-purple-700 rounded-2xl flex items-center justify-center\">\r\n                <FolderOpen className=\"w-6 h-6 text-white\" />\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-2xl font-bold text-gray-900\">{t('admin.categoryManagement')}</h1>\r\n                <p className=\"text-gray-600\">{t('admin.categories.headerDesc')}</p>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center space-x-4\">\r\n              <button\r\n                onClick={() => {\r\n                  setShowAddForm(true);\r\n                  setEditingCategory(null);\r\n                  setFormData({ name: '', description: '', icon: 'üìö', color: 'blue' });\r\n                }}\r\n                className=\"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors\"\r\n              >\r\n                <Plus className=\"w-5 h-5\" />\r\n                {t('categories.add')}\r\n              </button>\r\n              <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\r\n                <User className=\"w-4 h-4\" />\r\n                <span>{user?.email}</span>\r\n                <span className=\"ml-2 px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium\">{t('ui.admin')}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        {/* Stats Overview */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\r\n          <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-100\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">{t('categories.total')}</p>\r\n                <p className=\"text-2xl font-bold text-gray-900\">{categories.length}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center\">\r\n                <FolderOpen className=\"w-6 h-6 text-purple-600\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-100\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">{t('categories.withQuizzes')}</p>\r\n                <p className=\"text-2xl font-bold text-green-600\">{categories.filter(c => c.quizCount && c.quizCount > 0).length}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\r\n                <BookOpen className=\"w-6 h-6 text-green-600\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-100\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">{t('categories.totalQuizzes')}</p>\r\n                <p className=\"text-2xl font-bold text-blue-600\">{categories.reduce((sum, c) => sum + (c.quizCount || 0), 0)}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\r\n                <BarChart3 className=\"w-6 h-6 text-blue-600\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-100\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">{t('categories.empty')}</p>\r\n                <p className=\"text-2xl font-bold text-orange-600\">{categories.filter(c => !c.quizCount || c.quizCount === 0).length}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center\">\r\n                <Eye className=\"w-6 h-6 text-orange-600\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Search */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <input\r\n              type=\"text\"\r\n                placeholder={t('categories.searchPlaceholder')}\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Categories Grid */}\r\n        {filteredCategories.length === 0 ? (\r\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center\">\r\n            <FolderOpen className=\"w-16 h-16 text-gray-300 mx-auto mb-4\" />\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">{t('categories.noCategories')}</h3>\r\n            <p className=\"text-gray-600 mb-4\">\r\n              {searchTerm ? t('categories.noSearchMatch') : t('categories.noneCreated')}\r\n            </p>\r\n            <button\r\n              onClick={() => {\r\n                setShowAddForm(true);\r\n                setEditingCategory(null);\r\n                setFormData({ name: '', description: '', icon: 'üìö', color: 'blue' });\r\n              }}\r\n              className=\"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors mx-auto\"\r\n            >\r\n              <Plus className=\"w-5 h-5\" />\r\n              {t('categories.createFirst')}\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n            {filteredCategories.map((category) => (\r\n              <div key={category.id} className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow\">\r\n                <div className=\"flex items-start justify-between mb-4\">\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <div className={`w-12 h-12 ${getColorClass(category.color)} rounded-xl flex items-center justify-center text-2xl`}>\r\n                      {category.icon}\r\n                    </div>\r\n                    <div>\r\n                      <h3 className=\"text-lg font-bold text-gray-900\">{category.name}</h3>\r\n                      <p className=\"text-sm text-gray-600\">{category.quizCount || 0} {t('categories.quizSuffix')}</p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <button\r\n                      onClick={() => handleEdit(category)}\r\n                      className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\r\n                      title={t('edit')}\r\n                    >\r\n                      <Edit className=\"w-4 h-4\" />\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleDelete(category.id, category.name)}\r\n                      className=\"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\r\n                      title={t('delete')}\r\n                    >\r\n                      <Trash2 className=\"w-4 h-4\" />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n                \r\n                <p className=\"text-gray-600 text-sm mb-4\">{category.description}</p>\r\n                \r\n                <div className=\"flex items-center justify-between text-xs text-gray-500\">\r\n                  <span>{t('categories.createdAtLabel')}: {category.createdAt.toLocaleDateString()}</span>\r\n                  <span className={`px-2 py-1 rounded-full text-white ${getColorClass(category.color)}`}>\r\n                    {category.color}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Add/Edit Form Modal */}\r\n      {showAddForm && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\r\n          <div className=\"bg-white rounded-2xl max-w-md w-full p-6\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <h2 className=\"text-xl font-bold\">\r\n                {editingCategory ? t('categories.editTitle') : t('categories.addTitle')}\r\n              </h2>\r\n              <button\r\n                onClick={() => {\r\n                  setShowAddForm(false);\r\n                  setEditingCategory(null);\r\n                  setFormData({ name: '', description: '', icon: 'üìö', color: 'blue' });\r\n                }}\r\n                className=\"p-2 text-gray-400 hover:text-gray-600 rounded-lg\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n            \r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('categories.name')} *\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                  className=\"w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500\"\r\n                  placeholder={t('categories.namePlaceholder')}\r\n                  required\r\n                />\r\n              </div>\r\n              \r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('categories.description')}\r\n                </label>\r\n                <textarea\r\n                  value={formData.description}\r\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                  className=\"w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none\"\r\n                  rows={3}\r\n                  placeholder={t('categories.descriptionPlaceholder')}\r\n                />\r\n              </div>\r\n              \r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Icon\r\n                </label>\r\n                <div className=\"grid grid-cols-6 gap-2\">\r\n                  {icons.map((icon) => (\r\n                    <button\r\n                      key={icon}\r\n                      type=\"button\"\r\n                      onClick={() => setFormData({ ...formData, icon })}\r\n                      className={`p-3 text-2xl border-2 rounded-lg hover:bg-gray-50 transition-colors ${\r\n                        formData.icon === icon ? 'border-purple-500 bg-purple-50' : 'border-gray-200'\r\n                      }`}\r\n                    >\r\n                      {icon}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n              \r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('categories.color')}\r\n                </label>\r\n                <div className=\"grid grid-cols-4 gap-2\">\r\n                  {colors.map((color) => (\r\n                    <button\r\n                      key={color.value}\r\n                      type=\"button\"\r\n                      onClick={() => setFormData({ ...formData, color: color.value })}\r\n                      className={`p-3 border-2 rounded-lg hover:bg-gray-50 transition-colors ${\r\n                        formData.color === color.value ? 'border-purple-500 bg-purple-50' : 'border-gray-200'\r\n                      }`}\r\n                    >\r\n                      <div className={`w-6 h-6 ${color.class} rounded-full mx-auto mb-1`}></div>\r\n                      <span className=\"text-xs\">{color.label}</span>\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"flex gap-3 pt-4\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => {\r\n                    setShowAddForm(false);\r\n                    setEditingCategory(null);\r\n                    setFormData({ name: '', description: '', icon: 'üìö', color: 'blue' });\r\n                  }}\r\n                  className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\r\n                >\r\n                  {t('cancel')}\r\n                </button>\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors\"\r\n                >\r\n                  <Save className=\"w-4 h-4\" />\r\n                  {editingCategory ? t('update') : t('categories.create')}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CategoryManagement;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\pages\\CreatorManagement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\pages\\MyQuizzesPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\admin\\pages\\StatsDashboard.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-sm font-medium text-green-800\">\r\n              Th√†nh c√¥ng! B·∫°n ƒëang xem trang th·ªëng k√™ v·ªõi bi·ªÉu ƒë·ªì\r\n            </h3>","line":40,"column":64,"nodeType":"JSXText","endLine":42,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Trang n√†y hi·ªÉn th·ªã:</p>","line":44,"column":18,"nodeType":"JSXText","endLine":44,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>üìä Bi·ªÉu ƒë·ªì c·ªôt - Danh m·ª•c ph·ªï bi·∫øn</li>","line":46,"column":21,"nodeType":"JSXText","endLine":46,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>ü•ß Bi·ªÉu ƒë·ªì tr√≤n - T·ª∑ l·ªá quiz ƒë√£ duy·ªát/ch·ªù duy·ªát</li>","line":47,"column":21,"nodeType":"JSXText","endLine":47,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>üìà 8 Cards th·ªëng k√™ chi ti·∫øt</li>","line":48,"column":21,"nodeType":"JSXText","endLine":48,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>üéØ D·ªØ li·ªáu m·∫´u ƒë·ªÉ demo</li>","line":49,"column":21,"nodeType":"JSXText","endLine":49,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport AdminStats from '../components/AdminStats';\r\n\r\nconst StatsDashboard: React.FC = () => {\r\n  const { t } = useTranslation();\r\n  \r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {/* Header */}\r\n      <header className=\"bg-white shadow-sm border-b border-gray-200\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"flex justify-between items-center h-16\">\r\n            <div className=\"flex items-center\">\r\n              <div className=\"h-8 w-8 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mr-3\">\r\n                <span className=\"text-white text-xl\">üìä</span>\r\n              </div>\r\n              <h1 className=\"text-xl font-bold text-gray-900\">{t('admin.stats.title')}</h1>\r\n            </div>\r\n            \r\n            <div className=\"flex items-center space-x-4\">\r\n              <a\r\n                href=\"/admin\"\r\n                className=\"bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-700 transition-colors duration-200\"\r\n              >\r\n                ‚Üê {t('admin.sidebar.backToDashboard')}\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Success Banner */}\r\n      <div className=\"bg-green-50 border-l-4 border-green-400 p-4\">\r\n        <div className=\"flex\">\r\n          <div className=\"flex-shrink-0\">\r\n            <span className=\"text-green-400 text-xl\">‚úÖ</span>\r\n          </div>\r\n          <div className=\"ml-3\">\r\n            <h3 className=\"text-sm font-medium text-green-800\">\r\n              Th√†nh c√¥ng! B·∫°n ƒëang xem trang th·ªëng k√™ v·ªõi bi·ªÉu ƒë·ªì\r\n            </h3>\r\n            <div className=\"mt-2 text-sm text-green-700\">\r\n              <p>Trang n√†y hi·ªÉn th·ªã:</p>\r\n              <ul className=\"list-disc list-inside mt-1\">\r\n                <li>üìä Bi·ªÉu ƒë·ªì c·ªôt - Danh m·ª•c ph·ªï bi·∫øn</li>\r\n                <li>ü•ß Bi·ªÉu ƒë·ªì tr√≤n - T·ª∑ l·ªá quiz ƒë√£ duy·ªát/ch·ªù duy·ªát</li>\r\n                <li>üìà 8 Cards th·ªëng k√™ chi ti·∫øt</li>\r\n                <li>üéØ D·ªØ li·ªáu m·∫´u ƒë·ªÉ demo</li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        <AdminStats />\r\n      </main>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StatsDashboard;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\components\\AutoLogoutOnBan.tsx","messages":[{"ruleId":"prefer-const","severity":1,"message":"'interval' is never reassigned. Use 'const' instead.","line":38,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":38,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\nimport { doc, getDoc } from 'firebase/firestore';\r\nimport { db, auth } from '../../../lib/firebase/config';\r\nimport { logout } from '../store';\r\nimport { toast } from 'react-toastify';\r\n\r\n/**\r\n * Component n√†y s·∫Ω t·ª± ƒë·ªông ki·ªÉm tra tr·∫°ng th√°i isActive c·ªßa user m·ªói 5s.\r\n * N·∫øu user b·ªã kho√°, s·∫Ω t·ª± ƒë·ªông logout v√† hi·ªÉn th·ªã th√¥ng b√°o.\r\n */\r\nconst AutoLogoutOnBan = () => {\r\n  const user = useSelector((state: RootState) => state.auth.user);\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    let interval: NodeJS.Timeout;\r\n    let isUnmounted = false;\r\n\r\n    const checkActive = async () => {\r\n      try {\r\n        const userDoc = await getDoc(doc(db, 'users', user.uid));\r\n        const userData = userDoc.data();\r\n        if (userData && userData.isActive === false) {\r\n          if (!isUnmounted) {\r\n            dispatch(logout());\r\n            toast.error('T√†i kho·∫£n c·ªßa b·∫°n ƒë√£ b·ªã kho√°. Vui l√≤ng li√™n h·ªá qu·∫£n tr·ªã vi√™n.');\r\n            if (auth.currentUser) await auth.signOut();\r\n          }\r\n        }\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n    };\r\n    checkActive();\r\n    interval = setInterval(checkActive, 5000);\r\n    return () => {\r\n      isUnmounted = true;\r\n      clearInterval(interval);\r\n    };\r\n  }, [user?.uid, dispatch]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default AutoLogoutOnBan;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\components\\ForgotPassword.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1056,1059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1056,1059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold text-gray-800\">Qu√™n m·∫≠t kh·∫©u</h2>","line":56,"column":60,"nodeType":"JSXText","endLine":56,"endColumn":73},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-500 mt-2\">\r\n                Ch√∫ng t√¥i s·∫Ω g·ª≠i link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë·∫øn email n√†y.\r\n              </p>","line":76,"column":57,"nodeType":"JSXText","endLine":78,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-semibold text-gray-800\">Email ƒë√£ ƒë∆∞·ª£c g·ª≠i!</h3>","line":106,"column":65,"nodeType":"JSXText","endLine":106,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-600\">\r\n              Ch√∫ng t√¥i ƒë√£ g·ª≠i link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë·∫øn<br />\r\n              <strong>{email}</strong>\r\n            </p>","line":107,"column":50,"nodeType":"JSXText","endLine":108,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-500\">\r\n              Ki·ªÉm tra h·ªôp th∆∞ c·ªßa b·∫°n v√† click v√†o link ƒë·ªÉ ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u.\r\n            </p>","line":111,"column":50,"nodeType":"JSXText","endLine":113,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n              type=\"button\"\r\n              onClick={onBack}\r\n              className=\"w-full py-3 px-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-colors\"\r\n            >\r\n              Quay l·∫°i ƒëƒÉng nh·∫≠p\r\n            </button>","line":118,"column":14,"nodeType":"JSXText","endLine":120,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { sendPasswordResetEmail } from 'firebase/auth';\r\nimport { auth } from '../../../lib/firebase/config';\r\nimport { toast } from 'react-toastify';\r\nimport { ArrowLeft, Mail } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface ForgotPasswordProps {\r\n  onBack: () => void;\r\n}\r\n\r\nexport const ForgotPassword: React.FC<ForgotPasswordProps> = ({ onBack }) => {\r\n  const { t } = useTranslation();\r\n  const [email, setEmail] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [sent, setSent] = useState(false);\r\n\r\n  const handleResetPassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!email) {\r\n      toast.error('Vui l√≤ng nh·∫≠p email');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      // S·ª≠ d·ª•ng Firebase sendPasswordResetEmail\r\n      await sendPasswordResetEmail(auth, email);\r\n      toast.success('Email ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c g·ª≠i! H√£y ki·ªÉm tra h·ªôp th∆∞ c·ªßa b·∫°n.');\r\n      setSent(true);\r\n    } catch (error: any) {\r\n      console.error('Error resetting password:', error);\r\n      if (error.code === 'auth/user-not-found') {\r\n        toast.error('Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n v·ªõi email n√†y');\r\n      } else if (error.code === 'auth/invalid-email') {\r\n        toast.error('Email kh√¥ng h·ª£p l·ªá');\r\n      } else {\r\n        toast.error('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.');\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center p-4\">\r\n      <div className=\"bg-white rounded-2xl shadow-xl p-8 w-full max-w-md\">\r\n        <div className=\"flex items-center mb-6\">\r\n          <button\r\n            onClick={onBack}\r\n            className=\"mr-3 p-2 text-gray-400 hover:text-gray-600 transition-colors\"\r\n          >\r\n            <ArrowLeft className=\"w-5 h-5\" />\r\n          </button>\r\n          <h2 className=\"text-2xl font-bold text-gray-800\">Qu√™n m·∫≠t kh·∫©u</h2>\r\n        </div>\r\n\r\n        {!sent ? (\r\n          <form onSubmit={handleResetPassword} className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                {t(\"auth.email\")}\r\n              </label>\r\n              <div className=\"relative\">\r\n                <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n                <input\r\n                  type=\"email\"\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                  className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  placeholder={t(\"auth.emailPlaceholder\")}\r\n                  disabled={loading}\r\n                />\r\n              </div>\r\n              <p className=\"text-sm text-gray-500 mt-2\">\r\n                Ch√∫ng t√¥i s·∫Ω g·ª≠i link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë·∫øn email n√†y.\r\n              </p>\r\n            </div>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className={`w-full py-3 px-4 rounded-lg font-medium transition-colors ${\r\n                loading\r\n                  ? 'bg-gray-400 cursor-not-allowed'\r\n                  : 'bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white'\r\n              }`}\r\n            >\r\n              {loading ? 'ƒêang g·ª≠i...' : 'G·ª≠i email ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u'}\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              onClick={onBack}\r\n              className=\"w-full py-2 px-4 text-gray-600 hover:text-gray-800 transition-colors\"\r\n            >\r\n              {t(\"common.back\")}\r\n            </button>\r\n          </form>\r\n        ) : (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3\">\r\n              <Mail className=\"w-8 h-8 text-green-600\" />\r\n            </div>\r\n            <h3 className=\"text-lg font-semibold text-gray-800\">Email ƒë√£ ƒë∆∞·ª£c g·ª≠i!</h3>\r\n            <p className=\"text-sm text-gray-600\">\r\n              Ch√∫ng t√¥i ƒë√£ g·ª≠i link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u ƒë·∫øn<br />\r\n              <strong>{email}</strong>\r\n            </p>\r\n            <p className=\"text-sm text-gray-500\">\r\n              Ki·ªÉm tra h·ªôp th∆∞ c·ªßa b·∫°n v√† click v√†o link ƒë·ªÉ ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u.\r\n            </p>\r\n            <button\r\n              type=\"button\"\r\n              onClick={onBack}\r\n              className=\"w-full py-3 px-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-colors\"\r\n            >\r\n              Quay l·∫°i ƒëƒÉng nh·∫≠p\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\components\\OTPVerification.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\components\\ProtectedRoute.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"mt-1 text-sm text-gray-500\">\r\n              B·∫°n c·∫ßn c√≥ vai tr√≤ Creator ho·∫∑c Admin ƒë·ªÉ truy c·∫≠p trang n√†y.\r\n            </p>","line":54,"column":55,"nodeType":"JSXText","endLine":56,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Navigate } from 'react-router-dom';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\nimport { Loading } from '../../../shared/components/layout/Loading';\r\n\r\nimport { useTranslation } from 'react-i18next';\r\ninterface ProtectedRouteProps {\r\n  children: React.ReactNode;\r\n  requiredRole?: 'admin' | 'creator' | ('admin' | 'creator')[];\r\n}\r\n\r\nconst ProtectedRoute: React.FC<ProtectedRouteProps> = ({ \r\n  children, \r\n  requiredRole \r\n}) => {\r\n  const { t } = useTranslation();\r\n\r\n  const { user, isLoading } = useSelector((state: RootState) => state.auth);\r\n\r\n  console.log('üõ°Ô∏è ProtectedRoute check:', {\r\n    hasUser: !!user,\r\n    isLoading,\r\n    userRole: user?.role,\r\n    requiredRole,\r\n    userEmail: user?.email\r\n  });\r\n\r\n  if (isLoading) {\r\n    console.log('üõ°Ô∏è ProtectedRoute: Showing loading...');\r\n    return <Loading message=\"ƒêang x√°c th·ª±c...\" />;\r\n  }\r\n\r\n  if (!user) {\r\n    console.log('üõ°Ô∏è ProtectedRoute: No user, redirecting to login');\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n\r\n  if (requiredRole) {\r\n    const allowedRoles = Array.isArray(requiredRole) ? requiredRole : [requiredRole];\r\n    const hasRequiredRole = allowedRoles.includes(user.role as 'admin' | 'creator') || user.role === 'admin';\r\n    \r\n    if (!hasRequiredRole) {\r\n      console.log('üõ°Ô∏è ProtectedRoute: Role mismatch, showing unauthorized');\r\n      return (\r\n        <div className=\"min-h-screen bg-gray-100 flex items-center justify-center\">\r\n          <div className=\"text-center\">\r\n            <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100\">\r\n              <svg className=\"h-6 w-6 text-red-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.962-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\r\n              </svg>\r\n            </div>\r\n            <h3 className=\"mt-2 text-sm font-medium text-gray-900\">{t(\"messages.unauthorized\")}</h3>\r\n            <p className=\"mt-1 text-sm text-gray-500\">\r\n              B·∫°n c·∫ßn c√≥ vai tr√≤ Creator ho·∫∑c Admin ƒë·ªÉ truy c·∫≠p trang n√†y.\r\n            </p>\r\n            <div className=\"mt-6\">\r\n              <button\r\n                onClick={() => window.history.back()}\r\n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700\"\r\n              >{t(\"common.back\")}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  console.log('üõ°Ô∏è ProtectedRoute: Access granted, rendering children');\r\n  return <>{children}</>;\r\n};\r\n\r\nexport default ProtectedRoute;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\components\\RoleSelection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1709,1712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1709,1712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Ch·ªçn vai tr√≤ c·ªßa b·∫°n</h2>","line":84,"column":65,"nodeType":"JSXText","endLine":84,"endColumn":85},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600\">H√£y ch·ªçn vai tr√≤ ph√π h·ª£p ƒë·ªÉ b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng Quiz Trivia</p>","line":85,"column":40,"nodeType":"JSXText","endLine":85,"endColumn":95},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-semibold text-gray-800 mb-1\">User (Ng∆∞·ªùi d√πng)</h3>","line":107,"column":66,"nodeType":"JSXText","endLine":107,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-600\">\r\n                  Tham gia l√†m quiz, xem k·∫øt qu·∫£ v√† theo d√µi ti·∫øn ƒë·ªô h·ªçc t·∫≠p c·ªßa b·∫°n\r\n                </p>","line":108,"column":54,"nodeType":"JSXText","endLine":110,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ L√†m c√°c quiz c√≥ s·∫µn</li>","line":112,"column":23,"nodeType":"JSXText","endLine":112,"endColumn":44},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ Xem l·ªãch s·ª≠ k·∫øt qu·∫£</li>","line":113,"column":23,"nodeType":"JSXText","endLine":113,"endColumn":44},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ Theo d√µi ti·∫øn ƒë·ªô h·ªçc t·∫≠p</li>","line":114,"column":23,"nodeType":"JSXText","endLine":114,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-semibold text-gray-800 mb-1\">Creator (Ng∆∞·ªùi t·∫°o)</h3>","line":138,"column":66,"nodeType":"JSXText","endLine":138,"endColumn":85},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-600\">\r\n                  T·∫°o quiz cho c·ªông ƒë·ªìng, bao g·ªìm t·∫•t c·∫£ quy·ªÅn c·ªßa User\r\n                </p>","line":139,"column":54,"nodeType":"JSXText","endLine":141,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ T·∫•t c·∫£ quy·ªÅn c·ªßa User</li>","line":143,"column":23,"nodeType":"JSXText","endLine":143,"endColumn":46},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ T·∫°o quiz m·ªõi</li>","line":144,"column":23,"nodeType":"JSXText","endLine":144,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ Qu·∫£n l√Ω quiz ƒë√£ t·∫°o</li>","line":145,"column":23,"nodeType":"JSXText","endLine":145,"endColumn":44},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>‚Ä¢ Quiz c·∫ßn admin ph√™ duy·ªát</li>","line":146,"column":23,"nodeType":"JSXText","endLine":146,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-gray-500\">\r\n            B·∫°n c√≥ th·ªÉ thay ƒë·ªïi vai tr√≤ sau trong ph·∫ßn c√†i ƒë·∫∑t t√†i kho·∫£n\r\n          </p>","line":175,"column":48,"nodeType":"JSXText","endLine":177,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"Ôªøimport React, { useState } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport { setRole } from '../../auth/store';\r\nimport { AuthUser } from '../../auth/types';\r\nimport { doc, setDoc } from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { toast } from 'react-toastify';\r\n\r\ninterface RoleSelectionProps {\r\n  user: AuthUser;\r\n  onRoleSelected: (role: 'user' | 'creator') => void;\r\n}\r\n\r\nconst RoleSelection: React.FC<RoleSelectionProps> = ({ user, onRoleSelected }) => {\r\n  const [selectedRole, setSelectedRole] = useState<'user' | 'creator' | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const dispatch = useDispatch();\r\n\r\n  const handleRoleSelection = async (role: 'user' | 'creator') => {\r\n    setIsLoading(true);\r\n    \r\n    try {\r\n      // Th·ª≠ c·∫≠p nh·∫≠t Firestore tr∆∞·ªõc\r\n      const userDocRef = doc(db, 'users', user.uid);\r\n      await setDoc(userDocRef, { \r\n        role: role,\r\n        roleSelectedAt: new Date(),\r\n        needsRoleSelection: false, // Clear the flag\r\n        status: 'active',\r\n        email: user.email,\r\n        displayName: user.displayName,\r\n        updatedAt: new Date()\r\n      }, { merge: true });\r\n\r\n      // C·∫≠p nh·∫≠t Redux store\r\n      dispatch(setRole(role));\r\n      console.log('Role updated in Redux:', role);\r\n      \r\n      // L∆∞u v√†o localStorage nh∆∞ backup\r\n      localStorage.setItem(`user_role_${user.uid}`, role);\r\n      \r\n      // Call callback v·ªõi role ƒë·ªÉ parent c√≥ th·ªÉ navigate\r\n      toast.success(`Ch√†o m·ª´ng b·∫°n v·ªõi vai tr√≤ ${role === 'user' ? 'Ng∆∞·ªùi d√πng' : 'Ng∆∞·ªùi t·∫°o'}!`);\r\n      \r\n      // G·ªçi callback ngay l·∫≠p t·ª©c, kh√¥ng delay\r\n      onRoleSelected(role);\r\n      \r\n    } catch (error: any) {\r\n      console.error('Error updating user role:', error);\r\n      \r\n      // N·∫øu Firestore fail, v·∫´n l∆∞u role v√†o localStorage v√† Redux\r\n      console.warn('Firestore update failed, using localStorage fallback');\r\n      \r\n      // C·∫≠p nh·∫≠t Redux store\r\n      dispatch(setRole(role));\r\n      console.log('Role updated in Redux (fallback):', role);\r\n      \r\n      // L∆∞u v√†o localStorage \r\n      localStorage.setItem(`user_role_${user.uid}`, role);\r\n      \r\n      // Call callback v·ªõi role ƒë·ªÉ parent c√≥ th·ªÉ navigate\r\n      toast.success(`Ch√†o m·ª´ng b·∫°n v·ªõi vai tr√≤ ${role === 'user' ? 'Ng∆∞·ªùi d√πng' : 'Ng∆∞·ªùi t·∫°o'}!`);\r\n      \r\n      // G·ªçi callback ngay l·∫≠p t·ª©c, kh√¥ng delay\r\n      onRoleSelected(role);\r\n      \r\n      // Hi·ªÉn th·ªã th√¥ng b√°o nh·∫π nh√†ng\r\n      toast.info('Vai tr√≤ ƒë√£ ƒë∆∞·ª£c ch·ªçn. D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c ƒë·ªìng b·ªô khi k·∫øt n·ªëi ·ªïn ƒë·ªãnh.');\r\n      \r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl\">\r\n        <div className=\"text-center mb-6\">\r\n          <div className=\"w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n            <svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\r\n            </svg>\r\n          </div>\r\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Ch·ªçn vai tr√≤ c·ªßa b·∫°n</h2>\r\n          <p className=\"text-gray-600\">H√£y ch·ªçn vai tr√≤ ph√π h·ª£p ƒë·ªÉ b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng Quiz Trivia</p>\r\n        </div>\r\n\r\n        <div className=\"space-y-4\">\r\n          {/* User Role */}\r\n          <div \r\n            className={`p-4 border-2 rounded-lg cursor-pointer transition-all duration-200 ${\r\n              selectedRole === 'user' \r\n                ? 'border-blue-500 bg-blue-50' \r\n                : 'border-gray-200 hover:border-gray-300 hover:bg-gray-50'\r\n            }`}\r\n            onClick={() => setSelectedRole('user')}\r\n          >\r\n            <div className=\"flex items-start space-x-3\">\r\n              <div className=\"flex-shrink-0\">\r\n                <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center\">\r\n                  <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253\" />\r\n                  </svg>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <h3 className=\"font-semibold text-gray-800 mb-1\">User (Ng∆∞·ªùi d√πng)</h3>\r\n                <p className=\"text-sm text-gray-600\">\r\n                  Tham gia l√†m quiz, xem k·∫øt qu·∫£ v√† theo d√µi ti·∫øn ƒë·ªô h·ªçc t·∫≠p c·ªßa b·∫°n\r\n                </p>\r\n                <ul className=\"mt-2 text-xs text-gray-500 space-y-1\">\r\n                  <li>‚Ä¢ L√†m c√°c quiz c√≥ s·∫µn</li>\r\n                  <li>‚Ä¢ Xem l·ªãch s·ª≠ k·∫øt qu·∫£</li>\r\n                  <li>‚Ä¢ Theo d√µi ti·∫øn ƒë·ªô h·ªçc t·∫≠p</li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Creator Role */}\r\n          <div \r\n            className={`p-4 border-2 rounded-lg cursor-pointer transition-all duration-200 ${\r\n              selectedRole === 'creator' \r\n                ? 'border-purple-500 bg-purple-50' \r\n                : 'border-gray-200 hover:border-gray-300 hover:bg-gray-50'\r\n            }`}\r\n            onClick={() => setSelectedRole('creator')}\r\n          >\r\n            <div className=\"flex items-start space-x-3\">\r\n              <div className=\"flex-shrink-0\">\r\n                <div className=\"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center\">\r\n                  <svg className=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                  </svg>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <h3 className=\"font-semibold text-gray-800 mb-1\">Creator (Ng∆∞·ªùi t·∫°o)</h3>\r\n                <p className=\"text-sm text-gray-600\">\r\n                  T·∫°o quiz cho c·ªông ƒë·ªìng, bao g·ªìm t·∫•t c·∫£ quy·ªÅn c·ªßa User\r\n                </p>\r\n                <ul className=\"mt-2 text-xs text-gray-500 space-y-1\">\r\n                  <li>‚Ä¢ T·∫•t c·∫£ quy·ªÅn c·ªßa User</li>\r\n                  <li>‚Ä¢ T·∫°o quiz m·ªõi</li>\r\n                  <li>‚Ä¢ Qu·∫£n l√Ω quiz ƒë√£ t·∫°o</li>\r\n                  <li>‚Ä¢ Quiz c·∫ßn admin ph√™ duy·ªát</li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mt-6 flex space-x-3\">\r\n          <button\r\n            onClick={() => selectedRole && handleRoleSelection(selectedRole)}\r\n            disabled={!selectedRole || isLoading}\r\n            className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all duration-200 ${\r\n              selectedRole && !isLoading\r\n                ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700'\r\n                : 'bg-gray-200 text-gray-400 cursor-not-allowed'\r\n            }`}\r\n          >\r\n            {isLoading ? (\r\n              <div className=\"flex items-center justify-center\">\r\n                <div className=\"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2\"></div>\r\n                ƒêang thi·∫øt l·∫≠p vai tr√≤...\r\n              </div>\r\n            ) : (\r\n              'X√°c nh·∫≠n vai tr√≤'\r\n            )}\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"mt-4 text-center\">\r\n          <p className=\"text-xs text-gray-500\">\r\n            B·∫°n c√≥ th·ªÉ thay ƒë·ªïi vai tr√≤ sau trong ph·∫ßn c√†i ƒë·∫∑t t√†i kho·∫£n\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RoleSelection;\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\pages\\AuthPageNew.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3073,3076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3073,3076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4617,4620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4617,4620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":203,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6080,6083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6080,6083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6499,6502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6499,6502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7615,7618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7615,7618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { \r\n  createUserWithEmailAndPassword, \r\n  signInWithEmailAndPassword, \r\n  signInWithPopup,\r\n  GoogleAuthProvider,\r\n  User\r\n} from 'firebase/auth';\r\nimport { doc, setDoc, getDoc } from 'firebase/firestore';\r\nimport { auth, db } from '../../../lib/firebase/config';\r\nimport { toast } from 'react-toastify';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Eye, EyeOff, Mail, Lock, User as UserIcon, Chrome } from 'lucide-react';\r\nimport { ForgotPassword } from '../components/ForgotPassword';\r\nimport OTPVerification from '../components/OTPVerification';\r\nimport { generateAndSendOTP } from '../services/otpService';\r\n\r\ninterface FormData {\r\n  email: string;\r\n  password: string;\r\n  confirmPassword: string;\r\n  displayName: string;\r\n  acceptTerms: boolean;\r\n}\r\n\r\nconst AuthPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation();\r\n  const [isLogin, setIsLogin] = useState(true);\r\n  const [loading, setLoading] = useState(false);\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\r\n  const [showForgotPassword, setShowForgotPassword] = useState(false);\r\n  const [showOTPVerification, setShowOTPVerification] = useState(false);\r\n  const [pendingUserData, setPendingUserData] = useState<{\r\n    email: string;\r\n    password: string;\r\n    displayName: string;\r\n  } | null>(null);\r\n  const [formData, setFormData] = useState<FormData>({\r\n    email: '',\r\n    password: '',\r\n    confirmPassword: '',\r\n    displayName: '',\r\n    acceptTerms: false\r\n  });\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const { name, value, type, checked } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: type === 'checkbox' ? checked : value\r\n    }));\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    if (!formData.email.trim()) {\r\n      toast.error(t('auth.validation.emailRequired'));\r\n      return false;\r\n    }\r\n\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    if (!emailRegex.test(formData.email.trim())) {\r\n      toast.error(t('auth.validation.emailInvalid'));\r\n      return false;\r\n    }\r\n\r\n    if (!formData.password) {\r\n      toast.error(t('auth.validation.passwordRequired'));\r\n      return false;\r\n    }\r\n\r\n    if (!isLogin) {\r\n      if (!formData.displayName.trim()) {\r\n        toast.error(t('auth.validation.displayNameRequired'));\r\n        return false;\r\n      }\r\n\r\n      if (formData.password !== formData.confirmPassword) {\r\n        toast.error(t('auth.validation.passwordMismatch'));\r\n        return false;\r\n      }\r\n\r\n      if (formData.password.length < 6) {\r\n        toast.error(t('auth.validation.passwordTooShort'));\r\n        return false;\r\n      }\r\n\r\n      if (!formData.acceptTerms) {\r\n        toast.error(t('auth.validation.termsRequired'));\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  const createUserDocument = async (user: User, additionalData: any = {}) => {\r\n    if (!user) return;\r\n\r\n    const userDocRef = doc(db, 'users', user.uid);\r\n    const userSnapshot = await getDoc(userDocRef);\r\n\r\n    if (!userSnapshot.exists()) {\r\n      await setDoc(userDocRef, {\r\n        uid: user.uid,\r\n        email: user.email,\r\n        role: 'user',\r\n        createdAt: new Date(),\r\n        isActive: true,\r\n        emailVerified: true, // OTP ƒë√£ verify r·ªìi\r\n        needsRoleSelection: true,\r\n        ...additionalData\r\n      });\r\n    }\r\n  };\r\n\r\n  // Complete registration sau khi OTP verify th√†nh c√¥ng\r\n  const completeRegistrationAfterOTP = async () => {\r\n    if (!pendingUserData) {\r\n      toast.error(t('auth.errors.pendingRegistrationNotFound'));\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      // T·∫°o Firebase account\r\n      const userCredential = await createUserWithEmailAndPassword(\r\n        auth,\r\n        pendingUserData.email,\r\n        pendingUserData.password\r\n      );\r\n\r\n      // T·∫°o user document\r\n      await createUserDocument(userCredential.user, {\r\n        displayName: pendingUserData.displayName,\r\n        verificationMethod: 'otp'\r\n      });\r\n\r\n      toast.success(t('auth.registerSuccess'));\r\n      \r\n      // Reset states\r\n      setFormData({ \r\n        email: '', \r\n        password: '', \r\n        confirmPassword: '', \r\n        displayName: '', \r\n        acceptTerms: false \r\n      });\r\n      setPendingUserData(null);\r\n      setShowOTPVerification(false);\r\n      \r\n      // Navigate to role selection\r\n      navigate('/role-selection');\r\n    } catch (error: any) {\r\n      console.error('Registration error:', error);\r\n      switch (error.code) {\r\n        case 'auth/email-already-in-use':\r\n          toast.error(t('auth.errors.emailAlreadyInUse'));\r\n          break;\r\n        case 'auth/weak-password':\r\n          toast.error(t('auth.errors.weakPassword'));\r\n          break;\r\n        case 'auth/invalid-email':\r\n          toast.error(t('auth.errors.invalidEmail'));\r\n          break;\r\n        default:\r\n          toast.error(t('auth.errors.registerError'));\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleRegister = async () => {\r\n    if (!validateForm()) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      // G·ª≠i OTP tr∆∞·ªõc\r\n      const normalizedEmail = formData.email.trim().toLowerCase();\r\n      const result = await generateAndSendOTP(normalizedEmail);\r\n      \r\n      if (result.success) {\r\n        // L∆∞u data t·∫°m\r\n        setPendingUserData({\r\n          email: normalizedEmail,\r\n          password: formData.password,\r\n          displayName: formData.displayName.trim()\r\n        });\r\n        \r\n        // Hi·ªán m√†n h√¨nh nh·∫≠p OTP\r\n        setShowOTPVerification(true);\r\n        toast.success(t('auth.otp.sent', { email: normalizedEmail }));\r\n      } else {\r\n        const errorKey =\r\n          result.code === 'otp.emailFailed'\r\n            ? 'auth.otp.errors.emailFailed'\r\n            : 'auth.errors.genericError';\r\n        toast.error(t(errorKey));\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Registration error:', error);\r\n      toast.error(t('auth.errors.genericError'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleGoogleLogin = async () => {\r\n    try {\r\n      const provider = new GoogleAuthProvider();\r\n      await signInWithPopup(auth, provider);\r\n      // toast.success(t('auth.loginSuccess'));\r\n      navigate('/dashboard');\r\n    } catch (error: any) {\r\n      console.error('Google login error:', error);\r\n      toast.error(t('auth.errors.googleLoginError'));\r\n    }\r\n  };\r\n\r\n  const handleLogin = async () => {\r\n    if (!validateForm()) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      const userCredential = await signInWithEmailAndPassword(\r\n        auth, \r\n        formData.email.trim().toLowerCase(),\r\n        formData.password\r\n      );\r\n\r\n      const userDocRef = doc(db, 'users', userCredential.user.uid);\r\n      const userDoc = await getDoc(userDocRef);\r\n      let redirectPath = '/dashboard';\r\n\r\n      if (userDoc.exists()) {\r\n        const userData = userDoc.data();\r\n        const userRole = userData.role;\r\n        switch (userRole) {\r\n          case 'admin':\r\n          case 'creator':\r\n          case 'user':\r\n          default:\r\n            redirectPath = '/dashboard';\r\n            break;\r\n        }\r\n        await setDoc(userDocRef, { lastLoginAt: new Date(), emailVerified: userCredential.user.emailVerified }, { merge: true });\r\n      }\r\n\r\n      // toast.success(t('auth.loginSuccess'));\r\n      navigate(redirectPath);\r\n    } catch (error: any) {\r\n      console.error('‚ùå Login error:', error.code, error.message);\r\n      switch (error.code) {\r\n        case 'auth/user-not-found':\r\n          toast.error(t('auth.errors.userNotFound'));\r\n          break;\r\n        case 'auth/wrong-password':\r\n          toast.error(t('auth.errors.wrongPassword'));\r\n          break;\r\n        case 'auth/invalid-credential':\r\n          toast.error(t('auth.errors.invalidCredential'));\r\n          break;\r\n        case 'auth/invalid-email':\r\n          toast.error(t('auth.errors.invalidEmail'));\r\n          break;\r\n        case 'auth/user-disabled':\r\n          toast.error(t('auth.errors.userDisabled'));\r\n          break;\r\n        case 'auth/too-many-requests':\r\n          toast.error(t('auth.errors.tooManyRequests'));\r\n          break;\r\n        default:\r\n          toast.error(t('auth.errors.loginError'));\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleShowForgotPassword = () => setShowForgotPassword(true);\r\n  const handleCloseForgotPassword = () => setShowForgotPassword(false);\r\n  const handleCloseOTP = () => {\r\n    setShowOTPVerification(false);\r\n    setPendingUserData(null);\r\n  };\r\n\r\n  // Show OTP verification screen\r\n  if (showOTPVerification && pendingUserData) {\r\n    return (\r\n      <OTPVerification\r\n        email={pendingUserData.email}\r\n        onVerificationSuccess={completeRegistrationAfterOTP}\r\n        onCancel={handleCloseOTP}\r\n      />\r\n    );\r\n  }\r\n\r\n  if (showForgotPassword) {\r\n    return <ForgotPassword onBack={handleCloseForgotPassword} />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow\">\r\n        <div className=\"text-center\">\r\n          <h2 className=\"mt-2 text-3xl font-extrabold text-gray-900\">\r\n            {isLogin ? t('auth.login') : t('auth.register')}\r\n          </h2>\r\n          <p className=\"mt-2 text-sm text-gray-600\">\r\n            {isLogin ? t('auth.welcomeBack') : t('auth.createNewAccount')}\r\n          </p>\r\n        </div>\r\n\r\n        <form className=\"space-y-6\" onSubmit={(e) => e.preventDefault()}>\r\n          {/* Email Field */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              {t('auth.email')}\r\n            </label>\r\n            <div className=\"relative\">\r\n              <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <input\r\n                type=\"email\"\r\n                name=\"email\"\r\n                value={formData.email}\r\n                onChange={handleInputChange}\r\n                className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                placeholder={t('auth.emailPlaceholder')}\r\n                required\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Display Name - Only for register */}\r\n          {!isLogin && (\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                {t('auth.displayName')}\r\n              </label>\r\n              <div className=\"relative\">\r\n                <UserIcon className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n                <input\r\n                  type=\"text\"\r\n                  name=\"displayName\"\r\n                  value={formData.displayName}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  placeholder={t('auth.displayNamePlaceholder')}\r\n                  required={!isLogin}\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Password Field */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              {t('auth.password')}\r\n            </label>\r\n            <div className=\"relative\">\r\n              <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n              <input\r\n                type={showPassword ? \"text\" : \"password\"}\r\n                name=\"password\"\r\n                value={formData.password}\r\n                onChange={handleInputChange}\r\n                className=\"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                placeholder={t('auth.passwordPlaceholder')}\r\n                required\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowPassword(!showPassword)}\r\n                className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n              >\r\n                {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Confirm Password - Only for register */}\r\n          {!isLogin && (\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                {t('auth.confirmPassword')}\r\n              </label>\r\n              <div className=\"relative\">\r\n                <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\r\n                <input\r\n                  type={showConfirmPassword ? \"text\" : \"password\"}\r\n                  name=\"confirmPassword\"\r\n                  value={formData.confirmPassword}\r\n                  onChange={handleInputChange}\r\n                  className=\"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  placeholder={t('auth.confirmPasswordPlaceholder')}\r\n                  required={!isLogin}\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}\r\n                  className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n                >\r\n                  {showConfirmPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Terms & Conditions - Only for register */}\r\n          {!isLogin && (\r\n            <div className=\"flex items-center\">\r\n              <input\r\n                type=\"checkbox\"\r\n                name=\"acceptTerms\"\r\n                checked={formData.acceptTerms}\r\n                onChange={handleInputChange}\r\n                className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n                required={!isLogin}\r\n              />\r\n              <label className=\"ml-2 text-sm text-gray-600\">\r\n                {t('auth.agreeToTerms')}{' '}\r\n                <a href=\"#\" className=\"text-blue-600 hover:text-blue-500\">\r\n                  {t('auth.termsOfService')}\r\n                </a>\r\n              </label>\r\n            </div>\r\n          )}\r\n\r\n          {/* Submit Button */}\r\n          <button\r\n            type=\"button\"\r\n            onClick={isLogin ? handleLogin : handleRegister}\r\n            disabled={loading}\r\n            className=\"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium\"\r\n          >\r\n            {loading ? t('loading') : (isLogin ? t('auth.login') : t('auth.register'))}\r\n          </button>\r\n\r\n          {/* Forgot Password Link - Only show for login */}\r\n          {isLogin && (\r\n            <div className=\"text-center mt-4\">\r\n              <button\r\n                type=\"button\"\r\n                className=\"text-sm text-blue-600 hover:underline\"\r\n                onClick={handleShowForgotPassword}\r\n              >\r\n                {t('auth.forgotPassword')}\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* Google Login */}\r\n          <div className=\"relative\">\r\n            <div className=\"absolute inset-0 flex items-center\">\r\n              <div className=\"w-full border-t border-gray-300\" />\r\n            </div>\r\n            <div className=\"relative flex justify-center text-sm\">\r\n              <span className=\"px-2 bg-white text-gray-500\">{t('or')}</span>\r\n            </div>\r\n          </div>\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={handleGoogleLogin}\r\n            disabled={loading}\r\n            className=\"w-full bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium flex items-center justify-center gap-2\"\r\n          >\r\n            <Chrome className=\"w-5 h-5\" />\r\n            {t('auth.loginWithGoogle')}\r\n          </button>\r\n\r\n          {/* Switch between login/register */}\r\n          <div className=\"text-center\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => {\r\n                setIsLogin(!isLogin);\r\n                setFormData({\r\n                  email: '',\r\n                  password: '',\r\n                  confirmPassword: '',\r\n                  displayName: '',\r\n                  acceptTerms: false\r\n                });\r\n              }}\r\n              className=\"text-blue-600 hover:text-blue-500 font-medium\"\r\n            >\r\n              {isLogin \r\n                ? t('auth.noAccount')\r\n                : t('auth.hasAccount')\r\n              }\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AuthPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\pages\\LoginPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\pages\\Profile.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1470,1473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1470,1473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2638,2641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2638,2641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":99,"column":33,"nodeType":"BlockStatement","messageId":"unexpected","endLine":99,"endColumn":35,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3571,3571],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":260,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9298,9301],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9298,9301],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":432,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":432,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16733,16736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16733,16736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":521,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":521,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20642,20645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20642,20645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":536,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":536,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21557,21560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21557,21560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-600\">\r\n                    Showing results\r\n                  </p>","line":596,"column":56,"nodeType":"JSXText","endLine":598,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button className=\"px-3 py-1 border border-gray-300 rounded text-sm\">\r\n                      Previous\r\n                    </button>","line":600,"column":90,"nodeType":"JSXText","endLine":602,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"px-3 py-1 text-sm text-gray-600\">\r\n                      Page info\r\n                    </span>","line":603,"column":71,"nodeType":"JSXText","endLine":605,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"block text-sm font-medium text-gray-700 mb-3\">Avatar</label>","line":640,"column":83,"nodeType":"JSXText","endLine":640,"endColumn":89},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"font-medium\">Avatar hi·ªán t·∫°i</p>","line":651,"column":52,"nodeType":"JSXText","endLine":651,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                          onClick={() => setAvatarUrl('')}\r\n                          className=\"text-red-600 hover:text-red-700 text-xs mt-1\"\r\n                        >\r\n                          X√≥a avatar\r\n                        </button>","line":655,"column":26,"nodeType":"JSXText","endLine":657,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <summary className=\"text-xs text-gray-500 cursor-pointer hover:text-gray-700\">\r\n                      Ho·∫∑c nh·∫≠p URL avatar th·ªß c√¥ng\r\n                    </summary>","line":688,"column":99,"nodeType":"JSXText","endLine":690,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>‚ö†Ô∏è {t('profile.currentPasswordRequired')}</p>","line":770,"column":24,"nodeType":"JSXText","endLine":770,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>‚úì {t('profile.passwordMinLength')}</p>","line":771,"column":24,"nodeType":"JSXText","endLine":771,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>‚úì {t('profile.passwordMustDiffer')}</p>","line":772,"column":24,"nodeType":"JSXText","endLine":772,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { RootState } from '../../../lib/store';\r\nimport { QuizResult } from '../../quiz/types';\r\nimport { Link } from 'react-router-dom';\r\nimport { fetchUserQuizResults } from '../../quiz/store';\r\nimport { updateProfile, updatePassword, reauthenticateWithCredential, EmailAuthProvider } from 'firebase/auth';\r\nimport { auth } from '../../../lib/firebase/config';\r\nimport { toast } from 'react-toastify';\r\nimport { getQuizById } from '../../quiz/api';\r\nimport { \r\n  User, \r\n  Trophy, \r\n  Clock, \r\n  Target, \r\n  TrendingUp, \r\n  Calendar,\r\n  Star,\r\n  ChevronRight,\r\n  Search,\r\n  ArrowUp,\r\n  ArrowDown,\r\n  Eye,\r\n  Edit3,\r\n  RotateCcw\r\n} from 'lucide-react';\r\nimport ImageUploader from '../../../components/ImageUploader';\r\nimport { ImageUploadResult } from '../../../services/imageUploadService';\r\n\r\nconst Profile: React.FC = () => {\r\n  const { t, i18n } = useTranslation();\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const userResults = useSelector((state: RootState) => state.quiz.userResults);\r\n  const dispatch = useDispatch();\r\n  \r\n  // State management\r\n  const [results, setResults] = useState<QuizResult[]>([]);\r\n  const [quizTitles, setQuizTitles] = useState<{[key: string]: string}>({});\r\n  // const [loading, setLoading] = useState(true);\r\n  const [stats, setStats] = useState<any>(null);\r\n  const [tab, setTab] = useState<'overview' | 'history' | 'achievements' | 'settings'>('overview');\r\n  \r\n  // Profile edit states\r\n  const [displayName, setDisplayName] = useState(user?.displayName || '');\r\n  const [currentPassword, setCurrentPassword] = useState(''); // M·∫≠t kh·∫©u c≈©\r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const [avatarUrl, setAvatarUrl] = useState(user?.photoURL || '');\r\n  const [saving, setSaving] = useState(false);\r\n  \r\n  // Enhanced pagination and filtering\r\n  const [itemsPerPage, setItemsPerPage] = useState(10);\r\n  const [currentPage, ] = useState(1);\r\n  const [showAll, setShowAll] = useState(false);\r\n  const [sortBy, setSortBy] = useState<'date' | 'score' | 'percentage'>('date');\r\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [filterByScore, setFilterByScore] = useState<'all' | 'high' | 'medium' | 'low'>('all');\r\n\r\n  // Load user data\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    // setLoading(true);\r\n    dispatch(fetchUserQuizResults(user.uid) as any);\r\n  }, [user, dispatch]);\r\n\r\n  // Process results and calculate stats\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    \r\n    const loadQuizTitles = async () => {\r\n      const titles: {[key: string]: string} = {};\r\n      \r\n      // Load quiz titles for all results\r\n      for (const result of userResults) {\r\n        if (!titles[result.quizId]) {\r\n          try {\r\n            const quiz = await getQuizById(result.quizId);\r\n            titles[result.quizId] = quiz?.title || t('quiz.untitled');\r\n          } catch (error) {\r\n            console.error('Error fetching quiz:', error);\r\n            titles[result.quizId] = t('quiz.untitled');\r\n          }\r\n        }\r\n      }\r\n      \r\n      setQuizTitles(titles);\r\n      setResults(userResults);\r\n    };\r\n    \r\n    if (userResults.length > 0) {\r\n      loadQuizTitles();\r\n    } else {\r\n      setResults([]);\r\n      setQuizTitles({});\r\n    }\r\n    \r\n    if (userResults.length > 0) {}\r\n    \r\n    // Calculate comprehensive stats with more accurate scoring\r\n    const totalQuizzes = userResults.length;\r\n    \r\n    // Calculate scores more accurately - prioritize correctAnswers/totalQuestions\r\n    const accurateScores = userResults.map(r => {\r\n      // Always prioritize correctAnswers/totalQuestions if available\r\n      if (typeof r.correctAnswers === 'number' && typeof r.totalQuestions === 'number' && r.totalQuestions > 0) {\r\n        return Math.round((r.correctAnswers / r.totalQuestions) * 100);\r\n      } \r\n      // Fallback to score field if it exists and is valid\r\n      else if (typeof r.score === 'number' && !isNaN(r.score)) {\r\n        return r.score <= 1 ? Math.round(r.score * 100) : Math.round(r.score);\r\n      }\r\n      // Last resort: 0\r\n      return 0;\r\n    });\r\n    \r\n    const totalScore = accurateScores.reduce((sum, score) => sum + score, 0);\r\n    const totalCorrect = userResults.reduce((sum, r) => sum + (r.correctAnswers || 0), 0);\r\n    const totalQuestions = userResults.reduce((sum, r) => sum + (r.totalQuestions || 0), 0);\r\n    const totalTime = userResults.reduce((sum, r) => sum + (r.timeSpent || 0), 0);\r\n    \r\n    const averageScore = totalQuizzes > 0 ? totalScore / totalQuizzes : 0;\r\n    const accuracy = totalQuestions > 0 ? (totalCorrect / totalQuestions) * 100 : 0;\r\n    const averageTime = totalQuizzes > 0 ? totalTime / totalQuizzes : 0;\r\n    \r\n    // Performance grades - use accurate scores\r\n    const perfectScores = accurateScores.filter(score => score >= 100).length;\r\n    const highScores = accurateScores.filter(score => score >= 80).length;\r\n    \r\n    console.log('üìä Calculated Stats:', {\r\n      totalQuizzes,\r\n      averageScore: averageScore.toFixed(1),\r\n      accuracy: accuracy.toFixed(1),\r\n      perfectScores,\r\n      highScores,\r\n      accurateScores: accurateScores.slice(0, 3) // Show first 3 for debugging\r\n    });\r\n    \r\n    setStats({\r\n      totalQuizzes,\r\n      totalScore,\r\n      averageScore,\r\n      accuracy,\r\n      averageTime,\r\n      perfectScores,\r\n      highScores,\r\n      recentActivity: userResults.slice(0, 5)\r\n    });\r\n    \r\n    // setLoading(false);\r\n  }, [userResults, user, t]);\r\n\r\n  // Filter and sort results\r\n  const filteredResults = results\r\n    .filter(result => {\r\n      // Search filter\r\n      if (searchTerm) {\r\n        const quizTitle = quizTitles[result.quizId] || t('quiz.untitled');\r\n        return quizTitle.toLowerCase().includes(searchTerm.toLowerCase());\r\n      }\r\n      return true;\r\n    })\r\n    .filter(result => {\r\n      // Score filter with guard\r\n      const percentage = result.totalQuestions > 0 ? (result.correctAnswers / result.totalQuestions) * 100 : 0;\r\n      switch (filterByScore) {\r\n        case 'high': return percentage >= 80;\r\n        case 'medium': return percentage >= 60 && percentage < 80;\r\n        case 'low': return percentage < 60;\r\n        default: return true;\r\n      }\r\n    })\r\n    .sort((a, b) => {\r\n      let comparison = 0;\r\n      const percentageA = a.totalQuestions > 0 ? (a.correctAnswers / a.totalQuestions) * 100 : 0;\r\n      const percentageB = b.totalQuestions > 0 ? (b.correctAnswers / b.totalQuestions) * 100 : 0;\r\n\r\n      switch (sortBy) {\r\n        case 'date':\r\n          comparison = new Date(b.completedAt).getTime() - new Date(a.completedAt).getTime();\r\n          break;\r\n        case 'score':\r\n          comparison = percentageB - percentageA; // Sort by percentage for score\r\n          break;\r\n        case 'percentage':\r\n          comparison = percentageB - percentageA;\r\n          break;\r\n        default:\r\n          comparison = 0;\r\n      }\r\n      return sortOrder === 'asc' ? -comparison : comparison;\r\n    });\r\n\r\n  // Pagination\r\n  // const totalPages = Math.ceil(filteredResults.length / itemsPerPage);\r\n  const startIndex = (currentPage - 1) * itemsPerPage;\r\n  const paginatedResults = showAll ? filteredResults : filteredResults.slice(startIndex, startIndex + itemsPerPage);\r\n\r\n  const handleProfileUpdate = async () => {\r\n    if (!user || !auth.currentUser) return;\r\n    \r\n    setSaving(true);\r\n    try {\r\n      await updateProfile(auth.currentUser, {\r\n        displayName: displayName,\r\n        photoURL: avatarUrl\r\n      });\r\n      toast.success(t('profile.profileUpdateSuccess'));\r\n    } catch (error) {\r\n      console.error('Error updating profile:', error);\r\n      toast.error(t('profile.profileUpdateError'));\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handlePasswordUpdate = async () => {\r\n    if (!auth.currentUser || !currentPassword || !newPassword || !confirmPassword) {\r\n      toast.error(t('profile.fillAllFields'));\r\n      return;\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      toast.error(t('profile.passwordMismatch'));\r\n      return;\r\n    }\r\n\r\n    if (newPassword.length < 6) {\r\n      toast.error(t('profile.passwordTooShort'));\r\n      return;\r\n    }\r\n\r\n    if (newPassword === currentPassword) {\r\n      toast.error(t('profile.passwordMustDiffer'));\r\n      return;\r\n    }\r\n\r\n    if (!auth.currentUser.email) {\r\n      toast.error(t('profile.emailNotFound'));\r\n      return;\r\n    }\r\n    \r\n    setSaving(true);\r\n    try {\r\n      // T·∫°o credential ƒë·ªÉ reauthenticate\r\n      const credential = EmailAuthProvider.credential(auth.currentUser.email, currentPassword);\r\n      \r\n      // X√ÅC TH·ª∞C L·∫†I NG∆Ø·ªúI D√ôNG TR∆Ø·ªöC KHI ƒê·ªîI M·∫¨T KH·∫®U\r\n      await reauthenticateWithCredential(auth.currentUser, credential);\r\n      \r\n      // N·∫øu x√°c th·ª±c th√†nh c√¥ng, ƒë·ªïi m·∫≠t kh·∫©u m·ªõi\r\n      await updatePassword(auth.currentUser, newPassword);\r\n      \r\n      // Reset form\r\n      setCurrentPassword('');\r\n      setNewPassword('');\r\n      setConfirmPassword('');\r\n      toast.success(t('profile.passwordChangeSuccess'));\r\n    } catch (error: any) {\r\n      console.error('Error updating password:', error);\r\n      if (error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {\r\n        toast.error(t('profile.wrongPassword'));\r\n      } else if (error.code === 'auth/weak-password') {\r\n        toast.error(t('profile.weakPassword'));\r\n      } else if (error.code === 'auth/requires-recent-login') {\r\n        toast.error(t('profile.requiresRecentLogin'));\r\n      } else {\r\n        toast.error(t('profile.passwordChangeError', {message: error.message}));\r\n      }\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const renderStatCard = (icon: React.ReactNode, title: string, value: string | number, subtitle?: string, color: string = 'bg-blue-500') => (\r\n    <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center space-x-4\">\r\n          <div className={`p-3 rounded-full ${color}`}>\r\n            {icon}\r\n          </div>\r\n          <div>\r\n            <p className=\"text-2xl font-bold text-gray-900\">{value}</p>\r\n            <p className=\"text-sm text-gray-600\">{title}</p>\r\n            {subtitle && <p className=\"text-xs text-gray-500\">{subtitle}</p>}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const renderQuizHistoryItem = (result: QuizResult) => {\r\n    console.log('üîç Rendering quiz result (RAW DATA):', {\r\n      id: result.id,\r\n      correctAnswers: result.correctAnswers,\r\n      totalQuestions: result.totalQuestions,\r\n      score: result.score,\r\n      quizId: result.quizId,\r\n      rawResult: result\r\n    });\r\n    \r\n    // Calculate percentage using consistent logic\r\n    let percentage = 0;\r\n    let calculationMethod = 'none';\r\n    \r\n    // Primary: Use correctAnswers/totalQuestions if available\r\n    if (typeof result.correctAnswers === 'number' && typeof result.totalQuestions === 'number' && result.totalQuestions > 0) {\r\n      percentage = Math.round((result.correctAnswers / result.totalQuestions) * 100);\r\n      calculationMethod = 'answers_calculation';\r\n    } \r\n    // Fallback: Use score field\r\n    else if (typeof result.score === 'number' && !isNaN(result.score)) {\r\n      percentage = result.score <= 1 ? Math.round(result.score * 100) : Math.round(result.score);\r\n      calculationMethod = result.score <= 1 ? 'score_decimal' : 'score_percentage';\r\n    } \r\n    // Last resort: 0\r\n    else {\r\n      console.warn('‚ö†Ô∏è No valid score data found for result:', result.id);\r\n      calculationMethod = 'fallback_zero';\r\n      percentage = 0;\r\n    }\r\n    \r\n    console.log('üíØ Score calculation result:', {\r\n      method: calculationMethod,\r\n      finalPercentage: percentage,\r\n      rawScore: result.score,\r\n      correctAnswers: result.correctAnswers,\r\n      totalQuestions: result.totalQuestions\r\n    });\r\n    \r\n    const getScoreColor = (percent: number) => {\r\n      if (percent >= 90) return 'text-green-600 bg-green-50';\r\n      if (percent >= 70) return 'text-blue-600 bg-blue-50';\r\n      if (percent >= 50) return 'text-yellow-600 bg-yellow-50';\r\n      return 'text-red-600 bg-red-50';\r\n    };\r\n\r\n    return (\r\n      <div key={result.id} className=\"bg-white rounded-lg border border-gray-100 p-4 hover:shadow-md transition-shadow\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex-1\">\r\n            <h4 className=\"font-semibold text-gray-900 mb-1\">{quizTitles[result.quizId] || t('quiz.untitled')}</h4>\r\n            <div className=\"flex items-center space-x-4 text-sm text-gray-600\">\r\n              <span className=\"flex items-center space-x-1\">\r\n                <Target className=\"w-4 h-4\" />\r\n                <span>{result.correctAnswers}/{result.totalQuestions}</span>\r\n              </span>\r\n              <span className=\"flex items-center space-x-1\">\r\n                <Clock className=\"w-4 h-4\" />\r\n                <span>{Math.round((result.timeSpent || 0) / 60)} {t('minutes')}</span>\r\n              </span>\r\n              <span className=\"flex items-center space-x-1\">\r\n                <Calendar className=\"w-4 h-4\" />\r\n                <span>{new Date(result.completedAt).toLocaleDateString(i18n.language)}</span>\r\n              </span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center space-x-3\">\r\n            <div className={`px-3 py-1 rounded-full text-sm font-medium ${getScoreColor(percentage)}`}>\r\n              {percentage}%\r\n            </div>\r\n            <Link\r\n              to={`/quiz/${result.quizId}/reviews`}\r\n              className=\"p-2 text-gray-400 hover:text-purple-600 transition-colors\"\r\n              title={t('profile.viewAgain')}\r\n            >\r\n              <RotateCcw className=\"w-4 h-4\" />\r\n            </Link>\r\n            <Link\r\n              to={`/quiz-result/${result.id}`}\r\n              className=\"p-2 text-gray-400 hover:text-blue-600 transition-colors\"\r\n              title={t('profile.viewDetails')}\r\n            >\r\n              <Eye className=\"w-4 h-4\" />\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (!user) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-600\">{t('profile.loginRequired')}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        {/* Header */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8\">\r\n          <div className=\"flex items-center space-x-6\">\r\n            <div className=\"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center\">\r\n              {user.photoURL ? (\r\n                <img src={user.photoURL} alt=\"Avatar\" className=\"w-full h-full rounded-full object-cover\" />\r\n              ) : (\r\n                <User className=\"w-10 h-10 text-white\" />\r\n              )}\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <h1 className=\"text-2xl font-bold text-gray-900\">{user.displayName || user.email}</h1>\r\n              <p className=\"text-gray-600\">{user.email}</p>\r\n              <p className=\"text-sm text-gray-500 mt-1\">{t('profile.memberSince')} {new Date().toLocaleDateString(i18n.language)}</p>\r\n            </div>\r\n            <button\r\n              onClick={() => setTab('settings')}\r\n              className=\"p-2 text-gray-400 hover:text-blue-600 transition-colors\"\r\n            >\r\n              <Edit3 className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Navigation Tabs */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 mb-8\">\r\n          <div className=\"flex space-x-8 px-6\">\r\n            {[\r\n              { id: 'overview', label: t('profile.tabs.overview'), icon: TrendingUp },\r\n              { id: 'history', label: t('profile.tabs.history'), icon: Clock },\r\n              { id: 'achievements', label: t('profile.tabs.achievements'), icon: Trophy },\r\n              { id: 'settings', label: t('profile.tabs.settings'), icon: User }\r\n            ].map(({ id, label, icon: Icon }) => (\r\n              <button\r\n                key={id}\r\n                onClick={() => setTab(id as any)}\r\n                className={`flex items-center space-x-2 py-4 border-b-2 transition-colors ${\r\n                  tab === id \r\n                    ? 'border-blue-500 text-blue-600' \r\n                    : 'border-transparent text-gray-600 hover:text-gray-900'\r\n                }`}\r\n              >\r\n                <Icon className=\"w-4 h-4\" />\r\n                <span>{label}</span>\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Tab Content */}\r\n        {tab === 'overview' && stats && (\r\n          <div>\r\n            {/* Stats Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\r\n              {renderStatCard(\r\n                <Trophy className=\"w-6 h-6 text-white\" />,\r\n                t('profile.stats.completedQuizzes'),\r\n                stats.totalQuizzes,\r\n                undefined,\r\n                'bg-yellow-500'\r\n              )}\r\n              {renderStatCard(\r\n                <Star className=\"w-6 h-6 text-white\" />,\r\n                t('profile.stats.averageScore'),\r\n                stats.averageScore.toFixed(1),\r\n                t('profile.stats.onTotal'),\r\n                'bg-blue-500'\r\n              )}\r\n              {renderStatCard(\r\n                <Target className=\"w-6 h-6 text-white\" />,\r\n                t('profile.stats.accuracy'),\r\n                `${stats.accuracy.toFixed(1)}%`,\r\n                t('profile.stats.correctRate'),\r\n                'bg-green-500'\r\n              )}\r\n              {renderStatCard(\r\n                <TrendingUp className=\"w-6 h-6 text-white\" />,\r\n                t('profile.stats.highScores'),\r\n                `${stats.highScores}/${stats.totalQuizzes}`,\r\n                t('profile.stats.over80'),\r\n                'bg-purple-500'\r\n              )}\r\n            </div>\r\n\r\n            {/* Recent Activity */}\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-6\">{t('profile.recentActivity')}</h3>\r\n              <div className=\"space-y-4\">\r\n                {stats.recentActivity.map((result: QuizResult) => renderQuizHistoryItem(result))}\r\n              </div>\r\n              {stats.totalQuizzes > 5 && (\r\n                <div className=\"mt-6 text-center\">\r\n                  <button\r\n                    onClick={() => setTab('history')}\r\n                    className=\"text-blue-600 hover:text-blue-700 font-medium flex items-center space-x-1 mx-auto\"\r\n                  >\r\n                    <span>{t('profile.viewAllHistory')}</span>\r\n                    <ChevronRight className=\"w-4 h-4\" />\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {tab === 'history' && (\r\n          <div>\r\n            {/* Filters and Search */}\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6\">\r\n              <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0\">\r\n                <div className=\"flex items-center space-x-4\">\r\n                  <div className=\"relative\">\r\n                    <Search className=\"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\r\n                    <input\r\n                      type=\"text\"\r\n                      placeholder={t('profile.searchPlaceholder')}\r\n                      value={searchTerm}\r\n                      onChange={(e) => setSearchTerm(e.target.value)}\r\n                      className=\"pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    />\r\n                  </div>\r\n                  \r\n                  <select\r\n                    value={filterByScore}\r\n                    onChange={(e) => setFilterByScore(e.target.value as any)}\r\n                    className=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  >\r\n                    <option value=\"all\">{t('profile.filters.score.all')}</option>\r\n                    <option value=\"high\">{t('profile.filters.score.high')}</option>\r\n                    <option value=\"medium\">{t('profile.filters.score.medium')}</option>\r\n                    <option value=\"low\">{t('profile.filters.score.low')}</option>\r\n                  </select>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-4\">\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <span className=\"text-sm text-gray-600\">{t('profile.sort.label')}:</span>\r\n                    <select\r\n                      value={sortBy}\r\n                      onChange={(e) => setSortBy(e.target.value as any)}\r\n                      className=\"px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500\"\r\n                    >\r\n                      <option value=\"date\">{t('profile.sort.date')}</option>\r\n                      <option value=\"score\">{t('profile.sort.score')}</option>\r\n                      <option value=\"percentage\">{t('profile.sort.percentage')}</option>\r\n                    </select>\r\n                    <button\r\n                      onClick={() => setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc')}\r\n                      className=\"p-1 text-gray-400 hover:text-gray-600\"\r\n                    >\r\n                      {sortOrder === 'asc' ? <ArrowUp className=\"w-4 h-4\" /> : <ArrowDown className=\"w-4 h-4\" />}\r\n                    </button>\r\n                  </div>\r\n\r\n                  <select\r\n                    value={itemsPerPage}\r\n                    onChange={(e) => setItemsPerPage(Number(e.target.value))}\r\n                    className=\"px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500\"\r\n                  >\r\n                    <option value={10}>{t('profile.pagination.perPage10')}</option>\r\n                    <option value={25}>{t('profile.pagination.perPage25')}</option>\r\n                    <option value={50}>{t('profile.pagination.perPage50')}</option>\r\n                    <option value={100}>{t('profile.pagination.perPage100')}</option>\r\n                  </select>\r\n\r\n                  {filteredResults.length > itemsPerPage && (\r\n                    <button\r\n                      onClick={() => setShowAll(!showAll)}\r\n                      className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm\"\r\n                    >\r\n                      {showAll ? t('profile.pagination.paginate') : t('profile.viewAllCount')}\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-4\">\r\n              {paginatedResults.length > 0 ? (\r\n                paginatedResults.map(result => renderQuizHistoryItem(result))\r\n              ) : (\r\n                  <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-8 text-center\">\r\n                    <Trophy className=\"w-16 h-16 text-gray-300 mx-auto mb-4\" />\r\n                    <h3 className=\"text-lg font-medium text-gray-900 mb-2\">{t('profile.noResults')}</h3>\r\n                    <p className=\"text-gray-600 mb-4\">{t('profile.noResultsDesc')}</p>\r\n                    <Link\r\n                      to=\"/quizzes\"\r\n                      className=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n                    >\r\n                      {t('quiz.exploreQuizzes')}\r\n                    </Link>\r\n                  </div>\r\n                )}\r\n            </div>\r\n            \r\n            {/* Pagination */}\r\n            {!showAll && filteredResults.length > itemsPerPage && (\r\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <p className=\"text-sm text-gray-600\">\r\n                    Showing results\r\n                  </p>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <button className=\"px-3 py-1 border border-gray-300 rounded text-sm\">\r\n                      Previous\r\n                    </button>\r\n                    <span className=\"px-3 py-1 text-sm text-gray-600\">\r\n                      Page info\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n        </div>\r\n        )}\r\n\r\n        {tab === 'achievements' && (\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-6\">{t('profile.achievements')}</h3>\r\n              <div className=\"text-center py-8\">\r\n                <Trophy className=\"w-16 h-16 text-gray-300 mx-auto mb-4\" />\r\n                <h4 className=\"text-lg font-medium text-gray-900 mb-2\">{t('profile.achievementSystem')}</h4>\r\n                <p className=\"text-gray-600\">{t('profile.inDevelopment')}</p>\r\n              </div>\r\n            </div>\r\n        )}\r\n\r\n        {tab === 'settings' && (\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {/* Profile Settings */}\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-6\">{t('profile.settings.title')}</h3>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t('auth.displayName')}</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={displayName}\r\n                    onChange={(e) => setDisplayName(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-3\">Avatar</label>\r\n                  \r\n                  {/* Current Avatar Preview */}\r\n                  {avatarUrl && (\r\n                    <div className=\"mb-4 flex items-center gap-4\">\r\n                      <img \r\n                        src={avatarUrl} \r\n                        alt=\"Current Avatar\" \r\n                        className=\"w-20 h-20 rounded-full object-cover border-2 border-gray-200\"\r\n                      />\r\n                      <div className=\"text-sm text-gray-600\">\r\n                        <p className=\"font-medium\">Avatar hi·ªán t·∫°i</p>\r\n                        <button\r\n                          onClick={() => setAvatarUrl('')}\r\n                          className=\"text-red-600 hover:text-red-700 text-xs mt-1\"\r\n                        >\r\n                          X√≥a avatar\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Image Uploader Component */}\r\n                  <ImageUploader\r\n                    onUploadSuccess={(result: ImageUploadResult) => {\r\n                      if (result.originalUrl) {\r\n                        setAvatarUrl(result.originalUrl);\r\n                        toast.success('Upload avatar th√†nh c√¥ng! Nh·∫•n \"C·∫≠p nh·∫≠t th√¥ng tin\" ƒë·ªÉ l∆∞u.');\r\n                      }\r\n                    }}\r\n                    onUploadError={(error) => {\r\n                      toast.error('L·ªói upload avatar: ' + error);\r\n                    }}\r\n                    options={{\r\n                      folder: 'avatars',\r\n                      maxSizeKB: 2048,\r\n                      allowedTypes: ['image/jpeg', 'image/png', 'image/webp'],\r\n                      generateThumbnails: true\r\n                    }}\r\n                    previewUrl={avatarUrl}\r\n                    label=\"\"\r\n                    showThumbnails={true}\r\n                    compressBeforeUpload={true}\r\n                    className=\"mb-4\"\r\n                  />\r\n\r\n                  {/* Fallback: Nh·∫≠p URL th·ªß c√¥ng */}\r\n                  <details className=\"mt-2\">\r\n                    <summary className=\"text-xs text-gray-500 cursor-pointer hover:text-gray-700\">\r\n                      Ho·∫∑c nh·∫≠p URL avatar th·ªß c√¥ng\r\n                    </summary>\r\n                    <input\r\n                      type=\"url\"\r\n                      value={avatarUrl}\r\n                      onChange={(e) => setAvatarUrl(e.target.value)}\r\n                      className=\"w-full mt-2 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                      placeholder={t('placeholders.avatarUrl')}\r\n                    />\r\n                  </details>\r\n                </div>\r\n                <button\r\n                  onClick={handleProfileUpdate}\r\n                  disabled={saving}\r\n                  className=\"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\r\n                >\r\n                  {saving ? t('profile.updating') : t('profile.updateProfile')}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Password Settings */}\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-6\">{t('profile.changePassword')}</h3>\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t('profile.currentPassword')}</label>\r\n                  <input\r\n                    type=\"password\"\r\n                    value={currentPassword}\r\n                    onChange={(e) => setCurrentPassword(e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder={t('profile.currentPasswordRequired')}\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t('profile.newPassword')}</label>\r\n                  <input\r\n                    type=\"password\"\r\n                    value={newPassword}\r\n                    onChange={(e) => setNewPassword(e.target.value)}\r\n                    className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${\r\n                      newPassword && newPassword.length < 6 ? 'border-red-300' : 'border-gray-300'\r\n                    }`}\r\n                    placeholder={t('profile.passwordTooShort')}\r\n                  />\r\n                  {newPassword && newPassword.length < 6 && (\r\n                    <p className=\"text-xs text-red-500 mt-1\">{t('profile.passwordTooShort')}</p>\r\n                  )}\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">{t('profile.confirmNewPassword')}</label>\r\n                  <input\r\n                    type=\"password\"\r\n                    value={confirmPassword}\r\n                    onChange={(e) => setConfirmPassword(e.target.value)}\r\n                    className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${\r\n                      confirmPassword && newPassword !== confirmPassword ? 'border-red-300' : 'border-gray-300'\r\n                    }`}\r\n                    placeholder={t('profile.passwordMismatch')}\r\n                  />\r\n                  {confirmPassword && newPassword !== confirmPassword && (\r\n                    <p className=\"text-xs text-red-500 mt-1\">{t('profile.passwordMismatch')}</p>\r\n                  )}\r\n                </div>\r\n                <button\r\n                  onClick={handlePasswordUpdate}\r\n                  disabled={\r\n                    saving || \r\n                    !currentPassword || \r\n                    !newPassword || \r\n                    !confirmPassword ||\r\n                    newPassword.length < 6 ||\r\n                    newPassword !== confirmPassword ||\r\n                    newPassword === currentPassword\r\n                  }\r\n                  className=\"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors\"\r\n                >\r\n                  {saving ? t('profile.authenticating') : t('profile.changePassword')}\r\n                </button>\r\n                  <div className=\"text-xs text-gray-500 space-y-1\">\r\n                    <p>‚ö†Ô∏è {t('profile.currentPasswordRequired')}</p>\r\n                    <p>‚úì {t('profile.passwordMinLength')}</p>\r\n                    <p>‚úì {t('profile.passwordMustDiffer')}</p>\r\n                  </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Profile;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\services.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\services\\authService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\services\\otpService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5372,5375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5372,5375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6459,6462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6459,6462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import CryptoJS from 'crypto-js';\r\nimport { getFirestore, collection, addDoc } from 'firebase/firestore';\r\n\r\n// Initialize Firestore\r\nconst db = getFirestore();\r\n\r\n// Secret key ƒë·ªÉ hash OTP (trong production n√™n l∆∞u trong env)\r\nconst OTP_SECRET = import.meta.env.VITE_OTP_SECRET || 'quiz-app-otp-secret-2025';\r\nconst OTP_EXPIRY_MINUTES = 10;\r\n\r\ntype OTPMetadata = Record<string, unknown> & {\r\n  remaining?: number;\r\n};\r\n\r\nexport interface OTPData {\r\n  email: string;\r\n  hashedOTP: string;\r\n  expiresAt: number;\r\n  attempts: number;\r\n  maxAttempts: number;\r\n}\r\n\r\n/**\r\n * Generate random 6-digit OTP\r\n */\r\nexport const generateOTP = (): string => {\r\n  return Math.floor(100000 + Math.random() * 900000).toString();\r\n};\r\n\r\n/**\r\n * Hash OTP v·ªõi email ƒë·ªÉ b·∫£o m·∫≠t\r\n */\r\nconst hashOTP = (email: string, otp: string): string => {\r\n  return CryptoJS.SHA256(email + otp + OTP_SECRET).toString();\r\n};\r\n\r\n/**\r\n * Store OTP v√†o sessionStorage (kh√¥ng d√πng Firestore ƒë·ªÉ tr√°nh l·ªói permissions)\r\n */\r\nexport const storeOTP = (email: string, otp: string): void => {\r\n  const otpData: OTPData = {\r\n    email: email.toLowerCase().trim(),\r\n    hashedOTP: hashOTP(email, otp),\r\n    expiresAt: Date.now() + OTP_EXPIRY_MINUTES * 60 * 1000,\r\n    attempts: 0,\r\n    maxAttempts: 3\r\n  };\r\n\r\n  // L∆∞u v√†o sessionStorage (ch·ªâ t·ªìn t·∫°i trong tab hi·ªán t·∫°i)\r\n  sessionStorage.setItem(`otp_${email.toLowerCase()}`, JSON.stringify(otpData));\r\n  \r\n  console.log('‚úÖ OTP stored securely (hashed)');\r\n};\r\n\r\n/**\r\n * G·ª≠i OTP qua Firestore Trigger Email Extension\r\n * Extension s·∫Ω t·ª± ƒë·ªông g·ª≠i email khi c√≥ document m·ªõi trong collection 'mail'\r\n */\r\nexport const sendOTPEmail = async (\r\n  email: string,\r\n  otp: string\r\n): Promise<{\r\n  success: boolean;\r\n  code: 'otp.emailQueued' | 'otp.emailQueueFailed';\r\n  errorCode?: string;\r\n  details?: string;\r\n}> => {\r\n  try {\r\n    // T·∫°o HTML template cho email OTP\r\n    const emailHTML = `\r\n      <!DOCTYPE html>\r\n      <html>\r\n      <head>\r\n        <meta charset=\"utf-8\">\r\n        <style>\r\n          body { font-family: Arial, sans-serif; line-height: 1.6; background-color: #f4f4f4; margin: 0; padding: 20px; }\r\n          .container { max-width: 600px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }\r\n          .header { text-align: center; margin-bottom: 30px; }\r\n          .logo { font-size: 32px; font-weight: bold; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }\r\n          .otp-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 8px; margin: 30px 0; }\r\n          .otp-code { font-size: 48px; font-weight: bold; letter-spacing: 8px; margin: 10px 0; }\r\n          .warning { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 4px; }\r\n          .footer { text-align: center; color: #6b7280; font-size: 14px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        <div class=\"container\">\r\n          <div class=\"header\">\r\n            <div class=\"logo\">üß† Quiz App</div>\r\n            <h2 style=\"color: #1f2937; margin-top: 10px;\">M√£ X√°c Th·ª±c OTP</h2>\r\n          </div>\r\n          \r\n          <p style=\"color: #374151;\">Xin ch√†o,</p>\r\n          <p style=\"color: #374151;\">B·∫°n ƒë√£ y√™u c·∫ßu ƒëƒÉng k√Ω t√†i kho·∫£n t·∫°i <strong>Quiz App</strong>.</p>\r\n          <p style=\"color: #374151;\">Vui l√≤ng s·ª≠ d·ª•ng m√£ OTP b√™n d∆∞·ªõi ƒë·ªÉ ho√†n t·∫•t qu√° tr√¨nh ƒëƒÉng k√Ω:</p>\r\n          \r\n          <div class=\"otp-box\">\r\n            <div style=\"font-size: 16px; opacity: 0.9;\">M√É X√ÅC TH·ª∞C C·ª¶A B·∫†N</div>\r\n            <div class=\"otp-code\">${otp}</div>\r\n            <div style=\"font-size: 14px; margin-top: 10px; opacity: 0.9;\">‚è±Ô∏è C√≥ hi·ªáu l·ª±c trong 10 ph√∫t</div>\r\n          </div>\r\n          \r\n          <div class=\"warning\">\r\n            <strong style=\"color: #92400e;\">‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</strong>\r\n            <ul style=\"margin: 10px 0; color: #92400e;\">\r\n              <li>M√£ OTP n√†y ch·ªâ c√≥ hi·ªáu l·ª±c trong <strong>10 ph√∫t</strong></li>\r\n              <li><strong>KH√îNG chia s·∫ª</strong> m√£ n√†y v·ªõi b·∫•t k·ª≥ ai</li>\r\n              <li>N·∫øu b·∫°n kh√¥ng y√™u c·∫ßu ƒëƒÉng k√Ω, vui l√≤ng b·ªè qua email n√†y</li>\r\n            </ul>\r\n          </div>\r\n          \r\n          <p style=\"color: #374151;\">Tr√¢n tr·ªçng,<br><strong>Quiz App Team</strong> üéØ</p>\r\n          \r\n          <div class=\"footer\">\r\n            <p>Email n√†y ƒë∆∞·ª£c g·ª≠i t·ª± ƒë·ªông, vui l√≤ng kh√¥ng tr·∫£ l·ªùi.</p>\r\n            <p>¬© 2025 Quiz App. All rights reserved.</p>\r\n          </div>\r\n        </div>\r\n      </body>\r\n      </html>\r\n    `;\r\n\r\n    // T·∫°o document trong collection 'mail' - Extension s·∫Ω t·ª± ƒë·ªông g·ª≠i\r\n    await addDoc(collection(db, 'mail'), {\r\n      to: [email],\r\n      from: 'lequytoanptit0303@gmail.com', // Default FROM address t·ª´ extension config\r\n      replyTo: 'lequytoanptit0303@gmail.com',\r\n      message: {\r\n        subject: 'üîê M√£ x√°c th·ª±c ƒëƒÉng k√Ω Quiz App',\r\n        html: emailHTML,\r\n        text: `M√£ OTP c·ªßa b·∫°n l√†: ${otp}. M√£ n√†y c√≥ hi·ªáu l·ª±c trong 10 ph√∫t.`\r\n      },\r\n      createdAt: new Date()\r\n    });\r\n\r\n    console.log('‚úÖ Email queued successfully via Firestore extension');\r\n\r\n    return {\r\n      success: true,\r\n      code: 'otp.emailQueued'\r\n    };\r\n  } catch (error: any) {\r\n    console.error('Error queuing email:', error);\r\n    return {\r\n      success: false,\r\n      code: 'otp.emailQueueFailed',\r\n      errorCode: error?.code,\r\n      details: error?.message\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Generate v√† g·ª≠i OTP\r\n */\r\nexport const generateAndSendOTP = async (\r\n  email: string\r\n): Promise<{\r\n  success: boolean;\r\n  code: 'otp.sent' | 'otp.emailFailed' | 'otp.genericError';\r\n  metadata?: OTPMetadata;\r\n}> => {\r\n  try {\r\n    // Generate OTP\r\n    const otp = generateOTP();\r\n    \r\n    // Store OTP locally (hashed)\r\n    storeOTP(email, otp);\r\n    \r\n    // Send OTP via Cloud Function\r\n    const result = await sendOTPEmail(email, otp);\r\n    \r\n    if (result.success) {\r\n      return {\r\n        success: true,\r\n        code: 'otp.sent',\r\n        metadata: { email }\r\n      };\r\n    }\r\n\r\n    // Clear stored OTP n·∫øu g·ª≠i th·∫•t b·∫°i\r\n    clearOTP(email);\r\n    return {\r\n      success: false,\r\n      code: 'otp.emailFailed',\r\n      metadata: {\r\n        email,\r\n        errorCode: result.errorCode,\r\n        details: result.details\r\n      }\r\n    };\r\n  } catch (error: any) {\r\n    console.error('Error generating and sending OTP:', error);\r\n    return {\r\n      success: false,\r\n      code: 'otp.genericError',\r\n      metadata: {\r\n        email,\r\n        details: error?.message\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Verify OTP\r\n */\r\nexport const verifyOTP = (\r\n  email: string,\r\n  inputOTP: string\r\n): {\r\n  success: boolean;\r\n  code: 'otp.verifySuccess' | 'otp.notFound' | 'otp.expired' | 'otp.maxAttempts' | 'otp.incorrect' | 'otp.genericError';\r\n  metadata?: OTPMetadata;\r\n} => {\r\n  const storageKey = `otp_${email.toLowerCase()}`;\r\n  const storedData = sessionStorage.getItem(storageKey);\r\n\r\n  if (!storedData) {\r\n    return { success: false, code: 'otp.notFound' };\r\n  }\r\n\r\n  try {\r\n    const otpData: OTPData = JSON.parse(storedData);\r\n\r\n    // Check expiry\r\n    if (Date.now() > otpData.expiresAt) {\r\n      sessionStorage.removeItem(storageKey);\r\n      return { success: false, code: 'otp.expired' };\r\n    }\r\n\r\n    // Check max attempts\r\n    if (otpData.attempts >= otpData.maxAttempts) {\r\n      sessionStorage.removeItem(storageKey);\r\n      return { success: false, code: 'otp.maxAttempts' };\r\n    }\r\n\r\n    // Verify OTP\r\n    const inputHash = hashOTP(email, inputOTP);\r\n    if (inputHash === otpData.hashedOTP) {\r\n      // Success - x√≥a OTP\r\n      sessionStorage.removeItem(storageKey);\r\n      return { success: true, code: 'otp.verifySuccess' };\r\n    } else {\r\n      // Failed - tƒÉng attempts\r\n      otpData.attempts += 1;\r\n      sessionStorage.setItem(storageKey, JSON.stringify(otpData));\r\n      \r\n      const remaining = otpData.maxAttempts - otpData.attempts;\r\n      return { \r\n        success: false, \r\n        code: 'otp.incorrect',\r\n        metadata: { remaining }\r\n      };\r\n    }\r\n  } catch (error) {\r\n    console.error('Error verifying OTP:', error);\r\n    return { success: false, code: 'otp.genericError' };\r\n  }\r\n};\r\n\r\n/**\r\n * Clear OTP data\r\n */\r\nexport const clearOTP = (email: string): void => {\r\n  sessionStorage.removeItem(`otp_${email.toLowerCase()}`);\r\n};\r\n\r\n/**\r\n * Get OTP expiry time\r\n */\r\nexport const getOTPExpiryTime = (email: string): number | null => {\r\n  const storageKey = `otp_${email.toLowerCase()}`;\r\n  const storedData = sessionStorage.getItem(storageKey);\r\n\r\n  if (!storedData) return null;\r\n\r\n  try {\r\n    const otpData: OTPData = JSON.parse(storedData);\r\n    return otpData.expiresAt;\r\n  } catch {\r\n    return null;\r\n  }\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\store\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\auth\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\creator\\components\\CreatorNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\creator\\layouts\\CreatorLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\CreateRoomModal.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              <Clock className=\"w-4 h-4 inline mr-2\" />\r\n              {t('multiplayer.timeLimit')} ({MIN_TIME_LIMIT}-{MAX_TIME_LIMIT} gi√¢y)\r\n            </label>","line":133,"column":78,"nodeType":"JSXText","endLine":134,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-gray-500 mt-1\">\r\n              T·ª´ {MIN_TIME_LIMIT} ƒë·∫øn {MAX_TIME_LIMIT} gi√¢y cho m·ªói c√¢u h·ªèi (t·ªëi ƒëa 5 ph√∫t)\r\n            </p>","line":151,"column":55,"nodeType":"JSXText","endLine":152,"endColumn":18},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-gray-500 mt-1\">\r\n              T·ª´ {MIN_TIME_LIMIT} ƒë·∫øn {MAX_TIME_LIMIT} gi√¢y cho m·ªói c√¢u h·ªèi (t·ªëi ƒëa 5 ph√∫t)\r\n            </p>","line":152,"column":34,"nodeType":"JSXText","endLine":152,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-gray-500 mt-1\">\r\n              T·ª´ {MIN_TIME_LIMIT} ƒë·∫øn {MAX_TIME_LIMIT} gi√¢y cho m·ªói c√¢u h·ªèi (t·ªëi ƒëa 5 ph√∫t)\r\n            </p>","line":152,"column":55,"nodeType":"JSXText","endLine":153,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-blue-600\">\r\n                  {selectedQuiz.questions?.length || 0} c√¢u h·ªèi\r\n                </div>","line":222,"column":56,"nodeType":"JSXText","endLine":223,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { X, Lock, Users, Clock, Settings } from 'lucide-react';\r\nimport type { Quiz, RoomConfig } from '../types/index';\r\n\r\ninterface CreateRoomModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onCreateRoom: (roomConfig: RoomConfig) => void;\r\n  selectedQuiz?: Quiz;\r\n  loading?: boolean;\r\n}\r\n\r\nconst CreateRoomModal: React.FC<CreateRoomModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onCreateRoom,\r\n  selectedQuiz,\r\n  loading = false\r\n}) => {\r\n  const { t } = useTranslation();\r\n  const [roomName, setRoomName] = useState('');\r\n  const [maxPlayers, setMaxPlayers] = useState(4);\r\n  const [timeLimit, setTimeLimit] = useState(30);\r\n  const [isPrivate, setIsPrivate] = useState(false);\r\n  const [password, setPassword] = useState('');\r\n  const [showLeaderboard, setShowLeaderboard] = useState(true);\r\n  \r\n  // Reset password when isPrivate is unchecked\r\n  React.useEffect(() => {\r\n    if (!isPrivate) {\r\n      setPassword('');\r\n    }\r\n  }, [isPrivate]);\r\n\r\n  // Constants for validation\r\n  const MIN_TIME_LIMIT = 5;\r\n  const MAX_TIME_LIMIT = 300; // 5 minutes max for better UX\r\n  const MIN_PLAYERS = 2;\r\n  const MAX_PLAYERS = 20;\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!roomName.trim()) {\r\n      return;\r\n    }\r\n\r\n    const roomConfig = {\r\n      name: roomName.trim(),\r\n      maxPlayers,\r\n      isPrivate,\r\n      password: isPrivate ? password : undefined,\r\n      settings: {\r\n        timePerQuestion: timeLimit,\r\n        showLeaderboard,\r\n        allowLateJoin: true\r\n      }\r\n    };\r\n\r\n    console.log('üèóÔ∏è CreateRoomModal: Submitting room config', {\r\n      isPrivate,\r\n      hasPassword: !!password,\r\n      roomConfig\r\n    });\r\n\r\n    onCreateRoom(roomConfig);\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-6 border-b\">\r\n          <h2 className=\"text-xl font-bold text-gray-900\">\r\n            {t('multiplayer.createRoom')}\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\r\n          {/* Room Name */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              {t('multiplayer.roomName')}\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              value={roomName}\r\n              onChange={(e) => setRoomName(e.target.value)}\r\n              placeholder={t('multiplayer.enterRoomName')}\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              required\r\n              disabled={loading}\r\n            />\r\n          </div>\r\n\r\n          {/* Max Players */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              <Users className=\"w-4 h-4 inline mr-2\" />\r\n              {t('multiplayer.maxPlayers')} ({MIN_PLAYERS}-{MAX_PLAYERS})\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              value={maxPlayers}\r\n              onChange={(e) => {\r\n                const value = parseInt(e.target.value);\r\n                if (value >= MIN_PLAYERS && value <= MAX_PLAYERS) {\r\n                  setMaxPlayers(value);\r\n                }\r\n              }}\r\n              min={MIN_PLAYERS}\r\n              max={MAX_PLAYERS}\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              required\r\n              disabled={loading}\r\n            />\r\n          </div>\r\n\r\n          {/* Time Limit */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              <Clock className=\"w-4 h-4 inline mr-2\" />\r\n              {t('multiplayer.timeLimit')} ({MIN_TIME_LIMIT}-{MAX_TIME_LIMIT} gi√¢y)\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              value={timeLimit}\r\n              onChange={(e) => {\r\n                const value = parseInt(e.target.value);\r\n                if (value >= MIN_TIME_LIMIT && value <= MAX_TIME_LIMIT) {\r\n                  setTimeLimit(value);\r\n                }\r\n              }}\r\n              min={MIN_TIME_LIMIT}\r\n              max={MAX_TIME_LIMIT}\r\n              placeholder={t('placeholders.enterNumber')}\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              required\r\n              disabled={loading}\r\n            />\r\n            <p className=\"text-xs text-gray-500 mt-1\">\r\n              T·ª´ {MIN_TIME_LIMIT} ƒë·∫øn {MAX_TIME_LIMIT} gi√¢y cho m·ªói c√¢u h·ªèi (t·ªëi ƒëa 5 ph√∫t)\r\n            </p>\r\n          </div>\r\n\r\n          {/* Settings */}\r\n          <div className=\"space-y-4\">\r\n            <h3 className=\"text-sm font-medium text-gray-700 flex items-center\">\r\n              <Settings className=\"w-4 h-4 mr-2\" />\r\n              {t('multiplayer.roomSettings')}\r\n            </h3>\r\n\r\n            {/* Show Leaderboard */}\r\n            <div className=\"flex items-center\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"showLeaderboard\"\r\n                checked={showLeaderboard}\r\n                onChange={(e) => setShowLeaderboard(e.target.checked)}\r\n                className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n                disabled={loading}\r\n              />\r\n              <label htmlFor=\"showLeaderboard\" className=\"ml-2 text-sm text-gray-700\">\r\n                {t('multiplayer.showLeaderboard')}\r\n              </label>\r\n            </div>\r\n\r\n            {/* Private Room */}\r\n            <div className=\"flex items-center\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"isPrivate\"\r\n                checked={isPrivate}\r\n                onChange={(e) => setIsPrivate(e.target.checked)}\r\n                className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n                disabled={loading}\r\n              />\r\n              <label htmlFor=\"isPrivate\" className=\"ml-2 text-sm text-gray-700 flex items-center\">\r\n                <Lock className=\"w-4 h-4 mr-1\" />\r\n                {t('multiplayer.private')}\r\n              </label>\r\n            </div>\r\n\r\n            {/* Password */}\r\n            {isPrivate && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('multiplayer.password')}\r\n                </label>\r\n                <input\r\n                  type=\"password\"\r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                  placeholder={t('multiplayer.enterPassword')}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  required={isPrivate}\r\n                  disabled={loading}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Selected Quiz Info */}\r\n          {selectedQuiz && (\r\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n              <h4 className=\"font-medium text-blue-900 mb-2\">\r\n                {t('quiz.selectedQuiz')}\r\n              </h4>\r\n              <div className=\"text-sm text-blue-800\">\r\n                <div className=\"font-medium\">{selectedQuiz.title}</div>\r\n                <div className=\"text-blue-600\">\r\n                  {selectedQuiz.questions?.length || 0} c√¢u h·ªèi\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Actions */}\r\n          <div className=\"flex gap-3 pt-4\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors\"\r\n              disabled={loading}\r\n            >\r\n              {t('common.cancel')}\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              className=\"flex-1 px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors font-medium\"\r\n              disabled={loading}\r\n            >\r\n              {loading ? t('common.loading') : t('multiplayer.createRoom')}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CreateRoomModal;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\GameModeSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\GameResults.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-600\">\r\n                  {player.correctAnswers}/{player.totalAnswers} {t('common.correct')} ‚Ä¢ \r\n                  {Math.round(player.averageTime)}s {t('common.avgTime')}\r\n                </div>","line":145,"column":51,"nodeType":"JSXText","endLine":145,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-2xl font-bold text-gray-900\">\r\n            {Math.round(gameStats.totalTime / 60)}m\r\n          </div>","line":188,"column":51,"nodeType":"JSXText","endLine":189,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Trophy, Medal, Award, Users, Clock, Target } from 'lucide-react';\r\n\r\ninterface Player {\r\n  id: string;\r\n  username: string;\r\n  score: number;\r\n  correctAnswers: number;\r\n  totalAnswers: number;\r\n  averageTime: number;\r\n  rank: number;\r\n}\r\n\r\ninterface GameResultsProps {\r\n  players?: Player[];\r\n  currentUserId?: string;\r\n  gameStats?: {\r\n    totalQuestions: number;\r\n    totalTime: number;\r\n    averageScore: number;\r\n  };\r\n  onPlayAgain?: () => void;\r\n  onBackToLobby?: () => void;\r\n  onLeaveRoom?: () => void;\r\n}\r\n\r\nconst GameResults: React.FC<GameResultsProps> = ({\r\n  players = [],\r\n  currentUserId = '',\r\n  gameStats = { totalQuestions: 0, totalTime: 0, averageScore: 0 },\r\n  onPlayAgain,\r\n  onBackToLobby,\r\n  onLeaveRoom\r\n}) => {\r\n  const { t } = useTranslation();\r\n\r\n  // Memoize expensive computations\r\n  const currentPlayer = useMemo(\r\n    () => players.find(p => p.id === currentUserId),\r\n    [players, currentUserId]\r\n  );\r\n\r\n  const sortedPlayers = useMemo(\r\n    () => [...players].sort((a, b) => b.score - a.score),\r\n    [players]\r\n  );\r\n\r\n  const getRankIcon = (rank: number) => {\r\n    switch (rank) {\r\n      case 1:\r\n        return <Trophy className=\"w-6 h-6 text-yellow-500\" />;\r\n      case 2:\r\n        return <Medal className=\"w-6 h-6 text-gray-400\" />;\r\n      case 3:\r\n        return <Award className=\"w-6 h-6 text-orange-500\" />;\r\n      default:\r\n        return <div className=\"w-6 h-6 flex items-center justify-center text-gray-500 font-bold\">#{rank}</div>;\r\n    }\r\n  };\r\n\r\n  const getRankColor = (rank: number) => {\r\n    switch (rank) {\r\n      case 1:\r\n        return 'bg-gradient-to-r from-yellow-100 to-yellow-200 border-yellow-300';\r\n      case 2:\r\n        return 'bg-gradient-to-r from-gray-100 to-gray-200 border-gray-300';\r\n      case 3:\r\n        return 'bg-gradient-to-r from-orange-100 to-orange-200 border-orange-300';\r\n      default:\r\n        return 'bg-gray-50 border-gray-200';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto p-4 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"text-center space-y-4\">\r\n        <div className=\"flex items-center justify-center gap-3\">\r\n          <Trophy className=\"w-8 h-8 text-yellow-500\" />\r\n          <h1 className=\"text-3xl font-bold text-gray-900\">\r\n            {t('multiplayer.game.gameOver')}\r\n          </h1>\r\n        </div>\r\n        \r\n        {currentPlayer && (\r\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 inline-block\">\r\n            <div className=\"text-lg font-semibold text-blue-900\">\r\n              {t('multiplayer.yourResult')}\r\n            </div>\r\n            <div className=\"flex items-center justify-center gap-6 mt-2 text-blue-800\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold\">{currentPlayer.score}</div>\r\n                <div className=\"text-sm\">{t('common.points')}</div>\r\n              </div>\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold\">#{currentPlayer.rank}</div>\r\n                <div className=\"text-sm\">{t('common.rank')}</div>\r\n              </div>\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold\">\r\n                  {Math.round((currentPlayer.correctAnswers / currentPlayer.totalAnswers) * 100)}%\r\n                </div>\r\n                <div className=\"text-sm\">{t('common.accuracy')}</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Final Leaderboard */}\r\n      <div className=\"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden\">\r\n        <div className=\"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4\">\r\n          <h2 className=\"text-xl font-bold flex items-center gap-2\">\r\n            <Trophy className=\"w-6 h-6\" />\r\n            {t('multiplayer.game.finalResults')}\r\n          </h2>\r\n        </div>\r\n        \r\n        <div className=\"divide-y divide-gray-200\">\r\n          {sortedPlayers.map((player, index) => (\r\n            <div\r\n              key={player.id}\r\n              className={`p-4 flex items-center gap-4 ${getRankColor(index + 1)} ${\r\n                player.id === currentUserId ? 'ring-2 ring-blue-500' : ''\r\n              }`}\r\n            >\r\n              {/* Rank */}\r\n              <div className=\"flex items-center justify-center w-12\">\r\n                {getRankIcon(index + 1)}\r\n              </div>\r\n\r\n              {/* Player Info */}\r\n              <div className=\"flex-1\">\r\n                <div className=\"font-semibold text-gray-900 flex items-center gap-2\">\r\n                  {player.username}\r\n                  {player.id === currentUserId && (\r\n                    <span className=\"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full\">\r\n                      {t('common.you')}\r\n                    </span>\r\n                  )}\r\n                </div>\r\n                <div className=\"text-sm text-gray-600\">\r\n                  {player.correctAnswers}/{player.totalAnswers} {t('common.correct')} ‚Ä¢ \r\n                  {Math.round(player.averageTime)}s {t('common.avgTime')}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Score */}\r\n              <div className=\"text-right\">\r\n                <div className=\"text-xl font-bold text-gray-900\">\r\n                  {player.score}\r\n                </div>\r\n                <div className=\"text-xs text-gray-500\">\r\n                  {t('common.points')}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Accuracy */}\r\n              <div className=\"text-right w-16\">\r\n                <div className=\"text-lg font-semibold text-gray-700\">\r\n                  {Math.round((player.correctAnswers / player.totalAnswers) * 100)}%\r\n                </div>\r\n                <div className=\"text-xs text-gray-500\">\r\n                  {t('common.accuracy')}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Game Stats */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n        <div className=\"bg-white rounded-lg shadow border border-gray-200 p-4 text-center\">\r\n          <Target className=\"w-8 h-8 text-blue-600 mx-auto mb-2\" />\r\n          <div className=\"text-2xl font-bold text-gray-900\">\r\n            {gameStats.totalQuestions}\r\n          </div>\r\n          <div className=\"text-sm text-gray-600\">\r\n            {t('multiplayer.totalQuestions')}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white rounded-lg shadow border border-gray-200 p-4 text-center\">\r\n          <Clock className=\"w-8 h-8 text-green-600 mx-auto mb-2\" />\r\n          <div className=\"text-2xl font-bold text-gray-900\">\r\n            {Math.round(gameStats.totalTime / 60)}m\r\n          </div>\r\n          <div className=\"text-sm text-gray-600\">\r\n            {t('multiplayer.totalTime')}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white rounded-lg shadow border border-gray-200 p-4 text-center\">\r\n          <Users className=\"w-8 h-8 text-purple-600 mx-auto mb-2\" />\r\n          <div className=\"text-2xl font-bold text-gray-900\">\r\n            {Math.round(gameStats.averageScore)}\r\n          </div>\r\n          <div className=\"text-sm text-gray-600\">\r\n            {t('multiplayer.avgScore')}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Actions */}\r\n      <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\r\n        {onPlayAgain && (\r\n          <button\r\n            onClick={onPlayAgain}\r\n            className=\"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium\"\r\n          >\r\n            {t('multiplayer.playAgain')}\r\n          </button>\r\n        )}\r\n        \r\n        {onBackToLobby && (\r\n          <button\r\n            onClick={onBackToLobby}\r\n            className=\"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium\"\r\n          >\r\n            {t('multiplayer.backToLobby')}\r\n          </button>\r\n        )}\r\n        \r\n        {onLeaveRoom && (\r\n          <button\r\n            onClick={onLeaveRoom}\r\n            className=\"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium\"\r\n          >\r\n            {t('multiplayer.leaveRoom')}\r\n          </button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GameResults;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\JoinRoomModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3073,3076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3073,3076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has missing dependencies: 'checkingCode' and 'step'. Either include them or remove the dependency array.","line":113,"column":6,"nodeType":"ArrayExpression","endLine":113,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [roomCode, loading, step, checkingCode]","fix":{"range":[3788,3807],"text":"[roomCode, loading, step, checkingCode]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { X, Lock, AlertCircle } from 'lucide-react';\r\nimport { collection, query, where, limit, getDocs } from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\n\r\ninterface JoinRoomModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onJoinRoom: (roomCode: string, password?: string) => void;\r\n  loading?: boolean;\r\n  error?: string;\r\n}\r\n\r\nconst JoinRoomModal: React.FC<JoinRoomModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onJoinRoom,\r\n  loading = false,\r\n  error\r\n}) => {\r\n  const { t } = useTranslation();\r\n  const [roomCode, setRoomCode] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [showPasswordField, setShowPasswordField] = useState(false);\r\n  const [step, setStep] = useState<'code' | 'password'>('code');\r\n  const [checkingCode, setCheckingCode] = useState(false);\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    console.log('üìù Join room submit:', { step, roomCode, hasPassword: !!password });\r\n    \r\n    if (step === 'code') {\r\n      if (!roomCode.trim()) return;\r\n      \r\n      // Try joining with room code first (no password)\r\n      console.log('üö™ Attempting to join without password');\r\n      onJoinRoom(roomCode.trim().toUpperCase());\r\n    } else if (step === 'password') {\r\n      if (!password.trim()) return;\r\n      \r\n      // Join with password\r\n      console.log('üîë Attempting to join with password');\r\n      onJoinRoom(roomCode.trim().toUpperCase(), password.trim());\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setRoomCode('');\r\n    setPassword('');\r\n    setShowPasswordField(false);\r\n    setStep('code');\r\n    onClose();\r\n  };\r\n\r\n  // Handle specific errors\r\n  React.useEffect(() => {\r\n    if (!error) return;\r\n    \r\n    console.log('‚ùå Join room error received:', error);\r\n    const lower = error.toLowerCase();\r\n    \r\n    // Check for password-related errors in Vietnamese and English\r\n    if (lower.includes('y√™u c·∫ßu m·∫≠t kh·∫©u') || \r\n        lower.includes('password') || \r\n        lower.includes('room_requires_password') ||\r\n        lower.includes('passwordrequired')) {\r\n      console.log('üîí Password required, switching to password step');\r\n      setStep('password');\r\n      setShowPasswordField(true);\r\n    }\r\n  }, [error]);\r\n\r\n  // Auto-check room code to know if password is required without forcing a failed join\r\n  React.useEffect(() => {\r\n    const check = async () => {\r\n      const code = roomCode.trim().toUpperCase();\r\n      \r\n      // Only check when we have a complete code and not already in password step\r\n      if (code.length !== 6 || loading || step === 'password') return;\r\n      \r\n      // Prevent concurrent checks\r\n      if (checkingCode) return;\r\n      \r\n      try {\r\n        setCheckingCode(true);\r\n        const q = query(collection(db, 'multiplayer_rooms'), where('code', '==', code), limit(1));\r\n        const snap = await getDocs(q);\r\n        \r\n        if (!snap.empty) {\r\n          const data = snap.docs[0].data() as any;\r\n          console.log('üîç Room check:', { code, isPrivate: data.isPrivate });\r\n          \r\n          if (data.isPrivate) {\r\n            console.log('üîí Room requires password, showing password field');\r\n            setShowPasswordField(true);\r\n            setStep('password');\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error('Error checking room:', e);\r\n        // Silent fail; will be handled on submit\r\n      } finally {\r\n        setCheckingCode(false);\r\n      }\r\n    };\r\n    \r\n    // Add small delay to avoid checking on every keystroke\r\n    const timer = setTimeout(check, 500);\r\n    return () => clearTimeout(timer);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [roomCode, loading]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-xl shadow-2xl max-w-md w-full\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-6 border-b\">\r\n          <h2 className=\"text-xl font-bold text-gray-900\">\r\n            {t('multiplayer.joinRoom')}\r\n          </h2>\r\n          <button\r\n            onClick={handleClose}\r\n            className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\r\n          {/* Room Code */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              {t('multiplayer.roomCode')}\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              value={roomCode}\r\n              onChange={(e) => setRoomCode(e.target.value.toUpperCase())}\r\n              placeholder={t('multiplayer.enterRoomCode')}\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg font-mono tracking-wider\"\r\n              maxLength={6}\r\n              required\r\n              disabled={loading || step === 'password'}\r\n            />\r\n            <div className=\"text-xs text-gray-500 mt-1 text-center\">\r\n              {t('multiplayer.roomCodeHint')}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Password Field */}\r\n          {showPasswordField && (\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                <Lock className=\"w-4 h-4 inline mr-2\" />\r\n                {t('multiplayer.password')}\r\n              </label>\r\n              <input\r\n                type=\"password\"\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                placeholder={t('multiplayer.enterPassword')}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                required={step === 'password'}\r\n                disabled={loading}\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {/* Error Display */}\r\n          {error && step !== 'password' && (\r\n            <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n              <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0\" />\r\n              <span className=\"text-red-700 text-sm\">\r\n                {error}\r\n              </span>\r\n            </div>\r\n          )}\r\n          \r\n          {/* Wrong Password Error (only shown in password step) */}\r\n          {error && step === 'password' && error.toLowerCase().includes('sai') && (\r\n            <div className=\"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n              <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0\" />\r\n              <span className=\"text-red-700 text-sm\">\r\n                {error}\r\n              </span>\r\n            </div>\r\n          )}\r\n\r\n          {/* Password Required Info */}\r\n          {step === 'password' && (\r\n            <div className=\"flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg\">\r\n              <Lock className=\"w-5 h-5 text-yellow-600 flex-shrink-0\" />\r\n              <span className=\"text-yellow-700 text-sm\">\r\n                {t('multiplayer.passwordRequired')}\r\n              </span>\r\n            </div>\r\n          )}\r\n\r\n          {/* Actions */}\r\n          <div className=\"flex gap-3 pt-4\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleClose}\r\n              className=\"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors\"\r\n              disabled={loading}\r\n            >\r\n              {t('common.cancel')}\r\n            </button>\r\n            \r\n            {step === 'password' && (\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  setStep('code');\r\n                  setShowPasswordField(false);\r\n                  setPassword('');\r\n                }}\r\n                className=\"px-4 py-2 text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors\"\r\n                disabled={loading}\r\n              >\r\n                {t('common.back')}\r\n              </button>\r\n            )}\r\n            \r\n            <button\r\n              type=\"submit\"\r\n              className=\"flex-1 px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors font-medium disabled:opacity-50\"\r\n              disabled={loading || !roomCode.trim() || (step === 'password' && !password.trim())}\r\n            >\r\n              {loading ? (\r\n                <div className=\"flex items-center justify-center gap-2\">\r\n                  <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                  {t('common.loading')}\r\n                </div>\r\n              ) : (\r\n                step === 'code' \r\n                  ? t('multiplayer.joinRoom')\r\n                  : t('common.submit')\r\n              )}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default JoinRoomModal;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\MobileChatModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\MultiplayerChat.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-blue-100\">\r\n            {messages.length} messages\r\n          </span>","line":66,"column":30,"nodeType":"JSXText","endLine":67,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-400 text-xs mt-1\">\r\n              Start a conversation with your team!\r\n            </p>","line":81,"column":55,"nodeType":"JSXText","endLine":83,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Send, MessageSquare } from 'lucide-react';\r\n\r\ninterface ChatMessage {\r\n  id: string;\r\n  userId: string;\r\n  username: string;\r\n  message: string;\r\n  timestamp: Date;\r\n  type: 'user' | 'system';\r\n}\r\n\r\ninterface MultiplayerChatProps {\r\n  messages: ChatMessage[];\r\n  onSendMessage: (message: string) => void;\r\n  currentUserId: string;\r\n  disabled?: boolean;\r\n}\r\n\r\nconst MultiplayerChat: React.FC<MultiplayerChatProps> = ({\r\n  messages,\r\n  onSendMessage,\r\n  currentUserId,\r\n  disabled = false\r\n}) => {\r\n  const { t } = useTranslation();\r\n  const [inputMessage, setInputMessage] = useState('');\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // Auto scroll to bottom when new messages arrive\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!inputMessage.trim() || disabled) return;\r\n    \r\n    onSendMessage(inputMessage.trim());\r\n    setInputMessage('');\r\n    inputRef.current?.focus();\r\n  };\r\n\r\n  const formatTime = (date: Date) => {\r\n    return new Intl.DateTimeFormat('vi-VN', {\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }).format(date);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center gap-3 p-4 bg-gradient-to-r from-blue-500 to-indigo-500\">\r\n        <div className=\"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center\">\r\n          <MessageSquare className=\"w-5 h-5 text-white\" />\r\n        </div>\r\n        <div className=\"flex-1\">\r\n          <h3 className=\"font-bold text-white text-lg\">\r\n            {t('multiplayer.chat.title')}\r\n          </h3>\r\n          <span className=\"text-xs text-blue-100\">\r\n            {messages.length} messages\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Messages */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-3 bg-gradient-to-b from-gray-50 to-white\" style={{ maxHeight: 'calc(100vh - 300px)' }}>\r\n        {messages.length === 0 ? (\r\n          <div className=\"flex flex-col items-center justify-center h-full text-center py-8\">\r\n            <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-3\">\r\n              <MessageSquare className=\"w-8 h-8 text-blue-500\" />\r\n            </div>\r\n            <p className=\"text-gray-500 text-sm font-medium\">\r\n              {t('multiplayer.chat.noMessages')}\r\n            </p>\r\n            <p className=\"text-gray-400 text-xs mt-1\">\r\n              Start a conversation with your team!\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          messages.map((message) => (\r\n            <div\r\n              key={message.id}\r\n              className={`flex flex-col ${\r\n                message.type === 'system'\r\n                  ? 'items-center'\r\n                  : message.userId === currentUserId\r\n                  ? 'items-end'\r\n                  : 'items-start'\r\n              }`}\r\n            >\r\n              {message.type === 'system' ? (\r\n                <div className=\"bg-gray-200 text-gray-600 text-xs px-4 py-1.5 rounded-full font-medium shadow-sm\">\r\n                  {message.message}\r\n                </div>\r\n              ) : (\r\n                <div className=\"flex flex-col max-w-[75%]\">\r\n                  {message.userId !== currentUserId && (\r\n                    <span className=\"text-xs text-gray-500 font-semibold mb-1 ml-3\">\r\n                      {message.username}\r\n                    </span>\r\n                  )}\r\n                  <div\r\n                    className={`px-4 py-2.5 rounded-2xl text-sm shadow-sm ${\r\n                      message.userId === currentUserId\r\n                        ? 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-br-sm'\r\n                        : 'bg-white border border-gray-200 text-gray-800 rounded-bl-sm'\r\n                    }`}\r\n                  >\r\n                    <div className=\"break-words\">{message.message}</div>\r\n                    <div\r\n                      className={`text-xs mt-1 ${\r\n                        message.userId === currentUserId\r\n                          ? 'text-blue-100'\r\n                          : 'text-gray-400'\r\n                      }`}\r\n                    >\r\n                      {formatTime(message.timestamp)}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ))\r\n        )}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* Input */}\r\n      <form onSubmit={handleSubmit} className=\"p-4 bg-white border-t border-gray-100\">\r\n        <div className=\"flex gap-2\">\r\n          <input\r\n            ref={inputRef}\r\n            type=\"text\"\r\n            value={inputMessage}\r\n            onChange={(e) => setInputMessage(e.target.value)}\r\n            placeholder={\r\n              disabled\r\n                ? t('multiplayer.chat.disabled')\r\n                : t('multiplayer.chat.placeholder')\r\n            }\r\n            className=\"flex-1 px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:bg-white text-sm transition-all disabled:bg-gray-100 disabled:text-gray-400\"\r\n            disabled={disabled}\r\n            maxLength={200}\r\n          />\r\n          <button\r\n            type=\"submit\"\r\n            disabled={!inputMessage.trim() || disabled}\r\n            className=\"px-4 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-xl hover:from-blue-600 hover:to-indigo-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:shadow-lg disabled:shadow-none\"\r\n          >\r\n            <Send className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n        \r\n        {inputMessage.length > 150 && (\r\n          <div className=\"flex items-center justify-end gap-2 mt-2\">\r\n            <div className={`w-12 h-1.5 rounded-full overflow-hidden bg-gray-200`}>\r\n              <div \r\n                className={`h-full transition-all ${\r\n                  inputMessage.length > 180 ? 'bg-red-500' : 'bg-blue-500'\r\n                }`}\r\n                style={{ width: `${(inputMessage.length / 200) * 100}%` }}\r\n              />\r\n            </div>\r\n            <span className={`text-xs font-medium ${\r\n              inputMessage.length > 180 ? 'text-red-500' : 'text-gray-500'\r\n            }`}>\r\n              {inputMessage.length}/200\r\n            </span>\r\n          </div>\r\n        )}\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MultiplayerChat;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\MultiplayerErrorBoundary.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n                Oops! Something went wrong\r\n              </h1>","line":78,"column":69,"nodeType":"JSXText","endLine":80,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600 mb-6\">\r\n                The multiplayer game encountered an unexpected error. Don't worry, your progress might be saved.\r\n              </p>","line":83,"column":49,"nodeType":"JSXText","endLine":85,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <summary className=\"text-xs text-gray-600 cursor-pointer hover:text-gray-900\">\r\n                        Component Stack\r\n                      </summary>","line":95,"column":101,"nodeType":"JSXText","endLine":97,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                  onClick={this.handleReset}\r\n                  className=\"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center gap-2\"\r\n                >\r\n                  <RefreshCw className=\"w-4 h-4\" />\r\n                  Try Again\r\n                </button>","line":112,"column":52,"nodeType":"JSXText","endLine":114,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                  onClick={this.handleReload}\r\n                  className=\"flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium\"\r\n                >\r\n                  Reload Page\r\n                </button>","line":118,"column":18,"nodeType":"JSXText","endLine":120,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-gray-500 mt-4\">\r\n                If the problem persists, please contact support or try again later.\r\n              </p>","line":124,"column":57,"nodeType":"JSXText","endLine":126,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, ErrorInfo, ReactNode } from 'react';\r\nimport { AlertTriangle, RefreshCw } from 'lucide-react';\r\n\r\ninterface Props {\r\n  children: ReactNode;\r\n  fallback?: ReactNode;\r\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\r\n}\r\n\r\ninterface State {\r\n  hasError: boolean;\r\n  error: Error | null;\r\n  errorInfo: ErrorInfo | null;\r\n}\r\n\r\nclass MultiplayerErrorBoundary extends Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = {\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error): State {\r\n    return {\r\n      hasError: true,\r\n      error,\r\n      errorInfo: null\r\n    };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n    console.error('Multiplayer Error Boundary caught an error:', error, errorInfo);\r\n    \r\n    this.setState({\r\n      error,\r\n      errorInfo\r\n    });\r\n\r\n    // Call optional error handler\r\n    if (this.props.onError) {\r\n      this.props.onError(error, errorInfo);\r\n    }\r\n  }\r\n\r\n  handleReset = () => {\r\n    this.setState({\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null\r\n    });\r\n  };\r\n\r\n  handleReload = () => {\r\n    window.location.reload();\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      // Custom fallback UI if provided\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      // Default error UI\r\n      return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-orange-50 p-4\">\r\n          <div className=\"max-w-md w-full bg-white rounded-2xl shadow-2xl p-8\">\r\n            <div className=\"flex flex-col items-center text-center\">\r\n              {/* Error Icon */}\r\n              <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\r\n                <AlertTriangle className=\"w-8 h-8 text-red-600\" />\r\n              </div>\r\n\r\n              {/* Error Title */}\r\n              <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n                Oops! Something went wrong\r\n              </h1>\r\n\r\n              {/* Error Message */}\r\n              <p className=\"text-gray-600 mb-6\">\r\n                The multiplayer game encountered an unexpected error. Don't worry, your progress might be saved.\r\n              </p>\r\n\r\n              {/* Error Details (Development only) */}\r\n              {process.env.NODE_ENV === 'development' && this.state.error && (\r\n                <div className=\"w-full mb-6 p-4 bg-gray-50 rounded-lg text-left\">\r\n                  <p className=\"text-xs font-mono text-red-600 break-words\">\r\n                    {this.state.error.toString()}\r\n                  </p>\r\n                  {this.state.errorInfo && (\r\n                    <details className=\"mt-2\">\r\n                      <summary className=\"text-xs text-gray-600 cursor-pointer hover:text-gray-900\">\r\n                        Component Stack\r\n                      </summary>\r\n                      <pre className=\"text-xs text-gray-600 mt-2 overflow-auto max-h-40\">\r\n                        {this.state.errorInfo.componentStack}\r\n                      </pre>\r\n                    </details>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Action Buttons */}\r\n              <div className=\"flex gap-3 w-full\">\r\n                <button\r\n                  onClick={this.handleReset}\r\n                  className=\"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center gap-2\"\r\n                >\r\n                  <RefreshCw className=\"w-4 h-4\" />\r\n                  Try Again\r\n                </button>\r\n                <button\r\n                  onClick={this.handleReload}\r\n                  className=\"flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium\"\r\n                >\r\n                  Reload Page\r\n                </button>\r\n              </div>\r\n\r\n              {/* Help Text */}\r\n              <p className=\"text-xs text-gray-500 mt-4\">\r\n                If the problem persists, please contact support or try again later.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nexport default MultiplayerErrorBoundary;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\MultiplayerManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5033,5036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5033,5036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5707,5710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5707,5710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":188,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7236,7239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7236,7239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7530,7533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7530,7533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7906,7909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7906,7909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":282,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9946,9949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9946,9949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":292,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10230,10233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10230,10233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":373,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":373,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12920,12923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12920,12923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":377,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":377,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13048,13051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13048,13051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":415,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":415,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14394,14397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14394,14397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-bold text-lg\">\r\n                      {t('common.start')}: {readyCountdown}s\r\n                    </span>","line":469,"column":60,"nodeType":"JSXText","endLine":470,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":538,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":538,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19892,19895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19892,19895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-purple-200\">\r\n                  üéØ {selectedQuiz.title} ‚Ä¢ {selectedQuiz.questions?.length || 0} c√¢u h·ªèi\r\n                </p>","line":569,"column":82,"nodeType":"JSXText","endLine":570,"endColumn":17}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1113,1116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1113,1116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1190,1193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1190,1193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleConnectionLost', 'handleConnectionRestored', 'handleGameFinish', 'handleGameStart', 'handleNextQuestion', 'handlePlayersUpdate', and 'handleRoomUpdate'. Either include them or remove the dependency array.","line":108,"column":6,"nodeType":"ArrayExpression","endLine":108,"endColumn":41,"suggestions":[{"desc":"Update the dependencies array to be: [currentUserId, currentUserName, handleConnectionLost, handleConnectionRestored, handleGameFinish, handleGameStart, handleNextQuestion, handlePlayersUpdate, handleRoomUpdate, t]","fix":{"range":[4057,4092],"text":"[currentUserId, currentUserName, handleConnectionLost, handleConnectionRestored, handleGameFinish, handleGameStart, handleNextQuestion, handlePlayersUpdate, handleRoomUpdate, t]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { toast } from 'react-toastify';\r\nimport { \r\n  Users, \r\n  Wifi,\r\n  WifiOff,\r\n  AlertCircle\r\n} from 'lucide-react';\r\nimport { logger } from '../utils/logger';\r\n\r\n// Import c√°c components con\r\nimport GameModeSelector from './GameModeSelector';\r\nimport CreateRoomModal from './CreateRoomModal';\r\nimport JoinRoomModal from './JoinRoomModal';\r\nimport RoomLobby from './RoomLobby';\r\nimport MultiplayerQuiz from './MultiplayerQuiz';\r\nimport GameResults from './GameResults';\r\nimport RealtimeChat from './RealtimeChat';\r\nimport MobileChatModal from './MobileChatModal';\r\n\r\n// Import services\r\nimport { getMultiplayerService, MultiplayerServiceInterface } from '../services/enhancedMultiplayerService';\r\n\r\n// Types\r\nimport type { Quiz } from '../types/index';\r\nimport type { GameResults as GameResultsType } from '../types/index';\r\n\r\nexport interface MultiplayerState {\r\n  currentState: 'mode-selection' | 'create-room' | 'join-room' | 'lobby' | 'game' | 'results';\r\n  roomId?: string;\r\n  roomData?: any; // eslint-disable-line @typescript-eslint/no-explicit-any\r\n  gameData?: any; // eslint-disable-line @typescript-eslint/no-explicit-any\r\n  results?: GameResultsType;\r\n  error?: string;\r\n  isConnecting: boolean;\r\n  isConnected: boolean;\r\n}\r\n\r\ninterface MultiplayerManagerProps {\r\n  selectedQuiz?: Quiz;\r\n  currentUserId: string;\r\n  currentUserName: string;\r\n  onBackToLobby: () => void;\r\n  onQuizComplete: (results: GameResultsType) => void;\r\n  initialRoomId?: string;\r\n}\r\n\r\nconst MultiplayerManager: React.FC<MultiplayerManagerProps> = ({\r\n  selectedQuiz: initialSelectedQuiz,\r\n  currentUserId,\r\n  currentUserName,\r\n  onBackToLobby,\r\n  onQuizComplete,\r\n  initialRoomId\r\n}) => {\r\n  const { t } = useTranslation();\r\n  const [selectedQuiz] = useState<Quiz | undefined>(initialSelectedQuiz);\r\n  const [state, setState] = useState<MultiplayerState>({\r\n    currentState: 'mode-selection', // Lu√¥n b·∫Øt ƒë·∫ßu t·ª´ mode-selection v√¨ quiz ƒë√£ ƒë∆∞·ª£c ch·ªçn t·ª´ MultiplayerLobby\r\n    isConnecting: false,\r\n    isConnected: false\r\n  });\r\n  \r\n  const [multiplayerService, setMultiplayerService] = useState<MultiplayerServiceInterface | null>(null);\r\n  const [connectionStatus, setConnectionStatus] = useState<'disconnected' | 'connecting' | 'connected' | 'error'>('disconnected');\r\n  const [readyCountdown, setReadyCountdown] = useState<number | null>(null);\r\n  const [joinError, setJoinError] = useState<string | undefined>(undefined);\r\n\tconst [createLoading, setCreateLoading] = useState<boolean>(false);\r\n\tconst [joinLoading, setJoinLoading] = useState<boolean>(false);\r\n  const [isMobileChatOpen, setIsMobileChatOpen] = useState<boolean>(false);\r\n\r\n  // Initialize multiplayer service\r\n  useEffect(() => {\r\n    const service = getMultiplayerService();\r\n    setMultiplayerService(service);\r\n    \r\n    // Connect to service\r\n    const connectToService = async () => {\r\n      try {\r\n        setConnectionStatus('connecting');\r\n        await service.connect(currentUserId, currentUserName);\r\n        setConnectionStatus('connected');\r\n        setState(prev => ({ ...prev, isConnected: true }));\r\n        \r\n        // Set up event listeners\r\n        service.on('room:updated', handleRoomUpdate);\r\n        service.on('players:updated', handlePlayersUpdate);\r\n        // messages:updated listener removed - RealtimeChat handles this directly\r\n        service.on('game:start', handleGameStart);\r\n        service.on('game:next-question', handleNextQuestion);\r\n        service.on('game:finish', handleGameFinish);\r\n        service.on('connection:lost', handleConnectionLost);\r\n        service.on('connection:restored', handleConnectionRestored);\r\n        \r\n      } catch (error) {\r\n        console.error('Failed to connect to multiplayer service:', error);\r\n        setConnectionStatus('error');\r\n        toast.error(t('multiplayer.errors.connectionFailed'));\r\n      }\r\n    };\r\n\r\n    connectToService();\r\n\r\n    return () => {\r\n      service.disconnect();\r\n    };\r\n  }, [currentUserId, currentUserName, t]); // eslint-disable-line react-hooks/exhaustive-deps\r\n  // Handlers are intentionally omitted from dependencies to prevent infinite loop from re-subscription\r\n\r\n  // Try resuming room from state (if page reload)\r\n  useEffect(() => {\r\n    const previousRoomId = initialRoomId || state.roomId || (state.roomData?.id as string | undefined);\r\n    if (!previousRoomId || !multiplayerService || connectionStatus !== 'connected') return;\r\n    // Mark presence online and resume streams\r\n    multiplayerService.setPresence(previousRoomId, true).catch(() => {});\r\n    multiplayerService.resumeRoom(previousRoomId).catch(() => {});\r\n    // Set UI state to lobby immediately while streams resume\r\n    setState(prev => ({ ...prev, currentState: 'lobby', roomId: previousRoomId }));\r\n  }, [multiplayerService, connectionStatus, initialRoomId, state.roomId, state.roomData?.id]);\r\n\r\n  // Event handlers\r\n  const handleRoomUpdate = useCallback((roomData: any) => {\r\n    logger.debug('Room updated', { \r\n      roomId: roomData?.id, \r\n      status: roomData?.status,\r\n      playerCount: roomData?.players?.length \r\n    });\r\n    \r\n    setState(prev => {\r\n      // Preserve existing players if not in new roomData\r\n      const updatedRoomData = {\r\n        ...roomData,\r\n        players: roomData.players || prev.roomData?.players || []\r\n      };\r\n      \r\n      return { ...prev, roomData: updatedRoomData };\r\n    });\r\n    \r\n    // Auto-start countdown when all players ready (no host restriction)\r\n    try {\r\n      const players = roomData?.players || [];\r\n      const total = players.length;\r\n      const ready = players.filter((p: any) => p.isReady).length;\r\n      const allReady = total >= 2 && ready === total;\r\n      \r\n      if (allReady && state.currentState === 'lobby') {\r\n        if (readyCountdown === null) {\r\n          setReadyCountdown(5);\r\n          logger.info('All players ready - starting countdown', { total, ready });\r\n        }\r\n      } else {\r\n        if (readyCountdown !== null) {\r\n          setReadyCountdown(null);\r\n          logger.debug('Countdown cancelled', { total, ready, allReady });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      logger.error('Error in handleRoomUpdate', error);\r\n    }\r\n  }, [state.currentState, readyCountdown]);\r\n\r\n  useEffect(() => {\r\n    if (readyCountdown === null) return;\r\n    \r\n    if (readyCountdown <= 0) {\r\n      // Start game when countdown reaches 0 (any player can trigger)\r\n      if (multiplayerService && state.roomId) {\r\n        logger.info('Starting game from countdown...');\r\n        multiplayerService.startGame(state.roomId).then(() => {\r\n          logger.success('Game started successfully');\r\n        }).catch((error) => {\r\n          logger.error('Failed to start game', error);\r\n          toast.error('Failed to start game');\r\n        });\r\n      }\r\n      setReadyCountdown(null);\r\n      return;\r\n    }\r\n    \r\n    const timer = setTimeout(() => {\r\n      setReadyCountdown(prev => prev !== null ? prev - 1 : null);\r\n    }, 1000);\r\n    \r\n    return () => clearTimeout(timer);\r\n  }, [readyCountdown, multiplayerService, state.roomId]);\r\n\r\n  const handleGameStart = useCallback((gameData: any) => {\r\n    logger.debug('Game Start Event Received', {\r\n      hasQuestions: gameData?.questions?.length || 0\r\n    });\r\n    \r\n    setState(prev => ({ \r\n      ...prev, \r\n      currentState: 'game', \r\n      gameData \r\n    }));\r\n  }, []);\r\n\r\n  const handleNextQuestion = useCallback((gameData: any) => {\r\n    setState(prev => ({ \r\n      ...prev, \r\n      gameData\r\n    }));\r\n  }, []);\r\n\r\n  const handleGameFinish = useCallback((results: GameResultsType) => {\r\n    setState(prev => ({ \r\n      ...prev, \r\n      currentState: 'results', \r\n      results \r\n    }));\r\n    onQuizComplete(results);\r\n  }, [onQuizComplete]);\r\n\r\n  const handlePlayersUpdate = useCallback((players: any[]) => {\r\n    logger.debug('Players updated', { count: players.length, playerIds: players.map(p => p.id) });\r\n    setState(prev => {\r\n      // Ensure we merge players into existing roomData\r\n      if (!prev.roomData) {\r\n        logger.warn('Received players update but no roomData exists');\r\n        return prev;\r\n      }\r\n      \r\n      return {\r\n        ...prev,\r\n        roomData: { \r\n          ...prev.roomData, \r\n          players \r\n        }\r\n      };\r\n    });\r\n  }, []);\r\n\r\n  // Messages are now handled directly by RealtimeChat component via RTDB listeners\r\n  // No need for handleMessagesUpdate callback\r\n\r\n  // const handleChatMessage = useCallback((message: any) => {\r\n  //   console.log('MultiplayerManager received chat message:', message);\r\n  //   setChatMessages(prev => {\r\n  //     const newMessages = [...prev, message];\r\n  //     console.log('Updated chat messages count:', newMessages.length);\r\n  //     return newMessages;\r\n  //   });\r\n  // }, []);\r\n\r\n  const handleConnectionLost = useCallback(() => {\r\n    setConnectionStatus('disconnected');\r\n    // toast.warning(t('multiplayer.errors.connectionLost'));\r\n  }, []);\r\n\r\n  const handleConnectionRestored = useCallback(() => {\r\n    setConnectionStatus('connected');\r\n    // toast.success(t('multiplayer.success.connectionRestored'));\r\n  }, []);\r\n\r\n  // Navigation handlers\r\n  const handleModeSelection = (mode: 'create' | 'join') => {\r\n    if (mode === 'create') {\r\n      setState(prev => ({ ...prev, currentState: 'create-room' }));\r\n    } else {\r\n      setState(prev => ({ ...prev, currentState: 'join-room' }));\r\n    }\r\n  };\r\n\r\n  const handleBackToModeSelection = () => {\r\n    setState(prev => ({ \r\n      ...prev, \r\n      currentState: 'mode-selection',\r\n      roomId: undefined,\r\n      roomData: undefined,\r\n      gameData: undefined,\r\n      results: undefined\r\n    }));\r\n  };\r\n\r\n  const handleBackToQuizSelection = () => {\r\n    // Navigate back to lobby to select another quiz\r\n    onBackToLobby();\r\n  };\r\n\r\n  const handleRoomCreated = (roomId: string, roomData: any) => {\r\n    setState(prev => ({ \r\n      ...prev, \r\n      currentState: 'lobby',\r\n      roomId,\r\n      roomData\r\n    }));\r\n    // toast.success(t('multiplayer.success.roomCreated')); // Removed - too many notifications\r\n  };\r\n\r\n  const handleRoomJoined = (roomId: string, roomData: any) => {\r\n    setState(prev => ({ \r\n      ...prev, \r\n      currentState: 'lobby',\r\n      roomId,\r\n      roomData\r\n    }));\r\n    // toast.success(t('multiplayer.success.joinedRoom')); // Removed - too many notifications\r\n  };\r\n\r\n  const handleLeaveRoom = () => {\r\n    if (multiplayerService && state.roomId) {\r\n      multiplayerService.leaveRoom(state.roomId);\r\n    }\r\n    setState(prev => ({ \r\n      ...prev, \r\n      currentState: 'mode-selection',\r\n      roomId: undefined,\r\n      roomData: undefined,\r\n      gameData: undefined,\r\n      results: undefined\r\n    }));\r\n    toast.info(t('multiplayer.success.leftRoom'));\r\n  };\r\n\r\n  // Chat message handler - not needed with RealtimeChat component\r\n  // Messages are sent directly from RealtimeChat via RTDB\r\n\r\n  // Render connection status\r\n  const renderConnectionStatus = () => {\r\n    const statusConfig = {\r\n      disconnected: { icon: WifiOff, color: 'text-red-500', text: t('multiplayer.errors.connectionLost') },\r\n      connecting: { icon: Wifi, color: 'text-yellow-500', text: t('multiplayer.errors.reconnecting') },\r\n      connected: { icon: Wifi, color: 'text-green-500', text: t('multiplayer.success.connectionRestored') },\r\n      error: { icon: AlertCircle, color: 'text-red-500', text: t('multiplayer.errors.connectionFailed') }\r\n    } as const;\r\n\r\n    const config = statusConfig[connectionStatus];\r\n    const Icon = config.icon;\r\n\r\n    return (\r\n      <div className={`flex items-center gap-2 ${config.color} text-sm`}>\r\n        <Icon size={16} />\r\n        <span>{config.text}</span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Render current state\r\n  const renderCurrentState = () => {\r\n    switch (state.currentState) {\r\n      case 'mode-selection':\r\n        return (\r\n          <GameModeSelector\r\n            isOpen={true}\r\n            onClose={handleBackToQuizSelection}\r\n            onSelectMultiplayer={handleModeSelection}\r\n            connectionStatus={connectionStatus}\r\n          />\r\n        );\r\n\r\n      case 'create-room':\r\n        return (\r\n\t\t\t\t<CreateRoomModal\r\n            isOpen={true}\r\n\t\t\t\tonClose={handleBackToModeSelection}\r\n            onCreateRoom={async (roomConfig) => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tsetCreateLoading(true);\r\n\t\t\t\t\t\tif (!multiplayerService || connectionStatus !== 'connected') {\r\n\t\t\t\t\t\t\ttoast.info(t('multiplayer.errors.reconnecting'));\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Pass full quiz object instead of just quizId\r\n\t\t\t\t\t\tconsole.log('üéÆ Manager: Creating room with quiz', { \r\n\t\t\t\t\t\t\tquizId: selectedQuiz?.id, \r\n\t\t\t\t\t\t\tquizTitle: selectedQuiz?.title,\r\n\t\t\t\t\t\t\thasQuestions: !!selectedQuiz?.questions?.length\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst result = await multiplayerService.createRoom(roomConfig as any, selectedQuiz);\r\n\t\t\t\t\t\tif (result) {\r\n\t\t\t\t\t\t\thandleRoomCreated(result.room.id, result.room);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (error: any) {\r\n\t\t\t\t\t\tconsole.error('‚ùå Manager: Failed to create room:', error);\r\n\t\t\t\t\t\tconst errorMessage = error.message || t('multiplayer.errors.createRoomFailed');\r\n\t\t\t\t\t\ttoast.error(errorMessage);\r\n\t\t\t\t\t\t} finally {\r\n\t\t\t\t\t\t\tsetCreateLoading(false);\r\n\t\t\t\t\t\t}\r\n            }}\r\n            selectedQuiz={selectedQuiz}\r\n\t\t\t\t\tloading={createLoading || connectionStatus !== 'connected'}\r\n          />\r\n        );\r\n\r\n      case 'join-room':\r\n        return (\r\n\t\t\t\t<JoinRoomModal\r\n            isOpen={true}\r\n            onClose={() => {\r\n              setJoinError(undefined);\r\n              handleBackToModeSelection();\r\n            }}\r\n            onJoinRoom={async (roomCode, password) => {\r\n              try {\r\n\t\t\t\t\t\t\tsetJoinError(undefined);\r\n\t\t\t\t\t\t\tsetJoinLoading(true);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconsole.log('üéÆ Manager: Attempting to join room', { roomCode, hasPassword: !!password });\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (!multiplayerService || connectionStatus !== 'connected') {\r\n\t\t\t\t\t\t\t\ttoast.info(t('multiplayer.errors.reconnecting'));\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconst result = await multiplayerService.joinRoom(roomCode, password);\r\n                if (result) {\r\n                  console.log('‚úÖ Manager: Successfully joined room');\r\n                  handleRoomJoined(result.room.id, result.room);\r\n                }\r\n              } catch (error: any) {\r\n                console.error('‚ùå Manager: Failed to join room:', error);\r\n                console.log('Error details:', { message: error.message, code: error.code });\r\n                \r\n                // Translate error messages\r\n                let errorMessage = t('multiplayer.errors.joinRoomFailed');\r\n                const errorCode = error.message || '';\r\n                \r\n                if (errorCode === 'room_not_found') {\r\n                  errorMessage = t('multiplayer.errors.roomNotFound', 'Kh√¥ng t√¨m th·∫•y ph√≤ng');\r\n                } else if (errorCode === 'room_requires_password') {\r\n                  errorMessage = t('multiplayer.errors.passwordRequired', 'Ph√≤ng n√†y y√™u c·∫ßu m·∫≠t kh·∫©u');\r\n                } else if (errorCode === 'wrong_password') {\r\n                  errorMessage = t('multiplayer.errors.wrongPassword', 'M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng');\r\n                } else if (errorCode === 'room_full') {\r\n                  errorMessage = t('multiplayer.errors.roomFull', 'Ph√≤ng ƒë√£ ƒë·∫ßy');\r\n                } else if (errorCode === 'game_in_progress') {\r\n                  errorMessage = t('multiplayer.errors.gameInProgress', 'Game ƒëang di·ªÖn ra');\r\n                } else if (errorCode) {\r\n                  errorMessage = errorCode;\r\n                }\r\n                \r\n                console.log('üì® Manager: Setting error message:', errorMessage);\r\n                setJoinError(errorMessage);\r\n                \r\n                // Don't show toast for password required error - let modal handle it\r\n                if (errorCode !== 'room_requires_password') {\r\n                  toast.error(errorMessage);\r\n                }\r\n\t\t\t\t\t\t} finally {\r\n\t\t\t\t\t\t\tsetJoinLoading(false);\r\n\t\t\t\t\t\t}\r\n            }}\r\n\t\t\t\t\tloading={joinLoading || connectionStatus !== 'connected'}\r\n            error={joinError}\r\n          />\r\n        );\r\n\r\n      case 'lobby':\r\n        return (\r\n          <div className=\"flex flex-col lg:flex-row min-h-screen bg-gray-50\">\r\n            {/* Main Lobby - Full width on mobile, flex-1 on desktop */}\r\n            <div className=\"flex-1 overflow-y-auto\">\r\n              <RoomLobby\r\n                roomData={state.roomData}\r\n                currentUserId={currentUserId}\r\n                onLeaveRoom={handleLeaveRoom}\r\n                multiplayerService={multiplayerService ?? undefined}\r\n              />\r\n              {readyCountdown !== null && (\r\n                <div className=\"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50\">\r\n                  <div className=\"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 animate-pulse\">\r\n                    <div className=\"w-3 h-3 bg-white rounded-full animate-ping\"></div>\r\n                    <span className=\"font-bold text-lg\">\r\n                      {t('common.start')}: {readyCountdown}s\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            {/* Chat Sidebar - Hidden on mobile, show on lg+ */}\r\n            <div className=\"hidden lg:block lg:w-80 xl:w-96 border-l border-gray-200 bg-white\">\r\n              <div className=\"h-screen sticky top-0\">\r\n                <RealtimeChat\r\n                  roomId={state.roomId || ''}\r\n                  currentUserId={currentUserId}\r\n                  currentUsername={currentUserName}\r\n                  isMobile={false}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Mobile Chat Button - Show only on mobile */}\r\n            <button \r\n              className=\"lg:hidden fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-full shadow-2xl flex items-center justify-center z-50 hover:scale-110 transition-transform\"\r\n              onClick={() => setIsMobileChatOpen(true)}\r\n            >\r\n              <Users className=\"w-6 h-6\" />\r\n            </button>\r\n\r\n            {/* Mobile Chat Modal */}\r\n            <MobileChatModal\r\n              isOpen={isMobileChatOpen}\r\n              onClose={() => setIsMobileChatOpen(false)}\r\n              roomId={state.roomId || ''}\r\n              currentUserId={currentUserId}\r\n              currentUsername={currentUserName}\r\n            />\r\n          </div>\r\n        );\r\n\r\n      case 'game':\r\n        return (\r\n          <div className=\"flex flex-col lg:flex-row min-h-screen bg-gray-50\">\r\n            {/* Game Area - Full width on mobile */}\r\n            <div className=\"flex-1 overflow-y-auto\">\r\n              <MultiplayerQuiz\r\n                gameData={state.gameData ?? null}\r\n                roomData={state.roomData ?? null}\r\n                currentUserId={currentUserId}\r\n                currentUserName={currentUserName}\r\n                multiplayerService={multiplayerService}\r\n              />\r\n            </div>\r\n            \r\n            {/* Chat Sidebar - Hidden on mobile during game */}\r\n            <div className=\"hidden lg:block lg:w-80 xl:w-96 border-l border-gray-200 bg-white\">\r\n              <div className=\"h-screen sticky top-0\">\r\n                <RealtimeChat\r\n                  roomId={state.roomId || ''}\r\n                  currentUserId={currentUserId}\r\n                  currentUsername={currentUserName}\r\n                  isMobile={false}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        );\r\n\r\n      case 'results':\r\n        return (\r\n          <GameResults\r\n            players={state.results?.players as any || []}\r\n            currentUserId={currentUserId}\r\n            onPlayAgain={handleBackToModeSelection}\r\n            onBackToLobby={onBackToLobby}\r\n            onLeaveRoom={handleLeaveRoom}\r\n          />\r\n        );\r\n\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900\">\r\n      {/* Header with connection status */}\r\n      <div className=\"bg-white/10 backdrop-blur-md border-b border-white/20 p-4\">\r\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <button\r\n              onClick={handleBackToQuizSelection}\r\n              className=\"text-white hover:text-gray-200 transition-colors\"\r\n            >\r\n              ‚Üê {t('common.back')}\r\n            </button>\r\n            <div>\r\n              <h1 className=\"text-xl font-bold text-white\">\r\n                {t('multiplayer.title')}\r\n              </h1>\r\n              {selectedQuiz && (\r\n                <p className=\"text-sm text-purple-200\">\r\n                  üéØ {selectedQuiz.title} ‚Ä¢ {selectedQuiz.questions?.length || 0} c√¢u h·ªèi\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center gap-4\">\r\n            {renderConnectionStatus()}\r\n            {state.roomData && (\r\n              <div className=\"flex items-center gap-2 text-white\">\r\n                <Users size={16} />\r\n                <span>{state.roomData.players?.length || 0}/{state.roomData.settings?.maxPlayers || 10}</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main content */}\r\n      <div className=\"flex-1\">\r\n        {renderCurrentState()}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MultiplayerManager;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\MultiplayerQuiz.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">Game Starting Soon!</h2>","line":587,"column":67,"nodeType":"JSXText","endLine":587,"endColumn":86},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600\">Get ready to answer questions!</p>","line":589,"column":42,"nodeType":"JSXText","endLine":589,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-xl font-bold text-gray-800 mb-4 text-center\">Question Results</h3>","line":596,"column":78,"nodeType":"JSXText","endLine":596,"endColumn":94},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-lg text-gray-700 mb-2\">\r\n                  You earned <span className=\"font-bold text-blue-600\">+{questionResults.points}</span> points\r\n                </div>","line":604,"column":61,"nodeType":"JSXText","endLine":605,"endColumn":30},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-lg text-gray-700 mb-2\">\r\n                  You earned <span className=\"font-bold text-blue-600\">+{questionResults.points}</span> points\r\n                </div>","line":605,"column":104,"nodeType":"JSXText","endLine":606,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-600\">\r\n                  Correct Answer: <span className=\"font-semibold\">{finalQuestion.options?.[questionResults.correctAnswer] || 'N/A'}</span>\r\n                </div>","line":607,"column":56,"nodeType":"JSXText","endLine":608,"endColumn":35},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-semibold text-gray-700 mb-3 text-center\">Current Standings</h4>","line":618,"column":76,"nodeType":"JSXText","endLine":618,"endColumn":93},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-1 text-xs\">(You)</span>","line":648,"column":80,"nodeType":"JSXText","endLine":648,"endColumn":85},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-gray-500\">\r\n                              {correctAnswersCount} ƒë√∫ng ‚Ä¢ {player.score} ƒëi·ªÉm\r\n                              {currentAnswer && (\r\n                                <span className={`ml-2 ${currentAnswer.isCorrect ? 'text-green-600' : 'text-red-600'}`}>\r\n                                  {currentAnswer.isCorrect ? '‚úì' : '‚úó'} +{currentAnswer.points}\r\n                                </span>\r\n                              )}\r\n                            </div>","line":651,"column":52,"nodeType":"JSXText","endLine":651,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-gray-500\">\r\n                              {correctAnswersCount} ƒë√∫ng ‚Ä¢ {player.score} ƒëi·ªÉm\r\n                              {currentAnswer && (\r\n                                <span className={`ml-2 ${currentAnswer.isCorrect ? 'text-green-600' : 'text-red-600'}`}>\r\n                                  {currentAnswer.isCorrect ? '‚úì' : '‚úó'} +{currentAnswer.points}\r\n                                </span>\r\n                              )}\r\n                            </div>","line":651,"column":74,"nodeType":"JSXText","endLine":652,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-gray-500\">pts</div>","line":662,"column":66,"nodeType":"JSXText","endLine":662,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600\">C√¢u h·ªèi ti·∫øp theo trong: <span className=\"font-bold text-blue-600\">{nextQuestionCountdown}s</span></p>","line":673,"column":48,"nodeType":"JSXText","endLine":673,"endColumn":73},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-bold text-blue-600\">{nextQuestionCountdown}s</span>","line":673,"column":138,"nodeType":"JSXText","endLine":673,"endColumn":139},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-5xl font-black text-white mb-2 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent\">\r\n                  GAME COMPLETE!\r\n                </h1>","line":692,"column":146,"nodeType":"JSXText","endLine":694,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xl text-blue-200\">Amazing performance by all players</p>","line":695,"column":54,"nodeType":"JSXText","endLine":695,"endColumn":88},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-blue-600 font-medium\">(You)</div>","line":754,"column":100,"nodeType":"JSXText","endLine":754,"endColumn":105},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-gray-600\">Correct</div>","line":767,"column":64,"nodeType":"JSXText","endLine":767,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-gray-600\">Accuracy</div>","line":771,"column":64,"nodeType":"JSXText","endLine":771,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-3xl font-black text-gray-800 mb-6 text-center\">\r\n                  üèÖ COMPLETE RANKINGS\r\n                </h2>","line":783,"column":84,"nodeType":"JSXText","endLine":785,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-600\">\r\n                                  {correctAnswers}/{totalQuestions} correct ‚Ä¢ {accuracy}% accuracy ‚Ä¢ Avg: {avgTimePerQuestion}s\r\n                                </div>","line":836,"column":68,"nodeType":"JSXText","endLine":836,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-600\">\r\n                                  {correctAnswers}/{totalQuestions} correct ‚Ä¢ {accuracy}% accuracy ‚Ä¢ Avg: {avgTimePerQuestion}s\r\n                                </div>","line":836,"column":89,"nodeType":"JSXText","endLine":836,"endColumn":107},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-600\">\r\n                                  {correctAnswers}/{totalQuestions} correct ‚Ä¢ {accuracy}% accuracy ‚Ä¢ Avg: {avgTimePerQuestion}s\r\n                                </div>","line":836,"column":127,"nodeType":"JSXText","endLine":837,"endColumn":33},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-600 font-medium\">Total Questions</div>","line":860,"column":70,"nodeType":"JSXText","endLine":860,"endColumn":85},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-600 font-medium\">Players</div>","line":865,"column":70,"nodeType":"JSXText","endLine":865,"endColumn":77},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-600 font-medium\">Your Correct</div>","line":872,"column":70,"nodeType":"JSXText","endLine":872,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-600 font-medium\">Your Score</div>","line":879,"column":70,"nodeType":"JSXText","endLine":879,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xl text-blue-200 mb-6\">Thanks for playing! üéâ</p>","line":885,"column":59,"nodeType":"JSXText","endLine":885,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button \r\n                    onClick={() => window.location.href = '/multiplayer'}\r\n                    className=\"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:from-purple-700 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 shadow-2xl hover:shadow-purple-500/25\"\r\n                  >\r\n                    üéÆ Play Again\r\n                  </button>","line":890,"column":20,"nodeType":"JSXText","endLine":892,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button \r\n                    onClick={() => window.location.href = '/profile'}\r\n                    className=\"bg-gradient-to-r from-gray-600 to-gray-700 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:from-gray-700 hover:to-gray-800 transform hover:scale-105 transition-all duration-200 shadow-2xl\"\r\n                  >\r\n                    üë§ View Profile\r\n                  </button>","line":896,"column":20,"nodeType":"JSXText","endLine":898,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button \r\n                    onClick={() => window.location.href = '/leaderboard'}\r\n                    className=\"bg-gradient-to-r from-green-600 to-teal-600 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:from-green-700 hover:to-teal-700 transform hover:scale-105 transition-all duration-200 shadow-2xl\"\r\n                  >\r\n                    üèÜ Global Leaderboard\r\n                  </button>","line":902,"column":20,"nodeType":"JSXText","endLine":904,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"bg-gradient-to-r from-purple-500 to-blue-600 text-white px-3 sm:px-4 py-2 rounded-xl font-bold text-sm sm:text-base text-center\">\r\n                Question {currentQuestionIndex + 1} of {processedQuestions.length}\r\n              </div>","line":922,"column":160,"nodeType":"JSXText","endLine":923,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"bg-gradient-to-r from-purple-500 to-blue-600 text-white px-3 sm:px-4 py-2 rounded-xl font-bold text-sm sm:text-base text-center\">\r\n                Question {currentQuestionIndex + 1} of {processedQuestions.length}\r\n              </div>","line":923,"column":52,"nodeType":"JSXText","endLine":923,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm sm:text-base\">{currentRoomData?.players?.length || 0} players</span>","line":927,"column":95,"nodeType":"JSXText","endLine":927,"endColumn":103},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Submitted!</span>","line":935,"column":25,"nodeType":"JSXText","endLine":935,"endColumn":35},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{timeLeft}s</span>","line":944,"column":35,"nodeType":"JSXText","endLine":944,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium\">Time is running out!</span>","line":974,"column":47,"nodeType":"JSXText","endLine":974,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-500 mt-2\">\r\n                Questions available: {processedQuestions.length} | Current index: {currentQuestionIndex}\r\n              </p>","line":1002,"column":57,"nodeType":"JSXText","endLine":1003,"endColumn":38},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-500 mt-2\">\r\n                Questions available: {processedQuestions.length} | Current index: {currentQuestionIndex}\r\n              </p>","line":1003,"column":65,"nodeType":"JSXText","endLine":1003,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-red-700\">‚ùå No options available for this question</p>","line":1042,"column":43,"nodeType":"JSXText","endLine":1042,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Submitted!</span>","line":1056,"column":25,"nodeType":"JSXText","endLine":1056,"endColumn":35},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-3xl font-bold text-blue-600 mb-4\">\r\n                  +{questionResults.points} points\r\n                </div>","line":1086,"column":44,"nodeType":"JSXText","endLine":1087,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":41,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useRef, useState, useEffect, useCallback } from 'react';\r\nimport { MultiplayerServiceInterface } from '../services/enhancedMultiplayerService';\r\nimport { Clock, Users, CheckCircle, AlertCircle } from 'lucide-react';\r\nimport { doc, onSnapshot, collection, addDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { db } from '../../../firebase/config';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\nimport { toast } from 'react-toastify';\r\nimport SafeHTML from '../../../shared/components/ui/SafeHTML';\r\nimport { logger } from '../utils/logger';\r\n\r\n\r\n// Type definitions\r\ninterface Answer {\r\n  text: string;\r\n  isCorrect: boolean;\r\n}\r\n\r\ninterface Question {\r\n  id: string;\r\n  text?: string;\r\n  title?: string;\r\n  answers?: Answer[];\r\n  options?: string[];\r\n  type?: string;\r\n  points?: number;\r\n}\r\n\r\ninterface Player {\r\n  id: string;\r\n  username: string;\r\n  name?: string; // Alias for username\r\n  displayName?: string; // Alternative name field\r\n  isReady: boolean;\r\n  isOnline: boolean;\r\n  joinedAt: Date;\r\n}\r\n\r\ninterface PlayerAnswer {\r\n  questionId?: string;\r\n  selectedAnswer: number;\r\n  answer?: string;\r\n  timeToAnswer: number;\r\n  timeSpent?: number;\r\n  pointsEarned: number;\r\n  points?: number; // Alias for pointsEarned\r\n  isCorrect: boolean;\r\n  timestamp: number;\r\n}\r\n\r\ninterface PlayerResult {\r\n  playerId: string;\r\n  playerName: string;\r\n  isCorrect: boolean;\r\n  selectedAnswer: number | null;\r\n  points: number;\r\n  timeSpent: number;\r\n}\r\n\r\ninterface GameData {\r\n  currentQuestionIndex: number;\r\n  questions: Question[];\r\n  timePerQuestion: number;\r\n  showingResults?: boolean;\r\n  nextQuestionAt?: { seconds: number };\r\n  questionEndAt?: { seconds: number };\r\n  phase?: 'countdown' | 'question' | 'results' | 'finished';\r\n  questionResults?: {\r\n    [questionId: string]: PlayerResult[];\r\n  };\r\n}\r\n\r\ninterface RoomData {\r\n  id: string;\r\n  status: 'waiting' | 'starting' | 'playing' | 'finished';\r\n  gameData?: GameData;\r\n  gameStartAt?: { seconds: number };\r\n  gameStartDelay?: number;\r\n  settings?: {\r\n    timePerQuestion?: number;\r\n  };\r\n  quiz?: {\r\n    id?: string;\r\n    title?: string;\r\n    questions: Question[];\r\n  };\r\n  players?: Player[];\r\n  questionAnswers?: {\r\n    [questionIndex: number]: {\r\n      [playerId: string]: PlayerAnswer;\r\n    };\r\n  };\r\n}\r\n\r\ninterface ProcessedQuestion {\r\n  id: string;\r\n  title: string;\r\n  options: string[];\r\n  correct: number;\r\n  type?: string;\r\n  points?: number;\r\n  explanation?: string;\r\n}\r\n\r\ninterface QuestionResults {\r\n  isCorrect: boolean;\r\n  correctAnswer: number;\r\n  selectedAnswer: number | null;\r\n  points: number;\r\n  explanation: string;\r\n}\r\n\r\ninterface MultiplayerQuizProps {\r\n  gameData: GameData | null;\r\n  roomData: RoomData | null;\r\n  currentUserId: string;\r\n  currentUserName: string;\r\n  multiplayerService: MultiplayerServiceInterface | null;\r\n}\r\n\r\nconst MultiplayerQuiz: React.FC<MultiplayerQuizProps> = ({\r\n  gameData,\r\n  roomData,\r\n  currentUserName,\r\n  multiplayerService\r\n}) => {\r\n  const [selectedIndex, setSelectedIndex] = useState<number | null>(null);\r\n  const [locked, setLocked] = useState(false);\r\n  const [showResults, setShowResults] = useState(false);\r\n  const [questionResults, setQuestionResults] = useState<QuestionResults | null>(null);\r\n  const [nextQuestionCountdown, setNextQuestionCountdown] = useState<number | null>(null);\r\n  const [gameStartCountdown, setGameStartCountdown] = useState<number | null>(null);\r\n  const [questionTimeLeft, setQuestionTimeLeft] = useState<number>(0);\r\n  const [realtimeGameData, setRealtimeGameData] = useState<GameData | null>(gameData);\r\n  const [realtimeRoomData, setRealtimeRoomData] = useState<RoomData | null>(roomData);\r\n  \r\n  // Client-side game state for fast performance\r\n  const [playerScores, setPlayerScores] = useState<{[playerId: string]: number}>({});\r\n  const [playerAnswers, setPlayerAnswers] = useState<{[playerId: string]: PlayerAnswer[]}>({});\r\n  const [currentQuestionAnswers, setCurrentQuestionAnswers] = useState<{[playerId: string]: PlayerAnswer}>({});\r\n\r\n  const [waitingForOthers, setWaitingForOthers] = useState<boolean>(false);\r\n  \r\n  const timerRef = useRef<number | null>(null);\r\n  const countdownRef = useRef<number | null>(null);\r\n  const gameStartRef = useRef<number | null>(null);\r\n  const previousQuestionIndexRef = useRef<number>(-1);\r\n\r\n  // Use real-time data consistently\r\n  const currentGameData = realtimeGameData || gameData;\r\n  const currentRoomData = realtimeRoomData || roomData;\r\n  \r\n  const timePerQuestion = currentGameData?.timePerQuestion ?? currentRoomData?.settings?.timePerQuestion ?? 30;\r\n  const [timeLeft, setTimeLeft] = useState<number>(timePerQuestion);\r\n  \r\n  // Get current user from Redux store\r\n  const currentUser = useSelector((state: RootState) => state.auth.user);\r\n  \r\n  // Get current game phase\r\n  const gamePhase = currentGameData?.phase || 'question';\r\n  const roomStatus = currentRoomData?.status || 'waiting';\r\n\r\n  // Real-time Firestore listener\r\n  useEffect(() => {\r\n    if (!roomData?.id) return;\r\n\r\n    const roomRef = doc(db, 'multiplayer_rooms', roomData.id);\r\n    \r\n    const unsubscribe = onSnapshot(roomRef, (doc) => {\r\n      if (doc.exists()) {\r\n        const data = { id: doc.id, ...doc.data() } as RoomData;\r\n        \r\n        setRealtimeRoomData(data);\r\n        if (data.gameData) {\r\n          setRealtimeGameData(data.gameData as GameData);\r\n        }\r\n        \r\n        // Handle game starting phase\r\n        if (data.status === 'starting') {\r\n          if (data.gameStartAt && data.gameStartDelay) {\r\n            const startTime = new Date(data.gameStartAt.seconds * 1000);\r\n            const now = new Date();\r\n            const elapsedTime = Math.floor((now.getTime() - startTime.getTime()) / 1000);\r\n            const secondsLeft = Math.max(0, Math.floor(data.gameStartDelay / 1000) - elapsedTime);\r\n            \r\n            setGameStartCountdown(secondsLeft > 0 ? secondsLeft : 0);\r\n          } else {\r\n            setGameStartCountdown(5);\r\n          }\r\n        }\r\n        \r\n        // Clear countdown when game actually starts OR countdown reaches 0\r\n        if ((data.status === 'playing' && data.gameData?.phase === 'question') || \r\n            (data.status === 'starting' && gameStartCountdown === 0)) {\r\n          setGameStartCountdown(null);\r\n        }\r\n        \r\n        // Handle question timing\r\n        if (data.gameData?.questionEndAt && data.gameData?.phase === 'question') {\r\n          const endTime = new Date(data.gameData.questionEndAt.seconds * 1000);\r\n          const now = new Date();\r\n          const secondsLeft = Math.max(0, Math.ceil((endTime.getTime() - now.getTime()) / 1000));\r\n          \r\n          if (secondsLeft > 0) {\r\n            setQuestionTimeLeft(secondsLeft);\r\n            setTimeLeft(secondsLeft);\r\n          }\r\n        }\r\n        \r\n        // Detect question change\r\n        const newIndex = data.gameData?.currentQuestionIndex ?? 0;\r\n        if (newIndex !== previousQuestionIndexRef.current) {\r\n          previousQuestionIndexRef.current = newIndex;\r\n          \r\n          // Reset UI state for new question\r\n          setSelectedIndex(null);\r\n          setLocked(false);\r\n          setShowResults(false);\r\n          setQuestionResults(null);\r\n          setTimeLeft(timePerQuestion);\r\n          setWaitingForOthers(false);\r\n          setCurrentQuestionAnswers({});\r\n          \r\n          // Clear existing timers\r\n          if (timerRef.current) {\r\n            window.clearTimeout(timerRef.current);\r\n            timerRef.current = null;\r\n          }\r\n          if (countdownRef.current) {\r\n            window.clearTimeout(countdownRef.current);\r\n            countdownRef.current = null;\r\n          }\r\n        }\r\n        \r\n        // Handle results phase\r\n        if (data.gameData?.phase === 'results' && data.gameData?.nextQuestionAt) {\r\n          const nextTime = new Date(data.gameData.nextQuestionAt.seconds * 1000);\r\n          const now = new Date();\r\n          const secondsLeft = Math.max(0, Math.ceil((nextTime.getTime() - now.getTime()) / 1000));\r\n          \r\n          if (secondsLeft > 0) {\r\n            setShowResults(true);\r\n            setNextQuestionCountdown(secondsLeft);\r\n          }\r\n        }\r\n        \r\n        // Handle game finished\r\n        if (data.gameData?.phase === 'finished') {\r\n          setShowResults(true);\r\n          setNextQuestionCountdown(null);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Cleanup function\r\n    return () => {\r\n      unsubscribe();\r\n      if (timerRef.current) {\r\n        window.clearTimeout(timerRef.current);\r\n        timerRef.current = null;\r\n      }\r\n      if (countdownRef.current) {\r\n        window.clearTimeout(countdownRef.current);\r\n        countdownRef.current = null;\r\n      }\r\n      if (gameStartRef.current) {\r\n        window.clearTimeout(gameStartRef.current);\r\n        gameStartRef.current = null;\r\n      }\r\n    };\r\n  }, [roomData?.id, gameStartCountdown, timePerQuestion]);\r\n\r\n  // Sync all players' scores and answers from server data\r\n  useEffect(() => {\r\n    if (!currentRoomData?.questionAnswers) return;\r\n\r\n    const serverPlayerScores: {[playerId: string]: number} = {};\r\n    const serverPlayerAnswers: {[playerId: string]: PlayerAnswer[]} = {};\r\n\r\n    // Calculate scores and answers from server data for ALL players\r\n    Object.values(currentRoomData.questionAnswers).forEach(questionData => {\r\n      Object.entries(questionData).forEach(([playerId, answerData]: [string, PlayerAnswer]) => {\r\n        // Calculate scores\r\n        serverPlayerScores[playerId] = (serverPlayerScores[playerId] || 0) + (answerData.pointsEarned || 0);\r\n        \r\n        // Track answer history\r\n        if (!serverPlayerAnswers[playerId]) {\r\n          serverPlayerAnswers[playerId] = [];\r\n        }\r\n        serverPlayerAnswers[playerId].push({\r\n          questionId: answerData.questionId,\r\n          selectedAnswer: answerData.selectedAnswer,\r\n          isCorrect: answerData.isCorrect,\r\n          timeSpent: answerData.timeToAnswer || answerData.timeSpent,\r\n          timeToAnswer: answerData.timeToAnswer || answerData.timeSpent || 0,\r\n          pointsEarned: answerData.pointsEarned || 0,\r\n          points: answerData.pointsEarned || 0,\r\n          timestamp: answerData.timestamp || Date.now()\r\n        });\r\n      });\r\n    });\r\n    \r\n    // Update state with server data for all players\r\n    setPlayerScores(serverPlayerScores);\r\n    setPlayerAnswers(serverPlayerAnswers);\r\n  }, [currentRoomData?.questionAnswers]);\r\n\r\n  // Game start countdown effect\r\n  useEffect(() => {\r\n    if (gameStartCountdown !== null && gameStartCountdown > 0) {\r\n      gameStartRef.current = window.setTimeout(() => {\r\n        setGameStartCountdown(prev => {\r\n          const newCount = (prev ?? 0) - 1;\r\n          return newCount;\r\n        });\r\n      }, 1000);\r\n    } else if (gameStartCountdown === 0) {\r\n      // Countdown finished - game should start\r\n      setGameStartCountdown(null);\r\n    }\r\n    \r\n    return () => {\r\n      if (gameStartRef.current) {\r\n        window.clearTimeout(gameStartRef.current);\r\n        gameStartRef.current = null;\r\n      }\r\n    };\r\n  }, [gameStartCountdown]);\r\n\r\n  // Question timer countdown effect\r\n  useEffect(() => {\r\n    if (questionTimeLeft !== null && questionTimeLeft > 0 && realtimeGameData?.phase === 'question') {\r\n      const timer = window.setTimeout(() => {\r\n        setQuestionTimeLeft(prev => {\r\n          const newTime = (prev ?? 0) - 1;\r\n          return newTime;\r\n        });\r\n      }, 1000);\r\n      \r\n      return () => window.clearTimeout(timer);\r\n    }\r\n  }, [questionTimeLeft, realtimeGameData?.phase]);\r\n\r\n  // Get current game phase from room data\r\n  const currentGamePhase = realtimeGameData?.phase || gamePhase;\r\n  const currentRoomStatus = realtimeRoomData?.status || roomStatus;\r\n\r\n  // Save final results to server when game finishes\r\n  // Convert quiz format from Firestore to multiplayer format (using index-based answers)\r\n  const processedQuestions = useMemo((): ProcessedQuestion[] => {\r\n    const rawQuestions = currentGameData?.questions || [];\r\n    \r\n    return rawQuestions.map((q: Question): ProcessedQuestion => {\r\n      let options: string[] = [];\r\n      let correctIndex = 0;\r\n\r\n      if (q.answers && Array.isArray(q.answers)) {\r\n        options = q.answers.map(a => a.text);\r\n        correctIndex = q.answers.findIndex(a => a.isCorrect);\r\n      } else if (q.options && Array.isArray(q.options)) {\r\n        options = q.options;\r\n        correctIndex = 0;\r\n      }\r\n\r\n      return {\r\n        id: q.id || `q${rawQuestions.indexOf(q)}`,\r\n        title: q.text || q.title || '',\r\n        options,\r\n        correct: correctIndex,\r\n        type: q.type || 'multiple',\r\n        points: q.points || 10,\r\n        explanation: ''\r\n      };\r\n    });\r\n  }, [currentGameData?.questions]);\r\n\r\n  useEffect(() => {\r\n    const saveFinalResults = async () => {\r\n      if (currentGamePhase === 'finished' && currentUser?.uid && currentRoomData?.id) {\r\n        try {\r\n          const myAnswers = playerAnswers[currentUser.uid] || [];\r\n          const myScore = playerScores[currentUser.uid] || 0;\r\n          const correctAnswers = myAnswers.filter(a => a.isCorrect).length;\r\n          const totalQuestions = processedQuestions.length;\r\n          const percentage = totalQuestions > 0 ? (correctAnswers / totalQuestions) * 100 : 0;\r\n\r\n          // Save to quiz_results collection\r\n          await addDoc(collection(db, 'quiz_results'), {\r\n            userId: currentUser.uid,\r\n            quizId: currentRoomData.quiz?.id || currentRoomData.id,\r\n            quizTitle: currentRoomData.quiz?.title || 'Multiplayer Quiz',\r\n            mode: 'multiplayer',\r\n            roomId: currentRoomData.id,\r\n            score: myScore,\r\n            correctAnswers,\r\n            totalQuestions,\r\n            percentage: Math.round(percentage * 10) / 10,\r\n            timeSpent: myAnswers.reduce<number>((sum, a) => sum + (a.timeSpent || 0), 0),\r\n            completedAt: serverTimestamp(),\r\n            answers: myAnswers.map((a, index) => ({\r\n              questionId: processedQuestions[index]?.id || `q${index}`,\r\n              questionText: processedQuestions[index]?.title || '',\r\n              selectedAnswer: a.selectedAnswer,\r\n              isCorrect: a.isCorrect,\r\n              timeSpent: a.timeSpent || 0,\r\n              points: a.points || 0\r\n            }))\r\n          });\r\n\r\n          logger.success('Multiplayer results saved successfully');\r\n        } catch (error) {\r\n          logger.error('Failed to save multiplayer results', error);\r\n          toast.error('Failed to save your results');\r\n        }\r\n      }\r\n    };\r\n    \r\n    saveFinalResults();\r\n  }, [currentGamePhase, currentUser?.uid, currentRoomData?.id, currentRoomData?.quiz, playerAnswers, playerScores, processedQuestions]);\r\n\r\n  // Get current question\r\n  const currentQuestionIndex = currentGameData?.currentQuestionIndex || 0;\r\n  const currentQuestion = processedQuestions[currentQuestionIndex];\r\n\r\n  // Fallback for missing question data\r\n  const finalQuestion: ProcessedQuestion = useMemo(() => currentQuestion || {\r\n    id: 'error',\r\n    title: 'No question available',\r\n    options: ['Please wait...'],\r\n    correct: 0,\r\n    explanation: 'Question loading...'\r\n  }, [currentQuestion]);\r\n\r\n  // Countdown timer (optimized - minimal dependencies)\r\n  useEffect(() => {\r\n    if (locked || showResults || timeLeft <= 0) return;\r\n    \r\n    timerRef.current = window.setTimeout(() => {\r\n      setTimeLeft(prev => prev - 1);\r\n    }, 1000);\r\n\r\n    return () => {\r\n      if (timerRef.current) {\r\n        window.clearTimeout(timerRef.current);\r\n        timerRef.current = null;\r\n      }\r\n    };\r\n  }, [timeLeft, locked, showResults]);\r\n\r\n  // Submit answer function - defined before useEffect that uses it\r\n  const handleSubmit = useCallback(async (answerIndex?: number) => {\r\n    const indexToSubmit = answerIndex !== undefined ? answerIndex : selectedIndex;\r\n    if (locked) return; // Prevent double submission\r\n    \r\n    setLocked(true);\r\n    \r\n    if (!multiplayerService || !currentRoomData?.id || !finalQuestion?.id || !currentUser?.uid) {\r\n      console.warn('Cannot submit answer - missing data:', { \r\n        hasService: !!multiplayerService, \r\n        roomId: currentRoomData?.id, \r\n        questionId: finalQuestion?.id,\r\n        userId: currentUser?.uid\r\n      });\r\n      setLocked(false); // Allow retry\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const timeSpent = timePerQuestion - timeLeft;\r\n      const isCorrect = indexToSubmit !== null ? indexToSubmit === finalQuestion.correct : false;\r\n      const points = isCorrect ? Math.max(10, Math.floor(100 - (timeSpent * 2))) : 0; // 10-100 points based on speed\r\n      \r\n      // Update client-side scores immediately for fast UI response\r\n      setPlayerScores(prev => ({\r\n        ...prev,\r\n        [currentUser.uid]: (prev[currentUser.uid] || 0) + points\r\n      }));\r\n      \r\n      // Store current question answer for real-time leaderboard during results\r\n      setCurrentQuestionAnswers(prev => ({\r\n        ...prev,\r\n        [currentUser.uid]: {\r\n          selectedAnswer: indexToSubmit ?? -1,\r\n          answer: `${indexToSubmit ?? -1}`,\r\n          timeToAnswer: timeSpent,\r\n          timeSpent,\r\n          isCorrect,\r\n          pointsEarned: points,\r\n          points,\r\n          timestamp: Date.now()\r\n        }\r\n      }));\r\n      \r\n      // Update player's answer history\r\n      setPlayerAnswers(prev => ({\r\n        ...prev,\r\n        [currentUser.uid]: [\r\n          ...(prev[currentUser.uid] || []),\r\n          {\r\n            questionId: finalQuestion.id,\r\n            selectedAnswer: indexToSubmit ?? -1,\r\n            answer: `${indexToSubmit ?? -1}`,\r\n            timeToAnswer: timeSpent,\r\n            timeSpent,\r\n            isCorrect,\r\n            pointsEarned: points,\r\n            points,\r\n            timestamp: Date.now()\r\n          }\r\n        ]\r\n      }));\r\n      \r\n      // Submit to server (for sync with other players) - only if answer was selected\r\n      if (indexToSubmit !== null) {\r\n        await multiplayerService.submitAnswer(currentRoomData.id, finalQuestion.id, indexToSubmit, timeSpent);\r\n      }\r\n      \r\n      // Set waiting state\r\n      setWaitingForOthers(true);\r\n      \r\n      // Show results after 1 second\r\n      setTimeout(() => {\r\n        setQuestionResults({\r\n          isCorrect,\r\n          correctAnswer: finalQuestion.correct,\r\n          selectedAnswer: indexToSubmit ?? -1,\r\n          points,\r\n          explanation: finalQuestion.explanation || ''\r\n        });\r\n        setShowResults(true);\r\n      }, 1000);\r\n      \r\n    } catch (error) {\r\n      console.error('Error submitting answer:', error);\r\n      setLocked(false); // Allow retry on error\r\n    }\r\n  }, [selectedIndex, locked, multiplayerService, currentRoomData, finalQuestion, currentUser, timePerQuestion, timeLeft]);\r\n\r\n  // Handle time up\r\n  useEffect(() => {\r\n    if (timeLeft <= 0 && !locked) {\r\n      // Auto-submit with selected answer, or undefined if no selection\r\n      handleSubmit(selectedIndex ?? undefined);\r\n    }\r\n  }, [timeLeft, locked, handleSubmit, selectedIndex]);\r\n\r\n  // Next question countdown (server-controlled)\r\n  useEffect(() => {\r\n    if (nextQuestionCountdown === null || nextQuestionCountdown <= 0) return;\r\n    \r\n    countdownRef.current = window.setTimeout(() => {\r\n      setNextQuestionCountdown(prev => prev !== null ? prev - 1 : null);\r\n    }, 1000);\r\n\r\n    return () => {\r\n      if (countdownRef.current) {\r\n        window.clearTimeout(countdownRef.current);\r\n        countdownRef.current = null;\r\n      }\r\n    };\r\n  }, [nextQuestionCountdown]);\r\n\r\n  const handleSelect = (answerIndex: number) => {\r\n    if (locked) return;\r\n    setSelectedIndex(answerIndex);\r\n    // Auto-submit immediately after selection (like MultiplayerGameSimple)\r\n    setTimeout(() => handleSubmit(answerIndex), 100);\r\n  };\r\n  \r\n  // Calculate progress percentage with proper pathLength\r\n  const progressPercent = useMemo(() => {\r\n    return Math.max(0, Math.min(100, Math.round((timeLeft / timePerQuestion) * 100)));\r\n  }, [timeLeft, timePerQuestion]);\r\n\r\n  // SVG circle properties for accurate progress\r\n  const radius = 16;\r\n  const circumference = 2 * Math.PI * radius;\r\n  const strokeDashoffset = circumference - (progressPercent / 100) * circumference;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-blue-100 p-2 sm:p-4 lg:p-6\">\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        \r\n        {/* Game Start Countdown Phase */}\r\n        {currentRoomStatus === 'starting' && gameStartCountdown !== null && gameStartCountdown >= 0 && (\r\n          <div className=\"bg-white rounded-2xl shadow-xl p-8 text-center mb-6\">\r\n            <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">Game Starting Soon!</h2>\r\n            <div className=\"text-6xl font-bold text-purple-600 mb-4\">{gameStartCountdown}</div>\r\n            <p className=\"text-gray-600\">Get ready to answer questions!</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Question Results Phase */}\r\n        {currentGamePhase === 'results' && questionResults && (\r\n          <div className=\"bg-white rounded-2xl shadow-xl p-6 mb-6\">\r\n            <h3 className=\"text-xl font-bold text-gray-800 mb-4 text-center\">Question Results</h3>\r\n            \r\n            {/* Your Result */}\r\n            <div className=\"mb-6 p-4 bg-blue-50 rounded-xl border border-blue-200\">\r\n              <div className=\"text-center\">\r\n                <div className={`text-2xl font-bold mb-2 ${questionResults.isCorrect ? 'text-green-600' : 'text-red-600'}`}>\r\n                  {questionResults.isCorrect ? '‚úÖ Correct!' : '‚ùå Wrong!'}\r\n                </div>\r\n                <div className=\"text-lg text-gray-700 mb-2\">\r\n                  You earned <span className=\"font-bold text-blue-600\">+{questionResults.points}</span> points\r\n                </div>\r\n                <div className=\"text-sm text-gray-600\">\r\n                  Correct Answer: <span className=\"font-semibold\">{finalQuestion.options?.[questionResults.correctAnswer] || 'N/A'}</span>\r\n                </div>\r\n                {questionResults.explanation && (\r\n                  <SafeHTML content={questionResults.explanation} className=\"text-xs text-gray-500 mt-2\" />\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Live Leaderboard */}\r\n            <div className=\"mb-4\">\r\n              <h4 className=\"font-semibold text-gray-700 mb-3 text-center\">Current Standings</h4>\r\n              <div className=\"space-y-2 max-h-60 overflow-y-auto\">\r\n                {(currentRoomData?.players || [])\r\n                  .map((player: Player) => ({\r\n                    ...player,\r\n                    score: playerScores[player.id] || 0\r\n                  }))\r\n                  .sort((a, b) => b.score - a.score)\r\n                  .map((player, index) => {\r\n                    const isCurrentUser = player.id === currentUser?.uid;\r\n                    const position = index + 1;\r\n                    const trophy = position === 1 ? 'üëë' : position === 2 ? 'ü•à' : position === 3 ? 'ü•â' : 'üèÖ';\r\n                    const currentAnswer = currentQuestionAnswers[player.id];\r\n                    const correctAnswersCount = playerAnswers[player.id]?.filter(a => a.isCorrect).length || 0;\r\n                    \r\n                    return (\r\n                      <div \r\n                        key={player.id} \r\n                        className={`flex items-center justify-between p-3 rounded-lg ${\r\n                          isCurrentUser ? 'bg-blue-100 border border-blue-300' : 'bg-gray-50'\r\n                        }`}\r\n                      >\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <span className=\"text-lg\">{trophy}</span>\r\n                          <div>\r\n                            <div className={`font-medium text-sm ${isCurrentUser ? 'text-blue-700' : 'text-gray-800'}`}>\r\n                              #{position} {isCurrentUser \r\n                                ? (currentUserName || player?.username || player?.name || 'You')\r\n                                : (player?.username || player?.name || player?.displayName || `Player ${position}`)\r\n                              }\r\n                              {isCurrentUser && <span className=\"ml-1 text-xs\">(You)</span>}\r\n                            </div>\r\n                            <div className=\"text-xs text-gray-500\">\r\n                              {correctAnswersCount} ƒë√∫ng ‚Ä¢ {player.score} ƒëi·ªÉm\r\n                              {currentAnswer && (\r\n                                <span className={`ml-2 ${currentAnswer.isCorrect ? 'text-green-600' : 'text-red-600'}`}>\r\n                                  {currentAnswer.isCorrect ? '‚úì' : '‚úó'} +{currentAnswer.points}\r\n                                </span>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                        <div className={`text-right ${isCurrentUser ? 'text-blue-700' : 'text-gray-700'}`}>\r\n                          <div className=\"font-bold text-sm\">{player.score}</div>\r\n                          <div className=\"text-xs text-gray-500\">pts</div>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n              </div>\r\n            </div>\r\n            \r\n            {nextQuestionCountdown !== null && (\r\n              <div className=\"mt-4 text-center\">\r\n                {nextQuestionCountdown > 0 ? (\r\n                  <p className=\"text-gray-600\">C√¢u h·ªèi ti·∫øp theo trong: <span className=\"font-bold text-blue-600\">{nextQuestionCountdown}s</span></p>\r\n                ) : (\r\n                  <p className=\"text-gray-600\">ƒêang ch·ªù ng∆∞·ªùi ch∆°i kh√°c...</p>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Final Results Phase - Ultra Modern Leaderboard */}\r\n        {currentGamePhase === 'finished' && (\r\n          <div className=\"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4\">\r\n            <div className=\"max-w-4xl mx-auto\">\r\n              \r\n              {/* Trophy Header */}\r\n              <div className=\"text-center mb-8\">\r\n                <div className=\"inline-flex items-center justify-center w-24 h-24 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full mb-4 shadow-2xl\">\r\n                  <span className=\"text-4xl\">üèÜ</span>\r\n                </div>\r\n                <h1 className=\"text-5xl font-black text-white mb-2 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent\">\r\n                  GAME COMPLETE!\r\n                </h1>\r\n                <p className=\"text-xl text-blue-200\">Amazing performance by all players</p>\r\n              </div>\r\n\r\n              {/* Champion Podium */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n                {Object.entries(playerScores)\r\n                  .sort(([,a], [,b]) => b - a)\r\n                  .slice(0, 3)\r\n                  .map(([playerId, score], index) => {\r\n                    const player = currentRoomData?.players?.find((p: Player) => p.id === playerId);\r\n                    const isCurrentUser = playerId === currentUser?.uid;\r\n                    const position = index + 1;\r\n                    const playerAnswerHistory = playerAnswers[playerId] || [];\r\n                    const correctAnswers = playerAnswerHistory.filter(a => a.isCorrect).length;\r\n                    const totalQuestions = processedQuestions.length;\r\n                    const accuracy = totalQuestions > 0 ? Math.round((correctAnswers/totalQuestions)*100) : 0;\r\n                    \r\n                    const podiumData = {\r\n                      1: { \r\n                        trophy: 'ü•á', \r\n                        color: 'from-yellow-400 to-yellow-600', \r\n                        bgColor: 'from-yellow-50 to-orange-50',\r\n                        borderColor: 'border-yellow-400',\r\n                        height: 'h-32'\r\n                      },\r\n                      2: { \r\n                        trophy: 'ü•à', \r\n                        color: 'from-gray-400 to-gray-600', \r\n                        bgColor: 'from-gray-50 to-slate-50',\r\n                        borderColor: 'border-gray-400',\r\n                        height: 'h-24'\r\n                      },\r\n                      3: { \r\n                        trophy: 'ü•â', \r\n                        color: 'from-amber-600 to-amber-800', \r\n                        bgColor: 'from-amber-50 to-yellow-50',\r\n                        borderColor: 'border-amber-500',\r\n                        height: 'h-20'\r\n                      }\r\n                    };\r\n                    \r\n                    const podium = podiumData[position as keyof typeof podiumData];\r\n                    \r\n                    return (\r\n                      <div key={playerId} className=\"text-center\">\r\n                        <div className={`bg-white rounded-2xl shadow-2xl border-4 ${podium.borderColor} overflow-hidden transform hover:scale-105 transition-all duration-300 ${isCurrentUser ? 'ring-4 ring-blue-400' : ''}`}>\r\n                          \r\n                          {/* Podium Height Indicator */}\r\n                          <div className={`bg-gradient-to-r ${podium.color} ${podium.height} flex items-end justify-center pb-4`}>\r\n                            <span className=\"text-6xl\">{podium.trophy}</span>\r\n                          </div>\r\n                          \r\n                          {/* Player Info */}\r\n                          <div className={`bg-gradient-to-r ${podium.bgColor} p-6`}>\r\n                            <div className=\"text-2xl font-bold text-gray-800 mb-1\">\r\n                              #{position}\r\n                            </div>\r\n                            <div className={`text-lg font-semibold mb-2 ${isCurrentUser ? 'text-blue-700' : 'text-gray-700'}`}>\r\n                              {player?.username || player?.name || 'Player'}\r\n                              {isCurrentUser && <div className=\"text-sm text-blue-600 font-medium\">(You)</div>}\r\n                            </div>\r\n                            \r\n                            {/* Score Display */}\r\n                            <div className=\"bg-white rounded-xl p-4 mb-3 shadow-inner\">\r\n                              <div className=\"text-3xl font-black text-gray-800\">{score}</div>\r\n                              <div className=\"text-sm text-gray-600 font-medium\">POINTS</div>\r\n                            </div>\r\n                            \r\n                            {/* Stats */}\r\n                            <div className=\"grid grid-cols-2 gap-2 text-xs\">\r\n                              <div className=\"bg-white rounded-lg p-2\">\r\n                                <div className=\"font-bold text-green-600\">{correctAnswers}</div>\r\n                                <div className=\"text-gray-600\">Correct</div>\r\n                              </div>\r\n                              <div className=\"bg-white rounded-lg p-2\">\r\n                                <div className=\"font-bold text-blue-600\">{accuracy}%</div>\r\n                                <div className=\"text-gray-600\">Accuracy</div>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n              </div>\r\n\r\n              {/* Complete Leaderboard */}\r\n              <div className=\"bg-white rounded-3xl shadow-2xl p-8 mb-8\">\r\n                <h2 className=\"text-3xl font-black text-gray-800 mb-6 text-center\">\r\n                  üèÖ COMPLETE RANKINGS\r\n                </h2>\r\n                \r\n                <div className=\"space-y-3\">\r\n                  {Object.entries(playerScores)\r\n                    .sort(([,a], [,b]) => b - a)\r\n                    .map(([playerId, score], index) => {\r\n                      const player = currentRoomData?.players?.find((p: Player) => p.id === playerId);\r\n                      const isCurrentUser = playerId === currentUser?.uid;\r\n                      const position = index + 1;\r\n                      const playerAnswerHistory = playerAnswers[playerId] || [];\r\n                      const correctAnswers = playerAnswerHistory.filter(a => a.isCorrect).length;\r\n                      const totalQuestions = processedQuestions.length;\r\n                      const accuracy = totalQuestions > 0 ? Math.round((correctAnswers/totalQuestions)*100) : 0;\r\n                      const avgTimePerQuestion = playerAnswerHistory.length > 0 ? \r\n                        Math.round(playerAnswerHistory.reduce((sum, a) => sum + (a.timeSpent || 0), 0) / playerAnswerHistory.length) : 0;\r\n                      \r\n                      const positionColors = {\r\n                        1: 'bg-gradient-to-r from-yellow-100 to-orange-100 border-yellow-400',\r\n                        2: 'bg-gradient-to-r from-gray-100 to-slate-100 border-gray-400', \r\n                        3: 'bg-gradient-to-r from-amber-100 to-yellow-100 border-amber-400'\r\n                      };\r\n                      \r\n                      const defaultColor = isCurrentUser ? \r\n                        'bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-400' : \r\n                        'bg-white border-gray-200';\r\n                      \r\n                      const cardColor = positionColors[position as keyof typeof positionColors] || defaultColor;\r\n                      \r\n                      return (\r\n                        <div \r\n                          key={playerId}\r\n                          className={`${cardColor} border-2 rounded-2xl p-4 transform hover:scale-102 transition-all duration-200 shadow-lg hover:shadow-xl`}\r\n                        >\r\n                          <div className=\"flex items-center justify-between\">\r\n                            \r\n                            {/* Left: Rank & Player Info */}\r\n                            <div className=\"flex items-center gap-4\">\r\n                              <div className=\"text-center\">\r\n                                <div className={`w-12 h-12 rounded-full flex items-center justify-center font-black text-lg ${\r\n                                  position <= 3 ? 'bg-gradient-to-r from-purple-500 to-blue-600 text-white' : 'bg-gray-200 text-gray-700'\r\n                                }`}>\r\n                                  #{position}\r\n                                </div>\r\n                              </div>\r\n                              \r\n                              <div>\r\n                                <div className={`text-xl font-bold ${isCurrentUser ? 'text-blue-700' : 'text-gray-800'}`}>\r\n                                  {player?.username || player?.name || 'Player'}\r\n                                  {isCurrentUser && <span className=\"ml-2 text-sm bg-blue-500 text-white px-2 py-1 rounded-full\">YOU</span>}\r\n                                </div>\r\n                                <div className=\"text-sm text-gray-600\">\r\n                                  {correctAnswers}/{totalQuestions} correct ‚Ä¢ {accuracy}% accuracy ‚Ä¢ Avg: {avgTimePerQuestion}s\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                            \r\n                            {/* Right: Score */}\r\n                            <div className=\"text-right\">\r\n                              <div className={`text-3xl font-black ${isCurrentUser ? 'text-blue-700' : 'text-gray-800'}`}>\r\n                                {score}\r\n                              </div>\r\n                              <div className=\"text-sm text-gray-600 font-medium\">POINTS</div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Game Statistics */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8\">\r\n                <div className=\"bg-white rounded-2xl p-6 text-center shadow-xl\">\r\n                  <div className=\"text-3xl mb-2\">üìù</div>\r\n                  <div className=\"text-2xl font-bold text-gray-800\">{processedQuestions.length}</div>\r\n                  <div className=\"text-sm text-gray-600 font-medium\">Total Questions</div>\r\n                </div>\r\n                <div className=\"bg-white rounded-2xl p-6 text-center shadow-xl\">\r\n                  <div className=\"text-3xl mb-2\">üë•</div>\r\n                  <div className=\"text-2xl font-bold text-gray-800\">{Object.keys(playerScores).length}</div>\r\n                  <div className=\"text-sm text-gray-600 font-medium\">Players</div>\r\n                </div>\r\n                <div className=\"bg-white rounded-2xl p-6 text-center shadow-xl\">\r\n                  <div className=\"text-3xl mb-2\">‚úÖ</div>\r\n                  <div className=\"text-2xl font-bold text-gray-800\">\r\n                    {playerAnswers[currentUser?.uid || '']?.filter(a => a.isCorrect).length || 0}\r\n                  </div>\r\n                  <div className=\"text-sm text-gray-600 font-medium\">Your Correct</div>\r\n                </div>\r\n                <div className=\"bg-white rounded-2xl p-6 text-center shadow-xl\">\r\n                  <div className=\"text-3xl mb-2\">üéØ</div>\r\n                  <div className=\"text-2xl font-bold text-gray-800\">\r\n                    {playerScores[currentUser?.uid || ''] || 0}\r\n                  </div>\r\n                  <div className=\"text-sm text-gray-600 font-medium\">Your Score</div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Action Buttons */}\r\n              <div className=\"text-center\">\r\n                <p className=\"text-xl text-blue-200 mb-6\">Thanks for playing! üéâ</p>\r\n                <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\r\n                  <button \r\n                    onClick={() => window.location.href = '/multiplayer'}\r\n                    className=\"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:from-purple-700 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 shadow-2xl hover:shadow-purple-500/25\"\r\n                  >\r\n                    üéÆ Play Again\r\n                  </button>\r\n                  <button \r\n                    onClick={() => window.location.href = '/profile'}\r\n                    className=\"bg-gradient-to-r from-gray-600 to-gray-700 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:from-gray-700 hover:to-gray-800 transform hover:scale-105 transition-all duration-200 shadow-2xl\"\r\n                  >\r\n                    üë§ View Profile\r\n                  </button>\r\n                  <button \r\n                    onClick={() => window.location.href = '/leaderboard'}\r\n                    className=\"bg-gradient-to-r from-green-600 to-teal-600 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:from-green-700 hover:to-teal-700 transform hover:scale-105 transition-all duration-200 shadow-2xl\"\r\n                  >\r\n                    üèÜ Global Leaderboard\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              \r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Regular Game UI - show when ready to play */}\r\n        {((currentRoomStatus === 'playing' && currentGamePhase === 'question') || \r\n          (currentRoomStatus === 'starting' && gameStartCountdown === 0)) && \r\n         currentGamePhase !== 'finished' && \r\n         processedQuestions.length > 0 && (\r\n          <>\r\n        {/* Header */}\r\n        <div className=\"bg-white rounded-2xl shadow-xl p-4 sm:p-6 mb-4 sm:mb-6\">\r\n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4\">\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4\">\r\n              <div className=\"bg-gradient-to-r from-purple-500 to-blue-600 text-white px-3 sm:px-4 py-2 rounded-xl font-bold text-sm sm:text-base text-center\">\r\n                Question {currentQuestionIndex + 1} of {processedQuestions.length}\r\n              </div>\r\n              <div className=\"flex items-center gap-2 text-gray-600 justify-center sm:justify-start\">\r\n                <Users size={18} />\r\n                <span className=\"text-sm sm:text-base\">{currentRoomData?.players?.length || 0} players</span>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"flex flex-col sm:flex-row items-center gap-2 sm:gap-4\">\r\n              {locked && (\r\n                <div className=\"flex items-center gap-2 bg-green-100 text-green-700 px-3 py-2 rounded-xl font-medium text-sm\">\r\n                  <CheckCircle size={16} />\r\n                  <span>Submitted!</span>\r\n                </div>\r\n              )}\r\n              \r\n              <div className=\"flex items-center gap-2 sm:gap-3\">\r\n                <div className={`flex items-center gap-2 px-3 sm:px-4 py-2 rounded-xl font-bold text-sm sm:text-base ${\r\n                  timeLeft <= 5 ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'\r\n                }`}>\r\n                  <Clock size={16} />\r\n                  <span>{timeLeft}s</span>\r\n                </div>\r\n                \r\n                <div className=\"relative w-12 h-12 sm:w-16 sm:h-16\">\r\n                  <svg className=\"w-12 h-12 sm:w-16 sm:h-16 transform -rotate-90\" viewBox=\"0 0 36 36\">\r\n                    <circle cx=\"18\" cy=\"18\" r=\"16\" fill=\"none\" stroke=\"#e5e7eb\" strokeWidth=\"3\"/>\r\n                    <circle \r\n                      cx=\"18\" cy=\"18\" r=\"16\" fill=\"none\" \r\n                      stroke={timeLeft <= 5 ? \"#ef4444\" : \"#3b82f6\"}\r\n                      strokeWidth=\"3\" \r\n                      strokeLinecap=\"round\"\r\n                      strokeDasharray={circumference}\r\n                      strokeDashoffset={strokeDashoffset}\r\n                      className=\"transition-all duration-1000\"\r\n                    />\r\n                  </svg>\r\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                    <span className={`text-xs font-bold ${timeLeft <= 5 ? 'text-red-600' : 'text-blue-600'}`}>\r\n                      {progressPercent}%\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          {timeLeft <= 10 && !locked && (\r\n            <div className=\"bg-orange-100 border-l-4 border-orange-500 p-4 rounded-r-lg mb-4\">\r\n              <div className=\"flex items-center gap-2 text-orange-700\">\r\n                <AlertCircle size={18} />\r\n                <span className=\"font-medium\">Time is running out!</span>\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          {waitingForOthers && (\r\n            <div className=\"bg-blue-100 border-l-4 border-blue-500 p-4 rounded-r-lg mb-4\">\r\n              <div className=\"flex items-center gap-2 text-blue-700\">\r\n                <Clock size={18} />\r\n                <span className=\"font-medium\">Waiting for other players...</span>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Question */}\r\n        <div className=\"bg-white rounded-2xl shadow-xl p-4 sm:p-6 lg:p-8\">\r\n          <div className=\"text-center mb-6 sm:mb-8\">\r\n            <h2 className=\"text-lg sm:text-xl lg:text-2xl font-bold text-gray-800 mb-4\">\r\n              {finalQuestion.title || 'No question available'}\r\n            </h2>\r\n            <div className=\"w-12 sm:w-16 h-1 bg-gradient-to-r from-purple-500 to-blue-600 mx-auto rounded-full\"></div>\r\n          </div>\r\n          \r\n          {/* Show message if no options */}\r\n          {(!finalQuestion.options || finalQuestion.options.length === 0) && (\r\n            <div className=\"text-center p-8 bg-gray-50 rounded-xl\">\r\n              <p className=\"text-gray-600\">Waiting for question options to load...</p>\r\n              <p className=\"text-sm text-gray-500 mt-2\">\r\n                Questions available: {processedQuestions.length} | Current index: {currentQuestionIndex}\r\n              </p>\r\n            </div>\r\n          )}\r\n          \r\n          {/* Show options if available */}\r\n          {finalQuestion.options && finalQuestion.options.length > 0 ? (\r\n            <div className=\"grid gap-3 sm:gap-4 mb-6 sm:mb-8\">\r\n              {finalQuestion.options.map((option: string, idx: number) => {\r\n                const isSelected = selectedIndex === idx;\r\n                const optionLabels = ['A', 'B', 'C', 'D'];\r\n                \r\n                return (\r\n                  <button\r\n                    key={idx}\r\n                    onClick={() => handleSelect(idx)}\r\n                    className={`group relative px-4 sm:px-6 py-3 sm:py-4 rounded-2xl text-left transition-all duration-200 transform hover:scale-105 ${\r\n                      isSelected \r\n                        ? 'border-2 border-blue-500 bg-gradient-to-r from-blue-50 to-indigo-50 shadow-lg' \r\n                        : 'border-2 border-gray-200 bg-white hover:border-gray-300 hover:shadow-md'\r\n                    } ${locked ? 'opacity-60 cursor-not-allowed transform-none' : ''}`}\r\n                    disabled={locked}\r\n                  >\r\n                    <div className=\"flex items-center gap-3 sm:gap-4\">\r\n                      <div className={`w-8 h-8 sm:w-10 sm:h-10 rounded-xl flex items-center justify-center font-bold text-xs sm:text-sm ${\r\n                        isSelected \r\n                          ? 'bg-blue-500 text-white' \r\n                          : 'bg-gray-100 text-gray-600 group-hover:bg-gray-200'\r\n                      }`}>\r\n                        {optionLabels[idx] || idx + 1}\r\n                      </div>\r\n                      <span className=\"font-medium text-gray-800 text-sm sm:text-base\">{option}</span>\r\n                    </div>\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n          ) : (\r\n            <div className=\"bg-red-100 p-4 rounded-lg\">\r\n              <p className=\"text-red-700\">‚ùå No options available for this question</p>\r\n            </div>\r\n          )}\r\n\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n              <div className=\"text-sm text-gray-500 text-center sm:text-left\">\r\n                {locked ? 'Answer submitted' : \r\n                 selectedIndex !== null ? 'Answer selected' : \r\n                 'Choose your answer'}\r\n              </div>\r\n              \r\n              {locked && (\r\n                <div className=\"flex items-center gap-2 bg-green-100 text-green-700 px-4 py-2 rounded-xl font-medium\">\r\n                  <CheckCircle size={16} />\r\n                  <span>Submitted!</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n        </div>\r\n\r\n        {/* Question Results Modal */}\r\n        {showResults && questionResults && (\r\n          <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-6 transform animate-in fade-in zoom-in-95 duration-300\">\r\n              <div className=\"text-center mb-6\">\r\n                <div className={`w-20 h-20 mx-auto rounded-full flex items-center justify-center mb-4 ${\r\n                  questionResults.isCorrect \r\n                    ? 'bg-green-100 text-green-600' \r\n                    : 'bg-red-100 text-red-600'\r\n                }`}>\r\n                  {questionResults.isCorrect ? (\r\n                    <CheckCircle size={40} />\r\n                  ) : (\r\n                    <AlertCircle size={40} />\r\n                  )}\r\n                </div>\r\n                \r\n                <h3 className={`text-2xl font-bold mb-2 ${\r\n                  questionResults.isCorrect ? 'text-green-600' : 'text-red-600'\r\n                }`}>\r\n                  {questionResults.isCorrect ? 'üéâ Correct!' : '‚ùå Incorrect'}\r\n                </h3>\r\n                \r\n                <div className=\"text-3xl font-bold text-blue-600 mb-4\">\r\n                  +{questionResults.points} points\r\n                </div>\r\n                \r\n                <SafeHTML content={questionResults.explanation} className=\"text-gray-600 mb-4\" />\r\n                \r\n                {nextQuestionCountdown !== null && (\r\n                  <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-4\">\r\n                    <div className=\"flex items-center justify-center gap-2 text-blue-700\">\r\n                      <Clock size={20} />\r\n                      <span className=\"font-semibold\">\r\n                        {nextQuestionCountdown > 0 \r\n                          ? `C√¢u h·ªèi ti·∫øp theo trong ${nextQuestionCountdown} gi√¢y...`\r\n                          : \"ƒêang ch·ªù ng∆∞·ªùi ch∆°i kh√°c...\"\r\n                        }\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MultiplayerQuiz;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\QuizSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[394,397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[394,397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[596,599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[596,599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[832,835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[832,835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3177,3180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3177,3180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3916,3919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3916,3919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-3xl font-bold text-white mb-2\">\r\n                  üéÆ Ch·ªçn Quiz ƒë·ªÉ ch∆°i Multiplayer\r\n                </h1>","line":166,"column":68,"nodeType":"JSXText","endLine":168,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-purple-200\">\r\n                  Ch·ªçn m·ªôt quiz ƒë·ªÉ t·∫°o ph√≤ng ho·∫∑c tham gia ch∆°i v·ªõi b·∫°n b√®\r\n                </p>","line":169,"column":48,"nodeType":"JSXText","endLine":171,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                onClick={onBack}\r\n                className=\"px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-colors\"\r\n              >\r\n                ‚Üê Quay l·∫°i\r\n              </button>","line":176,"column":16,"nodeType":"JSXText","endLine":178,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-white font-bold mb-2\">üîç Debug Information:</h3>","line":223,"column":61,"nodeType":"JSXText","endLine":223,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>‚úÖ Auth User: {debugInfo.authUser}</p>","line":225,"column":24,"nodeType":"JSXText","endLine":225,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>üìä Total Quizzes in DB: {debugInfo.totalFromDb}</p>","line":226,"column":24,"nodeType":"JSXText","endLine":226,"endColumn":48},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>‚úÖ Valid Quizzes (with questions): {debugInfo.validQuizzes}</p>","line":227,"column":24,"nodeType":"JSXText","endLine":227,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>‚è∞ Last Fetch: {new Date(debugInfo.timestamp).toLocaleTimeString()}</p>","line":228,"column":24,"nodeType":"JSXText","endLine":228,"endColumn":38},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                      onClick={onBack}\r\n                      className=\"px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-lg transition-all\"\r\n                    >\r\n                      ‚Üê Quay l·∫°i\r\n                    </button>","line":249,"column":22,"nodeType":"JSXText","endLine":251,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{quiz.questions?.length || 0} c√¢u</span>","line":293,"column":60,"nodeType":"JSXText","endLine":293,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{quiz.duration || 15} ph√∫t</span>","line":297,"column":52,"nodeType":"JSXText","endLine":297,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button className=\"mt-4 w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 transform group-hover:scale-105\">\r\n                      üéÆ Ch·ªçn Quiz n√†y\r\n                    </button>","line":319,"column":244,"nodeType":"JSXText","endLine":321,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-purple-200\">\r\n                Hi·ªÉn th·ªã {filteredQuizzes.length} quiz\r\n              </p>","line":333,"column":46,"nodeType":"JSXText","endLine":334,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-purple-200\">\r\n                Hi·ªÉn th·ªã {filteredQuizzes.length} quiz\r\n              </p>","line":334,"column":50,"nodeType":"JSXText","endLine":335,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { collection, getDocs, query, where } from 'firebase/firestore';\r\nimport { db, auth } from '../../../firebase/config';\r\nimport { Search, BookOpen, Clock, Loader2 } from 'lucide-react';\r\nimport { logger } from '../utils/logger';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface QuizSelectorProps {\r\n  onSelectQuiz: (quiz: any) => void;\r\n  onBack: () => void;\r\n}\r\n\r\nconst QuizSelector: React.FC<QuizSelectorProps> = ({ onSelectQuiz, onBack }) => {\r\n  const { t } = useTranslation();\r\n  const [quizzes, setQuizzes] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\r\n  const [debugInfo, setDebugInfo] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    const fetchQuizzes = async () => {\r\n      try {\r\n        logger.debug('[QuizSelector] Starting to fetch quizzes...', {\r\n          userId: auth.currentUser?.uid,\r\n          isAuthenticated: !!auth.currentUser\r\n        });\r\n        \r\n        // Wait for auth to be ready\r\n        if (!auth.currentUser) {\r\n          logger.warn('[QuizSelector] Waiting for authentication...');\r\n          // Wait for auth state to initialize\r\n          const unsubscribe = auth.onAuthStateChanged((user) => {\r\n            if (user) {\r\n              logger.success('[QuizSelector] Auth ready', { userId: user.uid });\r\n              unsubscribe();\r\n              // Retry fetch after auth is ready\r\n              fetchQuizzesData();\r\n            } else {\r\n              logger.error('[QuizSelector] User not authenticated after waiting!');\r\n              setLoading(false);\r\n              unsubscribe();\r\n            }\r\n          });\r\n          return;\r\n        }\r\n        \r\n        await fetchQuizzesData();\r\n      } catch (error) {\r\n        logger.error('[QuizSelector] Error in main fetch', error);\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    const fetchQuizzesData = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const quizzesRef = query(\r\n          collection(db, 'quizzes'),\r\n          where('status', '==', 'approved')\r\n        );\r\n        \r\n        logger.debug('[QuizSelector] Fetching APPROVED quizzes...', { userId: auth.currentUser?.uid });\r\n        \r\n        // Fetch ONLY APPROVED quizzes (can be accessed by users)\r\n        const snapshot = await getDocs(quizzesRef);\r\n        \r\n        logger.debug('[QuizSelector] Total approved quizzes found', { count: snapshot.size });\r\n        \r\n        if (snapshot.empty) {\r\n          logger.warn('[QuizSelector] No approved quizzes found in database!');\r\n          setQuizzes([]);\r\n          return;\r\n        }\r\n        \r\n        const quizzesData = snapshot.docs.map(doc => {\r\n          const data = doc.data();\r\n          return {\r\n            id: doc.id,\r\n            ...data\r\n          };\r\n        });\r\n        \r\n        logger.debug('[QuizSelector] Total quizzes loaded', { count: quizzesData.length });\r\n        \r\n        // Filter quizzes that have questions array with length > 0\r\n        const validQuizzes = quizzesData.filter((quiz: any) => {\r\n          const isValid = Array.isArray(quiz.questions) && quiz.questions.length > 0;\r\n          if (!isValid) {\r\n            logger.debug(`[QuizSelector] Quiz \"${quiz.title}\" (${quiz.id}) INVALID - no questions`);\r\n          }\r\n          return isValid;\r\n        });\r\n        \r\n        logger.success('[QuizSelector] Valid quizzes for multiplayer', { \r\n          count: validQuizzes.length \r\n        });\r\n        \r\n        // Set debug info\r\n        setDebugInfo({\r\n          totalFromDb: quizzesData.length,\r\n          validQuizzes: validQuizzes.length,\r\n          authUser: auth.currentUser?.uid,\r\n          timestamp: new Date().toISOString()\r\n        });\r\n        \r\n        setQuizzes(validQuizzes);\r\n      } catch (error: any) {\r\n        logger.error('[QuizSelector] Error fetching quizzes', {\r\n          name: error.name,\r\n          message: error.message,\r\n          code: error.code\r\n        });\r\n      } finally {\r\n        setLoading(false);\r\n        logger.debug('[QuizSelector] Fetch completed');\r\n      }\r\n    };\r\n\r\n    fetchQuizzes();\r\n  }, []);\r\n\r\n  const categories = [\r\n    { value: 'all', label: 'T·∫•t c·∫£' },\r\n    { value: 'programming', label: 'L·∫≠p tr√¨nh' },\r\n    { value: 'math', label: 'To√°n h·ªçc' },\r\n    { value: 'science', label: 'Khoa h·ªçc' },\r\n    { value: 'history', label: 'L·ªãch s·ª≠' },\r\n    { value: 'language', label: 'Ng√¥n ng·ªØ' },\r\n    { value: 'general', label: 'T·ªïng h·ª£p' },\r\n  ];\r\n\r\n  const filteredQuizzes = quizzes.filter(quiz => {\r\n    const matchesSearch = quiz.title?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                         quiz.description?.toLowerCase().includes(searchTerm.toLowerCase());\r\n    const matchesCategory = selectedCategory === 'all' || quiz.category === selectedCategory;\r\n    return matchesSearch && matchesCategory;\r\n  });\r\n\r\n  const getDifficultyColor = (difficulty: string) => {\r\n    switch (difficulty) {\r\n      case 'easy': return 'text-green-600 bg-green-100';\r\n      case 'medium': return 'text-yellow-600 bg-yellow-100';\r\n      case 'hard': return 'text-red-600 bg-red-100';\r\n      default: return 'text-gray-600 bg-gray-100';\r\n    }\r\n  };\r\n\r\n  const getDifficultyLabel = (difficulty: string) => {\r\n    switch (difficulty) {\r\n      case 'easy': return 'D·ªÖ';\r\n      case 'medium': return 'Trung b√¨nh';\r\n      case 'hard': return 'Kh√≥';\r\n      default: return difficulty;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 z-50 overflow-y-auto\">\r\n      <div className=\"min-h-screen p-4\">\r\n        <div className=\"max-w-6xl mx-auto\">\r\n          {/* Header */}\r\n          <div className=\"bg-white/10 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-6 mb-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <div>\r\n                <h1 className=\"text-3xl font-bold text-white mb-2\">\r\n                  üéÆ Ch·ªçn Quiz ƒë·ªÉ ch∆°i Multiplayer\r\n                </h1>\r\n                <p className=\"text-purple-200\">\r\n                  Ch·ªçn m·ªôt quiz ƒë·ªÉ t·∫°o ph√≤ng ho·∫∑c tham gia ch∆°i v·ªõi b·∫°n b√®\r\n                </p>\r\n              </div>\r\n              <button\r\n                onClick={onBack}\r\n                className=\"px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-colors\"\r\n              >\r\n                ‚Üê Quay l·∫°i\r\n              </button>\r\n            </div>\r\n\r\n            {/* Search and Filter */}\r\n            <div className=\"flex flex-col sm:flex-row gap-4\">\r\n              {/* Search */}\r\n              <div className=\"flex-1 relative\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  placeholder={t('placeholders.searchQuizzes')}\r\n                  className=\"w-full pl-10 pr-4 py-2 bg-white/20 backdrop-blur-sm border border-white/30 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-400\"\r\n                />\r\n              </div>\r\n\r\n              {/* Category Filter */}\r\n              <select\r\n                value={selectedCategory}\r\n                onChange={(e) => setSelectedCategory(e.target.value)}\r\n                className=\"px-4 py-2 bg-white/20 backdrop-blur-sm border border-white/30 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-400\"\r\n              >\r\n                {categories.map(cat => (\r\n                  <option key={cat.value} value={cat.value} className=\"bg-gray-800\">\r\n                    {cat.label}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Quiz Grid */}\r\n          {loading ? (\r\n            <div className=\"flex items-center justify-center py-20\">\r\n              <div className=\"text-center\">\r\n                <Loader2 className=\"w-12 h-12 text-white animate-spin mx-auto mb-4\" />\r\n                <p className=\"text-white\">ƒêang t·∫£i danh s√°ch quiz...</p>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              {/* Debug Info Panel */}\r\n              {debugInfo && (\r\n                <div className=\"bg-yellow-500/20 backdrop-blur-md rounded-lg border border-yellow-500/40 p-4 mb-6\">\r\n                  <h3 className=\"text-white font-bold mb-2\">üîç Debug Information:</h3>\r\n                  <div className=\"text-sm text-yellow-100 space-y-1\">\r\n                    <p>‚úÖ Auth User: {debugInfo.authUser}</p>\r\n                    <p>üìä Total Quizzes in DB: {debugInfo.totalFromDb}</p>\r\n                    <p>‚úÖ Valid Quizzes (with questions): {debugInfo.validQuizzes}</p>\r\n                    <p>‚è∞ Last Fetch: {new Date(debugInfo.timestamp).toLocaleTimeString()}</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              \r\n              {filteredQuizzes.length === 0 ? (\r\n                <div className=\"bg-white/10 backdrop-blur-md rounded-2xl shadow-xl border border-white/20 p-12 text-center\">\r\n                  <BookOpen className=\"w-16 h-16 text-white/50 mx-auto mb-4\" />\r\n                  <h3 className=\"text-xl font-semibold text-white mb-2\">\r\n                    {quizzes.length === 0 ? 'Ch∆∞a c√≥ quiz n√†o' : 'Kh√¥ng t√¨m th·∫•y quiz'}\r\n                  </h3>\r\n                  <p className=\"text-purple-200 mb-4\">\r\n                    {quizzes.length === 0 \r\n                      ? 'Hi·ªán t·∫°i ch∆∞a c√≥ quiz n√†o ƒë∆∞·ª£c duy·ªát. Vui l√≤ng quay l·∫°i sau ho·∫∑c t·∫°o quiz m·ªõi!'\r\n                      : 'Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm'\r\n                    }\r\n                  </p>\r\n                  {quizzes.length === 0 && (\r\n                    <button\r\n                      onClick={onBack}\r\n                      className=\"px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-lg transition-all\"\r\n                    >\r\n                      ‚Üê Quay l·∫°i\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n              {filteredQuizzes.map((quiz) => (\r\n                <div\r\n                  key={quiz.id}\r\n                  onClick={() => onSelectQuiz(quiz)}\r\n                  className=\"group bg-white/10 backdrop-blur-md hover:bg-white/20 border border-white/20 hover:border-white/40 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 cursor-pointer overflow-hidden transform hover:scale-105\"\r\n                >\r\n                  {/* Quiz Image */}\r\n                  {quiz.imageUrl ? (\r\n                    <div className=\"h-40 overflow-hidden\">\r\n                      <img\r\n                        src={quiz.imageUrl}\r\n                        alt={quiz.title}\r\n                        className=\"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300\"\r\n                      />\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"h-40 bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center\">\r\n                      <BookOpen className=\"w-16 h-16 text-white/50\" />\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Quiz Info */}\r\n                  <div className=\"p-6\">\r\n                    <h3 className=\"text-xl font-bold text-white mb-2 line-clamp-2 group-hover:text-purple-200 transition-colors\">\r\n                      {quiz.title}\r\n                    </h3>\r\n                    \r\n                    {quiz.description && (\r\n                      <p className=\"text-purple-200 text-sm mb-4 line-clamp-2\">\r\n                        {quiz.description}\r\n                      </p>\r\n                    )}\r\n\r\n                    {/* Stats */}\r\n                    <div className=\"flex items-center gap-4 text-sm text-purple-200 mb-4\">\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <BookOpen className=\"w-4 h-4\" />\r\n                        <span>{quiz.questions?.length || 0} c√¢u</span>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <Clock className=\"w-4 h-4\" />\r\n                        <span>{quiz.duration || 15} ph√∫t</span>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Tags */}\r\n                    <div className=\"flex items-center gap-2 flex-wrap\">\r\n                      <span className={`px-2 py-1 rounded-lg text-xs font-medium ${getDifficultyColor(quiz.difficulty)}`}>\r\n                        {getDifficultyLabel(quiz.difficulty)}\r\n                      </span>\r\n                      {quiz.category && (\r\n                        <span className=\"px-2 py-1 rounded-lg text-xs font-medium bg-blue-100 text-blue-600\">\r\n                          {categories.find(c => c.value === quiz.category)?.label || quiz.category}\r\n                        </span>\r\n                      )}\r\n                      {quiz.quizType && (\r\n                        <span className=\"px-2 py-1 rounded-lg text-xs font-medium bg-purple-100 text-purple-600\">\r\n                          {quiz.quizType === 'with-materials' ? 'üìö C√≥ t√†i li·ªáu' : '‚ö° Nhanh'}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* Play Button */}\r\n                    <button className=\"mt-4 w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 transform group-hover:scale-105\">\r\n                      üéÆ Ch·ªçn Quiz n√†y\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n\r\n          {/* Results Count */}\r\n          {!loading && filteredQuizzes.length > 0 && (\r\n            <div className=\"mt-6 text-center\">\r\n              <p className=\"text-purple-200\">\r\n                Hi·ªÉn th·ªã {filteredQuizzes.length} quiz\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizSelector;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\RealtimeChat.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\RoomLobby.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"truncate\">Multiplayer Quiz Room</span>","line":183,"column":50,"nodeType":"JSXText","endLine":183,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-blue-50 text-xs sm:text-sm font-medium hidden sm:inline\">Players</span>","line":194,"column":100,"nodeType":"JSXText","endLine":194,"endColumn":107},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-blue-50 text-xs font-medium\">{onlineCount} online</span>","line":197,"column":87,"nodeType":"JSXText","endLine":197,"endColumn":94},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-green-50 text-xs sm:text-sm font-medium hidden sm:inline\">Ready</span>","line":205,"column":101,"nodeType":"JSXText","endLine":205,"endColumn":106},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-white text-xs font-semibold\">‚úì</span>","line":220,"column":74,"nodeType":"JSXText","endLine":220,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Leave</span>","line":246,"column":27,"nodeType":"JSXText","endLine":246,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"whitespace-nowrap\">Not Ready</span>","line":261,"column":61,"nodeType":"JSXText","endLine":261,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"whitespace-nowrap\">I'm Ready!</span>","line":266,"column":61,"nodeType":"JSXText","endLine":266,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-blue-600 text-xs sm:text-sm font-semibold\">Total</div>","line":281,"column":85,"nodeType":"JSXText","endLine":281,"endColumn":90},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-green-600 text-xs sm:text-sm font-semibold\">Ready</div>","line":294,"column":86,"nodeType":"JSXText","endLine":294,"endColumn":91},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-2xl sm:text-3xl font-bold text-purple-600 mb-0.5 sm:mb-1\">{roomData.settings.timeLimit}s</div>","line":306,"column":129,"nodeType":"JSXText","endLine":306,"endColumn":130},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-purple-600 text-xs sm:text-sm font-semibold\">Time</div>","line":307,"column":87,"nodeType":"JSXText","endLine":307,"endColumn":91},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-lg sm:text-xl lg:text-2xl font-bold text-gray-800\">Players</h2>","line":323,"column":86,"nodeType":"JSXText","endLine":323,"endColumn":93},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-400 text-sm mt-1\">Waiting for players to join</p>","line":334,"column":61,"nodeType":"JSXText","endLine":334,"endColumn":88},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs font-bold text-white\">Ready!</span>","line":407,"column":74,"nodeType":"JSXText","endLine":407,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs font-bold text-white\">Waiting</span>","line":412,"column":74,"nodeType":"JSXText","endLine":412,"endColumn":81}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { \n  Users, \n  CheckCircle, \n  Clock,\n  Copy,\n  LogOut,\n  Sparkles,\n  Trophy,\n  Zap,\n  Shield,\n  Star\n} from 'lucide-react';\nimport type { MultiplayerServiceInterface } from '../services/enhancedMultiplayerService';\nimport realtimeService from '../services/realtimeMultiplayerService';\n\ninterface Player {\n  id: string;\n  username: string;\n  isReady: boolean;\n  // Removed isHost - all players are equal\n  isOnline: boolean;\n  joinedAt: Date;\n}\n\ninterface Room {\n  id: string;\n  code: string;\n  name: string;\n  // Removed hostId - all players are equal\n  players: Player[];\n  maxPlayers: number;\n  isPrivate: boolean;\n  status: 'waiting' | 'starting' | 'playing' | 'finished';\n  settings: {\n    timeLimit: number;\n    showLeaderboard: boolean;\n    allowLateJoin: boolean;\n  };\n}\n\ninterface RoomLobbyProps {\n  roomData?: Room;\n  currentUserId: string;\n  onLeaveRoom: () => void;\n  multiplayerService?: MultiplayerServiceInterface;\n}\n\nconst RoomLobby: React.FC<RoomLobbyProps> = ({\n  roomData,\n  currentUserId,\n  onLeaveRoom,\n  multiplayerService\n}) => {\n  const { t } = useTranslation();\n  const [copySuccess, setCopySuccess] = useState(false);\n  const [countdownData, setCountdownData] = useState<{ remaining: number; isActive: boolean } | null>(null);\n\n  const players = useMemo(() => roomData?.players || [], [roomData?.players]);\n  const readyCount = useMemo(() => players.filter(p => p.isReady).length, [players]);\n  const onlineCount = useMemo(() => players.filter(p => p.isOnline).length, [players]);\n  const allReady = useMemo(() => players.length >= 2 && players.every(p => p.isReady), [players]);\n  const currentPlayer = players.find(p => p.id === currentUserId);\n  \n  // Log player updates for debugging\n  useEffect(() => {\n    console.log('üéÆ RoomLobby - Players updated:', {\n      total: players.length,\n      ready: readyCount,\n      allReady,\n      playerList: players.map(p => ({ id: p.id, username: p.username, isReady: p.isReady }))\n    });\n  }, [players, readyCount, allReady]);\n  \n  // Listen to RTDB countdown (synchronized across all clients)\n  useEffect(() => {\n    if (!roomData?.id) return;\n\n    const unsubscribe = realtimeService.listenToCountdown(roomData.id, (data) => {\n      setCountdownData(data);\n      \n      // When countdown reaches 0, start the game\n      if (data && data.remaining <= 0 && data.isActive) {\n        console.log('‚è∞ Countdown finished - starting game');\n        if (multiplayerService) {\n          multiplayerService.startGame(roomData.id).catch(err => {\n            console.error('Failed to start game:', err);\n          });\n        }\n        realtimeService.cancelCountdown(roomData.id);\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  }, [roomData?.id, multiplayerService]);\n\n  // Start countdown when all players ready (only one player triggers it)\n  useEffect(() => {\n    if (allReady && players.length >= 2 && !countdownData) {\n      // Only the first player alphabetically starts countdown to avoid race condition\n      const sortedPlayers = [...players].sort((a, b) => a.id.localeCompare(b.id));\n      const shouldStartCountdown = sortedPlayers[0].id === currentUserId;\n      \n      if (shouldStartCountdown && roomData?.id) {\n        console.log('üöÄ Starting countdown (triggered by first player)');\n        realtimeService.startCountdown(roomData.id, 5);\n        realtimeService.setGameStatus(roomData.id, 'starting');\n      }\n    } else if (!allReady && countdownData?.isActive) {\n      // Cancel countdown if someone unreadies\n      if (roomData?.id) {\n        console.log('‚ùå Cancelling countdown (player unreadied)');\n        realtimeService.cancelCountdown(roomData.id);\n        realtimeService.setGameStatus(roomData.id, 'waiting');\n      }\n    }\n  }, [allReady, players, countdownData, currentUserId, roomData?.id]);\n\n  const handleCopyRoomCode = async () => {\n    if (roomData?.code) {\n      try {\n        await navigator.clipboard.writeText(roomData.code);\n        setCopySuccess(true);\n        setTimeout(() => setCopySuccess(false), 2000);\n      } catch (err) {\n        console.error('Failed to copy room code:', err);\n      }\n    }\n  };\n\n  const handleToggleReady = async () => {\n    if (!multiplayerService || !roomData?.id) return;\n    \n    const newReadyState = !currentPlayer?.isReady;\n    await multiplayerService.updatePlayerStatus(roomData.id, newReadyState);\n  };\n\n  if (!roomData) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">{t('common.loading')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 relative overflow-hidden\">\n      {/* Subtle Background Pattern */}\n      <div className=\"absolute inset-0 opacity-30\" style={{\n        backgroundImage: `url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")`\n      }}></div>\n\n      {/* Floating Geometric Shapes - Hidden on mobile */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none hidden md:block\">\n        <div className=\"absolute top-20 left-20 w-64 h-64 bg-blue-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob\"></div>\n        <div className=\"absolute top-40 right-20 w-64 h-64 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000\"></div>\n        <div className=\"absolute -bottom-20 left-1/2 w-64 h-64 bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000\"></div>\n      </div>\n\n      <div className=\"relative z-10 p-3 sm:p-4 lg:p-6 xl:p-8\">\n        <div className=\"max-w-7xl mx-auto\">\n          {/* Header Card */}\n          <div className=\"bg-white rounded-2xl lg:rounded-3xl shadow-xl border border-gray-100 p-4 sm:p-5 lg:p-8 mb-4 lg:mb-6\">\n            {/* Room Title Section */}\n            <div className=\"flex flex-col lg:flex-row lg:items-start justify-between gap-4 lg:gap-6 mb-4 lg:mb-6\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-2 sm:gap-3 mb-3 lg:mb-4\">\n                  <div className=\"w-10 h-10 sm:w-12 sm:h-12 lg:w-14 lg:h-14 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-xl lg:rounded-2xl flex items-center justify-center shadow-lg\">\n                    <Trophy className=\"w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 text-white\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <h1 className=\"text-xl sm:text-2xl lg:text-3xl xl:text-4xl font-bold text-gray-800 mb-1 truncate\">\n                      {roomData.name}\n                    </h1>\n                    <p className=\"text-gray-500 text-xs sm:text-sm font-medium flex items-center gap-1 sm:gap-2\">\n                      <Sparkles className=\"w-3 h-3 sm:w-4 sm:h-4 text-indigo-500 flex-shrink-0\" />\n                      <span className=\"truncate\">Multiplayer Quiz Room</span>\n                    </p>\n                  </div>\n                </div>\n\n                {/* Status Badges */}\n                <div className=\"flex flex-wrap items-center gap-2 sm:gap-3\">\n                  {/* Player Count */}\n                  <div className=\"bg-gradient-to-r from-blue-500 to-indigo-500 px-3 py-2 sm:px-4 sm:py-2.5 rounded-lg sm:rounded-xl flex items-center gap-1.5 sm:gap-2 shadow-md hover:shadow-lg transition-shadow\">\n                    <Users className=\"w-4 h-4 sm:w-5 sm:h-5 text-white flex-shrink-0\" />\n                    <span className=\"text-white font-bold text-sm sm:text-base\">{players.length}/{roomData.maxPlayers}</span>\n                    <span className=\"text-blue-50 text-xs sm:text-sm font-medium hidden sm:inline\">Players</span>\n                    <div className=\"hidden md:flex items-center gap-1 ml-1 pl-1 border-l border-blue-300\">\n                      <div className=\"w-2 h-2 bg-green-400 rounded-full animate-pulse\"></div>\n                      <span className=\"text-blue-50 text-xs font-medium\">{onlineCount} online</span>\n                    </div>\n                  </div>\n\n                  {/* Ready Count */}\n                  <div className=\"bg-gradient-to-r from-green-500 to-emerald-500 px-3 py-2 sm:px-4 sm:py-2.5 rounded-lg sm:rounded-xl flex items-center gap-1.5 sm:gap-2 shadow-md hover:shadow-lg transition-shadow\">\n                    <CheckCircle className=\"w-4 h-4 sm:w-5 sm:h-5 text-white flex-shrink-0\" />\n                    <span className=\"text-white font-bold text-sm sm:text-base\">{readyCount}</span>\n                    <span className=\"text-green-50 text-xs sm:text-sm font-medium hidden sm:inline\">Ready</span>\n                  </div>\n\n                  {/* Room Code */}\n                  <button\n                    onClick={handleCopyRoomCode}\n                    className={`px-3 py-2 sm:px-4 sm:py-2.5 rounded-lg sm:rounded-xl flex items-center gap-1.5 sm:gap-2 shadow-md hover:shadow-lg transition-all hover:scale-105 ${\n                      copySuccess\n                        ? 'bg-gradient-to-r from-green-500 to-emerald-500'\n                        : 'bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600'\n                    }`}\n                  >\n                    <Copy className=\"w-4 h-4 sm:w-5 sm:h-5 text-white flex-shrink-0\" />\n                    <span className=\"text-white font-mono font-bold text-sm sm:text-base lg:text-lg\">{roomData.code}</span>\n                    {copySuccess && (\n                      <span className=\"text-white text-xs font-semibold\">‚úì</span>\n                    )}\n                  </button>\n                </div>\n              </div>\n              \n              {/* Action Buttons */}\n              <div className=\"flex flex-col gap-2 sm:gap-3 w-full lg:w-auto\">\n                {/* Countdown Timer - Synced via RTDB */}\n                {countdownData && countdownData.isActive && countdownData.remaining > 0 && (\n                  <div className=\"bg-gradient-to-r from-orange-500 to-red-500 px-4 py-3 sm:px-6 sm:py-4 rounded-xl sm:rounded-2xl flex items-center justify-center gap-2 sm:gap-3 shadow-lg animate-pulse\">\n                    <Clock className=\"w-5 h-5 sm:w-6 sm:h-6 text-white flex-shrink-0\" />\n                    <div className=\"text-center\">\n                      <div className=\"text-2xl sm:text-3xl font-black text-white\">{countdownData.remaining}</div>\n                      <div className=\"text-xs text-orange-50 font-semibold\">{t('multiplayer.starting')}</div>\n                    </div>\n                  </div>\n                )}\n                \n                <div className=\"flex gap-2 sm:gap-3\">\n                  {/* Leave Button */}\n                  <button\n                    onClick={onLeaveRoom}\n                    className=\"flex-1 lg:flex-none px-4 py-2.5 sm:px-5 sm:py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-semibold transition-all hover:scale-105 flex items-center justify-center gap-2 shadow-md text-sm sm:text-base\"\n                  >\n                    <LogOut className=\"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0\" />\n                    <span>Leave</span>\n                  </button>\n                  \n                  {/* Ready Button */}\n                  <button\n                    onClick={handleToggleReady}\n                    className={`flex-1 lg:flex-none px-5 py-2.5 sm:px-8 sm:py-3 rounded-xl font-bold transition-all hover:scale-105 shadow-lg flex items-center justify-center gap-2 text-sm sm:text-base ${\n                      currentPlayer?.isReady\n                        ? 'bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white'\n                        : 'bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white'\n                    }`}\n                  >\n                    {currentPlayer?.isReady ? (\n                      <>\n                        <Shield className=\"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0\" />\n                        <span className=\"whitespace-nowrap\">Not Ready</span>\n                      </>\n                    ) : (\n                      <>\n                        <Zap className=\"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0\" />\n                        <span className=\"whitespace-nowrap\">I'm Ready!</span>\n                      </>\n                    )}\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            {/* Stats Cards */}\n            <div className=\"grid grid-cols-3 sm:grid-cols-3 gap-2 sm:gap-3 lg:gap-4\">\n              {/* Total Players */}\n              <div className=\"group bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl sm:rounded-2xl p-3 sm:p-4 lg:p-5 border border-blue-100 hover:border-blue-200 transition-all hover:shadow-md\">\n                <div className=\"flex flex-col sm:flex-row items-center sm:justify-between gap-2\">\n                  <div className=\"text-center sm:text-left\">\n                    <div className=\"text-2xl sm:text-3xl font-bold text-blue-600 mb-0.5 sm:mb-1\">{players.length}</div>\n                    <div className=\"text-blue-600 text-xs sm:text-sm font-semibold\">Total</div>\n                  </div>\n                  <div className=\"w-10 h-10 sm:w-12 sm:h-12 lg:w-14 lg:h-14 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-xl sm:rounded-2xl flex items-center justify-center shadow-md group-hover:scale-110 transition-transform\">\n                    <Users className=\"w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7 text-white\" />\n                  </div>\n                </div>\n              </div>\n\n              {/* Ready Players */}\n              <div className=\"group bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl sm:rounded-2xl p-3 sm:p-4 lg:p-5 border border-green-100 hover:border-green-200 transition-all hover:shadow-md\">\n                <div className=\"flex flex-col sm:flex-row items-center sm:justify-between gap-2\">\n                  <div className=\"text-center sm:text-left\">\n                    <div className=\"text-2xl sm:text-3xl font-bold text-green-600 mb-0.5 sm:mb-1\">{readyCount}</div>\n                    <div className=\"text-green-600 text-xs sm:text-sm font-semibold\">Ready</div>\n                  </div>\n                  <div className=\"w-10 h-10 sm:w-12 sm:h-12 lg:w-14 lg:h-14 bg-gradient-to-br from-green-500 to-emerald-500 rounded-xl sm:rounded-2xl flex items-center justify-center shadow-md group-hover:scale-110 transition-transform\">\n                    <CheckCircle className=\"w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7 text-white\" />\n                  </div>\n                </div>\n              </div>\n\n              {/* Time Limit */}\n              <div className=\"group bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl sm:rounded-2xl p-3 sm:p-4 lg:p-5 border border-purple-100 hover:border-purple-200 transition-all hover:shadow-md\">\n                <div className=\"flex flex-col sm:flex-row items-center sm:justify-between gap-2\">\n                  <div className=\"text-center sm:text-left\">\n                    <div className=\"text-2xl sm:text-3xl font-bold text-purple-600 mb-0.5 sm:mb-1\">{roomData.settings.timeLimit}s</div>\n                    <div className=\"text-purple-600 text-xs sm:text-sm font-semibold\">Time</div>\n                  </div>\n                  <div className=\"w-10 h-10 sm:w-12 sm:h-12 lg:w-14 lg:h-14 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl sm:rounded-2xl flex items-center justify-center shadow-md group-hover:scale-110 transition-transform\">\n                    <Clock className=\"w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7 text-white\" />\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Players Grid */}\n          <div className=\"bg-white rounded-2xl lg:rounded-3xl shadow-xl border border-gray-100 p-4 sm:p-5 lg:p-8\">\n            <div className=\"flex items-center gap-2 sm:gap-3 mb-4 sm:mb-6\">\n              <div className=\"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-lg sm:rounded-xl flex items-center justify-center flex-shrink-0\">\n                <Users className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\" />\n              </div>\n              <h2 className=\"text-lg sm:text-xl lg:text-2xl font-bold text-gray-800\">Players</h2>\n              <div className=\"ml-auto bg-gradient-to-r from-blue-100 to-indigo-100 px-3 py-1 sm:px-4 sm:py-1.5 rounded-full\">\n                <span className=\"text-blue-700 font-bold text-xs sm:text-sm\">{players.length}/{roomData.maxPlayers}</span>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4\">\n              {players.length === 0 ? (\n                <div className=\"col-span-full text-center py-12\">\n                  <div className=\"text-gray-400 text-lg mb-2\">üë•</div>\n                  <p className=\"text-gray-500 font-medium\">No players yet...</p>\n                  <p className=\"text-gray-400 text-sm mt-1\">Waiting for players to join</p>\n                </div>\n              ) : (\n                players.map((player, index) => {\n                const isCurrentUser = player.id === currentUserId;\n                \n                return (\n                  <div\n                    key={player.id}\n                    className={`group relative bg-gradient-to-br rounded-xl sm:rounded-2xl p-3 sm:p-4 lg:p-5 border-2 transition-all hover:scale-105 hover:shadow-xl ${\n                      isCurrentUser\n                        ? 'from-blue-50 to-indigo-50 border-blue-200 shadow-blue-100 shadow-lg'\n                        : player.isReady\n                        ? 'from-green-50 to-emerald-50 border-green-200 shadow-green-100 shadow-md'\n                        : 'from-gray-50 to-slate-50 border-gray-200'\n                    }`}\n                    style={{\n                      animationDelay: `${index * 100}ms`\n                    }}\n                  >\n                    {/* \"You\" Badge */}\n                    {isCurrentUser && (\n                      <div className=\"absolute -top-1.5 -right-1.5 sm:-top-2 sm:-right-2 z-10\">\n                        <div className=\"bg-gradient-to-r from-yellow-400 to-orange-400 px-2 py-0.5 sm:px-3 sm:py-1 rounded-full flex items-center gap-1 sm:gap-1.5 shadow-lg animate-pulse\">\n                          <Star className=\"w-3 h-3 sm:w-3.5 sm:h-3.5 text-white fill-white flex-shrink-0\" />\n                          <span className=\"text-xs font-black text-white\">YOU</span>\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Player Content */}\n                    <div className=\"flex items-center gap-3 sm:gap-4 mb-2 sm:mb-3\">\n                      {/* Avatar */}\n                      <div className=\"relative flex-shrink-0\">\n                        <div className={`w-12 h-12 sm:w-14 sm:h-14 lg:w-16 lg:h-16 rounded-xl sm:rounded-2xl flex items-center justify-center text-lg sm:text-xl lg:text-2xl font-bold shadow-lg ${\n                          isCurrentUser\n                            ? 'bg-gradient-to-br from-blue-500 to-indigo-500 text-white'\n                            : player.isReady\n                            ? 'bg-gradient-to-br from-green-500 to-emerald-500 text-white'\n                            : 'bg-gradient-to-br from-gray-400 to-slate-400 text-white'\n                        }`}>\n                          {player.username.charAt(0).toUpperCase()}\n                        </div>\n                        \n                        {/* Online Indicator */}\n                        {player.isOnline && (\n                          <div className=\"absolute -bottom-0.5 -right-0.5 sm:-bottom-1 sm:-right-1 w-4 h-4 sm:w-5 sm:h-5 bg-green-500 rounded-full border-2 sm:border-3 border-white shadow-md\">\n                            <div className=\"w-full h-full bg-green-400 rounded-full animate-ping opacity-75\"></div>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Player Info */}\n                      <div className=\"flex-1 min-w-0\">\n                        <h3 className={`font-bold text-sm sm:text-base lg:text-lg truncate mb-0.5 sm:mb-1 ${\n                          isCurrentUser ? 'text-blue-700' : player.isReady ? 'text-green-700' : 'text-gray-700'\n                        }`}>\n                          {player.username}\n                        </h3>\n                        <div className=\"flex items-center gap-1.5 sm:gap-2 text-xs sm:text-sm text-gray-500\">\n                          <div className={`w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full flex-shrink-0 ${\n                            player.isOnline ? 'bg-green-500' : 'bg-gray-400'\n                          }`}></div>\n                          <span className=\"truncate\">{player.isOnline ? 'Online' : 'Offline'}</span>\n                        </div>\n                      </div>\n                    </div>\n                    \n                    {/* Status Badge */}\n                    <div className=\"flex items-center gap-2\">\n                      {player.isReady ? (\n                        <div className=\"flex-1 bg-gradient-to-r from-green-500 to-emerald-500 px-2 py-1.5 sm:px-3 sm:py-2 rounded-lg flex items-center justify-center gap-1 sm:gap-1.5 shadow-sm\">\n                          <CheckCircle className=\"w-3.5 h-3.5 sm:w-4 sm:h-4 text-white animate-bounce flex-shrink-0\" />\n                          <span className=\"text-xs font-bold text-white\">Ready!</span>\n                        </div>\n                      ) : (\n                        <div className=\"flex-1 bg-gradient-to-r from-gray-400 to-slate-400 px-2 py-1.5 sm:px-3 sm:py-2 rounded-lg flex items-center justify-center gap-1 sm:gap-1.5 shadow-sm\">\n                          <Clock className=\"w-3.5 h-3.5 sm:w-4 sm:h-4 text-white flex-shrink-0\" />\n                          <span className=\"text-xs font-bold text-white\">Waiting</span>\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Decorative Element */}\n                    {player.isReady && (\n                      <div className=\"absolute bottom-1.5 right-1.5 sm:bottom-2 sm:right-2 opacity-10\">\n                        <Trophy className=\"w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-green-600\" />\n                      </div>\n                    )}\n                  </div>\n                );\n              })\n              )}\n\n              {/* Empty Slots */}\n              {Array.from({ length: Math.max(0, roomData.maxPlayers - players.length) }).map((_, index) => (\n                <div\n                  key={`empty-${index}`}\n                  className=\"bg-gradient-to-br from-gray-50 to-slate-50 rounded-xl sm:rounded-2xl p-3 sm:p-4 lg:p-5 border-2 border-dashed border-gray-200 hover:border-gray-300 transition-all\"\n                >\n                  <div className=\"flex items-center gap-3 sm:gap-4 opacity-40 mb-2 sm:mb-3\">\n                    <div className=\"w-12 h-12 sm:w-14 sm:h-14 lg:w-16 lg:h-16 bg-gray-200 rounded-xl sm:rounded-2xl flex items-center justify-center flex-shrink-0\">\n                      <Users className=\"w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-gray-400\" />\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"h-3 sm:h-4 bg-gray-200 rounded-lg mb-1.5 sm:mb-2 w-3/4\"></div>\n                      <div className=\"h-2 sm:h-3 bg-gray-200 rounded-lg w-1/2\"></div>\n                    </div>\n                  </div>\n                  <div className=\"text-center text-gray-400 text-xs sm:text-sm font-medium\">\n                    Waiting for player...\n                    <span className=\"inline-flex ml-1\">\n                      <span className=\"animate-bounce\" style={{ animationDelay: '0ms' }}>.</span>\n                      <span className=\"animate-bounce\" style={{ animationDelay: '150ms' }}>.</span>\n                      <span className=\"animate-bounce\" style={{ animationDelay: '300ms' }}>.</span>\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default RoomLobby;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\pages\\MultiplayerLobby.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2614,2617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2614,2617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium\">Quay l·∫°i</span>","line":136,"column":47,"nodeType":"JSXText","endLine":136,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-4xl font-bold text-gray-900 mb-2 flex items-center gap-3\">\r\n                <Gamepad2 className=\"w-10 h-10 text-purple-600\" />\r\n                Multiplayer - Ch∆°i v·ªõi b·∫°n b√®\r\n              </h1>","line":139,"column":67,"nodeType":"JSXText","endLine":141,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600 text-lg\">Ch·ªçn quiz v√† t·∫°o ph√≤ng ƒë·ªÉ c·∫°nh tranh tr·ª±c ti·∫øp!</p>","line":142,"column":52,"nodeType":"JSXText","endLine":142,"endColumn":99},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-bold text-red-900 mb-1\">L·ªói t·∫£i d·ªØ li·ªáu</h3>","line":153,"column":61,"nodeType":"JSXText","endLine":153,"endColumn":76},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                  onClick={fetchQuizzes}\r\n                  className=\"px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors\"\r\n                >\r\n                  Th·ª≠ l·∫°i\r\n                </button>","line":158,"column":18,"nodeType":"JSXText","endLine":160,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-bold text-gray-900 mb-2 text-lg\">Real-time Competition</h3>","line":172,"column":66,"nodeType":"JSXText","endLine":172,"endColumn":87},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-600 leading-relaxed\">C·∫°nh tranh tr·ª±c ti·∫øp v·ªõi b·∫°n b√® v√† xem k·∫øt qu·∫£ ngay l·∫≠p t·ª©c</p>","line":173,"column":66,"nodeType":"JSXText","endLine":173,"endColumn":125},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-bold text-gray-900 mb-2 text-lg\">Private Rooms</h3>","line":180,"column":66,"nodeType":"JSXText","endLine":180,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-600 leading-relaxed\">T·∫°o ph√≤ng ri√™ng v·ªõi room code ƒë·ªÉ ch∆°i v·ªõi ng∆∞·ªùi b·∫°n mu·ªën</p>","line":181,"column":66,"nodeType":"JSXText","endLine":181,"endColumn":122},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-bold text-gray-900 mb-2 text-lg\">Live Leaderboard</h3>","line":188,"column":66,"nodeType":"JSXText","endLine":188,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-600 leading-relaxed\">Theo d√µi b·∫£ng x·∫øp h·∫°ng tr·ª±c ti·∫øp trong khi ch∆°i</p>","line":189,"column":66,"nodeType":"JSXText","endLine":189,"endColumn":113},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"all\">üè∑Ô∏è T·∫•t c·∫£ danh m·ª•c</option>","line":228,"column":35,"nodeType":"JSXText","endLine":228,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"all\">üìä T·∫•t c·∫£ ƒë·ªô kh√≥</option>","line":238,"column":35,"nodeType":"JSXText","endLine":238,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm text-gray-600\">Hi·ªÉn th·ªã:</span>","line":250,"column":57,"nodeType":"JSXText","endLine":250,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-4 text-sm text-gray-600\">\r\n            T√¨m th·∫•y <span className=\"font-semibold text-purple-600\">{filteredQuizzes.length}</span> quiz\r\n            {searchTerm && <span> cho \"{searchTerm}\"</span>}\r\n            {categoryFilter !== 'all' && <span> trong danh m·ª•c \"{categoryFilter}\"</span>}\r\n            {difficultyFilter !== 'all' && <span> v·ªõi ƒë·ªô kh√≥ \"{difficultyFilter}\"</span>}\r\n          </div>","line":276,"column":55,"nodeType":"JSXText","endLine":277,"endColumn":22},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-4 text-sm text-gray-600\">\r\n            T√¨m th·∫•y <span className=\"font-semibold text-purple-600\">{filteredQuizzes.length}</span> quiz\r\n            {searchTerm && <span> cho \"{searchTerm}\"</span>}\r\n            {categoryFilter !== 'all' && <span> trong danh m·ª•c \"{categoryFilter}\"</span>}\r\n            {difficultyFilter !== 'all' && <span> v·ªõi ƒë·ªô kh√≥ \"{difficultyFilter}\"</span>}\r\n          </div>","line":277,"column":101,"nodeType":"JSXText","endLine":278,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span> cho \"{searchTerm}\"</span>","line":278,"column":34,"nodeType":"JSXText","endLine":278,"endColumn":40},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span> trong danh m·ª•c \"{categoryFilter}\"</span>","line":279,"column":48,"nodeType":"JSXText","endLine":279,"endColumn":65},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span> v·ªõi ƒë·ªô kh√≥ \"{difficultyFilter}\"</span>","line":280,"column":50,"nodeType":"JSXText","endLine":280,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-xl font-medium text-gray-900 mb-2\">Kh√¥ng t√¨m th·∫•y quiz</h3>","line":295,"column":72,"nodeType":"JSXText","endLine":295,"endColumn":91},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600 mb-6\">Kh√¥ng c√≥ quiz n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc hi·ªán t·∫°i.</p>","line":296,"column":51,"nodeType":"JSXText","endLine":296,"endColumn":97},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button \r\n                  onClick={() => {\r\n                    setSearchTerm('');\r\n                    setCategoryFilter('all');\r\n                    setDifficultyFilter('all');\r\n                  }}\r\n                  className=\"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors\"\r\n                >\r\n                  üîÑ X√≥a b·ªô l·ªçc\r\n                </button>","line":304,"column":18,"nodeType":"JSXText","endLine":306,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-600\">\r\n                    {selectedQuiz.questions.length} c√¢u h·ªèi ‚Ä¢ {selectedQuiz.difficulty === 'easy' ? 'D·ªÖ' : selectedQuiz.difficulty === 'medium' ? 'Trung b√¨nh' : 'Kh√≥'}\r\n                  </div>","line":350,"column":52,"nodeType":"JSXText","endLine":350,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                onClick={handleStartMultiplayer}\r\n                className=\"flex items-center gap-2 bg-gradient-to-r from-purple-600 via-pink-600 to-indigo-600 text-white px-8 py-3 rounded-xl hover:shadow-xl hover:scale-105 transition-all duration-300 font-bold\"\r\n              >\r\n                <Gamepad2 className=\"w-5 h-5\" />\r\n                B·∫Øt ƒë·∫ßu Multiplayer\r\n              </button>","line":358,"column":49,"nodeType":"JSXText","endLine":360,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":25,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useSelector } from 'react-redux';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { RootState } from '../../../lib/store';\r\nimport { collection, getDocs, query, where } from 'firebase/firestore';\r\nimport { db, auth } from '../../../lib/firebase/config';\r\nimport QuizCard, { QuizCardSkeleton } from '../../quiz/components/QuizCard';\r\nimport { Quiz } from '../../quiz/types';\r\nimport { \r\n  Gamepad2, \r\n  Users, \r\n  Zap, \r\n  Trophy, \r\n  ArrowLeft, \r\n  AlertCircle\r\n} from 'lucide-react';\r\n\r\nconst MultiplayerLobby: React.FC = () => {\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const [quizzes, setQuizzes] = useState<Quiz[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedQuiz, setSelectedQuiz] = useState<Quiz | null>(null);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [difficultyFilter, setDifficultyFilter] = useState<string>('all');\r\n  const [categoryFilter, setCategoryFilter] = useState<string>('all');\r\n  const [fetchError, setFetchError] = useState<string | null>(null);\r\n  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');\r\n\r\n  const fetchQuizzes = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setFetchError(null);\r\n      \r\n      // Wait for auth to be ready if needed\r\n      if (!auth.currentUser) {\r\n        await new Promise<void>((resolve) => {\r\n          const unsubscribe = auth.onAuthStateChanged((authUser) => {\r\n            if (authUser) {\r\n              unsubscribe();\r\n              resolve();\r\n            }\r\n          });\r\n          // Timeout after 5 seconds\r\n          setTimeout(() => {\r\n            unsubscribe();\r\n            resolve();\r\n          }, 5000);\r\n        });\r\n      }\r\n      \r\n      // Fetch ONLY APPROVED quizzes with status filter\r\n      const allQuizzesRef = query(\r\n        collection(db, 'quizzes'),\r\n        where('status', '==', 'approved')\r\n      );\r\n      const allSnapshot = await getDocs(allQuizzesRef);\r\n      \r\n      const allQuizData = allSnapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      } as Quiz));\r\n      \r\n      // Filter quizzes - Ch·ªâ c·∫ßn 1 c√¢u h·ªèi tr·ªü l√™n (ƒë√£ approved t·ª´ query)\r\n      const validQuizzes = allQuizData.filter(quiz => {\r\n        const hasQuestions = quiz.questions && quiz.questions.length >= 1;\r\n        return hasQuestions;\r\n      });\r\n      \r\n      setQuizzes(validQuizzes);\r\n    } catch (error: any) {\r\n      console.error('Error fetching quizzes:', error);\r\n      setFetchError(error.message || 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch quiz');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!user) {\r\n      navigate('/login');\r\n      return;\r\n    }\r\n    fetchQuizzes();\r\n  }, [user, navigate, fetchQuizzes]);\r\n\r\n  const filteredQuizzes = quizzes.filter(quiz => {\r\n    const matchesSearch = quiz.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                         quiz.description.toLowerCase().includes(searchTerm.toLowerCase());\r\n    const matchesDifficulty = difficultyFilter === 'all' || quiz.difficulty === difficultyFilter;\r\n    const matchesCategory = categoryFilter === 'all' || quiz.category === categoryFilter;\r\n    \r\n    return matchesSearch && matchesDifficulty && matchesCategory;\r\n  });\r\n\r\n  const handleQuizSelect = (quiz: Quiz) => {\r\n    setSelectedQuiz(quiz);\r\n    // T·ª± ƒë·ªông scroll ƒë·∫øn n√∫t b·∫Øt ƒë·∫ßu\r\n    setTimeout(() => {\r\n      const startButton = document.getElementById('multiplayer-start-button');\r\n      startButton?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n    }, 100);\r\n  };\r\n\r\n  const handleStartMultiplayer = () => {\r\n    if (selectedQuiz) {\r\n      navigate('/multiplayer/game', { state: { selectedQuiz } });\r\n    }\r\n  };\r\n\r\n  const categories = Array.from(new Set(quizzes.map(q => q.category).filter(Boolean)));\r\n  const difficulties = Array.from(new Set(quizzes.map(q => q.difficulty)));\r\n\r\n  // Stats for potential future use\r\n  // const stats = {\r\n  //   total: filteredQuizzes.length,\r\n  //   easy: filteredQuizzes.filter(q => q.difficulty === 'easy').length,\r\n  //   medium: filteredQuizzes.filter(q => q.difficulty === 'medium').length,\r\n  //   hard: filteredQuizzes.filter(q => q.difficulty === 'hard').length,\r\n  // };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 py-8\">\r\n      <div className=\"max-w-7xl mx-auto px-4\">\r\n        {/* Header Section - Gi·ªëng QuizList */}\r\n        <div className=\"mb-8\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <button\r\n                onClick={() => navigate('/quizzes')}\r\n                className=\"group flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4 transition-all duration-300 hover:gap-3\"\r\n              >\r\n                <ArrowLeft className=\"w-5 h-5 group-hover:animate-bounce-x\" />\r\n                <span className=\"font-medium\">Quay l·∫°i</span>\r\n              </button>\r\n              <h1 className=\"text-4xl font-bold text-gray-900 mb-2 flex items-center gap-3\">\r\n                <Gamepad2 className=\"w-10 h-10 text-purple-600\" />\r\n                Multiplayer - Ch∆°i v·ªõi b·∫°n b√®\r\n              </h1>\r\n              <p className=\"text-gray-600 text-lg\">Ch·ªçn quiz v√† t·∫°o ph√≤ng ƒë·ªÉ c·∫°nh tranh tr·ª±c ti·∫øp!</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Error Display */}\r\n        {fetchError && (\r\n          <div className=\"bg-red-50 border-l-4 border-red-500 rounded-xl p-6 mb-6 shadow-lg animate-shake\">\r\n            <div className=\"flex items-start gap-4\">\r\n              <AlertCircle className=\"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5\" />\r\n              <div className=\"flex-1\">\r\n                <h3 className=\"font-bold text-red-900 mb-1\">L·ªói t·∫£i d·ªØ li·ªáu</h3>\r\n                <p className=\"text-sm text-red-700 mb-3\">{fetchError}</p>\r\n                <button\r\n                  onClick={fetchQuizzes}\r\n                  className=\"px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors\"\r\n                >\r\n                  Th·ª≠ l·∫°i\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Features Banner - Gi·ªëng QuizList */}\r\n        <div className=\"grid md:grid-cols-3 gap-6 mb-8\">\r\n          <div className=\"group bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:border-purple-300 hover:shadow-md transition-all\">\r\n            <div className=\"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mb-4 group-hover:rotate-12 transition-transform\">\r\n              <Zap className=\"w-6 h-6 text-white\" />\r\n            </div>\r\n            <h3 className=\"font-bold text-gray-900 mb-2 text-lg\">Real-time Competition</h3>\r\n            <p className=\"text-sm text-gray-600 leading-relaxed\">C·∫°nh tranh tr·ª±c ti·∫øp v·ªõi b·∫°n b√® v√† xem k·∫øt qu·∫£ ngay l·∫≠p t·ª©c</p>\r\n          </div>\r\n          \r\n          <div className=\"group bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:border-pink-300 hover:shadow-md transition-all\">\r\n            <div className=\"w-12 h-12 bg-gradient-to-br from-pink-500 to-rose-500 rounded-xl flex items-center justify-center mb-4 group-hover:rotate-12 transition-transform\">\r\n              <Users className=\"w-6 h-6 text-white\" />\r\n            </div>\r\n            <h3 className=\"font-bold text-gray-900 mb-2 text-lg\">Private Rooms</h3>\r\n            <p className=\"text-sm text-gray-600 leading-relaxed\">T·∫°o ph√≤ng ri√™ng v·ªõi room code ƒë·ªÉ ch∆°i v·ªõi ng∆∞·ªùi b·∫°n mu·ªën</p>\r\n          </div>\r\n          \r\n          <div className=\"group bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:border-indigo-300 hover:shadow-md transition-all\">\r\n            <div className=\"w-12 h-12 bg-gradient-to-br from-indigo-500 to-blue-500 rounded-xl flex items-center justify-center mb-4 group-hover:rotate-12 transition-transform\">\r\n              <Trophy className=\"w-6 h-6 text-white\" />\r\n            </div>\r\n            <h3 className=\"font-bold text-gray-900 mb-2 text-lg\">Live Leaderboard</h3>\r\n            <p className=\"text-sm text-gray-600 leading-relaxed\">Theo d√µi b·∫£ng x·∫øp h·∫°ng tr·ª±c ti·∫øp trong khi ch∆°i</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Enhanced Filter Section - Gi·ªëng QuizList */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4\">\r\n            {/* Enhanced Search */}\r\n            <div className=\"lg:col-span-2 relative\">\r\n              <div className=\"relative\">\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder={t('placeholders.searchQuiz')}\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  className=\"w-full border border-gray-300 rounded-lg p-3 pl-10 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500\"\r\n                />\r\n                <svg className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n                </svg>\r\n                {searchTerm && (\r\n                  <button\r\n                    onClick={() => setSearchTerm('')}\r\n                    className=\"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 hover:text-gray-600\"\r\n                  >\r\n                    <svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                    </svg>\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Category Filter */}\r\n            <select \r\n              className=\"border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500\" \r\n              value={categoryFilter} \r\n              onChange={e => setCategoryFilter(e.target.value)}\r\n            >\r\n              <option value=\"all\">üè∑Ô∏è T·∫•t c·∫£ danh m·ª•c</option>\r\n              {categories.map(c => <option key={c} value={c}>{c}</option>)}\r\n            </select>\r\n            \r\n            {/* Difficulty Filter */}\r\n            <select \r\n              className=\"border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500\" \r\n              value={difficultyFilter} \r\n              onChange={e => setDifficultyFilter(e.target.value)}\r\n            >\r\n              <option value=\"all\">üìä T·∫•t c·∫£ ƒë·ªô kh√≥</option>\r\n              {difficulties.map(d => <option key={d} value={d}>\r\n                {d === 'easy' ? 'üòä D·ªÖ' : d === 'medium' ? 'üòê Trung b√¨nh' : 'üò§ Kh√≥'}\r\n              </option>)}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Advanced Controls */}\r\n          <div className=\"flex flex-wrap items-center justify-between gap-4 pt-4 border-t border-gray-100\">\r\n            <div className=\"flex items-center gap-4\">\r\n              {/* View Mode Toggle */}\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className=\"text-sm text-gray-600\">Hi·ªÉn th·ªã:</span>\r\n                <div className=\"flex border border-gray-300 rounded-lg overflow-hidden\">\r\n                  <button\r\n                    onClick={() => setViewMode('grid')}\r\n                    className={`p-2 ${viewMode === 'grid' ? 'bg-purple-500 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'}`}\r\n                    title=\"L∆∞·ªõi\"\r\n                  >\r\n                    <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                      <path d=\"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\" />\r\n                    </svg>\r\n                  </button>\r\n                  <button\r\n                    onClick={() => setViewMode('list')}\r\n                    className={`p-2 ${viewMode === 'list' ? 'bg-purple-500 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'}`}\r\n                    title=\"Danh s√°ch\"\r\n                  >\r\n                    <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                      <path fillRule=\"evenodd\" d=\"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Results Summary */}\r\n          <div className=\"mt-4 text-sm text-gray-600\">\r\n            T√¨m th·∫•y <span className=\"font-semibold text-purple-600\">{filteredQuizzes.length}</span> quiz\r\n            {searchTerm && <span> cho \"{searchTerm}\"</span>}\r\n            {categoryFilter !== 'all' && <span> trong danh m·ª•c \"{categoryFilter}\"</span>}\r\n            {difficultyFilter !== 'all' && <span> v·ªõi ƒë·ªô kh√≥ \"{difficultyFilter}\"</span>}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Quiz Grid/List - Gi·ªëng QuizList s·ª≠ d·ª•ng QuizCard */}\r\n        <div className={viewMode === 'grid' \r\n          ? \"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\" \r\n          : \"space-y-4\"\r\n        }>\r\n          {loading ? (\r\n            Array.from({length: 8}).map((_,i) => <QuizCardSkeleton key={i} />)\r\n          ) : filteredQuizzes.length === 0 ? (\r\n            <div className=\"col-span-full text-center\">\r\n              <div className=\"bg-gray-50 border border-gray-200 rounded-xl p-12\">\r\n                <Gamepad2 className='w-16 h-16 mx-auto text-gray-300 mb-4' />\r\n                <h3 className=\"text-xl font-medium text-gray-900 mb-2\">Kh√¥ng t√¨m th·∫•y quiz</h3>\r\n                <p className=\"text-gray-600 mb-6\">Kh√¥ng c√≥ quiz n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc hi·ªán t·∫°i.</p>\r\n                <button \r\n                  onClick={() => {\r\n                    setSearchTerm('');\r\n                    setCategoryFilter('all');\r\n                    setDifficultyFilter('all');\r\n                  }}\r\n                  className=\"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors\"\r\n                >\r\n                  üîÑ X√≥a b·ªô l·ªçc\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            filteredQuizzes.map(quiz => (\r\n              <div \r\n                key={quiz.id}\r\n                onClick={() => handleQuizSelect(quiz)}\r\n                className={`cursor-pointer transition-all ${\r\n                  selectedQuiz?.id === quiz.id \r\n                    ? 'ring-4 ring-purple-500 ring-offset-2' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <QuizCard \r\n                  quiz={quiz} \r\n                  viewMode={viewMode}\r\n                  onStartQuiz={() => handleQuizSelect(quiz)}\r\n                />\r\n                {selectedQuiz?.id === quiz.id && (\r\n                  <div className=\"absolute top-4 left-4 z-30\">\r\n                    <div className=\"w-8 h-8 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center animate-bounce shadow-lg\">\r\n                      <svg className=\"w-5 h-5 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                        <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\r\n                      </svg>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n\r\n        {/* Start Button - Fixed at bottom khi ƒë√£ ch·ªçn quiz */}\r\n        {selectedQuiz && (\r\n          <div id=\"multiplayer-start-button\" className=\"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg p-4 z-50 animate-slide-up\">\r\n            <div className=\"max-w-7xl mx-auto flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className=\"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center\">\r\n                  <Gamepad2 className=\"w-6 h-6 text-purple-600\" />\r\n                </div>\r\n                <div>\r\n                  <div className=\"font-bold text-gray-900\">{selectedQuiz.title}</div>\r\n                  <div className=\"text-sm text-gray-600\">\r\n                    {selectedQuiz.questions.length} c√¢u h·ªèi ‚Ä¢ {selectedQuiz.difficulty === 'easy' ? 'D·ªÖ' : selectedQuiz.difficulty === 'medium' ? 'Trung b√¨nh' : 'Kh√≥'}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={handleStartMultiplayer}\r\n                className=\"flex items-center gap-2 bg-gradient-to-r from-purple-600 via-pink-600 to-indigo-600 text-white px-8 py-3 rounded-xl hover:shadow-xl hover:scale-105 transition-all duration-300 font-bold\"\r\n              >\r\n                <Gamepad2 className=\"w-5 h-5\" />\r\n                B·∫Øt ƒë·∫ßu Multiplayer\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MultiplayerLobby;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\pages\\MultiplayerPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[378,381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[378,381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[710,713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[710,713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useSelector } from 'react-redux';\nimport MultiplayerManager from '../components/MultiplayerManager';\nimport MultiplayerErrorBoundary from '../components/MultiplayerErrorBoundary';\nimport { logger } from '../utils/logger';\n\ninterface LocationState {\n  selectedQuiz?: any;\n}\n\nconst MultiplayerPage: React.FC = () => {\n  const location = useLocation();\n  const navigate = useNavigate();\n  const state = location.state as LocationState;\n  const searchParams = new URLSearchParams(location.search);\n  const initialRoomId = searchParams.get('roomId') || undefined;\n  const { user } = useSelector((state: any) => state.auth);\n  \n  // Use useEffect for navigation to avoid React warnings\n  useEffect(() => {\n    if (!user) {\n      navigate('/login');\n      return;\n    }\n    \n    // Quiz is now optional - can be selected inside multiplayer\n    const selectedQuiz = state?.selectedQuiz;\n    \n    if (selectedQuiz) {\n      // Validate quiz if provided\n      if (!selectedQuiz.questions || selectedQuiz.questions.length === 0) {\n        logger.error('Selected quiz has no questions!');\n        navigate('/quizzes', { \n          state: { \n            error: 'Selected quiz has no questions. Please choose a different quiz.' \n          } \n        });\n        return;\n      }\n      \n      logger.debug('MultiplayerPage Real Quiz Data', {\n        quizId: selectedQuiz.id,\n        quizTitle: selectedQuiz.title,\n        questionsCount: selectedQuiz.questions?.length || 0\n      });\n    } else {\n      logger.debug('No quiz pre-selected - will select inside multiplayer');\n    }\n  }, [user, state?.selectedQuiz, navigate]);\n  \n  // Don't render anything if redirecting\n  if (!user) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n  \n  return (\n    <MultiplayerErrorBoundary>\n      <div className=\"min-h-screen bg-gray-50\">\n        <MultiplayerManager \n          selectedQuiz={state?.selectedQuiz} // Now optional\n          currentUserId={user.uid}\n          currentUserName={user.displayName || user.email || 'User'}\n          onBackToLobby={() => navigate('/multiplayer')}\n          onQuizComplete={() => {\n            // Don't auto-redirect - let players see final results\n            // navigate('/leaderboard')\n          }}\n          initialRoomId={initialRoomId}\n        />\n      </div>\n    </MultiplayerErrorBoundary>\n  );\n};\n\nexport default MultiplayerPage;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\services\\enhancedMultiplayerService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[924,927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[924,927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[962,965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[962,965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1559,1562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1559,1562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1847,1850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1847,1850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2281,2284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2281,2284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2341,2344],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2341,2344],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2564,2567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2564,2567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2989,2992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2989,2992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3793,3796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3793,3796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Simple event emitter for browser (removed - not used in current implementation)\r\n\r\n// Types\r\nexport interface Player {\r\n  id: string;\r\n  name: string;\r\n  avatar?: string;\r\n  isHost: boolean;\r\n  isReady: boolean;\r\n  score: number;\r\n  currentQuestion: number;\r\n  isOnline: boolean;\r\n  joinedAt: Date;\r\n}\r\n\r\nexport interface Room {\r\n  id: string;\r\n  name: string;\r\n  code: string;\r\n  hostId: string;\r\n  players: Player[];\r\n  maxPlayers: number;\r\n  isPrivate: boolean;\r\n  password?: string;\r\n  status: 'waiting' | 'playing' | 'finished';\r\n  quizId?: string;\r\n  quizTitle?: string;\r\n  settings: {\r\n    timePerQuestion: number;\r\n    showAnswers: boolean;\r\n    allowLateJoin: boolean;\r\n    autoStart: boolean;\r\n  };\r\n  createdAt: Date;\r\n  startedAt?: Date;\r\n  endedAt?: Date;\r\n}\r\n\r\nexport interface GameState {\r\n  roomId: string;\r\n  currentQuestion: number;\r\n  totalQuestions: number;\r\n  timeRemaining: number;\r\n  questionData: any;\r\n  playerAnswers: Record<string, any>;\r\n  leaderboard: Player[];\r\n  phase: 'question' | 'answer' | 'results' | 'finished';\r\n}\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  roomId: string;\r\n  playerId: string;\r\n  playerName: string;\r\n  message: string;\r\n  type: 'player' | 'system';\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface MultiplayerServiceInterface {\r\n  connect(userId: string, userName: string): Promise<void>;\r\n  disconnect(): void;\r\n  resumeRoom(roomId: string): Promise<{ room: Room } | null>;\r\n  setPresence(roomId: string, isOnline: boolean): Promise<void>;\r\n  createRoom(roomConfig: Partial<Room>, selectedQuiz?: any): Promise<{ room: Room; player: Player }>;\r\n  joinRoom(roomCode: string, password?: string): Promise<{ room: Room; player: Player }>;\r\n  leaveRoom(roomId: string): Promise<void>;\r\n  startGame(roomId: string): Promise<void>;\r\n  submitAnswer(roomId: string, questionId: string, answer: any, timeRemaining: number): Promise<void>;\r\n  advanceToNextQuestion(roomId: string): Promise<void>;\r\n  sendChatMessage(roomId: string, message: string): Promise<void>;\r\n  kickPlayer(roomId: string, playerId: string): Promise<void>;\r\n  updatePlayerStatus(roomId: string, isReady: boolean): Promise<void>;\r\n  updateRoomSettings(roomId: string, settings: Partial<Room['settings']>): Promise<void>;\r\n  on(event: string, callback: (data: any) => void): void;\r\n  off(event: string, callback: (data: any) => void): void;\r\n}\r\n\r\nimport { FirestoreMultiplayerService } from './firestoreMultiplayerService';\r\nimport realtimeService from './realtimeMultiplayerService';\r\n\r\n// Singleton instance\r\nlet multiplayerServiceInstance: any = null;\r\n\r\n/**\r\n * Get multiplayer service with hybrid approach\r\n * - Firestore: Persistent data (rooms, scores, metadata)\r\n * - Realtime DB: Live state (presence, timer, chat)\r\n */\r\nexport function getMultiplayerService(): MultiplayerServiceInterface {\r\n  if (!multiplayerServiceInstance) {\r\n    // Create Firestore service with Realtime DB integration\r\n    const firestoreService = new FirestoreMultiplayerService() as any;\r\n    \r\n    // Enhance with Realtime DB capabilities\r\n    const originalConnect = firestoreService.connect.bind(firestoreService);\r\n    firestoreService.connect = async (userId: string, userName: string) => {\r\n      await originalConnect(userId, userName);\r\n      console.log('‚úÖ Connected to Firestore + Realtime DB');\r\n    };\r\n    \r\n    const originalDisconnect = firestoreService.disconnect.bind(firestoreService);\r\n    firestoreService.disconnect = () => {\r\n      originalDisconnect();\r\n      realtimeService.cleanupAll();\r\n      console.log('‚úÖ Disconnected from all services');\r\n    };\r\n    \r\n    // Store reference to realtime service\r\n    firestoreService.realtimeService = realtimeService;\r\n    \r\n    multiplayerServiceInstance = firestoreService;\r\n  }\r\n  return multiplayerServiceInstance as any;\r\n}\r\n\r\nexport function resetMultiplayerService(): void {\r\n  if (multiplayerServiceInstance) {\r\n    multiplayerServiceInstance.disconnect();\r\n    realtimeService.cleanupAll();\r\n    multiplayerServiceInstance = null;\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\services\\firestoreMultiplayerService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[660,663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[660,663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[681,684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[681,684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1503,1506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1503,1506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1605,1608],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1605,1608],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1628,1631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1628,1631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1652,1655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1652,1655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2110,2113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2110,2113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-types","severity":1,"message":"Don't use `Function` as a type. The `Function` type accepts any function-like value.\nIt provides no type safety when calling the function, which can be a common source of bugs.\nIt also accepts things like class declarations, which will throw at runtime as they will not be called with `new`.\nIf you are expecting the function to accept certain arguments, you should explicitly define the function shape.","line":122,"column":31,"nodeType":"Identifier","messageId":"bannedTypeMessage","endLine":122,"endColumn":39},{"ruleId":"@typescript-eslint/ban-types","severity":1,"message":"Don't use `Function` as a type. The `Function` type accepts any function-like value.\nIt provides no type safety when calling the function, which can be a common source of bugs.\nIt also accepts things like class declarations, which will throw at runtime as they will not be called with `new`.\nIf you are expecting the function to accept certain arguments, you should explicitly define the function shape.","line":123,"column":32,"nodeType":"Identifier","messageId":"bannedTypeMessage","endLine":123,"endColumn":40},{"ruleId":"@typescript-eslint/ban-types","severity":1,"message":"Don't use `Function` as a type. The `Function` type accepts any function-like value.\nIt provides no type safety when calling the function, which can be a common source of bugs.\nIt also accepts things like class declarations, which will throw at runtime as they will not be called with `new`.\nIf you are expecting the function to accept certain arguments, you should explicitly define the function shape.","line":128,"column":36,"nodeType":"Identifier","messageId":"bannedTypeMessage","endLine":128,"endColumn":44},{"ruleId":"@typescript-eslint/ban-types","severity":1,"message":"Don't use `Function` as a type. The `Function` type accepts any function-like value.\nIt provides no type safety when calling the function, which can be a common source of bugs.\nIt also accepts things like class declarations, which will throw at runtime as they will not be called with `new`.\nIf you are expecting the function to accept certain arguments, you should explicitly define the function shape.","line":130,"column":31,"nodeType":"Identifier","messageId":"bannedTypeMessage","endLine":130,"endColumn":39},{"ruleId":"@typescript-eslint/ban-types","severity":1,"message":"Don't use `Function` as a type. The `Function` type accepts any function-like value.\nIt provides no type safety when calling the function, which can be a common source of bugs.\nIt also accepts things like class declarations, which will throw at runtime as they will not be called with `new`.\nIf you are expecting the function to accept certain arguments, you should explicitly define the function shape.","line":137,"column":32,"nodeType":"Identifier","messageId":"bannedTypeMessage","endLine":137,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3413,3416],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3413,3416],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4612,4615],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4612,4615],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":568,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":568,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17555,17558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17555,17558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":611,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":611,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18967,18970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18967,18970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":831,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":831,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26472,26475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26472,26475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { \n  collection, \n  doc, \n  addDoc, \n  setDoc, \n  getDoc, \n  getDocs, \n  updateDoc, \n  deleteDoc, \n  query, \n  where, \n  orderBy, \n  limit, \n  onSnapshot, \n  serverTimestamp\n} from 'firebase/firestore';\nimport { db } from '../../../lib/firebase/config';\nimport { logger } from '../utils/logger';\nimport realtimeService from './realtimeMultiplayerService';\n\n// Types\nexport interface Room {\n  id: string;\n  code: string;\n  name: string;\n  // Removed hostId - all players are equal\n  players: Player[];\n  maxPlayers: number;\n  isPrivate: boolean;\n  password?: string;\n  status: 'waiting' | 'starting' | 'playing' | 'finished';\n  quizId?: string;\n  quiz?: any;\n  gameStartAt?: any;\n  gameStartDelay?: number;\n  settings: {\n    timeLimit: number;\n    timePerQuestion?: number;\n    showLeaderboard: boolean;\n    allowLateJoin: boolean;\n  };\n  createdAt: Date;\n  startedAt?: Date;\n  finishedAt?: Date;\n}\n\nexport interface Player {\n  id: string;\n  username: string;\n  isReady: boolean;\n  isOnline: boolean;\n  // Removed isHost - all players are equal\n  score: number;\n  answers: PlayerAnswer[];\n  joinedAt: Date;\n}\n\nexport interface PlayerAnswer {\n  questionId: string;\n  selectedAnswer: number;\n  isCorrect: boolean;\n  timeSpent: number;\n  points: number;\n  timestamp: Date;\n}\n\nexport interface ChatMessage {\n  id: string;\n  userId: string;\n  username: string;\n  message: string;\n  timestamp: Date;\n  type: 'user' | 'system';\n}\n\nexport interface GameData {\n  currentQuestionIndex: number;\n  questions: any[];\n  timePerQuestion?: number;\n  phase?: 'question' | 'results' | 'finished';\n  questionStartAt?: any;\n  questionEndAt?: any;\n  nextQuestionAt?: any;\n  startTime?: Date;\n  endTime?: Date;\n  results?: {\n    [playerId: string]: {\n      score: number;\n      correctAnswers: number;\n      totalAnswers: number;\n      averageTime: number;\n    };\n  };\n}\n\n// Service Interface\nexport interface MultiplayerServiceInterface {\n  // Connection\n  connect(userId: string, username: string): Promise<void>;\n  disconnect(): Promise<void>;\n  \n  // Room Management\n  createRoom(roomConfig: Partial<Room>, selectedQuiz?: any): Promise<{ room: Room; player: Player }>;\n  joinRoom(roomCode: string, password?: string): Promise<{ room: Room; player: Player }>;\n  leaveRoom(roomId: string): Promise<void>;\n  \n  // Game Control\n  startGame(roomId: string): Promise<void>;\n  submitAnswer(roomId: string, questionId: string, answer: number, timeSpent: number): Promise<void>;\n  \n  // Communication\n  sendChatMessage(roomId: string, message: string): Promise<void>;\n  \n  // Player Management\n  updatePlayerStatus(roomId: string, isReady: boolean): Promise<void>;\n  kickPlayer(roomId: string, playerId: string): Promise<void>;\n  \n  // Settings\n  updateRoomSettings(roomId: string, settings: Partial<Room['settings']>): Promise<void>;\n  \n  // Event Listeners\n  on(event: string, callback: Function): void;\n  off(event: string, callback: Function): void;\n}\n\n// Simple Event Emitter for browser compatibility\nclass SimpleEventEmitter {\n  private events: { [key: string]: Function[] } = {};\n\n  on(event: string, callback: Function) {\n    if (!this.events[event]) {\n      this.events[event] = [];\n    }\n    this.events[event].push(callback);\n  }\n\n  off(event: string, callback: Function) {\n    if (!this.events[event]) return;\n    this.events[event] = this.events[event].filter(cb => cb !== callback);\n  }\n\n  emit(event: string, ...args: any[]) {\n    if (!this.events[event]) return;\n    this.events[event].forEach(callback => callback(...args));\n  }\n}\n\n// Firestore Multiplayer Service\nexport class FirestoreMultiplayerService extends SimpleEventEmitter implements MultiplayerServiceInterface {\n  private userId: string = '';\n  private username: string = '';\n  private currentRoomId: string | null = null;\n  private unsubscribeFunctions: (() => void)[] = [];\n\n  // Connection\n  async connect(userId: string, username: string): Promise<void> {\n    this.userId = userId;\n    this.username = username;\n    logger.success('Connected to Firestore Multiplayer Service', { userId, username });\n    this.emit('connected', { userId, username });\n  }\n\n  async disconnect(): Promise<void> {\n    // Unsubscribe from all listeners\n    this.unsubscribeFunctions.forEach(unsubscribe => unsubscribe());\n    this.unsubscribeFunctions = [];\n    \n    // Leave current room if any\n    if (this.currentRoomId) {\n      await this.leaveRoom(this.currentRoomId);\n    }\n    \n    logger.info('Disconnected from Firestore Multiplayer Service');\n    this.emit('disconnected');\n  }\n\n  // Room Management\n  async createRoom(roomConfig: Partial<Room>, selectedQuiz?: any): Promise<{ room: Room; player: Player }> {\n    try {\n      console.log('üèóÔ∏è Service createRoom: Received config', {\n        isPrivate: roomConfig.isPrivate,\n        password: roomConfig.password,\n        fullConfig: roomConfig\n      });\n      \n      // Generate unique room code\n      const code = this.generateRoomCode();\n      \n      // Create room document\n      const roomDoc = doc(collection(db, 'multiplayer_rooms'));\n      \n      // Create room creator player\n      const player: Player = {\n        id: this.userId,\n        username: this.username,\n        isReady: false,\n        isOnline: true,\n        // Removed isHost - all players are equal\n        score: 0,\n        answers: [],\n        joinedAt: new Date()\n      };\n\n      // Room data\n      const roomData = {\n        code,\n        name: roomConfig.name || `${this.username}'s Room`,\n        // Removed hostId - all players are equal\n        maxPlayers: roomConfig.maxPlayers || 4,\n        isPrivate: roomConfig.isPrivate || false,\n        password: roomConfig.password || null,\n        status: 'waiting' as const,\n        quizId: selectedQuiz?.id || null,\n        quiz: selectedQuiz ? {\n          id: selectedQuiz.id,\n          title: selectedQuiz.title,\n          description: selectedQuiz.description,\n          questions: selectedQuiz.questions || []\n        } : null,\n        settings: {\n          timeLimit: roomConfig.settings?.timeLimit || 30,\n          showLeaderboard: roomConfig.settings?.showLeaderboard ?? true,\n          allowLateJoin: roomConfig.settings?.allowLateJoin ?? true\n        },\n        createdAt: serverTimestamp()\n      };\n      \n      console.log('üíæ Service createRoom: Saving to Firestore', {\n        isPrivate: roomData.isPrivate,\n        password: roomData.password,\n        code: roomData.code\n      });\n\n      await setDoc(roomDoc, roomData);\n\n      // Add player to room\n      const playerDoc = doc(collection(db, 'multiplayer_rooms', roomDoc.id, 'players'), this.userId);\n      await setDoc(playerDoc, player);\n\n      // Setup Realtime Database presence for instant sync\n      await realtimeService.setupPresence(roomDoc.id, this.userId, this.username);\n\n      // Set current room\n      this.currentRoomId = roomDoc.id;\n\n      // Start listening to room updates\n      this.listenToRoom(roomDoc.id);\n      this.listenToPlayers(roomDoc.id);\n      this.listenToMessages(roomDoc.id);\n\n      const room: Room = {\n        id: roomDoc.id,\n        code,\n        name: roomData.name,\n        // Removed hostId - all players are equal\n        players: [player],\n        maxPlayers: roomData.maxPlayers,\n        isPrivate: roomData.isPrivate,\n        password: roomData.password || undefined,\n        status: 'waiting',\n        quizId: selectedQuiz?.id || undefined,\n        quiz: roomData.quiz || undefined,\n        settings: roomData.settings,\n        createdAt: new Date()\n      };\n\n      logger.success('Room created', { roomId: room.id, code: room.code });\n      this.emit('room:created', room);\n      \n      return { room, player };\n    } catch (error) {\n      console.error('Error creating room:', error);\n      throw error;\n    }\n  }\n\n  async joinRoom(roomCode: string, password?: string): Promise<{ room: Room; player: Player }> {\n    try {\n      logger.info('üö™ Service: Attempting to join room', { roomCode, hasPassword: !!password });\n      \n      // Find room by code\n      const q = query(collection(db, 'multiplayer_rooms'), where('code', '==', roomCode), limit(1));\n      const snapshot = await getDocs(q);\n      \n      if (snapshot.empty) {\n        logger.error('‚ùå Service: Room not found', { roomCode });\n        throw new Error('room_not_found');\n      }\n      \n      const roomDoc = snapshot.docs[0];\n      const roomData = roomDoc.data();\n      \n      logger.debug('üîç Service: Room found', { \n        roomId: roomDoc.id, \n        isPrivate: roomData.isPrivate,\n        hasPassword: !!roomData.password,\n        providedPassword: !!password\n      });\n      \n      // Check if room requires password\n      if (roomData.isPrivate && !password) {\n        logger.warn('üîí Service: Room requires password but none provided');\n        throw new Error('room_requires_password');\n      }\n      \n      if (roomData.isPrivate && roomData.password !== password) {\n        logger.error('‚ùå Service: Wrong password provided');\n        throw new Error('wrong_password');\n      }\n      \n      // Check room capacity\n      const playersSnapshot = await getDocs(collection(db, 'multiplayer_rooms', roomDoc.id, 'players'));\n      if (playersSnapshot.size >= roomData.maxPlayers) {\n        throw new Error('room_full');\n      }\n      \n      // Check if game is in progress\n      if (roomData.status === 'playing' && !roomData.settings.allowLateJoin) {\n        throw new Error('game_in_progress');\n      }\n      \n      logger.success('‚úÖ Service: All checks passed, creating player');\n      \n      // Create player\n      const player: Player = {\n        id: this.userId,\n        username: this.username,\n        isReady: false,\n        isOnline: true,\n        // Removed isHost - all players are equal\n        score: 0,\n        answers: [],\n        joinedAt: new Date()\n      };\n      \n      // Add player to room\n      const playerDoc = doc(collection(db, 'multiplayer_rooms', roomDoc.id, 'players'), this.userId);\n      await setDoc(playerDoc, player);\n      \n      // Setup Realtime Database presence for instant sync\n      await realtimeService.setupPresence(roomDoc.id, this.userId, this.username);\n      \n      // Set current room\n      this.currentRoomId = roomDoc.id;\n      \n      // Start listening to room updates\n      this.listenToRoom(roomDoc.id);\n      this.listenToPlayers(roomDoc.id);\n      this.listenToMessages(roomDoc.id);\n      \n      // Send system message\n      await this.sendSystemMessage(roomDoc.id, `${this.username} joined the room`);\n      \n      const room: Room = {\n        id: roomDoc.id,\n        code: roomData.code,\n        name: roomData.name,\n        // Removed hostId - all players are equal\n        players: [player], // Will be updated by listener\n        maxPlayers: roomData.maxPlayers,\n        isPrivate: roomData.isPrivate,\n        password: roomData.password,\n        status: roomData.status,\n        quizId: roomData.quizId,\n        quiz: roomData.quiz,\n        settings: roomData.settings,\n        createdAt: roomData.createdAt?.toDate() || new Date()\n      };\n      \n      logger.success('Joined room', { roomId: room.id, code: room.code });\n      this.emit('room:joined', room);\n      \n      return { room, player };\n    } catch (error) {\n      logger.error('Error joining room', error);\n      throw error;\n    }\n  }\n\n  async leaveRoom(roomId: string): Promise<void> {\n    try {\n      if (!this.userId) return;\n      \n      // Remove player from room\n      const playerDoc = doc(db, 'multiplayer_rooms', roomId, 'players', this.userId);\n      await deleteDoc(playerDoc);\n      \n      // Send system message\n      await this.sendSystemMessage(roomId, `${this.username} left the room`);\n      \n      // Clean up listeners\n      this.unsubscribeFunctions.forEach(unsubscribe => unsubscribe());\n      this.unsubscribeFunctions = [];\n      \n      this.currentRoomId = null;\n      \n      logger.info('Left room', { roomId });\n      this.emit('room:left', roomId);\n    } catch (error) {\n      logger.error('Error leaving room', error);\n      throw error;\n    }\n  }\n\n  // Game Control\n  async startGame(roomId: string): Promise<void> {\n    try {\n      logger.info('Starting 5-second game countdown...');\n      \n      // First, set room status to 'starting' with countdown timer\n      const roomRef = doc(db, 'multiplayer_rooms', roomId);\n      await updateDoc(roomRef, {\n        status: 'starting',\n        gameStartAt: serverTimestamp(),\n        gameStartDelay: 5000 // 5 seconds delay\n      });\n      \n      // After 5 seconds, actually start the game\n      setTimeout(() => {\n        this.actuallyStartGame(roomId).catch(logger.error);\n      }, 5000);\n      \n    } catch (error) {\n      logger.error('Error starting game', error);\n      throw error;\n    }\n  }\n\n  private async actuallyStartGame(roomId: string): Promise<void> {\n    try {\n      logger.debug('Loading quiz data', {\n        roomId,\n        hasUserId: !!this.userId,\n        timestamp: new Date().toISOString()\n      });\n      \n      const roomRef = doc(db, 'multiplayer_rooms', roomId);\n      const roomSnap = await getDoc(roomRef);\n      \n      if (!roomSnap.exists()) {\n        throw new Error('Room not found');\n      }\n      \n      const roomData = roomSnap.data();\n      let questions = [];\n      \n      if (roomData.quiz && roomData.quiz.questions && roomData.quiz.questions.length > 0) {\n        logger.success('Using embedded quiz questions', { count: questions.length });\n        questions = roomData.quiz.questions;\n      } else if (roomData.quizId) {\n        try {\n          logger.debug('Fetching quiz from Firestore', { quizId: roomData.quizId });\n          \n          const quizRef = doc(db, 'quizzes', roomData.quizId);\n          const quizSnap = await getDoc(quizRef);\n          \n          if (quizSnap.exists()) {\n            logger.debug('Quiz data received', {\n              id: quizSnap.id,\n              hasData: !!quizSnap.data(),\n              hasQuestions: !!quizSnap.data()?.questions\n            });\n            \n            const quizData = quizSnap.data();\n            if (quizData?.questions && Array.isArray(quizData.questions)) {\n              questions = quizData.questions;\n              logger.success('Loaded quiz questions from Firestore', { count: questions.length });\n            } else {\n              logger.warn('Quiz found but no valid questions array');\n            }\n          } else {\n            logger.warn('Quiz document not found in Firestore');\n          }\n        } catch (e) {\n          logger.error('Failed to load quiz by quizId', e);\n        }\n      }\n      \n      // Fallback to mock questions if no real questions available\n      if (!questions || questions.length === 0) {\n        logger.warn('No quiz questions found, using fallback mock questions');\n        questions = [\n          {\n            id: 'mock-q1',\n            text: 'What is 2 + 2?',\n            answers: [\n              { text: '3', isCorrect: false },\n              { text: '4', isCorrect: true },\n              { text: '5', isCorrect: false },\n              { text: '6', isCorrect: false }\n            ]\n          },\n          {\n            id: 'mock-q2',\n            text: 'What is the capital of Vietnam?',\n            answers: [\n              { text: 'Ho Chi Minh City', isCorrect: false },\n              { text: 'Hanoi', isCorrect: true },\n              { text: 'Da Nang', isCorrect: false },\n              { text: 'Hue', isCorrect: false }\n            ]\n          }\n        ];\n      }\n      \n      const timePerQuestion = roomData.settings?.timePerQuestion || 30;\n      \n      const gameData = {\n        currentQuestionIndex: 0,\n        questions,\n        timePerQuestion,\n        phase: 'question',\n        questionStartAt: serverTimestamp(),\n        questionEndAt: new Date(Date.now() + (timePerQuestion * 1000))\n      };\n      \n      // Update room with game data and playing status\n      await updateDoc(roomRef, {\n        status: 'playing',\n        startedAt: serverTimestamp(),\n        gameData,\n        // Clear countdown fields\n        gameStartAt: null,\n        gameStartDelay: null\n      });\n      \n      const emitData = {\n        ...gameData,\n        roomId,\n        questionsCount: questions.length\n      };\n      \n      logger.success('Game actually started', { roomId, questionsCount: questions.length });\n      this.emit('game:start', emitData);\n    } catch (error) {\n      logger.error('Error starting game', error);\n      throw error;\n    }\n  }\n\n  async submitAnswer(roomId: string, questionId: string, answer: number, timeSpent: number): Promise<void> {\n    try {\n      const playerDoc = doc(db, 'multiplayer_rooms', roomId, 'players', this.userId);\n      const playerSnap = await getDoc(playerDoc);\n      \n      if (!playerSnap.exists()) return;\n      \n      const playerData = playerSnap.data();\n      \n      // Get room data to access questions for correct answer calculation\n      const roomRef = doc(db, 'multiplayer_rooms', roomId);\n      const roomSnap = await getDoc(roomRef);\n      \n      if (!roomSnap.exists()) return;\n      \n      const roomData = roomSnap.data();\n      const currentQuestionIndex = roomData.gameData?.currentQuestionIndex || 0;\n      const currentQuestion = roomData.gameData?.questions?.[currentQuestionIndex];\n      \n      // Calculate correct answer and points\n      let isCorrect = false;\n      let points = 0;\n      \n      if (currentQuestion) {\n        // Find correct answer index\n        let correctIndex = 0;\n        if (currentQuestion.answers && Array.isArray(currentQuestion.answers)) {\n          correctIndex = currentQuestion.answers.findIndex((a: any) => a.isCorrect);\n          if (correctIndex === -1) correctIndex = 0;\n        }\n        \n        isCorrect = answer === correctIndex;\n        points = isCorrect ? Math.max(10, Math.floor(100 - (timeSpent * 2))) : 0;\n      }\n      \n      const playerAnswer: PlayerAnswer = {\n        questionId,\n        selectedAnswer: answer,\n        isCorrect,\n        timeSpent,\n        points,\n        timestamp: new Date()\n      };\n      \n      // Update player's answers\n      const updatedAnswers = [...(playerData.answers || []), playerAnswer];\n      \n      await updateDoc(playerDoc, {\n        answers: updatedAnswers\n      });\n      \n      this.emit('answer:submitted', { questionId, answer, timeSpent, isCorrect, points });\n      \n      // Check if all players have submitted and auto-advance\n      this.checkAndAdvanceQuestion(roomId, questionId);\n      \n    } catch (error) {\n      console.error('Error submitting answer:', error);\n      throw error;\n    }\n  }\n\n  private async checkAndAdvanceQuestion(roomId: string, questionId: string): Promise<void> {\n    try {\n      // Get all players\n      const playersSnapshot = await getDocs(collection(db, 'multiplayer_rooms', roomId, 'players'));\n      const players = playersSnapshot.docs.map(doc => doc.data());\n      \n      // Check if all players have answered this question\n      const allAnswered = players.every(player => \n        player.answers?.some((answer: any) => answer.questionId === questionId)\n      );\n      \n      if (allAnswered && players.length > 0) {\n        logger.info('All players answered, advancing to next question...');\n        \n        // Update room with advancement countdown immediately for real-time sync\n        const roomRef = doc(db, 'multiplayer_rooms', roomId);\n        await updateDoc(roomRef, {\n          'gameData.phase': 'results',\n          'gameData.nextQuestionAt': new Date(Date.now() + 3000) // 3 seconds to show results\n        });\n        \n        // After 3 seconds, advance to next question or finish game\n        setTimeout(async () => {\n          try {\n            const roomSnap = await getDoc(roomRef);\n            if (!roomSnap.exists()) return;\n            \n            const roomData = roomSnap.data();\n            const currentIndex = roomData.gameData?.currentQuestionIndex || 0;\n            const totalQuestions = roomData.gameData?.questions?.length || 0;\n            \n            if (currentIndex + 1 >= totalQuestions) {\n              // Game finished\n              await updateDoc(roomRef, {\n                status: 'finished',\n                finishedAt: serverTimestamp(),\n                'gameData.phase': 'finished'\n              });\n            } else {\n              // Next question\n              const nextIndex = currentIndex + 1;\n              const timePerQuestion = roomData.settings?.timePerQuestion || 30;\n              \n              await updateDoc(roomRef, {\n                'gameData.currentQuestionIndex': nextIndex,\n                'gameData.phase': 'question',\n                'gameData.questionStartAt': serverTimestamp(),\n                'gameData.questionEndAt': new Date(Date.now() + (timePerQuestion * 1000)),\n                'gameData.nextQuestionAt': null\n              });\n            }\n          } catch (error) {\n            console.error('Error advancing question:', error);\n          }\n        }, 3000);\n      }\n    } catch (error) {\n      console.error('Error checking players answers:', error);\n    }\n  }\n\n  // Communication\n  async sendChatMessage(roomId: string, message: string): Promise<void> {\n    try {\n      // Use Realtime Database for instant chat delivery\n      const messageData = {\n        userId: this.userId,\n        username: this.username,\n        message: message.trim(),\n        type: 'user'\n      };\n      \n      await realtimeService.sendChatMessage(roomId, messageData);\n      \n      logger.debug('Chat message sent via Realtime DB');\n      // Don't emit locally - let the listener handle it for consistency\n    } catch (error) {\n      logger.error('Error sending chat message', error);\n      throw error;\n    }\n  }\n\n  private async sendSystemMessage(roomId: string, message: string): Promise<void> {\n    try {\n      const messageData = {\n        userId: 'system',\n        username: 'System',\n        message,\n        timestamp: serverTimestamp(),\n        type: 'system'\n      };\n      \n      await addDoc(collection(db, 'multiplayer_rooms', roomId, 'messages'), messageData);\n    } catch (error) {\n      logger.error('Error sending system message', error);\n    }\n  }\n\n  // Player Management\n  async updatePlayerStatus(roomId: string, isReady: boolean): Promise<void> {\n    try {\n      const playerDoc = doc(db, 'multiplayer_rooms', roomId, 'players', this.userId);\n      await updateDoc(playerDoc, { isReady });\n      \n      logger.debug('Player status updated', { isReady });\n      this.emit('player:status_updated', { isReady });\n    } catch (error) {\n      logger.error('Error updating player status', error);\n      throw error;\n    }\n  }\n\n  async kickPlayer(roomId: string, playerId: string): Promise<void> {\n    try {\n      const playerDoc = doc(db, 'multiplayer_rooms', roomId, 'players', playerId);\n      await deleteDoc(playerDoc);\n      \n      logger.info('Player kicked', { playerId });\n      this.emit('player:kicked', playerId);\n    } catch (error) {\n      logger.error('Error kicking player', error);\n      throw error;\n    }\n  }\n\n  // Settings\n  async updateRoomSettings(roomId: string, settings: Partial<Room['settings']>): Promise<void> {\n    try {\n      const roomDoc = doc(db, 'multiplayer_rooms', roomId);\n      await updateDoc(roomDoc, { \n        [`settings.${Object.keys(settings)[0]}`]: Object.values(settings)[0] \n      });\n      \n      logger.debug('Room settings updated', settings);\n      this.emit('room:settings_updated', settings);\n    } catch (error) {\n      logger.error('Error updating room settings', error);\n      throw error;\n    }\n  }\n\n  // Listeners\n  private listenToRoom(roomId: string) {\n    const roomDoc = doc(db, 'multiplayer_rooms', roomId);\n    const unsubscribe = onSnapshot(roomDoc, (doc) => {\n      if (doc.exists()) {\n        const roomData = doc.data();\n        const room: Room = {\n          id: doc.id,\n          code: roomData.code,\n          name: roomData.name,\n          // Removed hostId - all players are equal\n          players: [], // Will be populated by players listener\n          maxPlayers: roomData.maxPlayers,\n          isPrivate: roomData.isPrivate,\n          password: roomData.password,\n          status: roomData.status,\n          quizId: roomData.quizId,\n          quiz: roomData.quiz,\n          settings: roomData.settings,\n          createdAt: roomData.createdAt?.toDate() || new Date(),\n          startedAt: roomData.startedAt?.toDate(),\n          finishedAt: roomData.finishedAt?.toDate()\n        };\n        \n        this.emit('room:updated', room);\n        \n        // Emit game events\n        if (roomData.gameData) {\n          this.emit('game:data_updated', roomData.gameData);\n        }\n      }\n    });\n    \n    this.unsubscribeFunctions.push(unsubscribe);\n  }\n\n  private listenToPlayers(roomId: string) {\n    const playersCollection = collection(db, 'multiplayer_rooms', roomId, 'players');\n    const q = query(playersCollection, orderBy('joinedAt', 'asc'));\n    \n    // Store Firestore players for merging with Realtime DB data\n    let firestorePlayers: Player[] = [];\n    \n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const players: Player[] = [];\n      snapshot.forEach((doc) => {\n        const data = doc.data();\n        players.push({\n          ...data,\n          joinedAt: data.joinedAt?.toDate() || new Date()\n        } as Player);\n      });\n      \n      firestorePlayers = players;\n      \n      logger.info('Players snapshot updated', { \n        roomId, \n        count: players.length,\n        playerNames: players.map(p => p.username)\n      });\n      \n      this.emit('players:updated', players);\n    });\n    \n    // Listen to Realtime Database presence for instant online/offline updates\n    realtimeService.listenToPresence(roomId, (presence) => {\n      // Merge Firestore data with Realtime DB presence\n      const enhancedPlayers = firestorePlayers.map(player => ({\n        ...player,\n        isOnline: presence[player.id]?.isOnline ?? player.isOnline\n      }));\n      \n      logger.debug('Merged presence data', { \n        roomId, \n        onlineCount: Object.values(presence).filter(p => p.isOnline).length \n      });\n      \n      this.emit('players:updated', enhancedPlayers);\n    });\n    \n    this.unsubscribeFunctions.push(unsubscribe);\n  }\n\n  private listenToMessages(roomId: string) {\n    // Use Realtime Database for instant chat updates\n    realtimeService.listenToChatMessages(roomId, (realtimeMessages) => {\n      // Convert Realtime DB format to ChatMessage format\n      const messages: ChatMessage[] = realtimeMessages.map((msg: any) => ({\n        id: msg.id || `${msg.userId}_${msg.timestamp}`,\n        userId: msg.userId,\n        username: msg.username,\n        message: msg.message,\n        timestamp: msg.timestamp ? new Date(msg.timestamp) : new Date(),\n        type: msg.type || 'user'\n      }));\n      \n      logger.debug('Chat messages updated from Realtime DB', { count: messages.length });\n      this.emit('messages:updated', messages);\n    });\n  }\n\n  // Utility\n  private generateRoomCode(): string {\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    let result = '';\n    for (let i = 0; i < 6; i++) {\n      result += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return result;\n  }\n}\n\n// Export singleton instance\nexport const firestoreMultiplayerService = new FirestoreMultiplayerService();\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\services\\realtimeMultiplayerService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[526,529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[526,529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1503,1506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1503,1506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1760,1763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1760,1763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2944,2947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2944,2947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3202,3205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3202,3205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4614,4617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4614,4617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6037,6040],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6037,6040],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6310,6313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6310,6313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":240,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6912,6915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6912,6915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":260,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7437,7440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7437,7440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":267,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7748,7751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7748,7751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { \r\n  ref, \r\n  onValue, \r\n  set, \r\n  update, \r\n  remove,\r\n  serverTimestamp,\r\n  onDisconnect,\r\n  push,\r\n  get,\r\n  off\r\n} from 'firebase/database';\r\nimport { rtdb } from '../../../lib/firebase/config';\r\nimport { logger } from '../utils/logger';\r\n\r\n/**\r\n * Realtime Database Service for multiplayer\r\n * Handles instant sync for:\r\n * - Player presence (online/offline)\r\n * - Ready status\r\n * - Game timer\r\n * - Answer progress\r\n * - Chat messages\r\n */\r\nclass RealtimeMultiplayerService {\r\n  private listeners: Map<string, any> = new Map();\r\n\r\n  /**\r\n   * Setup presence system - auto set offline on disconnect\r\n   */\r\n  async setupPresence(roomId: string, userId: string, userName: string) {\r\n    try {\r\n      const presenceRef = ref(rtdb, `rooms/${roomId}/presence/${userId}`);\r\n      \r\n      // Set online - ph·∫£i match v·ªõi database.rules.json validation\r\n      await set(presenceRef, {\r\n        isOnline: true,\r\n        username: userName,\r\n        lastSeen: Date.now(),\r\n      });\r\n\r\n      logger.success(`Presence setup for ${userName} in room ${roomId}`);\r\n\r\n      // Auto set offline on disconnect\r\n      onDisconnect(presenceRef).set({\r\n        isOnline: false,\r\n        username: userName,\r\n        lastSeen: Date.now(),\r\n      });\r\n    } catch (error) {\r\n      logger.error('Failed to setup presence:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to player presence (real-time online/offline)\r\n   */\r\n  listenToPresence(roomId: string, callback: (presence: Record<string, any>) => void) {\r\n    const presenceRef = ref(rtdb, `rooms/${roomId}/presence`);\r\n    \r\n    const unsubscribe = onValue(presenceRef, (snapshot) => {\r\n      const presence = snapshot.val() || {};\r\n      const onlineCount = Object.values(presence).filter((p: any) => p.isOnline).length;\r\n      \r\n      logger.debug('Presence updated:', { \r\n        roomId, \r\n        onlineCount,\r\n        players: Object.keys(presence)\r\n      });\r\n      \r\n      callback(presence);\r\n    }, (error) => {\r\n      logger.error('Presence listener error:', error);\r\n    });\r\n\r\n    const listenerKey = `presence_${roomId}`;\r\n    this.listeners.set(listenerKey, { ref: presenceRef, unsubscribe });\r\n    \r\n    return () => {\r\n      off(presenceRef);\r\n      this.listeners.delete(listenerKey);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Update player ready status (instant sync)\r\n   */\r\n  async updatePlayerStatus(roomId: string, userId: string, isReady: boolean) {\r\n    try {\r\n      const statusRef = ref(rtdb, `rooms/${roomId}/playerStatuses/${userId}`);\r\n      \r\n      await set(statusRef, {\r\n        isReady: isReady,\r\n        updatedAt: Date.now(),\r\n      });\r\n\r\n      logger.info(`Player ${userId} ready status: ${isReady}`);\r\n    } catch (error) {\r\n      logger.error('Failed to update player status:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to all players' ready status\r\n   */\r\n  listenToPlayerStatuses(roomId: string, callback: (players: Record<string, any>) => void) {\r\n    const playersRef = ref(rtdb, `rooms/${roomId}/playerStatuses`);\r\n    \r\n    const unsubscribe = onValue(playersRef, (snapshot) => {\r\n      const players = snapshot.val() || {};\r\n      const readyCount = Object.values(players).filter((p: any) => p.isReady).length;\r\n      const totalCount = Object.keys(players).length;\r\n      \r\n      logger.debug('Players status updated:', { \r\n        roomId, \r\n        ready: readyCount, \r\n        total: totalCount,\r\n        playerIds: Object.keys(players)\r\n      });\r\n      \r\n      callback(players);\r\n    }, (error) => {\r\n      logger.error('Players listener error:', error);\r\n    });\r\n\r\n    const listenerKey = `players_${roomId}`;\r\n    this.listeners.set(listenerKey, { ref: playersRef, unsubscribe });\r\n    \r\n    return () => {\r\n      off(playersRef);\r\n      this.listeners.delete(listenerKey);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Broadcast game timer (sync across all clients)\r\n   */\r\n  async updateGameTimer(roomId: string, timeRemaining: number, questionIndex: number) {\r\n    try {\r\n      const timerRef = ref(rtdb, `rooms/${roomId}/game/timer`);\r\n      \r\n      await set(timerRef, {\r\n        timeLeft: timeRemaining,\r\n        isRunning: timeRemaining > 0,\r\n        updatedAt: Date.now(),\r\n      });\r\n      \r\n      // Also update current question\r\n      const gameRef = ref(rtdb, `rooms/${roomId}/game`);\r\n      await update(gameRef, {\r\n        currentQuestion: questionIndex,\r\n        updatedAt: Date.now(),\r\n      });\r\n    } catch (error) {\r\n      logger.error('Failed to update game timer:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to game timer\r\n   */\r\n  listenToGameTimer(roomId: string, callback: (timer: any) => void) {\r\n    const timerRef = ref(rtdb, `rooms/${roomId}/game/timer`);\r\n    \r\n    const unsubscribe = onValue(timerRef, (snapshot) => {\r\n      const timer = snapshot.val();\r\n      if (timer) {\r\n        logger.debug('Timer updated:', timer);\r\n        callback(timer);\r\n      }\r\n    }, (error) => {\r\n      logger.error('Timer listener error:', error);\r\n    });\r\n\r\n    const listenerKey = `timer_${roomId}`;\r\n    this.listeners.set(listenerKey, { ref: timerRef, unsubscribe });\r\n    \r\n    return () => {\r\n      off(timerRef);\r\n      this.listeners.delete(listenerKey);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Submit answer progress (for tracking who answered)\r\n   */\r\n  async submitAnswerProgress(roomId: string, questionId: string, userId: string) {\r\n    try {\r\n      const answerRef = ref(\r\n        rtdb, \r\n        `rooms/${roomId}/answerProgress/${userId}`\r\n      );\r\n      \r\n      await set(answerRef, {\r\n        hasAnswered: true,\r\n        answeredAt: Date.now(),\r\n      });\r\n\r\n      logger.debug(`Answer progress: ${userId} answered question ${questionId}`);\r\n    } catch (error) {\r\n      logger.error('Failed to submit answer progress:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to answer progress (how many players answered for a specific question)\r\n   * Updated to support per-question tracking\r\n   */\r\n  listenToAnswerProgress(\r\n    roomId: string, \r\n    questionIndex: number, \r\n    callback: (count: number, answers: any) => void\r\n  ) {\r\n    const answersRef = ref(rtdb, `rooms/${roomId}/answerProgress/${questionIndex}`);\r\n    \r\n    const unsubscribe = onValue(answersRef, (snapshot) => {\r\n      const answers = snapshot.val() || {};\r\n      const count = Object.values(answers).filter((a: any) => a.hasAnswered).length;\r\n      \r\n      logger.debug(`Answer progress Q${questionIndex}: ${count} players answered`);\r\n      callback(count, answers);\r\n    }, (error) => {\r\n      logger.error('Answer progress listener error:', error);\r\n    });\r\n\r\n    const listenerKey = `answers_${roomId}_${questionIndex}`;\r\n    this.listeners.set(listenerKey, { ref: answersRef, unsubscribe });\r\n    \r\n    return () => {\r\n      off(answersRef);\r\n      this.listeners.delete(listenerKey);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Send chat message (instant delivery)\r\n   */\r\n  async sendChatMessage(roomId: string, message: any) {\r\n    try {\r\n      const messagesRef = ref(rtdb, `rooms/${roomId}/chat`);\r\n      const newMessageRef = push(messagesRef);\r\n      \r\n      await set(newMessageRef, {\r\n        ...message,\r\n        timestamp: serverTimestamp(),\r\n      });\r\n\r\n      logger.debug('Chat message sent:', message.message);\r\n    } catch (error) {\r\n      logger.error('Failed to send chat message:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to chat messages\r\n   */\r\n  listenToChatMessages(roomId: string, callback: (messages: any[]) => void) {\r\n    const messagesRef = ref(rtdb, `rooms/${roomId}/chat`);\r\n    \r\n    const unsubscribe = onValue(messagesRef, (snapshot) => {\r\n      const messagesObj = snapshot.val() || {};\r\n      const messages = Object.entries(messagesObj).map(([key, value]) => ({\r\n        id: key,\r\n        ...value as any,\r\n      })).sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));\r\n      \r\n      logger.debug(`Chat updated: ${messages.length} messages`);\r\n      callback(messages);\r\n    }, (error) => {\r\n      logger.error('Chat listener error:', error);\r\n    });\r\n\r\n    const listenerKey = `chat_${roomId}`;\r\n    this.listeners.set(listenerKey, { ref: messagesRef, unsubscribe });\r\n    \r\n    return () => {\r\n      off(messagesRef);\r\n      this.listeners.delete(listenerKey);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Update current question index (sync game state)\r\n   */\r\n  async updateCurrentQuestion(roomId: string, questionIndex: number) {\r\n    try {\r\n      const gameRef = ref(rtdb, `rooms/${roomId}/game`);\r\n      \r\n      await update(gameRef, {\r\n        currentQuestion: questionIndex,\r\n        updatedAt: Date.now(),\r\n      });\r\n\r\n      logger.info(`Current question updated: ${questionIndex}`);\r\n    } catch (error) {\r\n      logger.error('Failed to update current question:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to current question changes\r\n   */\r\n  listenToCurrentQuestion(roomId: string, callback: (index: number) => void) {\r\n    const questionRef = ref(rtdb, `rooms/${roomId}/game/currentQuestion`);\r\n    \r\n    const unsubscribe = onValue(questionRef, (snapshot) => {\r\n      const index = snapshot.val();\r\n      if (index !== null && index !== undefined) {\r\n        logger.debug(`Question changed to: ${index}`);\r\n        callback(index);\r\n      }\r\n    }, (error) => {\r\n      logger.error('Question listener error:', error);\r\n    });\r\n\r\n    const listenerKey = `question_${roomId}`;\r\n    this.listeners.set(listenerKey, { ref: questionRef, unsubscribe });\r\n    \r\n    return () => {\r\n      off(questionRef);\r\n      this.listeners.delete(listenerKey);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Set room as active (for cleanup purposes)\r\n   */\r\n  async setRoomActive(roomId: string, isActive: boolean) {\r\n    try {\r\n      const roomRef = ref(rtdb, `rooms/${roomId}/metadata`);\r\n      \r\n      await set(roomRef, {\r\n        active: isActive,\r\n        updatedAt: Date.now(),\r\n      });\r\n    } catch (error) {\r\n      logger.error('Failed to set room active status:', error);\r\n    }\r\n  }\r\n\r\n  // ============================================================================\r\n  // SYNCHRONIZED GAME TIMER\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Start synchronized game timer\r\n   * Server-authoritative: only the host (first player alphabetically) should call this\r\n   */\r\n  async startQuestionTimer(roomId: string, durationSeconds: number) {\r\n    try {\r\n      const timerRef = ref(rtdb, `rooms/${roomId}/game/timer`);\r\n      \r\n      await set(timerRef, {\r\n        startedAt: Date.now(),\r\n        duration: durationSeconds,\r\n        remaining: durationSeconds,\r\n        isActive: true,\r\n      });\r\n\r\n      logger.info(`Question timer started: ${durationSeconds}s`);\r\n    } catch (error) {\r\n      logger.error('Failed to start question timer:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to synchronized timer\r\n   */\r\n  listenToTimer(roomId: string, callback: (timerData: {\r\n    remaining: number;\r\n    isActive: boolean;\r\n    startedAt: number;\r\n    duration: number;\r\n  } | null) => void) {\r\n    const timerRef = ref(rtdb, `rooms/${roomId}/game/timer`);\r\n    \r\n    const unsubscribe = onValue(timerRef, (snapshot) => {\r\n      const data = snapshot.val();\r\n      if (data) {\r\n        // Calculate remaining time based on server time\r\n        const elapsed = Math.floor((Date.now() - data.startedAt) / 1000);\r\n        const remaining = Math.max(0, data.duration - elapsed);\r\n        \r\n        callback({\r\n          remaining,\r\n          isActive: data.isActive && remaining > 0,\r\n          startedAt: data.startedAt,\r\n          duration: data.duration,\r\n        });\r\n      } else {\r\n        callback(null);\r\n      }\r\n    }, (error) => {\r\n      logger.error('Timer listener error:', error);\r\n    });\r\n\r\n    const listenerKey = `timer_${roomId}`;\r\n    this.listeners.set(listenerKey, { ref: timerRef, unsubscribe });\r\n    \r\n    return () => {\r\n      off(timerRef);\r\n      this.listeners.delete(listenerKey);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Stop the question timer\r\n   */\r\n  async stopQuestionTimer(roomId: string) {\r\n    try {\r\n      const timerRef = ref(rtdb, `rooms/${roomId}/game/timer`);\r\n      \r\n      await update(timerRef, {\r\n        isActive: false,\r\n        remaining: 0,\r\n      });\r\n\r\n      logger.info('Question timer stopped');\r\n    } catch (error) {\r\n      logger.error('Failed to stop question timer:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Track who has answered the current question\r\n   */\r\n  async markPlayerAnswered(roomId: string, userId: string, questionIndex: number) {\r\n    try {\r\n      const answerRef = ref(rtdb, `rooms/${roomId}/answerProgress/${questionIndex}/${userId}`);\r\n      \r\n      await set(answerRef, {\r\n        hasAnswered: true,\r\n        timestamp: Date.now(),\r\n      });\r\n\r\n      logger.info(`Player ${userId} marked as answered for Q${questionIndex}`);\r\n    } catch (error) {\r\n      logger.error('Failed to mark player as answered:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear answer progress for next question\r\n   */\r\n  async clearAnswerProgress(roomId: string, questionIndex: number) {\r\n    try {\r\n      const progressRef = ref(rtdb, `rooms/${roomId}/answerProgress/${questionIndex}`);\r\n      await remove(progressRef);\r\n      logger.info(`Cleared answer progress for Q${questionIndex}`);\r\n    } catch (error) {\r\n      logger.error('Failed to clear answer progress:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup all listeners for a room\r\n   */\r\n  cleanupRoom(roomId: string) {\r\n    logger.info(`Cleaning up listeners for room ${roomId}`);\r\n    \r\n    this.listeners.forEach((listener, key) => {\r\n      if (key.includes(roomId)) {\r\n        if (listener.ref) {\r\n          off(listener.ref);\r\n        }\r\n        this.listeners.delete(key);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Delete room data (when game ends)\r\n   */\r\n  async deleteRoom(roomId: string) {\r\n    try {\r\n      const roomRef = ref(rtdb, `rooms/${roomId}`);\r\n      await remove(roomRef);\r\n      \r\n      logger.success(`Room ${roomId} deleted from Realtime DB`);\r\n    } catch (error) {\r\n      logger.error('Failed to delete room:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if room exists in Realtime DB\r\n   */\r\n  async roomExists(roomId: string): Promise<boolean> {\r\n    try {\r\n      const roomRef = ref(rtdb, `rooms/${roomId}/metadata`);\r\n      const snapshot = await get(roomRef);\r\n      return snapshot.exists();\r\n    } catch (error) {\r\n      logger.error('Failed to check room existence:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all active listeners count (for debugging)\r\n   */\r\n  getActiveListenersCount(): number {\r\n    return this.listeners.size;\r\n  }\r\n\r\n  /**\r\n   * Cleanup all listeners (call on app unmount)\r\n   */\r\n  cleanupAll() {\r\n    logger.info(`Cleaning up all listeners (${this.listeners.size})`);\r\n    \r\n    this.listeners.forEach((listener) => {\r\n      if (listener.ref) {\r\n        off(listener.ref);\r\n      }\r\n    });\r\n    \r\n    this.listeners.clear();\r\n  }\r\n\r\n  /**\r\n   * Start countdown for game start (synchronized)\r\n   */\r\n  async startCountdown(roomId: string, seconds: number) {\r\n    try {\r\n      const countdownRef = ref(rtdb, `rooms/${roomId}/countdown`);\r\n      \r\n      await set(countdownRef, {\r\n        remaining: seconds,\r\n        startedAt: Date.now(),\r\n        isActive: true,\r\n      });\r\n\r\n      logger.info(`Countdown started: ${seconds} seconds`);\r\n    } catch (error) {\r\n      logger.error('Failed to start countdown:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to countdown (synchronized across all clients)\r\n   */\r\n  listenToCountdown(roomId: string, callback: (countdown: { remaining: number; isActive: boolean } | null) => void) {\r\n    const countdownRef = ref(rtdb, `rooms/${roomId}/countdown`);\r\n    \r\n    const unsubscribe = onValue(countdownRef, (snapshot) => {\r\n      const data = snapshot.val();\r\n      if (data) {\r\n        logger.debug('Countdown updated:', data);\r\n        callback(data);\r\n      } else {\r\n        callback(null);\r\n      }\r\n    }, (error) => {\r\n      logger.error('Countdown listener error:', error);\r\n    });\r\n\r\n    const listenerKey = `countdown_${roomId}`;\r\n    this.listeners.set(listenerKey, { ref: countdownRef, unsubscribe });\r\n    \r\n    return () => {\r\n      off(countdownRef);\r\n      this.listeners.delete(listenerKey);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Cancel countdown\r\n   */\r\n  async cancelCountdown(roomId: string) {\r\n    try {\r\n      const countdownRef = ref(rtdb, `rooms/${roomId}/countdown`);\r\n      await remove(countdownRef);\r\n      \r\n      logger.info('Countdown cancelled');\r\n    } catch (error) {\r\n      logger.error('Failed to cancel countdown:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set game status (waiting, starting, playing, finished)\r\n   */\r\n  async setGameStatus(roomId: string, status: 'waiting' | 'starting' | 'playing' | 'finished') {\r\n    try {\r\n      const statusRef = ref(rtdb, `rooms/${roomId}/gameStatus`);\r\n      \r\n      await set(statusRef, {\r\n        status,\r\n        updatedAt: Date.now(),\r\n      });\r\n\r\n      logger.info(`Game status updated: ${status}`);\r\n    } catch (error) {\r\n      logger.error('Failed to update game status:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Listen to game status changes\r\n   */\r\n  listenToGameStatus(roomId: string, callback: (status: string) => void) {\r\n    const statusRef = ref(rtdb, `rooms/${roomId}/gameStatus/status`);\r\n    \r\n    const unsubscribe = onValue(statusRef, (snapshot) => {\r\n      const status = snapshot.val();\r\n      if (status) {\r\n        logger.debug(`Game status changed: ${status}`);\r\n        callback(status);\r\n      }\r\n    }, (error) => {\r\n      logger.error('Game status listener error:', error);\r\n    });\r\n\r\n    const listenerKey = `gameStatus_${roomId}`;\r\n    this.listeners.set(listenerKey, { ref: statusRef, unsubscribe });\r\n    \r\n    return () => {\r\n      off(statusRef);\r\n      this.listeners.delete(listenerKey);\r\n    };\r\n  }\r\n}\r\n\r\nexport default new RealtimeMultiplayerService();\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\types\\index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2480,2483],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2480,2483],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2851,2854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2851,2854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Question } from '../../quiz/types';\r\n\r\nexport interface Player {\r\n  id: string;\r\n  name: string;\r\n  avatar?: string;\r\n  isReady: boolean;\r\n  score: number;\r\n  joinedAt: number;\r\n}\r\n\r\nexport interface MultiplayerRoom {\r\n  id: string;\r\n  // Removed hostId - all players are equal\r\n  quiz: {\r\n    id: string;\r\n    title: string;\r\n    questions: Question[];\r\n  };\r\n  players: Player[];\r\n  settings: {\r\n    maxPlayers: number;\r\n    questionTimeLimit: number;\r\n    showLeaderboard: boolean;\r\n    allowSpectators: boolean;\r\n  };\r\n  status: 'waiting' | 'starting' | 'playing' | 'finished';\r\n  currentQuestion?: number;\r\n  questionAnswers?: {\r\n    [questionIndex: number]: {\r\n      [playerId: string]: {\r\n        answer: string;\r\n        timeToAnswer: number;\r\n        pointsEarned: number;\r\n        isCorrect: boolean;\r\n        timestamp: number;\r\n      };\r\n    };\r\n  };\r\n  createdAt: number;\r\n  startedAt?: number;\r\n  finishedAt?: number;\r\n}\r\n\r\nexport interface GameAnswer {\r\n  playerId: string;\r\n  playerName: string;\r\n  answer: string;\r\n  timeToAnswer: number;\r\n  pointsEarned: number;\r\n  isCorrect: boolean;\r\n  timestamp: number;\r\n}\r\n\r\nexport interface QuestionResult {\r\n  questionIndex: number;\r\n  question: Question;\r\n  answers: GameAnswer[];\r\n  correctAnswer: string;\r\n  totalAnswers: number;\r\n}\r\n\r\nexport interface GameStatistics {\r\n  totalPlayers: number;\r\n  totalQuestions: number;\r\n  averageScore: number;\r\n  topScore: number;\r\n  fastestAnswer: number;\r\n  completionRate: number;\r\n}\r\n\r\nexport interface RoomSettings {\r\n  maxPlayers: number;\r\n  questionTimeLimit: number;\r\n  showLeaderboard: boolean;\r\n  allowSpectators: boolean;\r\n  enableChat?: boolean;\r\n  autoAdvanceTime?: number;\r\n}\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  playerId: string;\r\n  playerName: string;\r\n  message: string;\r\n  timestamp: number;\r\n  type: 'message' | 'system' | 'emoji';\r\n}\r\n\r\nexport interface PlayerStats {\r\n  playerId: string;\r\n  playerName: string;\r\n  totalScore: number;\r\n  correctAnswers: number;\r\n  averageTimePerAnswer: number;\r\n  streak: number;\r\n  rank: number;\r\n}\r\n\r\nexport interface LeaderboardEntry {\r\n  playerId: string;\r\n  playerName: string;\r\n  score: number;\r\n  correctAnswers: number;\r\n  totalQuestions: number;\r\n  averageTime: number;\r\n  rank: number;\r\n  avatar?: string;\r\n}\r\n\r\n// Real-time events\r\nexport interface MultiplayerEvent {\r\n  type: 'player_joined' | 'player_left' | 'game_started' | 'question_changed' | 'game_finished' | 'chat_message';\r\n  data: any;\r\n  timestamp: number;\r\n}\r\n\r\n// Room creation data\r\nexport interface CreateRoomData {\r\n  quizId: string;\r\n  settings: RoomSettings;\r\n  isPrivate?: boolean;\r\n}\r\n\r\n// Join room data\r\nexport interface JoinRoomData {\r\n  roomId: string;\r\n  playerName: string;\r\n  avatar?: string;\r\n}\r\n\r\nexport interface MultiplayerError {\r\n  code: string;\r\n  message: string;\r\n  details?: any;\r\n}\r\n\r\n// Additional types for better type safety\r\nexport interface Quiz {\r\n  id: string;\r\n  title: string;\r\n  description?: string;\r\n  questions: Question[];\r\n  category?: string;\r\n  difficulty?: 'easy' | 'medium' | 'hard';\r\n  createdBy?: string;\r\n  createdAt?: Date;\r\n}\r\n\r\nexport interface RoomConfig {\r\n  name: string;\r\n  maxPlayers: number;\r\n  isPrivate: boolean;\r\n  password?: string;\r\n  settings: {\r\n    timePerQuestion: number;\r\n    showLeaderboard: boolean;\r\n    showAnswers?: boolean;\r\n    allowLateJoin: boolean;\r\n    autoStart?: boolean;\r\n  };\r\n}\r\n\r\nexport interface PlayerResult {\r\n  playerId: string;\r\n  playerName: string;\r\n  isCorrect: boolean;\r\n  selectedAnswer: number | null;\r\n  points: number;\r\n  timeSpent: number;\r\n}\r\n\r\nexport interface GameResults {\r\n  roomId: string;\r\n  quizId: string;\r\n  players: PlayerStats[];\r\n  gameStats: GameStatistics;\r\n  completedAt: Date;\r\n}\r\n\r\nexport interface GameData {\r\n  questions: Question[];\r\n  currentQuestionIndex: number;\r\n  questionStartTime: number;\r\n  questionEndTime: number;\r\n  serverTimeOffset: number;\r\n}","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\multiplayer\\utils\\logger.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[294,297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[294,297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[441,444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[441,444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[592,595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[592,595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[744,747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[744,747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[907,910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[907,910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1062,1065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1062,1065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Multiplayer Logging Utility\r\n * Environment-based logging that only works in development\r\n */\r\n\r\nconst isDevelopment = import.meta.env.DEV || import.meta.env.MODE === 'development';\r\n\r\nclass MultiplayerLogger {\r\n  private prefix = 'üéÆ [Multiplayer]';\r\n\r\n  log(message: string, ...args: any[]): void {\r\n    if (isDevelopment) {\r\n      console.log(`${this.prefix} ${message}`, ...args);\r\n    }\r\n  }\r\n\r\n  info(message: string, ...args: any[]): void {\r\n    if (isDevelopment) {\r\n      console.info(`${this.prefix} ‚ÑπÔ∏è ${message}`, ...args);\r\n    }\r\n  }\r\n\r\n  warn(message: string, ...args: any[]): void {\r\n    if (isDevelopment) {\r\n      console.warn(`${this.prefix} ‚ö†Ô∏è ${message}`, ...args);\r\n    }\r\n  }\r\n\r\n  error(message: string, ...args: any[]): void {\r\n    // Always log errors, even in production\r\n    console.error(`${this.prefix} ‚ùå ${message}`, ...args);\r\n  }\r\n\r\n  debug(message: string, ...args: any[]): void {\r\n    if (isDevelopment) {\r\n      console.debug(`${this.prefix} üîç ${message}`, ...args);\r\n    }\r\n  }\r\n\r\n  success(message: string, ...args: any[]): void {\r\n    if (isDevelopment) {\r\n      console.log(`${this.prefix} ‚úÖ ${message}`, ...args);\r\n    }\r\n  }\r\n}\r\n\r\nexport const logger = new MultiplayerLogger();\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\api\\admin.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[532,535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[532,535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[538,541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[538,541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ...API admin, gi·ªØ nguy√™n v·ªã tr√≠ chu·∫©n h√≥a...\r\n// ...existing code...\r\n// ...existing code...\r\nimport {\r\n  collection,\r\n  getDocs,\r\n  query,\r\n  where,\r\n  orderBy,\r\n  limit,\r\n  startAfter,\r\n  DocumentSnapshot,\r\n} from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { Quiz, QuizFilters } from '../types';\r\nimport { QUIZZES_COLLECTION } from './base';\r\nimport { applyQuizFilters } from './shared';\r\n\r\n/**\r\n * Convert Firestore Timestamp fields to ISO strings\r\n */\r\nconst convertTimestamps = (data: any): any => {\r\n  const converted = { ...data };\r\n  \r\n  // Convert common timestamp fields\r\n  const timestampFields = ['createdAt', 'updatedAt', 'submittedAt', 'completedAt', 'approvedAt'];\r\n  \r\n  timestampFields.forEach(field => {\r\n    if (converted[field]) {\r\n      if (converted[field]?.toDate) {\r\n        // Firestore Timestamp\r\n        converted[field] = converted[field].toDate().toISOString();\r\n      } else if (converted[field] instanceof Date) {\r\n        // JavaScript Date\r\n        converted[field] = converted[field].toISOString();\r\n      } else if (typeof converted[field] !== 'string') {\r\n        // Other types, convert to empty string\r\n        converted[field] = '';\r\n      }\r\n    }\r\n  });\r\n  \r\n  return converted;\r\n};\r\n\r\n/**\r\n * Get quizzes for ADMIN role - can see ALL quizzes\r\n */\r\nexport const getAdminQuizzes = async (\r\n  filters?: QuizFilters, \r\n  pageSize = 20, \r\n  lastDoc?: DocumentSnapshot\r\n): Promise<{\r\n  quizzes: Quiz[];\r\n  lastDoc: DocumentSnapshot | null;\r\n  hasMore: boolean;\r\n}> => {\r\n  try {\r\n    console.log('üîç [ADMIN] Fetching ALL quizzes from Firestore...');\r\n    \r\n    let q = query(collection(db, QUIZZES_COLLECTION));\r\n    q = query(q, orderBy('createdAt', 'desc'), limit(pageSize || 50));\r\n\r\n    if (lastDoc) {\r\n      q = query(q, startAfter(lastDoc));\r\n    }\r\n\r\n    const querySnapshot = await getDocs(q);\r\n    const quizzes: Quiz[] = [];\r\n    let lastDocument: DocumentSnapshot | null = null;\r\n\r\n    console.log('üìù [ADMIN] Found', querySnapshot.size, 'quiz documents');\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const quizData = doc.data();\r\n      const convertedData = convertTimestamps(quizData);\r\n      console.log('üìù [ADMIN] Quiz data:', doc.id, {\r\n        title: convertedData.title,\r\n        status: convertedData.status,\r\n        isPublished: convertedData.isPublished,\r\n        createdBy: convertedData.createdBy\r\n      });\r\n      quizzes.push({\r\n        id: doc.id,\r\n        ...convertedData,\r\n      } as Quiz);\r\n      lastDocument = doc;\r\n    });\r\n\r\n    console.log('‚úÖ [ADMIN] Total quizzes before filtering:', quizzes.length);\r\n\r\n    // Admin sees ALL quizzes - no role-based filtering\r\n    let filteredQuizzes = quizzes;\r\n\r\n    // Apply client-side filters only\r\n    filteredQuizzes = applyQuizFilters(filteredQuizzes, filters);\r\n\r\n    console.log('‚úÖ [ADMIN] Returning', filteredQuizzes.length, 'filtered quizzes');\r\n\r\n    return {\r\n      quizzes: filteredQuizzes,\r\n      lastDoc: lastDocument,\r\n      hasMore: querySnapshot.size === pageSize,\r\n    };\r\n  } catch (error) {\r\n    console.error('‚ùå [ADMIN] Error fetching quizzes:', error);\r\n    throw new Error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch quiz');\r\n  }\r\n};\r\n\r\n/**\r\n * Get quizzes created by a specific user (Admin function)\r\n */\r\nexport const getUserQuizzesAdmin = async (userId: string): Promise<Quiz[]> => {\r\n  try {\r\n    console.log('üîç [ADMIN] Fetching quizzes for user:', userId);\r\n    \r\n    const q = query(\r\n      collection(db, QUIZZES_COLLECTION),\r\n      where('createdBy', '==', userId),\r\n      orderBy('createdAt', 'desc')\r\n    );\r\n\r\n    const querySnapshot = await getDocs(q);\r\n    const quizzes: Quiz[] = [];\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const quizData = doc.data();\r\n      const convertedData = convertTimestamps(quizData);\r\n      quizzes.push({ id: doc.id, ...convertedData } as Quiz);\r\n    });\r\n\r\n    console.log('‚úÖ [ADMIN] Found', quizzes.length, 'quizzes for user:', userId);\r\n    return quizzes;\r\n  } catch (error) {\r\n    console.error('‚ùå [ADMIN] Error fetching user quizzes:', error);\r\n    throw new Error('Kh√¥ng th·ªÉ t·∫£i quiz c·ªßa ng∆∞·ªùi d√πng');\r\n  }\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\api\\ai.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[153,156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[153,156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Placeholder API functions for AI integration\r\n// This file is kept for backward compatibility\r\n\r\nexport const generateQuestionsWithAI = async (_data: any) => {\r\n  throw new Error('This function is deprecated. Use ClientSideAIGenerator instead.');\r\n};\r\n\r\nexport const testAIConnection = async () => {\r\n  throw new Error('This function is deprecated. Use ClientSideAIGenerator instead.');\r\n};","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\api\\base.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[496,499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[496,499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[502,505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[502,505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4010,4013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4010,4013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":245,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7955,7958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7955,7958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":246,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7993,7996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7993,7996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":247,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":247,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8028,8031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8028,8031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  collection,\r\n  doc,\r\n  addDoc,\r\n  updateDoc,\r\n  deleteDoc,\r\n  getDoc,\r\n  getDocs,\r\n  query,\r\n  where,\r\n  orderBy,\r\n} from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { Quiz, QuizResult } from '../types';\r\nimport { toast } from 'react-toastify';\r\n\r\nconst QUIZZES_COLLECTION = 'quizzes';\r\nconst QUIZ_RESULTS_COLLECTION = 'quizResults';\r\n\r\n/**\r\n * Convert Firestore Timestamp fields to ISO strings (recursive)\r\n */\r\nconst convertTimestamps = (data: any): any => {\r\n  if (!data || typeof data !== 'object') {\r\n    return data;\r\n  }\r\n\r\n  // Handle arrays\r\n  if (Array.isArray(data)) {\r\n    return data.map(item => convertTimestamps(item));\r\n  }\r\n\r\n  const converted = { ...data };\r\n  \r\n  // Convert all fields recursively\r\n  Object.keys(converted).forEach(key => {\r\n    const value = converted[key];\r\n    \r\n    if (value && typeof value === 'object') {\r\n      // Check if it's a Firestore Timestamp\r\n      if (value.toDate && typeof value.toDate === 'function') {\r\n        // Firestore Timestamp\r\n        converted[key] = value.toDate().toISOString();\r\n      } else if (value instanceof Date) {\r\n        // JavaScript Date\r\n        converted[key] = value.toISOString();\r\n      } else if (Array.isArray(value)) {\r\n        // Recursively handle arrays\r\n        converted[key] = value.map(item => convertTimestamps(item));\r\n      } else {\r\n        // Recursively handle nested objects\r\n        converted[key] = convertTimestamps(value);\r\n      }\r\n    }\r\n  });\r\n  \r\n  return converted;\r\n};\r\n\r\n/**\r\n * Create a new quiz\r\n */\r\nexport const createQuiz = async (quizData: Omit<Quiz, 'id' | 'createdAt' | 'updatedAt'>): Promise<string> => {\r\n  try {\r\n    const quiz: Omit<Quiz, 'id'> = {\r\n      ...quizData,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n    };\r\n\r\n    const docRef = await addDoc(collection(db, QUIZZES_COLLECTION), quiz);\r\n    toast.success('T·∫°o quiz th√†nh c√¥ng!');\r\n    return docRef.id;\r\n  } catch (error) {\r\n    console.error('Error creating quiz:', error);\r\n    toast.error('Kh√¥ng th·ªÉ t·∫°o quiz');\r\n    throw new Error('Kh√¥ng th·ªÉ t·∫°o quiz');\r\n  }\r\n};\r\n\r\n/**\r\n * Update an existing quiz\r\n */\r\nexport const updateQuiz = async (quizId: string, updates: Partial<Quiz>): Promise<void> => {\r\n  try {\r\n    const quizRef = doc(db, QUIZZES_COLLECTION, quizId);\r\n    await updateDoc(quizRef, {\r\n      ...updates,\r\n      updatedAt: new Date(),\r\n    });\r\n    toast.success('C·∫≠p nh·∫≠t quiz th√†nh c√¥ng!');\r\n  } catch (error) {\r\n    console.error('Error updating quiz:', error);\r\n    toast.error('Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t quiz');\r\n    throw new Error('Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t quiz');\r\n  }\r\n};\r\n\r\n/**\r\n * Delete a quiz\r\n */\r\nexport const deleteQuiz = async (quizId: string): Promise<void> => {\r\n  try {\r\n    await deleteDoc(doc(db, QUIZZES_COLLECTION, quizId));\r\n    toast.success('X√≥a quiz th√†nh c√¥ng!');\r\n  } catch (error) {\r\n    console.error('Error deleting quiz:', error);\r\n    toast.error('Kh√¥ng th·ªÉ x√≥a quiz');\r\n    throw new Error('Kh√¥ng th·ªÉ x√≥a quiz');\r\n  }\r\n};\r\n\r\n/**\r\n * Get quiz by ID\r\n */\r\nexport const getQuizById = async (quizId: string): Promise<Quiz | null> => {\r\n  try {\r\n    const quizDoc = await getDoc(doc(db, QUIZZES_COLLECTION, quizId));\r\n    if (quizDoc.exists()) {\r\n      const data = quizDoc.data();\r\n      const convertedData = convertTimestamps(data);\r\n      return {\r\n        id: quizDoc.id,\r\n        ...convertedData,\r\n      } as Quiz;\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error('Error fetching quiz:', error);\r\n    throw new Error('Kh√¥ng th·ªÉ t·∫£i quiz');\r\n  }\r\n};\r\n\r\n/**\r\n * Submit quiz result\r\n */\r\nexport const submitQuizResult = async (result: Omit<QuizResult, 'id'>): Promise<string> => {\r\n  console.log('üîç [submitQuizResult] Input data:', result);\r\n  \r\n  // Enhanced validation for all required fields\r\n  const requiredFields = ['userId', 'quizId', 'score', 'correctAnswers', 'totalQuestions', 'answers', 'completedAt'];\r\n  const missingFields = requiredFields.filter(field => {\r\n    const value = (result as any)[field];\r\n    if (field === 'answers') return !Array.isArray(value);\r\n    if (field === 'completedAt') return !value;\r\n    if (['score', 'correctAnswers', 'totalQuestions'].includes(field)) {\r\n      return typeof value !== 'number' || isNaN(value);\r\n    }\r\n    return !value;\r\n  });\r\n\r\n  if (missingFields.length > 0) {\r\n    console.error('‚ùå [submitQuizResult] Missing required fields:', missingFields, result);\r\n    throw new Error(`Thi·∫øu tr∆∞·ªùng b·∫Øt bu·ªôc: ${missingFields.join(', ')}`);\r\n  }\r\n\r\n  // Validate score range\r\n  if (result.score < 0 || result.score > 100) {\r\n    console.error('‚ùå [submitQuizResult] Invalid score range:', result.score);\r\n    throw new Error('ƒêi·ªÉm s·ªë ph·∫£i trong kho·∫£ng 0-100');\r\n  }\r\n\r\n  // Validate correctAnswers vs totalQuestions\r\n  if (result.correctAnswers > result.totalQuestions) {\r\n    console.error('‚ùå [submitQuizResult] correctAnswers > totalQuestions:', { \r\n      correctAnswers: result.correctAnswers, \r\n      totalQuestions: result.totalQuestions \r\n    });\r\n    throw new Error('S·ªë c√¢u ƒë√∫ng kh√¥ng th·ªÉ l·ªõn h∆°n t·ªïng s·ªë c√¢u');\r\n  }\r\n\r\n  // Validate answers array has isCorrect field\r\n  const answersWithoutCorrect = result.answers.filter(a => typeof a.isCorrect !== 'boolean');\r\n  if (answersWithoutCorrect.length > 0) {\r\n    console.warn('‚ö†Ô∏è [submitQuizResult] Some answers missing isCorrect field:', answersWithoutCorrect.length);\r\n  }\r\n  \r\n  console.log('‚úÖ [submitQuizResult] All validations passed, saving to Firestore...');\r\n  console.log('üìä [submitQuizResult] Final data to save:', {\r\n    userId: result.userId,\r\n    quizId: result.quizId,\r\n    score: result.score,\r\n    correctAnswers: result.correctAnswers,\r\n    totalQuestions: result.totalQuestions,\r\n    answersCount: result.answers.length,\r\n    answersWithCorrect: result.answers.filter(a => a.isCorrect).length\r\n  });\r\n  \r\n  try {\r\n    const docRef = await addDoc(collection(db, QUIZ_RESULTS_COLLECTION), result);\r\n    console.log('‚úÖ [submitQuizResult] Successfully saved with ID:', docRef.id);\r\n    toast.success('N·ªôp b√†i th√†nh c√¥ng!');\r\n    return docRef.id;\r\n  } catch (error) {\r\n    console.error('‚ùå [submitQuizResult] Firestore error:', error);\r\n    console.error('‚ùå [submitQuizResult] Data that failed to save:', result);\r\n    toast.error('Kh√¥ng th·ªÉ l∆∞u k·∫øt qu·∫£ quiz');\r\n    throw new Error('Kh√¥ng th·ªÉ l∆∞u k·∫øt qu·∫£ quiz');\r\n  }\r\n};\r\n\r\n/**\r\n * Get quiz results for a specific quiz\r\n */\r\nexport const getQuizResults = async (quizId: string): Promise<QuizResult[]> => {\r\n  try {\r\n    console.log('üîç getQuizResults called for quizId:', quizId);\r\n    console.log('üîç Collection name:', QUIZ_RESULTS_COLLECTION);\r\n    \r\n    const q = query(\r\n      collection(db, QUIZ_RESULTS_COLLECTION),\r\n      where('quizId', '==', quizId),\r\n      orderBy('completedAt', 'desc')\r\n    );\r\n\r\n    console.log('üîç Executing Firestore query...');\r\n    const querySnapshot = await getDocs(q);\r\n    const results: QuizResult[] = [];\r\n    \r\n    console.log('üìä Found', querySnapshot.size, 'quiz results');\r\n\r\n    if (querySnapshot.empty) {\r\n      console.log('üìä No quiz results found for quizId:', quizId);\r\n      console.log('üìä This could mean:');\r\n      console.log('   - No one has completed this quiz yet');\r\n      console.log('   - The quizId is incorrect');\r\n      console.log('   - There are Firestore permission issues');\r\n      return [];\r\n    }\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const data = doc.data();\r\n      console.log('üìä Raw document data:', { id: doc.id, ...data });\r\n      const convertedData = convertTimestamps(data);\r\n      const result = { id: doc.id, ...convertedData } as QuizResult;\r\n      console.log('üìä Converted quiz result:', result);\r\n      results.push(result);\r\n    });\r\n    \r\n    console.log('üìä Returning', results.length, 'quiz results');\r\n    return results;\r\n  } catch (error) {\r\n    console.error('‚ùå Error fetching quiz results:', error);\r\n    console.error('‚ùå Error details:', {\r\n      message: (error as any)?.message,\r\n      code: (error as any)?.code,\r\n      name: (error as any)?.name\r\n    });\r\n    throw new Error('Kh√¥ng th·ªÉ t·∫£i k·∫øt qu·∫£ quiz');\r\n  }\r\n};\r\n\r\n/**\r\n * Get quiz result by ID\r\n */\r\nexport async function getQuizResultById(attemptId: string) {\r\n  console.log('üîç [getQuizResultById] Fetching result for ID:', attemptId);\r\n  \r\n  try {\r\n    const docRef = doc(db, QUIZ_RESULTS_COLLECTION, attemptId);\r\n    const docSnap = await getDoc(docRef);\r\n    \r\n    if (docSnap.exists()) {\r\n      const data = docSnap.data();\r\n      console.log('‚úÖ [getQuizResultById] Raw Firestore data:', data);\r\n      \r\n      const convertedData = convertTimestamps(data);\r\n      const result = { id: docSnap.id, ...convertedData };\r\n      \r\n      console.log('‚úÖ [getQuizResultById] Converted data:', result);\r\n      console.log('üìä [getQuizResultById] Key fields:', {\r\n        score: result.score,\r\n        correctAnswers: result.correctAnswers,\r\n        totalQuestions: result.totalQuestions,\r\n        answersCount: result.answers?.length,\r\n        userId: result.userId,\r\n        quizId: result.quizId\r\n      });\r\n      \r\n      return result;\r\n    } else {\r\n      console.warn('‚ùå [getQuizResultById] No document found for ID:', attemptId);\r\n      return null;\r\n    }\r\n  } catch (error) {\r\n    console.error('‚ùå [getQuizResultById] Error fetching document:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Export collection names for other modules\r\nexport { QUIZZES_COLLECTION, QUIZ_RESULTS_COLLECTION };\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\api\\creator.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[435,438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[435,438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[441,444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[441,444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  collection,\r\n  getDocs,\r\n  query,\r\n  where,\r\n  orderBy,\r\n  limit,\r\n  startAfter,\r\n  DocumentSnapshot,\r\n} from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { Quiz, QuizFilters } from '../types';\r\nimport { QUIZZES_COLLECTION } from './base';\r\nimport { applyQuizFilters } from './shared';\r\n\r\n/**\r\n * Convert Firestore Timestamp fields to ISO strings\r\n */\r\nconst convertTimestamps = (data: any): any => {\r\n  const converted = { ...data };\r\n  \r\n  // Convert common timestamp fields\r\n  const timestampFields = ['createdAt', 'updatedAt', 'submittedAt', 'completedAt', 'approvedAt'];\r\n  \r\n  timestampFields.forEach(field => {\r\n    if (converted[field]) {\r\n      if (converted[field]?.toDate) {\r\n        // Firestore Timestamp\r\n        converted[field] = converted[field].toDate().toISOString();\r\n      } else if (converted[field] instanceof Date) {\r\n        // JavaScript Date\r\n        converted[field] = converted[field].toISOString();\r\n      } else if (typeof converted[field] !== 'string') {\r\n        // Other types, convert to empty string\r\n        converted[field] = '';\r\n      }\r\n    }\r\n  });\r\n  \r\n  return converted;\r\n};\r\n\r\n/**\r\n * Get quizzes for CREATOR role - can see own quizzes + approved published quizzes\r\n */\r\nexport const getCreatorQuizzes = async (\r\n  userId: string,\r\n  filters?: QuizFilters, \r\n  pageSize = 20, \r\n  lastDoc?: DocumentSnapshot\r\n): Promise<{\r\n  quizzes: Quiz[];\r\n  lastDoc: DocumentSnapshot | null;\r\n  hasMore: boolean;\r\n}> => {\r\n  try {\r\n    console.log('üîç [CREATOR] Fetching quizzes for creator:', userId);\r\n    \r\n    let q = query(collection(db, QUIZZES_COLLECTION));\r\n    q = query(q, orderBy('createdAt', 'desc'), limit(pageSize || 50));\r\n\r\n    if (lastDoc) {\r\n      q = query(q, startAfter(lastDoc));\r\n    }\r\n\r\n    const querySnapshot = await getDocs(q);\r\n    const allQuizzes: Quiz[] = [];\r\n    let lastDocument: DocumentSnapshot | null = null;\r\n\r\n    console.log('üìù [CREATOR] Found', querySnapshot.size, 'quiz documents');\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const quizData = doc.data();\r\n      const convertedData = convertTimestamps(quizData);\r\n      allQuizzes.push({ id: doc.id, ...convertedData } as Quiz);\r\n      lastDocument = doc;\r\n    });\r\n\r\n    // Filter quizzes for creator:\r\n    // 1. Own quizzes (regardless of status)\r\n    // 2. Other's approved and published quizzes\r\n    const filteredQuizzes = allQuizzes.filter(quiz => {\r\n      // Own quiz - always show\r\n      if (quiz.createdBy === userId) {\r\n        console.log('üìù [CREATOR] Own quiz:', quiz.title, 'Status:', quiz.status);\r\n        return true;\r\n      }\r\n      \r\n      // Other's quiz - must be approved and published\r\n      if (quiz.status === 'approved' && quiz.isPublished === true) {\r\n        console.log('üìù [CREATOR] Approved quiz:', quiz.title);\r\n        return true;\r\n      }\r\n      \r\n      console.log('üìù [CREATOR] Filtered out quiz:', quiz.title, 'Status:', quiz.status, 'Published:', quiz.isPublished);\r\n      return false;\r\n    });\r\n\r\n    console.log('‚úÖ [CREATOR] Filtered quizzes:', {\r\n      total: allQuizzes.length,\r\n      creatorVisible: filteredQuizzes.length,\r\n      ownQuizzes: filteredQuizzes.filter(q => q.createdBy === userId).length,\r\n      approvedQuizzes: filteredQuizzes.filter(q => q.createdBy !== userId).length\r\n    });\r\n\r\n    // Apply client-side filters\r\n    const finalQuizzes = applyQuizFilters(filteredQuizzes, filters);\r\n\r\n    console.log('‚úÖ [CREATOR] Returning', finalQuizzes.length, 'quizzes after filters');\r\n\r\n    return {\r\n      quizzes: finalQuizzes,\r\n      lastDoc: lastDocument,\r\n      hasMore: querySnapshot.size === pageSize,\r\n    };\r\n  } catch (error) {\r\n    console.error('‚ùå [CREATOR] Error fetching quizzes:', error);\r\n    throw new Error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch quiz');\r\n  }\r\n};\r\n\r\n/**\r\n * Get quizzes created by a specific creator\r\n */\r\nexport const getCreatorOwnQuizzes = async (userId: string): Promise<Quiz[]> => {\r\n  try {\r\n    console.log('üîç [CREATOR] Fetching own quizzes for:', userId);\r\n    \r\n    const q = query(\r\n      collection(db, QUIZZES_COLLECTION),\r\n      where('createdBy', '==', userId),\r\n      orderBy('createdAt', 'desc')\r\n    );\r\n\r\n    const querySnapshot = await getDocs(q);\r\n    const quizzes: Quiz[] = [];\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const quizData = doc.data();\r\n      const convertedData = convertTimestamps(quizData);\r\n      console.log('üìù [CREATOR] Own quiz:', doc.id, convertedData.title, 'Status:', convertedData.status);\r\n      quizzes.push({\r\n        id: doc.id,\r\n        ...convertedData,\r\n      } as Quiz);\r\n    });\r\n\r\n    console.log('‚úÖ [CREATOR] Found', quizzes.length, 'own quizzes');\r\n    return quizzes;\r\n  } catch (error) {\r\n    console.error('‚ùå [CREATOR] Error fetching own quizzes:', error);\r\n    throw new Error('Kh√¥ng th·ªÉ t·∫£i quiz c·ªßa ng∆∞·ªùi d√πng');\r\n  }\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\api\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\api\\shared.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1200,1203],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1200,1203],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1799,1802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1799,1802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  collection,\r\n  getDocs,\r\n  query,\r\n  where,\r\n  orderBy,\r\n  limit,\r\n} from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { Quiz, QuizResult, QuizFilters } from '../types';\r\nimport { QUIZZES_COLLECTION, QUIZ_RESULTS_COLLECTION } from './base';\r\n\r\n/**\r\n * Get user's quiz results\r\n */\r\nexport const getUserQuizResults = async (userId: string): Promise<QuizResult[]> => {\r\n  try {\r\n    const q = query(\r\n      collection(db, QUIZ_RESULTS_COLLECTION),\r\n      where('userId', '==', userId),\r\n      orderBy('completedAt', 'desc')\r\n    );\r\n\r\n    const querySnapshot = await getDocs(q);\r\n    const results: QuizResult[] = [];\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const data = doc.data();\r\n      console.log('üîç Raw Firestore data for result:', doc.id, data);\r\n      \r\n      const result = {\r\n        id: doc.id,\r\n        ...data,\r\n        completedAt: data.completedAt?.toDate\r\n          ? data.completedAt.toDate().toISOString()\r\n          : (data.completedAt instanceof Date\r\n              ? data.completedAt.toISOString()\r\n              : typeof data.completedAt === 'string'\r\n                ? data.completedAt\r\n                : ''),\r\n      } as any;\r\n\r\n      // Validate and fix score data for legacy results\r\n      const hasValidCorrectAnswers = typeof result.correctAnswers === 'number';\r\n      const hasValidTotalQuestions = typeof result.totalQuestions === 'number' && result.totalQuestions > 0;\r\n      const hasValidScore = typeof result.score === 'number' && !isNaN(result.score);\r\n\r\n      // If missing critical fields but has answers, compute them\r\n      if ((!hasValidCorrectAnswers || !hasValidTotalQuestions) && Array.isArray(result.answers) && result.answers.length > 0) {\r\n        const computedCorrect = result.answers.filter((a: any) => a && a.isCorrect === true).length;\r\n        const computedTotal = result.answers.length;\r\n        \r\n        if (!hasValidCorrectAnswers) {\r\n          result.correctAnswers = computedCorrect;\r\n        }\r\n        if (!hasValidTotalQuestions) {\r\n          result.totalQuestions = computedTotal;\r\n        }\r\n        \r\n        // Recompute score if missing or zero\r\n        if (!hasValidScore || result.score === 0) {\r\n          result.score = result.totalQuestions > 0 ? Math.round((result.correctAnswers / result.totalQuestions) * 100) : 0;\r\n        }\r\n        \r\n        console.log('üõ†Ô∏è Hydrated legacy result:', { \r\n          id: result.id, \r\n          correctAnswers: result.correctAnswers, \r\n          totalQuestions: result.totalQuestions, \r\n          score: result.score,\r\n          computedFromAnswers: true\r\n        });\r\n      }\r\n\r\n      results.push(result as QuizResult);\r\n    });\r\n\r\n    return results;\r\n  } catch (error) {\r\n    console.error('Error fetching user quiz results:', error);\r\n    throw new Error('Kh√¥ng th·ªÉ t·∫£i k·∫øt qu·∫£ quiz');\r\n  }\r\n};\r\n\r\n/**\r\n * Get quiz categories (from existing quizzes)\r\n */\r\nexport const getQuizCategories = async (): Promise<string[]> => {\r\n  try {\r\n    const q = query(collection(db, QUIZZES_COLLECTION), where('isPublished', '==', true));\r\n    const querySnapshot = await getDocs(q);\r\n    \r\n    const categories = new Set<string>();\r\n    querySnapshot.forEach((doc) => {\r\n      const quiz = doc.data() as Quiz;\r\n      categories.add(quiz.category);\r\n    });\r\n\r\n    return Array.from(categories).sort();\r\n  } catch (error) {\r\n    console.error('Error fetching quiz categories:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n/**\r\n * Get popular quizzes (most attempts)\r\n */\r\nexport const getPopularQuizzes = async (limitCount = 10): Promise<Quiz[]> => {\r\n  try {\r\n    // This would require aggregation queries or a separate collection\r\n    // For now, we'll get recent quizzes as a placeholder\r\n    const q = query(\r\n      collection(db, QUIZZES_COLLECTION),\r\n      where('isPublished', '==', true),\r\n      orderBy('createdAt', 'desc'),\r\n      limit(limitCount)\r\n    );\r\n\r\n    const querySnapshot = await getDocs(q);\r\n    const quizzes: Quiz[] = [];\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      quizzes.push({ id: doc.id, ...doc.data() } as Quiz);\r\n    });\r\n\r\n    return quizzes;\r\n  } catch (error) {\r\n    console.error('Error fetching popular quizzes:', error);\r\n    throw new Error('Kh√¥ng th·ªÉ t·∫£i quiz ph·ªï bi·∫øn');\r\n  }\r\n};\r\n\r\n/**\r\n * Search quizzes by title or description\r\n */\r\nexport const searchQuizzes = async (searchTerm: string, limitCount = 20): Promise<Quiz[]> => {\r\n  try {\r\n    // Firestore doesn't support full-text search natively\r\n    // This is a basic implementation - in production, you'd use Algolia or similar\r\n    const q = query(\r\n      collection(db, QUIZZES_COLLECTION),\r\n      where('isPublished', '==', true),\r\n      orderBy('title'),\r\n      limit(limitCount)\r\n    );\r\n\r\n    const querySnapshot = await getDocs(q);\r\n    const quizzes: Quiz[] = [];\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const quiz = { id: doc.id, ...doc.data() } as Quiz;\r\n      const term = searchTerm.toLowerCase();\r\n      \r\n      if (\r\n        quiz.title.toLowerCase().includes(term) ||\r\n        quiz.description.toLowerCase().includes(term) ||\r\n        quiz.category.toLowerCase().includes(term)\r\n      ) {\r\n        quizzes.push(quiz);\r\n      }\r\n    });\r\n\r\n    return quizzes;\r\n  } catch (error) {\r\n    console.error('Error searching quizzes:', error);\r\n    throw new Error('Kh√¥ng th·ªÉ t√¨m ki·∫øm quiz');\r\n  }\r\n};\r\n\r\n/**\r\n * Apply client-side filters to quiz list\r\n */\r\nexport const applyQuizFilters = (quizzes: Quiz[], filters?: QuizFilters): Quiz[] => {\r\n  let filteredQuizzes = [...quizzes];\r\n\r\n  if (filters?.category) {\r\n    filteredQuizzes = filteredQuizzes.filter(quiz => quiz.category === filters.category);\r\n  }\r\n\r\n  if (filters?.difficulty) {\r\n    filteredQuizzes = filteredQuizzes.filter(quiz => quiz.difficulty === filters.difficulty);\r\n  }\r\n\r\n  if (filters?.searchTerm) {\r\n    const searchTerm = filters.searchTerm.toLowerCase();\r\n    filteredQuizzes = filteredQuizzes.filter(\r\n      quiz =>\r\n        quiz.title?.toLowerCase().includes(searchTerm) ||\r\n        quiz.description?.toLowerCase().includes(searchTerm) ||\r\n        quiz.category?.toLowerCase().includes(searchTerm)\r\n    );\r\n  }\r\n\r\n  return filteredQuizzes;\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\api\\user.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[435,438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[435,438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[441,444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[441,444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1539,1542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1539,1542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  collection,\r\n  getDocs,\r\n  query,\r\n  where,\r\n  orderBy,\r\n  limit,\r\n  startAfter,\r\n  DocumentSnapshot,\r\n} from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { Quiz, QuizFilters } from '../types';\r\nimport { QUIZZES_COLLECTION } from './base';\r\nimport { applyQuizFilters } from './shared';\r\n\r\n/**\r\n * Convert Firestore Timestamp fields to ISO strings\r\n */\r\nconst convertTimestamps = (data: any): any => {\r\n  const converted = { ...data };\r\n  \r\n  // Convert common timestamp fields\r\n  const timestampFields = ['createdAt', 'updatedAt', 'submittedAt', 'completedAt', 'approvedAt'];\r\n  \r\n  timestampFields.forEach(field => {\r\n    if (converted[field]) {\r\n      if (converted[field]?.toDate) {\r\n        // Firestore Timestamp\r\n        converted[field] = converted[field].toDate().toISOString();\r\n      } else if (converted[field] instanceof Date) {\r\n        // JavaScript Date\r\n        converted[field] = converted[field].toISOString();\r\n      } else if (typeof converted[field] !== 'string') {\r\n        // Other types, convert to empty string\r\n        converted[field] = '';\r\n      }\r\n    }\r\n  });\r\n  \r\n  return converted;\r\n};\r\n\r\n/**\r\n * Check if Firestore is accessible\r\n */\r\nconst checkFirestoreConnection = async (): Promise<boolean> => {\r\n  try {\r\n    // Simple test query\r\n    const testQuery = query(\r\n      collection(db, QUIZZES_COLLECTION),\r\n      limit(1)\r\n    );\r\n    await getDocs(testQuery);\r\n    console.log('‚úÖ Firestore connection successful');\r\n    return true;\r\n  } catch (error: any) {\r\n    console.error('‚ùå Firestore connection failed:', error);\r\n    \r\n    if (error.code === 'unavailable' || error.message?.includes('ERR_BLOCKED_BY_CLIENT')) {\r\n      console.error('üö´ Firestore b·ªã ch·∫∑n b·ªüi ad blocker ho·∫∑c network. Vui l√≤ng:');\r\n      console.error('   1. T·∫Øt ad blocker cho localhost');\r\n      console.error('   2. Th√™m *.googleapis.com v√†o whitelist');\r\n      console.error('   3. Th·ª≠ ch·∫ø ƒë·ªô Incognito');\r\n    }\r\n    \r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Get quizzes for USER role - can see published quizzes only\r\n */\r\nexport const getUserQuizzes = async (\r\n  filters?: QuizFilters, \r\n  pageSize = 20, \r\n  lastDoc?: DocumentSnapshot\r\n): Promise<{\r\n  quizzes: Quiz[];\r\n  lastDoc: DocumentSnapshot | null;\r\n  hasMore: boolean;\r\n}> => {\r\n  try {\r\n    // Check Firestore connection first\r\n    const isConnected = await checkFirestoreConnection();\r\n    if (!isConnected) {\r\n      throw new Error('Kh√¥ng th·ªÉ k·∫øt n·ªëi Firestore. Vui l√≤ng t·∫Øt ad blocker ho·∫∑c th·ª≠ ch·∫ø ƒë·ªô Incognito.');\r\n    }\r\n\r\n    console.log('üîç [USER] Fetching published quizzes for regular user');\r\n    \r\n    let q = query(collection(db, QUIZZES_COLLECTION));\r\n    q = query(q, orderBy('createdAt', 'desc'), limit(pageSize || 50));\r\n\r\n    if (lastDoc) {\r\n      q = query(q, startAfter(lastDoc));\r\n    }\r\n\r\n    const querySnapshot = await getDocs(q);\r\n    const allQuizzes: Quiz[] = [];\r\n    let lastDocument: DocumentSnapshot | null = null;\r\n\r\n    console.log('üìù [USER] Found', querySnapshot.size, 'quiz documents');\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const quizData = doc.data();\r\n      const convertedData = convertTimestamps(quizData);\r\n      allQuizzes.push({\r\n        id: doc.id,\r\n        ...convertedData,\r\n      } as Quiz);\r\n      lastDocument = doc;\r\n    });\r\n\r\n    // Filter quizzes for regular user:\r\n    // Only approved AND published quizzes\r\n    const filteredQuizzes = allQuizzes.filter(quiz => {\r\n      const isApproved = quiz.status === 'approved';\r\n      const isPublished = quiz.isPublished === true;\r\n      \r\n      if (isApproved && isPublished) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    });\r\n\r\n    console.log('‚úÖ [USER] Filtered quizzes:', {\r\n      total: allQuizzes.length,\r\n      userVisible: filteredQuizzes.length,\r\n      publishedQuizzes: filteredQuizzes.length\r\n    });\r\n\r\n    // Apply client-side filters\r\n    const finalQuizzes = applyQuizFilters(filteredQuizzes, filters);\r\n\r\n    console.log('‚úÖ [USER] Returning', finalQuizzes.length, 'quizzes after filters');\r\n\r\n    return {\r\n      quizzes: finalQuizzes,\r\n      lastDoc: lastDocument,\r\n      hasMore: querySnapshot.size === pageSize,\r\n    };\r\n  } catch (error) {\r\n    console.error('‚ùå [USER] Error fetching quizzes:', error);\r\n    throw new Error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch quiz');\r\n  }\r\n};\r\n\r\n/**\r\n * Get quizzes for anonymous (not logged in) users\r\n */\r\nexport const getAnonymousQuizzes = async (\r\n  filters?: QuizFilters, \r\n  pageSize = 20, \r\n  lastDoc?: DocumentSnapshot\r\n): Promise<{\r\n  quizzes: Quiz[];\r\n  lastDoc: DocumentSnapshot | null;\r\n  hasMore: boolean;\r\n}> => {\r\n  try {\r\n    // Check Firestore connection first\r\n    const isConnected = await checkFirestoreConnection();\r\n    if (!isConnected) {\r\n      throw new Error('Kh√¥ng th·ªÉ k·∫øt n·ªëi Firestore. Vui l√≤ng t·∫Øt ad blocker ho·∫∑c th·ª≠ ch·∫ø ƒë·ªô Incognito.');\r\n    }\r\n\r\n    console.log('üîç [ANONYMOUS] Fetching published quizzes for anonymous user');\r\n    \r\n    // For anonymous users, only show published quizzes (filter by status client-side)\r\n    let q = query(\r\n      collection(db, QUIZZES_COLLECTION),\r\n      where('isPublished', '==', true)\r\n    );\r\n    q = query(q, orderBy('createdAt', 'desc'), limit(pageSize || 50));\r\n\r\n    if (lastDoc) {\r\n      q = query(q, startAfter(lastDoc));\r\n    }\r\n\r\n    const querySnapshot = await getDocs(q);\r\n    const quizzes: Quiz[] = [];\r\n    let lastDocument: DocumentSnapshot | null = null;\r\n\r\n    console.log('üìù [ANONYMOUS] Found', querySnapshot.size, 'published quiz documents');\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const quizData = doc.data();\r\n      const convertedData = convertTimestamps(quizData);\r\n      console.log('üìù [ANONYMOUS] Published quiz:', doc.id, convertedData.title, 'status:', convertedData.status);\r\n      quizzes.push({ id: doc.id, ...convertedData } as Quiz);\r\n      lastDocument = doc;\r\n    });\r\n\r\n    // Filter for anonymous users: only approved quizzes\r\n    const approvedQuizzes = quizzes.filter(quiz => {\r\n      const isApproved = quiz.status === 'approved';\r\n      if (!isApproved) {\r\n        console.log('üö´ [ANONYMOUS] Filtering out quiz:', quiz.id, quiz.title, 'status:', quiz.status);\r\n      }\r\n      return isApproved;\r\n    });\r\n\r\n    console.log('‚úÖ [ANONYMOUS] Approved quizzes:', {\r\n      total: quizzes.length,\r\n      approved: approvedQuizzes.length\r\n    });\r\n\r\n    // Apply client-side filters\r\n    const finalQuizzes = applyQuizFilters(approvedQuizzes, filters);\r\n\r\n    console.log('‚úÖ [ANONYMOUS] Returning', finalQuizzes.length, 'quizzes after filters');\r\n\r\n    return {\r\n      quizzes: finalQuizzes,\r\n      lastDoc: lastDocument,\r\n      hasMore: querySnapshot.size === pageSize,\r\n    };\r\n  } catch (error) {\r\n    console.error('‚ùå [ANONYMOUS] Error fetching quizzes:', error);\r\n    throw new Error('Kh√¥ng th·ªÉ t·∫£i danh s√°ch quiz');\r\n  }\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\GeminiAIQuestionGenerator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\ModernGeminiAIGenerator_new.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\QuestionEditor.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                onClick={handleSave}\r\n                className=\"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors shadow-sm\"\r\n              >\r\n                <Check className=\"w-4 h-4\" />\r\n                Save\r\n              </button>","line":140,"column":46,"nodeType":"JSXText","endLine":142,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                onClick={handleCancel}\r\n                className=\"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-xl hover:bg-gray-600 transition-colors shadow-sm\"\r\n              >\r\n                <X className=\"w-4 h-4\" />\r\n                Cancel\r\n              </button>","line":147,"column":42,"nodeType":"JSXText","endLine":149,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                <Type className=\"w-4 h-4\" />\r\n                Question Text *\r\n              </label>","line":179,"column":45,"nodeType":"JSXText","endLine":181,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                  <List className=\"w-4 h-4\" />\r\n                  Question Type\r\n                </label>","line":195,"column":47,"nodeType":"JSXText","endLine":197,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7279,7282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7279,7282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"multiple\">Multiple Choice</option>","line":203,"column":44,"nodeType":"JSXText","endLine":203,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"boolean\">True/False</option>","line":204,"column":43,"nodeType":"JSXText","endLine":204,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"checkbox\">Checkbox</option>","line":205,"column":44,"nodeType":"JSXText","endLine":205,"endColumn":52},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"short_answer\">Short Answer</option>","line":206,"column":48,"nodeType":"JSXText","endLine":206,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"image\">Image Choice</option>","line":207,"column":41,"nodeType":"JSXText","endLine":207,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                  <Target className=\"w-4 h-4\" />\r\n                  Points\r\n                </label>","line":213,"column":49,"nodeType":"JSXText","endLine":215,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"text-sm font-semibold text-gray-700\">Difficulty</label>","line":227,"column":72,"nodeType":"JSXText","endLine":227,"endColumn":82},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8839,8842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8839,8842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"easy\">üü¢ Easy</option>","line":233,"column":40,"nodeType":"JSXText","endLine":233,"endColumn":47},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"medium\">üü° Medium</option>","line":234,"column":42,"nodeType":"JSXText","endLine":234,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"hard\">üî¥ Hard</option>","line":235,"column":40,"nodeType":"JSXText","endLine":235,"endColumn":47},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                  <List className=\"w-4 h-4\" />\r\n                  Answer Options *\r\n                </label>","line":244,"column":47,"nodeType":"JSXText","endLine":246,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                  onClick={addAnswer}\r\n                  disabled={localQuestion.answers.length >= 6}\r\n                  className=\"flex items-center gap-2 px-3 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors text-sm font-medium disabled:opacity-50\"\r\n                >\r\n                  <Plus className=\"w-4 h-4\" />\r\n                  Add Answer\r\n                </button>","line":252,"column":47,"nodeType":"JSXText","endLine":254,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-green-700\">Correct</span>","line":277,"column":56,"nodeType":"JSXText","endLine":277,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                <Lightbulb className=\"w-4 h-4\" />\r\n                Explanation (Optional)\r\n              </label>","line":295,"column":50,"nodeType":"JSXText","endLine":297,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"flex items-center gap-1\">\r\n                <Target className=\"w-4 h-4\" />\r\n                <strong>{question.points}</strong> points\r\n              </span>","line":341,"column":51,"nodeType":"JSXText","endLine":342,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"flex items-center gap-1\">\r\n                  <Lightbulb className=\"w-4 h-4\" />\r\n                  Has explanation\r\n                </span>","line":352,"column":52,"nodeType":"JSXText","endLine":354,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"flex items-center gap-2 font-semibold text-blue-800 mb-2\">\r\n                  <Lightbulb className=\"w-4 h-4\" />\r\n                  Explanation\r\n                </h5>","line":362,"column":52,"nodeType":"JSXText","endLine":364,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Question } from '../types';\r\nimport { \r\n  Plus, Trash2, Edit3, Check, X, ArrowUp, ArrowDown, \r\n  Lightbulb, Target, Type, List\r\n} from 'lucide-react';\r\nimport SafeHTML from '../../../shared/components/ui/SafeHTML';\r\n\r\n\r\ninterface QuestionEditorProps {\r\n  question: Question;\r\n  index: number;\r\n  isEditing: boolean;\r\n  onEdit: (questionId: string) => void;\r\n  onUpdate: (questionId: string, updates: Partial<Question>) => void;\r\n  onDelete: (questionId: string) => void;\r\n  onMove: (index: number, direction: 'up' | 'down') => void;\r\n  totalQuestions: number;\r\n}\r\n\r\nexport const QuestionEditor: React.FC<QuestionEditorProps> = ({\r\n  question,\r\n  index,\r\n  isEditing,\r\n  onEdit,\r\n  onUpdate,\r\n  onDelete,\r\n  onMove,\r\n  totalQuestions\r\n}) => {\r\n  const { t } = useTranslation();\r\n  const [localQuestion, setLocalQuestion] = useState<Question>(question);\r\n\r\n  useEffect(() => {\r\n    setLocalQuestion(question);\r\n  }, [question]);\r\n\r\n  const handleSave = () => {\r\n    onUpdate(question.id, localQuestion);\r\n    onEdit('');\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    setLocalQuestion(question);\r\n    onEdit('');\r\n  };\r\n\r\n  const addAnswer = () => {\r\n    if (localQuestion.answers.length < 6) {\r\n      const newAnswer = {\r\n        id: `a_${Date.now()}`,\r\n        text: '',\r\n        isCorrect: false\r\n      };\r\n      setLocalQuestion({\r\n        ...localQuestion,\r\n        answers: [...localQuestion.answers, newAnswer]\r\n      });\r\n    }\r\n  };\r\n\r\n  const updateAnswer = (answerId: string, updates: Partial<{ text: string; isCorrect: boolean }>) => {\r\n    setLocalQuestion({\r\n      ...localQuestion,\r\n      answers: localQuestion.answers.map(a => \r\n        a.id === answerId ? { ...a, ...updates } : a\r\n      )\r\n    });\r\n  };\r\n\r\n  const deleteAnswer = (answerId: string) => {\r\n    if (localQuestion.answers.length > 2) {\r\n      setLocalQuestion({\r\n        ...localQuestion,\r\n        answers: localQuestion.answers.filter(a => a.id !== answerId)\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`bg-gradient-to-br from-white to-gray-50 rounded-3xl border-2 transition-all duration-300 shadow-sm hover:shadow-lg ${\r\n      isEditing \r\n        ? 'border-blue-300 shadow-blue-100' \r\n        : 'border-gray-200 hover:border-gray-300'\r\n    }`}>\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between p-6 border-b border-gray-100\">\r\n        <div className=\"flex items-center gap-4\">\r\n          {/* Question Number */}\r\n          <div className=\"relative\">\r\n            <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center text-white font-bold text-lg shadow-lg\">\r\n              {index + 1}\r\n            </div>\r\n            {question.type === 'multiple' && (\r\n              <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center\">\r\n                <List className=\"w-3 h-3 text-white\" />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Move Controls */}\r\n          <div className=\"flex flex-col gap-1\">\r\n            <button\r\n              onClick={() => onMove(index, 'up')}\r\n              disabled={index === 0}\r\n              className=\"p-1 text-gray-400 hover:text-blue-600 disabled:opacity-30 transition-colors\"\r\n              title=\"Move up\"\r\n            >\r\n              <ArrowUp className=\"w-4 h-4\" />\r\n            </button>\r\n            <button\r\n              onClick={() => onMove(index, 'down')}\r\n              disabled={index === totalQuestions - 1}\r\n              className=\"p-1 text-gray-400 hover:text-blue-600 disabled:opacity-30 transition-colors\"\r\n              title=\"Move down\"\r\n            >\r\n              <ArrowDown className=\"w-4 h-4\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Question Type Badge */}\r\n          <div className=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium\">\r\n            {question.type === 'multiple' ? 'üî¢ Multiple Choice' : \r\n             question.type === 'boolean' ? '‚úì‚úó True/False' : \r\n             question.type === 'checkbox' ? '‚òëÔ∏è Checkbox' :\r\n             question.type === 'short_answer' ? 'üìù Short Answer' :\r\n             'üñºÔ∏è Image Choice'}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Action Buttons */}\r\n        <div className=\"flex items-center gap-2\">\r\n          {isEditing ? (\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={handleSave}\r\n                className=\"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors shadow-sm\"\r\n              >\r\n                <Check className=\"w-4 h-4\" />\r\n                Save\r\n              </button>\r\n              <button\r\n                onClick={handleCancel}\r\n                className=\"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-xl hover:bg-gray-600 transition-colors shadow-sm\"\r\n              >\r\n                <X className=\"w-4 h-4\" />\r\n                Cancel\r\n              </button>\r\n            </div>\r\n          ) : (\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={() => onEdit(question.id)}\r\n                className=\"p-3 bg-blue-100 text-blue-600 rounded-xl hover:bg-blue-200 transition-colors shadow-sm\"\r\n                title=\"Edit question\"\r\n              >\r\n                <Edit3 className=\"w-5 h-5\" />\r\n              </button>\r\n              <button\r\n                onClick={() => onDelete(question.id)}\r\n                className=\"p-3 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-colors shadow-sm\"\r\n                title=\"Delete question\"\r\n              >\r\n                <Trash2 className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"p-6\">\r\n        {isEditing ? (\r\n          <div className=\"space-y-6\">\r\n            {/* Question Text */}\r\n            <div className=\"space-y-2\">\r\n              <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                <Type className=\"w-4 h-4\" />\r\n                Question Text *\r\n              </label>\r\n              <textarea\r\n                value={localQuestion.text}\r\n                onChange={(e) => setLocalQuestion({ ...localQuestion, text: e.target.value })}\r\n                placeholder={t('placeholders.enterQuestionHere')}\r\n                className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none\"\r\n                rows={3}\r\n              />\r\n            </div>\r\n\r\n            {/* Question Type */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                  <List className=\"w-4 h-4\" />\r\n                  Question Type\r\n                </label>\r\n                <select\r\n                  value={localQuestion.type}\r\n                  onChange={(e) => setLocalQuestion({ ...localQuestion, type: e.target.value as any })}\r\n                  className=\"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                >\r\n                  <option value=\"multiple\">Multiple Choice</option>\r\n                  <option value=\"boolean\">True/False</option>\r\n                  <option value=\"checkbox\">Checkbox</option>\r\n                  <option value=\"short_answer\">Short Answer</option>\r\n                  <option value=\"image\">Image Choice</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                  <Target className=\"w-4 h-4\" />\r\n                  Points\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  value={localQuestion.points}\r\n                  onChange={(e) => setLocalQuestion({ ...localQuestion, points: parseInt(e.target.value) || 10 })}\r\n                  min=\"1\"\r\n                  max=\"100\"\r\n                  className=\"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <label className=\"text-sm font-semibold text-gray-700\">Difficulty</label>\r\n                <select\r\n                  value={localQuestion.difficulty || 'medium'}\r\n                  onChange={(e) => setLocalQuestion({ ...localQuestion, difficulty: e.target.value as any })}\r\n                  className=\"w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                >\r\n                  <option value=\"easy\">üü¢ Easy</option>\r\n                  <option value=\"medium\">üü° Medium</option>\r\n                  <option value=\"hard\">üî¥ Hard</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Answers */}\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                  <List className=\"w-4 h-4\" />\r\n                  Answer Options *\r\n                </label>\r\n                <button\r\n                  onClick={addAnswer}\r\n                  disabled={localQuestion.answers.length >= 6}\r\n                  className=\"flex items-center gap-2 px-3 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors text-sm font-medium disabled:opacity-50\"\r\n                >\r\n                  <Plus className=\"w-4 h-4\" />\r\n                  Add Answer\r\n                </button>\r\n              </div>\r\n              \r\n              <div className=\"space-y-3\">\r\n                {localQuestion.answers.map((answer, answerIndex) => (\r\n                  <div key={answer.id} className=\"flex items-center gap-3 p-4 bg-gray-50 rounded-xl border-2 border-gray-100\">\r\n                    <div className=\"w-8 h-8 bg-white rounded-full flex items-center justify-center text-gray-700 font-semibold shadow-sm\">\r\n                      {String.fromCharCode(65 + answerIndex)}\r\n                    </div>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={answer.text}\r\n                      onChange={(e) => updateAnswer(answer.id, { text: e.target.value })}\r\n                      placeholder={`Answer ${String.fromCharCode(65 + answerIndex)}`}\r\n                      className=\"flex-1 p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                    />\r\n                    <label className=\"flex items-center gap-2 text-sm font-medium\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={answer.isCorrect}\r\n                        onChange={(e) => updateAnswer(answer.id, { isCorrect: e.target.checked })}\r\n                        className=\"w-5 h-5 text-green-600 rounded focus:ring-green-500\"\r\n                      />\r\n                      <span className=\"text-green-700\">Correct</span>\r\n                    </label>\r\n                    {localQuestion.answers.length > 2 && (\r\n                      <button\r\n                        onClick={() => deleteAnswer(answer.id)}\r\n                        className=\"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors\"\r\n                      >\r\n                        <X className=\"w-5 h-5\" />\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Explanation */}\r\n            <div className=\"space-y-2\">\r\n              <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                <Lightbulb className=\"w-4 h-4\" />\r\n                Explanation (Optional)\r\n              </label>\r\n              <textarea\r\n                value={localQuestion.explanation || ''}\r\n                onChange={(e) => setLocalQuestion({ ...localQuestion, explanation: e.target.value })}\r\n                placeholder={t('placeholders.explainAnswer')}\r\n                className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none\"\r\n                rows={3}\r\n              />\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-4\">\r\n            {/* Question Display */}\r\n            <h4 className=\"text-xl font-bold text-gray-900 leading-relaxed\">\r\n              {question.text || '‚ùì Untitled Question'}\r\n            </h4>\r\n            \r\n            {/* Answers Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n              {question.answers.map((answer, answerIndex) => (\r\n                <div key={answer.id} className={`p-4 rounded-xl border-2 transition-all ${\r\n                  answer.isCorrect \r\n                    ? 'bg-green-50 border-green-200 text-green-800' \r\n                    : 'bg-gray-50 border-gray-200 text-gray-700'\r\n                }`}>\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${\r\n                      answer.isCorrect ? 'bg-green-500 text-white' : 'bg-gray-300 text-gray-600'\r\n                    }`}>\r\n                      {String.fromCharCode(65 + answerIndex)}\r\n                    </div>\r\n                    <span className=\"flex-1 font-medium\">\r\n                      {answer.text || 'Empty answer'}\r\n                    </span>\r\n                    {answer.isCorrect && <Check className=\"w-5 h-5 text-green-600\" />}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Question Info */}\r\n            <div className=\"flex items-center gap-6 text-sm text-gray-600 bg-gray-50 p-4 rounded-xl\">\r\n              <span className=\"flex items-center gap-1\">\r\n                <Target className=\"w-4 h-4\" />\r\n                <strong>{question.points}</strong> points\r\n              </span>\r\n              <span className=\"flex items-center gap-1\">\r\n                <Type className=\"w-4 h-4\" />\r\n                {question.type}\r\n              </span>\r\n              <span className=\"flex items-center gap-1\">\r\n                üìä {question.difficulty || 'medium'}\r\n              </span>\r\n              {question.explanation && (\r\n                <span className=\"flex items-center gap-1\">\r\n                  <Lightbulb className=\"w-4 h-4\" />\r\n                  Has explanation\r\n                </span>\r\n              )}\r\n            </div>\r\n\r\n            {/* Explanation Preview */}\r\n            {question.explanation && (\r\n              <div className=\"bg-blue-50 p-4 rounded-xl border-l-4 border-blue-400\">\r\n                <h5 className=\"flex items-center gap-2 font-semibold text-blue-800 mb-2\">\r\n                  <Lightbulb className=\"w-4 h-4\" />\r\n                  Explanation\r\n                </h5>\r\n                <SafeHTML content={question.explanation} className=\"text-blue-700\" />\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\QuizBulkImport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\QuizCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1117,1120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1117,1120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { Quiz } from '../types';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\nimport { doc, getDoc, setDoc, updateDoc, arrayUnion, arrayRemove } from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\n// import { toast } from 'react-toastify';\r\nimport { Star, Eye, Play } from 'lucide-react';\r\nimport { reviewService } from '../services/reviewService';\r\nimport { QuizReviewStats } from '../types/review';\r\nimport SafeHTML from '../../../shared/components/ui/SafeHTML';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\n\r\ninterface QuizCardProps {\r\n  quiz: Quiz;\r\n  viewMode?: 'grid' | 'list';\r\n  onStartQuiz?: (quiz: Quiz) => void;\r\n}\r\n\r\n  const QuizCard: React.FC<QuizCardProps> = ({ quiz, viewMode = 'grid', onStartQuiz }) => {\r\n  const { t } = useTranslation();\r\n\r\n  const translate = useCallback(\r\n    (key: string, fallback: string, options?: Record<string, unknown>): string => {\r\n      const value = t(key, options as any);\r\n      if (typeof value === 'string') {\r\n        return value === key ? fallback : value;\r\n      }\r\n      return fallback;\r\n    },\r\n    [t]\r\n  );\r\n\r\n  const resources = Array.isArray(quiz.resources) ? quiz.resources : [];\r\n  const hasResources = resources.length > 0;\r\n  const resourceCount = resources.length;\r\n\r\n  const isPasswordProtected = useMemo(() => {\r\n    const extended = quiz as Partial<{ havePassword?: string; visibility?: string }>;\r\n    return extended.havePassword === 'password' || extended.visibility === 'password';\r\n  }, [quiz]);\r\n\r\n  // **TH√äM M·ªöI**: Helper functions\r\n  const getDifficultyColor = (difficulty: string) => {\r\n    switch (difficulty) {\r\n      case 'easy': return 'bg-green-100 text-green-800 border-green-200';\r\n      case 'medium': return 'bg-yellow-100 text-yellow-800 border-yellow-200';\r\n      case 'hard': return 'bg-red-100 text-red-800 border-red-200';\r\n      default: return 'bg-gray-100 text-gray-800 border-gray-200';\r\n    }\r\n  };\r\n\r\n  const formatDuration = useCallback(\r\n    (minutes: number) => {\r\n      if (!Number.isFinite(minutes)) {\r\n        return '';\r\n      }\r\n\r\n      if (minutes < 60) {\r\n        return translate('quiz.card.duration.minutes', `${minutes} ph√∫t`, { count: minutes });\r\n      }\r\n\r\n      const hours = Math.floor(minutes / 60);\r\n      const remainingMinutes = minutes % 60;\r\n\r\n      if (remainingMinutes > 0) {\r\n        return translate('quiz.card.duration.hoursAndMinutes', `${hours} gi·ªù ${remainingMinutes} ph√∫t`, {\r\n          hours,\r\n          minutes: remainingMinutes,\r\n        });\r\n      }\r\n\r\n      return translate('quiz.card.duration.hours', `${hours} gi·ªù`, { count: hours });\r\n    },\r\n    [translate]\r\n  );\r\n\r\n  const getDifficultyLabel = useCallback(\r\n    (difficulty: Quiz['difficulty']) =>\r\n      translate(`quiz.difficulty.${difficulty}`, difficulty.charAt(0).toUpperCase() + difficulty.slice(1)),\r\n    [translate]\r\n  );\r\n\r\n  const getDifficultyBadgeLabel = useCallback(\r\n    (difficulty: Quiz['difficulty']) =>\r\n      translate(`quiz.card.difficultyBadge.${difficulty}`, difficulty.charAt(0).toUpperCase() + difficulty.slice(1)),\r\n    [translate]\r\n  );\r\n\r\n  const getResourceLabel = useCallback(\r\n    (count: number) => translate('quiz.card.resources', `üìö ${count} t√†i li·ªáu h·ªçc t·∫≠p`, { count }),\r\n    [translate]\r\n  );\r\n\r\n  const getQuestionsLabel = useCallback(\r\n    (count: number) => translate('quiz.card.questions', `${count} c√¢u h·ªèi`, { count }),\r\n    [translate]\r\n  );\r\n\r\n  const getPlayersLabel = useCallback(\r\n    (count: number) => translate('quiz.card.players', `${count} l∆∞·ª£t ch∆°i`, { count }),\r\n    [translate]\r\n  );\r\n\r\n  const getTagsRemainingLabel = useCallback(\r\n    (count: number) => translate('quiz.card.tagsRemaining', `+${count}`, { count }),\r\n    [translate]\r\n  );\r\n\r\n  const getCompletedWithScore = useCallback(\r\n    (score?: number) => translate('quiz.card.completedWithScore', `ƒê√£ ho√†n th√†nh: ${score ?? 0}%`, { score: score ?? 0 }),\r\n    [translate]\r\n  );\r\n\r\n  const getRatingSummary = useCallback(\r\n    (rating: number, count: number) =>\r\n      translate('quiz.card.ratingSummary', `${rating.toFixed(1)} (${count})`, {\r\n        rating: rating.toFixed(1),\r\n        count\r\n      }),\r\n    [translate]\r\n  );\r\n\r\n  const favoriteTooltipAdd = useMemo(\r\n    () => translate('quiz.card.favoriteTooltipAdd', 'Y√™u th√≠ch quiz n√†y'),\r\n    [translate]\r\n  );\r\n\r\n  const favoriteTooltipRemove = useMemo(\r\n    () => translate('quiz.card.favoriteTooltipRemove', 'B·ªè y√™u th√≠ch'),\r\n    [translate]\r\n  );\r\n\r\n  const viewReviewsLabel = useMemo(\r\n    () => translate('quiz.card.viewReviews', 'Xem ƒë√°nh gi√°'),\r\n    [translate]\r\n  );\r\n\r\n  const retakeLabel = useMemo(\r\n    () => translate('quiz.card.retake', 'üîÑ Ch∆°i l·∫°i'),\r\n    [translate]\r\n  );\r\n\r\n  const startLabel = useMemo(\r\n    () => translate('quiz.card.start', 'üöÄ B·∫Øt ƒë·∫ßu Quiz'),\r\n    [translate]\r\n  );\r\n\r\n  const completedBadgeLabel = useMemo(\r\n    () => translate('quiz.card.completed', '‚úì Ho√†n th√†nh'),\r\n    [translate]\r\n  );\r\n\r\n  const passwordBadgeLabel = useMemo(\r\n    () => translate('quiz.card.passwordRequired', 'üîí C·∫ßn m·∫≠t kh·∫©u'),\r\n    [translate]\r\n  );\r\n\r\n  const resourcesHint = useMemo(\r\n    () => translate('quiz.card.resourcesHint', 'üí° Xem t√†i li·ªáu ƒë·ªÉ hi·ªÉu s√¢u h∆°n tr∆∞·ªõc khi l√†m b√†i!'),\r\n    [translate]\r\n  );\r\n\r\n  const reviewsButtonLabel = useMemo(\r\n    () => translate('quiz.card.reviewsButton', 'ƒê√°nh gi√°'),\r\n    [translate]\r\n  );\r\n\r\n  const favoriteButtonAddedLabel = useMemo(\r\n    () => translate('quiz.card.favoriteAdded', 'ƒê√£ th√≠ch'),\r\n    [translate]\r\n  );\r\n\r\n  const favoriteButtonAddLabel = useMemo(\r\n    () => translate('quiz.card.favoriteAction', 'Y√™u th√≠ch'),\r\n    [translate]\r\n  );\r\n\r\n  // Helper component for rating display\r\n  const RatingDisplay = ({ rating, reviewCount, size = 'sm' }: { rating: number; reviewCount: number; size?: 'sm' | 'md' }) => {\r\n    const starSize = size === 'sm' ? 'w-4 h-4' : 'w-5 h-5';\r\n    const textSize = size === 'sm' ? 'text-sm' : 'text-base';\r\n    \r\n    return (\r\n      <div className={`flex items-center gap-1 ${textSize}`}>\r\n        <div className=\"flex items-center\">\r\n          {[1, 2, 3, 4, 5].map((star) => (\r\n            <Star\r\n              key={star}\r\n              className={`${starSize} ${\r\n                star <= Math.round(rating)\r\n                  ? 'text-yellow-400 fill-current'\r\n                  : 'text-gray-300'\r\n              }`}\r\n            />\r\n          ))}\r\n        </div>\r\n        <span className=\"text-gray-600 font-medium\">\r\n          {rating.toFixed(1)}\r\n        </span>\r\n        <span className=\"text-gray-500\">\r\n          ({reviewCount})\r\n        </span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const user = useSelector((state: RootState) => state.auth.user);\r\n  const [isFavorite, setIsFavorite] = useState(false);\r\n  const [favLoading, setFavLoading] = useState(false);\r\n  const [reviewStats, setReviewStats] = useState<QuizReviewStats | null>(null);\r\n\r\n  // Fetch review stats\r\n  useEffect(() => {\r\n    const fetchReviewStats = async () => {\r\n      try {\r\n        const stats = await reviewService.getQuizReviewStats(quiz.id);\r\n        setReviewStats(stats);\r\n      } catch (error) {\r\n        console.error('Error fetching review stats:', error);\r\n      }\r\n    };\r\n    \r\n    fetchReviewStats();\r\n  }, [quiz.id]);\r\n\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    const checkFavorite = async () => {\r\n      const favRef = doc(db, 'user_favorites', user.uid);\r\n      const favSnap = await getDoc(favRef);\r\n      if (favSnap.exists()) {\r\n        const data = favSnap.data();\r\n        setIsFavorite(Array.isArray(data.quizIds) && data.quizIds.includes(quiz.id));\r\n      } else {\r\n        setIsFavorite(false);\r\n      }\r\n    };\r\n    checkFavorite();\r\n  }, [user, quiz.id]);\r\n\r\n  const handleToggleFavorite = async (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    if (!user) return;\r\n    setFavLoading(true);\r\n    const favRef = doc(db, 'user_favorites', user.uid);\r\n    try {\r\n      const favSnap = await getDoc(favRef);\r\n      if (favSnap.exists()) {\r\n        await updateDoc(favRef, {\r\n          quizIds: isFavorite ? arrayRemove(quiz.id) : arrayUnion(quiz.id)\r\n        });\r\n      } else {\r\n        await setDoc(favRef, {\r\n          quizIds: [quiz.id]\r\n        });\r\n      }\r\n      setIsFavorite(!isFavorite);\r\n      // toast.success(isFavorite ? 'ƒê√£ b·ªè y√™u th√≠ch quiz!' : 'ƒê√£ th√™m v√†o y√™u th√≠ch!');\r\n      // N·∫øu ƒëang ·ªü trang Favorites, refetch l·∫°i\r\n      if (window.location.pathname.startsWith('/favorites')) {\r\n        window.location.reload();\r\n      }\r\n    } catch (err) {\r\n      // toast.error('L·ªói khi c·∫≠p nh·∫≠t y√™u th√≠ch!');\r\n    } finally {\r\n      setFavLoading(false);\r\n    }\r\n  };\r\n\r\n  // **TH√äM M·ªöI**: Render list view\r\n  if (viewMode === 'list') {\r\n    return (\r\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow\">\r\n        <div className=\"flex items-center gap-6\">\r\n          {/* Image/Icon */}\r\n          <div className=\"w-20 h-20 rounded-lg overflow-hidden flex-shrink-0 bg-gradient-to-br from-blue-500 to-purple-600 relative\">\r\n            {quiz.imageUrl ? (\r\n              <img src={quiz.imageUrl} alt={quiz.title} className=\"w-full h-full object-cover\" />\r\n            ) : (\r\n              <div className=\"w-full h-full flex items-center justify-center text-white text-2xl font-bold\">\r\n                {quiz.category.charAt(0).toUpperCase()}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"flex-1 min-w-0\">\r\n            <div className=\"flex items-start justify-between mb-2\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 truncate pr-4\">{quiz.title}</h3>\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className={`px-2 py-1 rounded text-xs font-medium ${getDifficultyColor(quiz.difficulty)}`}>\r\n                  {getDifficultyLabel(quiz.difficulty)}\r\n                </span>\r\n                {quiz.isCompleted && (\r\n                  <span className=\"px-2 py-1 bg-green-100 text-green-800 text-xs rounded font-medium\">\r\n                    {completedBadgeLabel}\r\n                  </span>\r\n                )}\r\n                {/* üîí Password Badge - Support both old (havePassword) and new (visibility) format */}\r\n                {isPasswordProtected && (\r\n                  <span className=\"px-2 py-1 bg-purple-100 text-purple-700 border border-purple-300 text-xs rounded-full font-bold flex items-center gap-1\">\r\n                    {passwordBadgeLabel}\r\n                  </span>\r\n                )}\r\n                {/* üÜï Resource Badge */}\r\n                {hasResources && (\r\n                  <span className=\"px-2 py-1 bg-emerald-100 text-emerald-700 border border-emerald-300 text-xs rounded-full font-bold flex items-center gap-1\">\r\n                    {getResourceLabel(resourceCount)}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </div>\r\n            \r\n            <SafeHTML content={quiz.description} className=\"text-gray-600 text-sm mb-3 line-clamp-1\" />\r\n            \r\n            <div className=\"flex items-center gap-6 text-sm text-gray-500 mb-4\">\r\n              <div className=\"flex items-center\">\r\n                <svg className=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\r\n                </svg>\r\n                {quiz.category}\r\n              </div>\r\n              <div className=\"flex items-center\">\r\n                <svg className=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                {getQuestionsLabel(quiz.questions.length)}\r\n              </div>\r\n              <div className=\"flex items-center\">\r\n                <svg className=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                {formatDuration(quiz.duration)}\r\n              </div>\r\n              {quiz.totalPlayers && (\r\n                <div className=\"flex items-center\">\r\n                  <Eye className=\"w-4 h-4 mr-1\" />\r\n                  {getPlayersLabel(quiz.totalPlayers)}\r\n                </div>\r\n              )}\r\n              {reviewStats && reviewStats.totalReviews > 0 && (\r\n                <RatingDisplay \r\n                  rating={reviewStats.averageRating} \r\n                  reviewCount={reviewStats.totalReviews} \r\n                />\r\n              )}\r\n            </div>\r\n\r\n            {/* Tags */}\r\n            {quiz.tags && quiz.tags.length > 0 && (\r\n              <div className=\"flex flex-wrap gap-1 mb-4\">\r\n                {quiz.tags.slice(0, 4).map((tag, index) => (\r\n                  <span key={index} className=\"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded\">\r\n                    {tag}\r\n                  </span>\r\n                ))}\r\n                {quiz.tags.length > 4 && (\r\n                  <span className=\"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded\">\r\n                    {getTagsRemainingLabel(quiz.tags.length - 4)}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Actions */}\r\n          <div className=\"flex items-center gap-3 flex-shrink-0\">\r\n            <button\r\n              onClick={handleToggleFavorite}\r\n              disabled={!user || favLoading}\r\n              className={`p-2 border rounded-lg transition-colors ${isFavorite ? 'bg-yellow-100 border-yellow-400 text-yellow-600' : 'border-gray-300 text-gray-700 hover:bg-gray-50'}`}\r\n              title={isFavorite ? favoriteTooltipRemove : favoriteTooltipAdd}\r\n            >\r\n              <svg className=\"w-5 h-5\" fill={isFavorite ? 'gold' : 'none'} stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\" />\r\n              </svg>\r\n            </button>\r\n            <Link\r\n              to={`/quiz/${quiz.id}/reviews`}\r\n              className=\"p-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\r\n              title={viewReviewsLabel}\r\n            >\r\n              <Eye className=\"w-5 h-5\" />\r\n            </Link>\r\n            <button\r\n              onClick={() => onStartQuiz?.(quiz)}\r\n              className=\"bg-gradient-to-r from-blue-500 to-purple-600 text-white py-2 px-6 rounded-lg font-medium hover:from-blue-600 hover:to-purple-700 transition-all duration-200\"\r\n            >\r\n              {quiz.isCompleted ? retakeLabel : startLabel}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Grid view (existing code)\r\n  return (\r\n    <div className=\"bg-white rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 overflow-hidden border border-gray-100 hover:border-blue-300 group transform hover:scale-105 cursor-pointer flex flex-col h-full\">\r\n      {/* **TH√äM M·ªöI**: Image Header */}\r\n      <div className=\"relative h-48 bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 overflow-hidden\">\r\n        {quiz.imageUrl ? (\r\n          <img \r\n            src={quiz.imageUrl} \r\n            alt={quiz.title}\r\n            className=\"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500\"\r\n          />\r\n        ) : (\r\n          <div className=\"w-full h-full flex items-center justify-center relative\">\r\n            <div className=\"absolute inset-0 bg-gradient-to-br from-blue-400/20 to-purple-600/20 backdrop-blur-3xl\"></div>\r\n            <div className=\"relative text-white text-6xl font-bold opacity-30 drop-shadow-lg\">\r\n              {quiz.category.charAt(0).toUpperCase()}\r\n            </div>\r\n            <div className=\"absolute bottom-4 left-4 text-white/90 font-semibold text-sm px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full border border-white/30\">\r\n              {quiz.category}\r\n            </div>\r\n          </div>\r\n        )}\r\n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/50 via-black/20 to-transparent z-10\" />\r\n        \r\n        {/* **TH√äM M·ªöI**: Overlay badges */}\r\n        <div className=\"absolute top-4 left-4 flex flex-wrap gap-2 z-20\">\r\n          <span className={`px-3 py-1.5 rounded-2xl text-xs font-semibold backdrop-blur-sm shadow-lg ${getDifficultyColor(quiz.difficulty)}`}>\r\n            {getDifficultyBadgeLabel(quiz.difficulty)}\r\n          </span>\r\n          {/* üîí Password Badge - Support both old (havePassword) and new (visibility) format */}\r\n          {isPasswordProtected && (\r\n            <span className=\"px-3 py-1.5 rounded-2xl text-xs font-semibold bg-purple-500/90 text-white backdrop-blur-sm shadow-lg border border-purple-400\">\r\n              {passwordBadgeLabel}\r\n            </span>\r\n          )}\r\n        </div>\r\n\r\n        {/* **TH√äM M·ªöI**: Favorite button in overlay */}\r\n        <div className=\"absolute top-4 right-4 z-20\">\r\n          <button\r\n            onClick={handleToggleFavorite}\r\n            disabled={!user || favLoading}\r\n            className={`p-2.5 backdrop-blur-sm rounded-2xl shadow-lg transition-all duration-300 ${isFavorite ? 'bg-yellow-400/90 border border-yellow-300 text-yellow-900' : 'bg-white/20 border border-white/30 text-white hover:bg-white/30'}`}\r\n            title={isFavorite ? favoriteTooltipRemove : favoriteTooltipAdd}\r\n          >\r\n            <svg className=\"w-5 h-5\" fill={isFavorite ? 'currentColor' : 'none'} stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Quiz stats in bottom */}\r\n        <div className=\"absolute bottom-4 left-4 right-4 z-20 flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            {quiz.totalPlayers && (\r\n              <div className=\"flex items-center text-white/90 text-sm bg-black/30 backdrop-blur-sm px-3 py-1.5 rounded-2xl\">\r\n                <Eye className=\"w-4 h-4 mr-1.5\" />\r\n                {getPlayersLabel(quiz.totalPlayers)}\r\n              </div>\r\n            )}\r\n          </div>\r\n          {reviewStats && reviewStats.totalReviews > 0 && (\r\n            <div className=\"flex items-center text-white text-sm bg-black/30 backdrop-blur-sm px-3 py-1.5 rounded-2xl\">\r\n              <Star className=\"w-4 h-4 mr-1.5 fill-current text-yellow-400\" />\r\n              {getRatingSummary(reviewStats.averageRating, reviewStats.totalReviews)}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"p-6 flex-1 flex flex-col\">\r\n        <div className=\"flex items-start justify-between mb-4\">\r\n          <h3 className=\"text-xl font-bold text-gray-900 group-hover:text-blue-600 transition-colors line-clamp-2 flex-1\">\r\n            {quiz.title}\r\n          </h3>\r\n        </div>\r\n        \r\n        <SafeHTML content={quiz.description} className=\"text-gray-600 text-sm mb-6 line-clamp-2 leading-relaxed\" />\r\n\r\n        {/* **TH√äM M·ªöI**: Quiz metadata */}\r\n        <div className=\"space-y-4 mb-6\">\r\n          <div className=\"flex items-center justify-between text-sm text-gray-500\">\r\n            <div className=\"flex items-center\">\r\n              <svg className=\"w-4 h-4 mr-2 text-blue-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\r\n              </svg>\r\n              <span className=\"font-medium\">{quiz.category}</span>\r\n            </div>\r\n            <div className=\"flex items-center\">\r\n              <svg className=\"w-4 h-4 mr-2 text-green-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <span className=\"font-medium\">{formatDuration(quiz.duration)}</span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center justify-between text-sm text-gray-500\">\r\n            <div className=\"flex items-center\">\r\n              <svg className=\"w-4 h-4 mr-2 text-purple-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <span className=\"font-medium\">{getQuestionsLabel(quiz.questions.length)}</span>\r\n            </div>\r\n            {reviewStats && reviewStats.totalReviews > 0 && (\r\n              <div className=\"flex items-center\">\r\n                <Star className=\"w-4 h-4 mr-1 text-yellow-500 fill-current\" />\r\n                <span className=\"font-medium\">{getRatingSummary(reviewStats.averageRating, reviewStats.totalReviews)}</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* **TH√äM M·ªöI**: Completion status */}\r\n        {quiz.isCompleted && (\r\n          <div className=\"flex items-center text-green-600 text-sm mb-4 bg-green-50 px-3 py-2 rounded-2xl border border-green-200\">\r\n            <svg className=\"w-4 h-4 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n              <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\r\n            </svg>\r\n            <span className=\"font-semibold\">{getCompletedWithScore(quiz.score)}</span>\r\n          </div>\r\n        )}\r\n\r\n        {/* **TH√äM M·ªöI**: Tags */}\r\n        {quiz.tags && quiz.tags.length > 0 && (\r\n          <div className=\"flex flex-wrap gap-2 mb-6\">\r\n            {quiz.tags.slice(0, 3).map((tag, index) => (\r\n              <span\r\n                key={index}\r\n                className=\"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs rounded-2xl font-medium transition-colors\"\r\n              >\r\n                #{tag}\r\n              </span>\r\n            ))}\r\n            {quiz.tags.length > 3 && (\r\n              <span className=\"px-3 py-1.5 bg-gray-100 text-gray-600 text-xs rounded-2xl font-medium\">\r\n                {getTagsRemainingLabel(quiz.tags.length - 3)}\r\n              </span>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* üÜï Learning Resources Badge */}\r\n        {hasResources && (\r\n          <div className=\"mb-4 p-3 bg-gradient-to-r from-emerald-50 to-teal-50 border-2 border-emerald-200 rounded-xl\">\r\n            <div className=\"flex items-center gap-2 text-emerald-800\">\r\n              <span className=\"text-lg\">üìö</span>\r\n              <span className=\"font-bold text-sm\">\r\n                {getResourceLabel(resourceCount)}\r\n              </span>\r\n            </div>\r\n            <p className=\"text-xs text-emerald-600 mt-1\">\r\n              {resourcesHint}\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Action buttons */}\r\n        <div className=\"mt-auto pt-4 border-t border-gray-100\">\r\n          <button\r\n            onClick={() => onStartQuiz?.(quiz)}\r\n            className=\"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-3 px-4 rounded-xl font-semibold text-center transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center space-x-2\"\r\n          >\r\n            <Play className=\"w-5 h-5\" />\r\n            <span>{quiz.isCompleted ? retakeLabel : startLabel}</span>\r\n          </button>\r\n          \r\n          <div className=\"flex gap-2 mt-3\">\r\n            <Link\r\n              to={`/quiz/${quiz.id}/reviews`}\r\n              className=\"flex-1 px-3 py-2 border border-gray-200 hover:border-blue-300 text-gray-700 hover:text-blue-600 rounded-lg transition-all duration-300 hover:bg-blue-50 text-sm text-center flex items-center justify-center\"\r\n              title={viewReviewsLabel}\r\n            >\r\n              <Eye className=\"w-4 h-4 mr-2\" />\r\n              {reviewsButtonLabel}\r\n            </Link>\r\n            \r\n            <button\r\n              onClick={handleToggleFavorite}\r\n              disabled={favLoading}\r\n              className={`flex-1 px-3 py-2 rounded-lg text-sm transition-all duration-300 flex items-center justify-center ${\r\n                isFavorite\r\n                  ? 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200'\r\n                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\r\n              }`}\r\n              title={isFavorite ? favoriteTooltipRemove : favoriteTooltipAdd}\r\n            >\r\n              <Star className={`w-4 h-4 mr-2 ${isFavorite ? 'fill-current' : ''}`} />\r\n              {isFavorite ? favoriteButtonAddedLabel : favoriteButtonAddLabel}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const QuizCardSkeleton = () => (\r\n  <div className=\"bg-white rounded-xl shadow-lg animate-pulse h-96 flex flex-col\">\r\n    <div className=\"h-48 bg-gray-200 w-full\" />\r\n    <div className=\"p-6 flex-1 flex flex-col\">\r\n      <div className=\"h-6 bg-gray-200 rounded w-2/3 mb-4\" />\r\n      <div className=\"h-4 bg-gray-200 rounded w-1/2 mb-2\" />\r\n      <div className=\"h-4 bg-gray-200 rounded w-1/3 mb-6\" />\r\n      <div className=\"flex gap-2 mt-auto\">\r\n        <div className=\"h-10 w-24 bg-gray-200 rounded\" />\r\n        <div className=\"h-10 w-10 bg-gray-200 rounded\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nexport default QuizCard;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\QuizFilters.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1034,1037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1034,1037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-600\">{t(\"profile.pagination.showing\")} <span className=\"font-semibold text-blue-600\">{filteredCount}</span> / {totalQuizzes} quiz\r\n          </div>","line":71,"column":169,"nodeType":"JSXText","endLine":72,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{showAdvanced ? '·∫®n' : 'Hi·ªán'} t√πy ch·ªçn n√¢ng cao</span>","line":85,"column":47,"nodeType":"JSXText","endLine":85,"endColumn":65},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"popular\">üî• Ph·ªï bi·∫øn nh·∫•t</option>","line":145,"column":39,"nodeType":"JSXText","endLine":145,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"questions\">üî¢ Theo s·ªë c√¢u h·ªèi</option>","line":147,"column":41,"nodeType":"JSXText","endLine":147,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"duration\">‚è±Ô∏è Theo th·ªùi l∆∞·ª£ng</option>","line":148,"column":40,"nodeType":"JSXText","endLine":148,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"block text-sm text-gray-600 mb-1\">S·ªë c√¢u h·ªèi t·ªëi thi·ªÉu: {filters.minQuestions}</label>","line":153,"column":67,"nodeType":"JSXText","endLine":153,"endColumn":89},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"block text-sm text-gray-600 mb-1\">Th·ªùi l∆∞·ª£ng t·ªëi ƒëa: {filters.maxDuration} ph√∫t</label>","line":166,"column":67,"nodeType":"JSXText","endLine":166,"endColumn":86},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"block text-sm text-gray-600 mb-1\">Th·ªùi l∆∞·ª£ng t·ªëi ƒëa: {filters.maxDuration} ph√∫t</label>","line":166,"column":107,"nodeType":"JSXText","endLine":166,"endColumn":112}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\n\r\nimport { useTranslation } from 'react-i18next';\r\ninterface QuizFiltersProps {\r\n  onFilterChange: (filters: FilterOptions) => void;\r\n  categories: string[];\r\n  difficulties: string[];\r\n  totalQuizzes: number;\r\n  filteredCount: number;\r\n}\r\n\r\ninterface FilterOptions {\r\n  search: string;\r\n  category: string;\r\n  difficulty: string;\r\n  sortBy: string;\r\n  showCompleted: boolean;\r\n  tags: string[];\r\n  minQuestions: number;\r\n  maxDuration: number;\r\n}\r\n\r\nconst QuizFilters: React.FC<QuizFiltersProps> = ({\r\n  onFilterChange,\r\n  categories,\r\n  difficulties,\r\n  totalQuizzes,\r\n  filteredCount\r\n}) => {\r\n  const { t } = useTranslation();\r\n\r\n  const [filters, setFilters] = useState<FilterOptions>({\r\n    search: '',\r\n    category: 'all',\r\n    difficulty: 'all',\r\n    sortBy: 'newest',\r\n    showCompleted: true,\r\n    tags: [],\r\n    minQuestions: 0,\r\n    maxDuration: 120\r\n  });\r\n\r\n  const [showAdvanced, setShowAdvanced] = useState(false);\r\n\r\n  const updateFilter = (key: keyof FilterOptions, value: any) => {\r\n    const newFilters = { ...filters, [key]: value };\r\n    setFilters(newFilters);\r\n    onFilterChange(newFilters);\r\n  };\r\n\r\n  const resetFilters = () => {\r\n    const defaultFilters: FilterOptions = {\r\n      search: '',\r\n      category: 'all',\r\n      difficulty: 'all',\r\n      sortBy: 'newest',\r\n      showCompleted: true,\r\n      tags: [],\r\n      minQuestions: 0,\r\n      maxDuration: 120\r\n    };\r\n    setFilters(defaultFilters);\r\n    onFilterChange(defaultFilters);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8\">\r\n      {/* Quick Stats */}\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <div className=\"flex items-center gap-6\">\r\n          <div className=\"text-sm text-gray-600\">{t(\"profile.pagination.showing\")} <span className=\"font-semibold text-blue-600\">{filteredCount}</span> / {totalQuizzes} quiz\r\n          </div>\r\n          {filteredCount !== totalQuizzes && (\r\n            <button\r\n              onClick={resetFilters}\r\n              className=\"text-sm text-blue-600 hover:text-blue-700 font-medium\"\r\n            >{t(\"quizList.empty.clearFilters\")}\r\n            </button>\r\n          )}\r\n        </div>\r\n        <button\r\n          onClick={() => setShowAdvanced(!showAdvanced)}\r\n          className=\"text-sm text-gray-600 hover:text-gray-700 flex items-center gap-1\"\r\n        >\r\n          <span>{showAdvanced ? '·∫®n' : 'Hi·ªán'} t√πy ch·ªçn n√¢ng cao</span>\r\n          <svg \r\n            className={`w-4 h-4 transition-transform ${showAdvanced ? 'rotate-180' : ''}`} \r\n            fill=\"none\" \r\n            stroke=\"currentColor\" \r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      {/* Basic Filters */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4\">\r\n        {/* Search */}\r\n        <div className=\"lg:col-span-2\">\r\n          <input\r\n            type=\"text\"\r\n            placeholder={t('placeholders.searchQuiz')}\r\n            value={filters.search}\r\n            onChange={(e) => updateFilter('search', e.target.value)}\r\n            className=\"w-full border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n          />\r\n        </div>\r\n        \r\n        {/* Category */}\r\n        <select \r\n          value={filters.category}\r\n          onChange={(e) => updateFilter('category', e.target.value)}\r\n          className=\"border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n        >\r\n          <option value=\"all\">{t(\"quizList.filters.allCategories\")}</option>\r\n          {categories.map(c => <option key={c} value={c}>{c}</option>)}\r\n        </select>\r\n        \r\n        {/* Difficulty */}\r\n        <select \r\n          value={filters.difficulty}\r\n          onChange={(e) => updateFilter('difficulty', e.target.value)}\r\n          className=\"border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n        >\r\n          <option value=\"all\">{t(\"quizList.filters.allDifficulties\")}</option>\r\n          {difficulties.map(d => <option key={d} value={d}>\r\n            {d === 'easy' ? 'üòä D·ªÖ' : d === 'medium' ? 'üòê Trung b√¨nh' : 'üò§ Kh√≥'}\r\n          </option>)}\r\n        </select>\r\n      </div>\r\n\r\n      {/* Advanced Filters */}\r\n      {showAdvanced && (\r\n        <div className=\"border-t border-gray-100 pt-4\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\r\n            {/* Sort Options */}\r\n            <select \r\n              value={filters.sortBy}\r\n              onChange={(e) => updateFilter('sortBy', e.target.value)}\r\n              className=\"border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n            >\r\n              <option value=\"newest\">{t(\"quizList.sort.newest\")}</option>\r\n              <option value=\"oldest\">{t(\"quizList.sort.oldest\")}</option>\r\n              <option value=\"popular\">üî• Ph·ªï bi·∫øn nh·∫•t</option>\r\n              <option value=\"difficulty\">{t(\"quizList.sort.difficulty\")}</option>\r\n              <option value=\"questions\">üî¢ Theo s·ªë c√¢u h·ªèi</option>\r\n              <option value=\"duration\">‚è±Ô∏è Theo th·ªùi l∆∞·ª£ng</option>\r\n            </select>\r\n\r\n            {/* Min Questions */}\r\n            <div>\r\n              <label className=\"block text-sm text-gray-600 mb-1\">S·ªë c√¢u h·ªèi t·ªëi thi·ªÉu: {filters.minQuestions}</label>\r\n              <input\r\n                type=\"range\"\r\n                min=\"0\"\r\n                max=\"50\"\r\n                value={filters.minQuestions}\r\n                onChange={(e) => updateFilter('minQuestions', parseInt(e.target.value))}\r\n                className=\"w-full\"\r\n              />\r\n            </div>\r\n\r\n            {/* Max Duration */}\r\n            <div>\r\n              <label className=\"block text-sm text-gray-600 mb-1\">Th·ªùi l∆∞·ª£ng t·ªëi ƒëa: {filters.maxDuration} ph√∫t</label>\r\n              <input\r\n                type=\"range\"\r\n                min=\"5\"\r\n                max=\"120\"\r\n                value={filters.maxDuration}\r\n                onChange={(e) => updateFilter('maxDuration', parseInt(e.target.value))}\r\n                className=\"w-full\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Additional Options */}\r\n          <div className=\"flex items-center gap-6\">\r\n            <label className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={filters.showCompleted}\r\n                onChange={(e) => updateFilter('showCompleted', e.target.checked)}\r\n                className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n              />{t(\"quizList.options.showCompleted\")}\r\n            </label>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizFilters;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\QuizPreviewModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[542,545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[542,545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[569,572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[569,572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold flex items-center gap-2\">\r\n                üëÅÔ∏è {t('quiz.preview.title') || 'Preview Quiz'}\r\n              </h2>","line":33,"column":74,"nodeType":"JSXText","endLine":34,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n              onClick={onClose}\r\n              className=\"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-colors\"\r\n            >\r\n              ‚úï\r\n            </button>","line":43,"column":14,"nodeType":"JSXText","endLine":45,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3178,3181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3178,3181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3207,3210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3207,3210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-lg font-bold text-orange-900\">~{estimatedTime} min</p>","line":82,"column":80,"nodeType":"JSXText","endLine":82,"endColumn":84},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-semibold text-gray-900 mb-3\">\r\n              ‚öôÔ∏è {t('quiz.settings') || 'Settings'}\r\n            </h4>","line":88,"column":62,"nodeType":"JSXText","endLine":89,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4010,4013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4010,4013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4109,4112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4109,4112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4688,4691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4688,4691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5498,5501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5498,5501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-yellow-800 flex items-center gap-2\">\r\n                ‚ö†Ô∏è <span className=\"font-medium\">\r\n                  {t('quiz.validation.minQuestions') || 'Recommended: At least 3 questions for a good quiz'}\r\n                </span>\r\n              </p>","line":170,"column":70,"nodeType":"JSXText","endLine":171,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Quiz } from '../types';\r\n\r\ninterface QuizPreviewModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  quiz: Partial<Quiz>;\r\n  onProceedToPublish: () => void;\r\n}\r\n\r\nexport const QuizPreviewModal: React.FC<QuizPreviewModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  quiz,\r\n  onProceedToPublish\r\n}) => {\r\n  const { t } = useTranslation();\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const questionCount = quiz.questions?.length || 0;\r\n  const hasResources = (quiz as any).resources && (quiz as any).resources.length > 0;\r\n  const estimatedTime = questionCount * 1.5; // 1.5 ph√∫t/c√¢u\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl\">\r\n        {/* Header */}\r\n        <div className=\"bg-gradient-to-r from-indigo-600 to-blue-600 p-6 text-white rounded-t-2xl\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h2 className=\"text-2xl font-bold flex items-center gap-2\">\r\n                üëÅÔ∏è {t('quiz.preview.title') || 'Preview Quiz'}\r\n              </h2>\r\n              <p className=\"text-indigo-100 mt-1\">\r\n                {t('quiz.preview.subtitle') || 'Review before publishing'}\r\n              </p>\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-colors\"\r\n            >\r\n              ‚úï\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"p-6 space-y-6\">\r\n          {/* Quiz Header */}\r\n          <div>\r\n            <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n              {quiz.title || t('quiz.untitled')}\r\n            </h3>\r\n            <p className=\"text-gray-600 leading-relaxed\">\r\n              {quiz.description || t('quiz.noDescription')}\r\n            </p>\r\n          </div>\r\n\r\n          {/* Quiz Stats */}\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n            <div className=\"bg-blue-50 p-4 rounded-lg border border-blue-200\">\r\n              <p className=\"text-sm text-blue-600 mb-1\">{t('quiz.questions') || 'Questions'}</p>\r\n              <p className=\"text-2xl font-bold text-blue-900\">{questionCount}</p>\r\n            </div>\r\n            <div className=\"bg-purple-50 p-4 rounded-lg border border-purple-200\">\r\n              <p className=\"text-sm text-purple-600 mb-1\">{t('quiz.difficulty') || 'Difficulty'}</p>\r\n              <p className=\"text-lg font-bold text-purple-900\">\r\n                {quiz.difficulty === 'easy' ? 'üü¢ Easy' :\r\n                 quiz.difficulty === 'medium' ? 'üü° Medium' :\r\n                 quiz.difficulty === 'hard' ? 'üî¥ Hard' : '‚ùì'}\r\n              </p>\r\n            </div>\r\n            <div className=\"bg-green-50 p-4 rounded-lg border border-green-200\">\r\n              <p className=\"text-sm text-green-600 mb-1\">{t('quiz.timeLimit') || 'Time Limit'}</p>\r\n              <p className=\"text-lg font-bold text-green-900\">\r\n                {(quiz as any).timeLimit ? `${(quiz as any).timeLimit} min` : '‚àû Unlimited'}\r\n              </p>\r\n            </div>\r\n            <div className=\"bg-orange-50 p-4 rounded-lg border border-orange-200\">\r\n              <p className=\"text-sm text-orange-600 mb-1\">{t('quiz.estimatedTime') || 'Est. Time'}</p>\r\n              <p className=\"text-lg font-bold text-orange-900\">~{estimatedTime} min</p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Quiz Settings */}\r\n          <div className=\"bg-gray-50 p-4 rounded-lg border border-gray-200\">\r\n            <h4 className=\"font-semibold text-gray-900 mb-3\">\r\n              ‚öôÔ∏è {t('quiz.settings') || 'Settings'}\r\n            </h4>\r\n            <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className={(quiz as any).visibility === 'public' ? 'text-green-600' : 'text-orange-600'}>\r\n                  {(quiz as any).visibility === 'public' ? 'üåê Public' : 'üîí Password Protected'}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className=\"text-gray-700\">\r\n                  {quiz.category || t('quiz.noCategory')}\r\n                </span>\r\n              </div>\r\n              {hasResources && (\r\n                <div className=\"flex items-center gap-2 text-blue-600\">\r\n                  üìö {t('quiz.hasResources') || 'Has Learning Materials'}\r\n                </div>\r\n              )}\r\n              {(quiz as any).showResults && (\r\n                <div className=\"flex items-center gap-2 text-green-600\">\r\n                  ‚úÖ {t('quiz.showResults') || 'Show Results'}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Questions Preview */}\r\n          <div>\r\n            <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\r\n              üìù {t('quiz.questionsPreview') || 'Questions Preview'}\r\n              <span className=\"text-sm font-normal text-gray-500\">\r\n                ({questionCount} {t('quiz.total') || 'total'})\r\n              </span>\r\n            </h4>\r\n\r\n            <div className=\"space-y-3 max-h-96 overflow-y-auto\">\r\n              {quiz.questions && quiz.questions.length > 0 ? (\r\n                quiz.questions.slice(0, 5).map((q: any, index: number) => (\r\n                  <div key={index} className=\"bg-white p-4 rounded-lg border border-gray-200\">\r\n                    <div className=\"flex items-start gap-3\">\r\n                      <span className=\"flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-semibold text-sm\">\r\n                        {index + 1}\r\n                      </span>\r\n                      <div className=\"flex-1\">\r\n                        <p className=\"text-gray-900 font-medium mb-2\">{q.question}</p>\r\n                        <div className=\"space-y-1\">\r\n                          {q.options.map((opt: string, optIndex: number) => (\r\n                            <div\r\n                              key={optIndex}\r\n                              className={`text-sm px-3 py-1.5 rounded ${\r\n                                optIndex === q.correctAnswer\r\n                                  ? 'bg-green-50 text-green-700 border border-green-200'\r\n                                  : 'bg-gray-50 text-gray-600'\r\n                              }`}\r\n                            >\r\n                              {opt}\r\n                              {optIndex === q.correctAnswer && ' ‚úì'}\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))\r\n              ) : (\r\n                <div className=\"text-center py-8 text-gray-500\">\r\n                  {t('quiz.noQuestions') || 'No questions added yet'}\r\n                </div>\r\n              )}\r\n\r\n              {questionCount > 5 && (\r\n                <p className=\"text-center text-sm text-gray-500 py-2\">\r\n                  ... {t('quiz.andMore', { count: questionCount - 5 }) || `and ${questionCount - 5} more questions`}\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Validation Warnings */}\r\n          {questionCount < 3 && (\r\n            <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\r\n              <p className=\"text-yellow-800 flex items-center gap-2\">\r\n                ‚ö†Ô∏è <span className=\"font-medium\">\r\n                  {t('quiz.validation.minQuestions') || 'Recommended: At least 3 questions for a good quiz'}\r\n                </span>\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-between p-6 bg-gray-50 rounded-b-2xl border-t border-gray-200\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-6 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors\"\r\n          >\r\n            ‚Üê {t('common.back') || 'Back to Edit'}\r\n          </button>\r\n          <button\r\n            onClick={onProceedToPublish}\r\n            disabled={questionCount === 0}\r\n            className=\"px-6 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n          >\r\n            {t('quiz.preview.proceedPublish') || 'Proceed to Publish'} ‚Üí\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\QuizPublishModal.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"font-medium text-blue-900\">\r\n                  üë®‚Äçüíº {t('quiz.publish.requireReview') || 'Submit for Admin Review'}\r\n                </p>","line":150,"column":58,"nodeType":"JSXText","endLine":151,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium\">‚ÑπÔ∏è {t('quiz.publish.info') || 'What happens next'}:</span>","line":199,"column":45,"nodeType":"JSXText","endLine":199,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface QuizPublishModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onPublish: (settings: PublishSettings) => Promise<void>;\r\n  quizTitle: string;\r\n  currentStatus: 'draft' | 'pending' | 'approved' | 'rejected';\r\n}\r\n\r\nexport interface PublishSettings {\r\n  visibility: 'public' | 'password';\r\n  requireReview: boolean;\r\n  password?: string;\r\n  schedulePublish?: boolean;\r\n  publishDate?: string;\r\n  notifyUsers?: boolean;\r\n}\r\n\r\nexport const QuizPublishModal: React.FC<QuizPublishModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onPublish,\r\n  quizTitle,\r\n  currentStatus\r\n}) => {\r\n  const { t } = useTranslation();\r\n  const [loading, setLoading] = useState(false);\r\n  const [settings, setSettings] = useState<PublishSettings>({\r\n    visibility: 'public',\r\n    requireReview: true,\r\n    schedulePublish: false,\r\n    notifyUsers: false\r\n  });\r\n\r\n  const handlePublish = async () => {\r\n    try {\r\n      setLoading(true);\r\n      await onPublish(settings);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Error publishing quiz:', error);\r\n      alert(t('quiz.publish.error') || 'Failed to publish quiz');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl\">\r\n        {/* Header */}\r\n        <div className=\"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl\">\r\n          <h2 className=\"text-2xl font-bold flex items-center gap-2\">\r\n            üöÄ {t('quiz.publish.title') || 'Publish Quiz'}\r\n          </h2>\r\n          <p className=\"text-blue-100 mt-1\">{quizTitle}</p>\r\n        </div>\r\n\r\n        <div className=\"p-6 space-y-6\">\r\n          {/* Current Status */}\r\n          <div className=\"bg-gray-50 p-4 rounded-lg border border-gray-200\">\r\n            <p className=\"text-sm text-gray-600 mb-1\">\r\n              {t('quiz.publish.currentStatus') || 'Current Status'}:\r\n            </p>\r\n            <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${\r\n              currentStatus === 'draft' ? 'bg-gray-100 text-gray-800' :\r\n              currentStatus === 'pending' ? 'bg-yellow-100 text-yellow-800' :\r\n              currentStatus === 'approved' ? 'bg-green-100 text-green-800' :\r\n              'bg-red-100 text-red-800'\r\n            }`}>\r\n              {currentStatus === 'draft' ? 'üìù Draft' :\r\n               currentStatus === 'pending' ? '‚è≥ Pending Review' :\r\n               currentStatus === 'approved' ? '‚úÖ Approved' :\r\n               '‚ùå Rejected'}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Visibility Setting */}\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              {t('quiz.publish.visibility') || 'Visibility'}\r\n            </label>\r\n            <div className=\"space-y-3\">\r\n              <label className=\"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors\"\r\n                style={{ borderColor: settings.visibility === 'public' ? '#3b82f6' : '#e5e7eb' }}>\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"visibility\"\r\n                  value=\"public\"\r\n                  checked={settings.visibility === 'public'}\r\n                  onChange={(e) => setSettings({ ...settings, visibility: e.target.value as 'public' | 'password' })}\r\n                  className=\"mt-1\"\r\n                />\r\n                <div>\r\n                  <p className=\"font-medium text-gray-900\">\r\n                    üåê {t('quiz.visibility.public') || 'Public'}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500\">\r\n                    {t('quiz.visibility.publicDesc') || 'Anyone can access this quiz'}\r\n                  </p>\r\n                </div>\r\n              </label>\r\n\r\n              <label className=\"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-purple-50 transition-colors\"\r\n                style={{ borderColor: settings.visibility === 'password' ? '#8b5cf6' : '#e5e7eb' }}>\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"visibility\"\r\n                  value=\"password\"\r\n                  checked={settings.visibility === 'password'}\r\n                  onChange={(e) => setSettings({ ...settings, visibility: e.target.value as 'public' | 'password' })}\r\n                  className=\"mt-1\"\r\n                />\r\n                <div className=\"flex-1\">\r\n                  <p className=\"font-medium text-gray-900\">\r\n                    üîí {t('quiz.visibility.password') || 'Password Protected'}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500 mb-2\">\r\n                    {t('quiz.visibility.passwordDesc') || 'Requires password to access'}\r\n                  </p>\r\n                  {settings.visibility === 'password' && (\r\n                    <input\r\n                      type=\"password\"\r\n                      placeholder={t('quiz.password.enter') || 'Enter password...'}\r\n                      value={settings.password || ''}\r\n                      onChange={(e) => setSettings({ ...settings, password: e.target.value })}\r\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500\"\r\n                      required\r\n                    />\r\n                  )}\r\n                </div>\r\n              </label>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Review Requirement */}\r\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n            <label className=\"flex items-start gap-3 cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={settings.requireReview}\r\n                onChange={(e) => setSettings({ ...settings, requireReview: e.target.checked })}\r\n                className=\"mt-1\"\r\n              />\r\n              <div>\r\n                <p className=\"font-medium text-blue-900\">\r\n                  üë®‚Äçüíº {t('quiz.publish.requireReview') || 'Submit for Admin Review'}\r\n                </p>\r\n                <p className=\"text-sm text-blue-700\">\r\n                  {t('quiz.publish.requireReviewDesc') || 'Quiz will be reviewed by admin before going live'}\r\n                </p>\r\n              </div>\r\n            </label>\r\n          </div>\r\n\r\n          {/* Schedule Publishing */}\r\n          <div>\r\n            <label className=\"flex items-center gap-3 cursor-pointer mb-3\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={settings.schedulePublish || false}\r\n                onChange={(e) => setSettings({ ...settings, schedulePublish: e.target.checked })}\r\n              />\r\n              <span className=\"font-medium text-gray-700\">\r\n                üìÖ {t('quiz.publish.schedule') || 'Schedule Publishing'}\r\n              </span>\r\n            </label>\r\n\r\n            {settings.schedulePublish && (\r\n              <input\r\n                type=\"datetime-local\"\r\n                value={settings.publishDate || ''}\r\n                onChange={(e) => setSettings({ ...settings, publishDate: e.target.value })}\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                min={new Date().toISOString().slice(0, 16)}\r\n              />\r\n            )}\r\n          </div>\r\n\r\n          {/* Notify Users */}\r\n          <label className=\"flex items-center gap-3 cursor-pointer\">\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={settings.notifyUsers || false}\r\n              onChange={(e) => setSettings({ ...settings, notifyUsers: e.target.checked })}\r\n            />\r\n            <span className=\"text-gray-700\">\r\n              üîî {t('quiz.publish.notifyUsers') || 'Notify followers when published'}\r\n            </span>\r\n          </label>\r\n\r\n          {/* Info Box */}\r\n          <div className=\"bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-lg p-4\">\r\n            <p className=\"text-sm text-gray-700\">\r\n              <span className=\"font-medium\">‚ÑπÔ∏è {t('quiz.publish.info') || 'What happens next'}:</span>\r\n            </p>\r\n            <ul className=\"text-sm text-gray-600 mt-2 space-y-1 ml-4\">\r\n              {settings.requireReview ? (\r\n                <>\r\n                  <li>‚Ä¢ {t('quiz.publish.step1') || 'Quiz will be submitted for review'}</li>\r\n                  <li>‚Ä¢ {t('quiz.publish.step2') || 'Admin will review your quiz'}</li>\r\n                  <li>‚Ä¢ {t('quiz.publish.step3') || 'You will be notified of the decision'}</li>\r\n                  {settings.schedulePublish && (\r\n                    <li>‚Ä¢ {t('quiz.publish.step4') || 'Quiz will be published at scheduled time'}</li>\r\n                  )}\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <li>‚Ä¢ {t('quiz.publish.immediate1') || 'Quiz will be published immediately'}</li>\r\n                  <li>‚Ä¢ {t('quiz.publish.immediate2') || 'Users can start taking it right away'}</li>\r\n                </>\r\n              )}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-end gap-3 p-6 bg-gray-50 rounded-b-2xl\">\r\n          <button\r\n            onClick={onClose}\r\n            disabled={loading}\r\n            className=\"px-6 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50\"\r\n          >\r\n            {t('common.cancel') || 'Cancel'}\r\n          </button>\r\n          <button\r\n            onClick={handlePublish}\r\n            disabled={loading || (settings.visibility === 'password' && !settings.password)}\r\n            className=\"px-6 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n          >\r\n            {loading ? (\r\n              <>\r\n                <svg className=\"animate-spin h-5 w-5\" viewBox=\"0 0 24 24\">\r\n                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" fill=\"none\" />\r\n                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\r\n                </svg>\r\n                {t('quiz.publish.publishing') || 'Publishing...'}\r\n              </>\r\n            ) : (\r\n              <>\r\n                üöÄ {settings.requireReview \r\n                  ? (t('quiz.publish.submitReview') || 'Submit for Review')\r\n                  : (t('quiz.publish.publishNow') || 'Publish Now')\r\n                }\r\n              </>\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\QuizStats.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{averageQuestions} c√¢u h·ªèi trung b√¨nh</span>","line":54,"column":35,"nodeType":"JSXText","endLine":54,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Ti·∫øn ƒë·ªô</span>","line":73,"column":19,"nodeType":"JSXText","endLine":73,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>\r\n            {totalQuizzes > 0 ? Math.round(totalPlayers / totalQuizzes) : 0} trung b√¨nh/quiz\r\n          </span>","line":100,"column":77,"nodeType":"JSXText","endLine":101,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Ch·∫•t l∆∞·ª£ng t·ªët</span>","line":119,"column":17,"nodeType":"JSXText","endLine":119,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Ph√¢n b·ªë ƒë·ªô kh√≥</h3>","line":125,"column":66,"nodeType":"JSXText","endLine":125,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Danh m·ª•c ph·ªï bi·∫øn</h3>","line":177,"column":66,"nodeType":"JSXText","endLine":177,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm text-gray-600\">{count} quiz</span>","line":188,"column":64,"nodeType":"JSXText","endLine":188,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-center text-gray-500 py-4\">\r\n              Ch∆∞a c√≥ d·ªØ li·ªáu danh m·ª•c\r\n            </div>","line":199,"column":61,"nodeType":"JSXText","endLine":201,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Quiz } from '../types';\r\n\r\nimport { useTranslation } from 'react-i18next';\r\ninterface QuizStatsProps {\r\n  quizzes: Quiz[];\r\n}\r\n\r\nconst QuizStats: React.FC<QuizStatsProps> = ({ quizzes }) => {\r\n  const { t } = useTranslation();\r\n\r\n  // Calculate statistics\r\n  const totalQuizzes = quizzes.length;\r\n  const completedQuizzes = quizzes.filter(q => q.isCompleted).length;\r\n  const totalQuestions = quizzes.reduce((sum, q) => sum + q.questions.length, 0);\r\n  const averageQuestions = totalQuizzes > 0 ? Math.round(totalQuestions / totalQuizzes) : 0;\r\n  \r\n  const difficultyCount = {\r\n    easy: quizzes.filter(q => q.difficulty === 'easy').length,\r\n    medium: quizzes.filter(q => q.difficulty === 'medium').length,\r\n    hard: quizzes.filter(q => q.difficulty === 'hard').length\r\n  };\r\n\r\n  const categoryCount = quizzes.reduce((acc, quiz) => {\r\n    acc[quiz.category] = (acc[quiz.category] || 0) + 1;\r\n    return acc;\r\n  }, {} as Record<string, number>);\r\n\r\n  const topCategories = Object.entries(categoryCount)\r\n    .sort(([,a], [,b]) => b - a)\r\n    .slice(0, 5);\r\n\r\n  const totalPlayers = quizzes.reduce((sum, q) => sum + (q.totalPlayers || 0), 0);\r\n  const averageScore = quizzes.filter(q => q.averageScore).reduce((sum, q) => sum + (q.averageScore || 0), 0) / quizzes.filter(q => q.averageScore).length || 0;\r\n\r\n  const progressPercentage = totalQuizzes > 0 ? Math.round((completedQuizzes / totalQuizzes) * 100) : 0;\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\r\n      {/* Total Quizzes */}\r\n      <div className=\"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <p className=\"text-blue-100 text-sm font-medium\">{t(\"admin.quizManagement.cards.totalQuizzes\")}</p>\r\n            <p className=\"text-3xl font-bold\">{totalQuizzes}</p>\r\n          </div>\r\n          <div className=\"p-3 bg-white/20 rounded-lg\">\r\n            <svg className=\"w-8 h-8\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n              <path d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n            </svg>\r\n          </div>\r\n        </div>\r\n        <div className=\"mt-4 flex items-center text-blue-100 text-sm\">\r\n          <span>{averageQuestions} c√¢u h·ªèi trung b√¨nh</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Completed Progress */}\r\n      <div className=\"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <p className=\"text-green-100 text-sm font-medium\">{t(\"admin.quickActions.stats.completions\")}</p>\r\n            <p className=\"text-3xl font-bold\">{completedQuizzes}</p>\r\n          </div>\r\n          <div className=\"p-3 bg-white/20 rounded-lg\">\r\n            <svg className=\"w-8 h-8\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n              <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\"/>\r\n            </svg>\r\n          </div>\r\n        </div>\r\n        <div className=\"mt-4\">\r\n          <div className=\"flex items-center justify-between text-green-100 text-sm mb-1\">\r\n            <span>Ti·∫øn ƒë·ªô</span>\r\n            <span>{progressPercentage}%</span>\r\n          </div>\r\n          <div className=\"w-full bg-white/20 rounded-full h-2\">\r\n            <div \r\n              className=\"bg-white rounded-full h-2 transition-all duration-300\"\r\n              style={{ width: `${progressPercentage}%` }}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Total Players */}\r\n      <div className=\"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <p className=\"text-purple-100 text-sm font-medium\">{t(\"leaderboard.plays\")}</p>\r\n            <p className=\"text-3xl font-bold\">{totalPlayers.toLocaleString()}</p>\r\n          </div>\r\n          <div className=\"p-3 bg-white/20 rounded-lg\">\r\n            <svg className=\"w-8 h-8\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n              <path d=\"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z\"/>\r\n            </svg>\r\n          </div>\r\n        </div>\r\n        <div className=\"mt-4 flex items-center text-purple-100 text-sm\">\r\n          <span>\r\n            {totalQuizzes > 0 ? Math.round(totalPlayers / totalQuizzes) : 0} trung b√¨nh/quiz\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Average Score */}\r\n      <div className=\"bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-6 text-white\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <p className=\"text-orange-100 text-sm font-medium\">{t(\"leaderboard.avgScore\")}</p>\r\n            <p className=\"text-3xl font-bold\">{Math.round(averageScore)}%</p>\r\n          </div>\r\n          <div className=\"p-3 bg-white/20 rounded-lg\">\r\n            <svg className=\"w-8 h-8\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n              <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"/>\r\n            </svg>\r\n          </div>\r\n        </div>\r\n        <div className=\"mt-4 flex items-center text-orange-100 text-sm\">\r\n          <span>Ch·∫•t l∆∞·ª£ng t·ªët</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Difficulty Distribution */}\r\n      <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-200 md:col-span-2\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Ph√¢n b·ªë ƒë·ªô kh√≥</h3>\r\n        <div className=\"space-y-3\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-4 h-4 bg-green-500 rounded\"></div>\r\n              <span className=\"text-sm text-gray-600\">{t(\"difficulty.easy\")}</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              <span className=\"text-sm font-medium\">{difficultyCount.easy}</span>\r\n              <div className=\"w-20 bg-gray-200 rounded-full h-2\">\r\n                <div \r\n                  className=\"bg-green-500 h-2 rounded-full\"\r\n                  style={{ width: `${totalQuizzes > 0 ? (difficultyCount.easy / totalQuizzes) * 100 : 0}%` }}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-4 h-4 bg-yellow-500 rounded\"></div>\r\n              <span className=\"text-sm text-gray-600\">{t(\"difficulty.medium\")}</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              <span className=\"text-sm font-medium\">{difficultyCount.medium}</span>\r\n              <div className=\"w-20 bg-gray-200 rounded-full h-2\">\r\n                <div \r\n                  className=\"bg-yellow-500 h-2 rounded-full\"\r\n                  style={{ width: `${totalQuizzes > 0 ? (difficultyCount.medium / totalQuizzes) * 100 : 0}%` }}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-4 h-4 bg-red-500 rounded\"></div>\r\n              <span className=\"text-sm text-gray-600\">{t(\"difficulty.hard\")}</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              <span className=\"text-sm font-medium\">{difficultyCount.hard}</span>\r\n              <div className=\"w-20 bg-gray-200 rounded-full h-2\">\r\n                <div \r\n                  className=\"bg-red-500 h-2 rounded-full\"\r\n                  style={{ width: `${totalQuizzes > 0 ? (difficultyCount.hard / totalQuizzes) * 100 : 0}%` }}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Top Categories */}\r\n      <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-200 md:col-span-2\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Danh m·ª•c ph·ªï bi·∫øn</h3>\r\n        <div className=\"space-y-3\">\r\n          {topCategories.map(([category, count], index) => (\r\n            <div key={category} className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"flex items-center justify-center w-6 h-6 bg-blue-100 text-blue-600 rounded-full text-xs font-medium\">\r\n                  {index + 1}\r\n                </div>\r\n                <span className=\"text-sm text-gray-900 font-medium\">{category}</span>\r\n              </div>\r\n              <div className=\"flex items-center gap-3\">\r\n                <span className=\"text-sm text-gray-600\">{count} quiz</span>\r\n                <div className=\"w-16 bg-gray-200 rounded-full h-2\">\r\n                  <div \r\n                    className=\"bg-blue-500 h-2 rounded-full\"\r\n                    style={{ width: `${totalQuizzes > 0 ? (count / totalQuizzes) * 100 : 0}%` }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n          {topCategories.length === 0 && (\r\n            <div className=\"text-center text-gray-500 py-4\">\r\n              Ch∆∞a c√≥ d·ªØ li·ªáu danh m·ª•c\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizStats;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\ResourceViewers\\ImageSlidesViewer.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-400\">\r\n            Slide {currentIndex + 1} / {urls.length}\r\n          </p>","line":98,"column":48,"nodeType":"JSXText","endLine":99,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>\r\n            üìä ƒê√£ xem: {imagesViewed.size}/{urls.length} slides ({progressPercent}%)\r\n          </span>","line":124,"column":17,"nodeType":"JSXText","endLine":125,"endColumn":24},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>\r\n            üìä ƒê√£ xem: {imagesViewed.size}/{urls.length} slides ({progressPercent}%)\r\n          </span>","line":125,"column":57,"nodeType":"JSXText","endLine":125,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-400\">\r\n            ‚è±Ô∏è Th·ªùi gian slide n√†y: {imageViewTimes[currentIndex] || 0}s\r\n          </span>","line":127,"column":43,"nodeType":"JSXText","endLine":128,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-400\">\r\n            ‚è±Ô∏è Th·ªùi gian slide n√†y: {imageViewTimes[currentIndex] || 0}s\r\n          </span>","line":128,"column":72,"nodeType":"JSXText","endLine":129,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { ChevronLeft, ChevronRight, Maximize2, Grid } from 'lucide-react';\r\n\r\ninterface ImageSlidesViewerProps {\r\n  urls: string[]; // Array of image URLs\r\n  title: string;\r\n  onProgressUpdate: (progress: {\r\n    imagesViewed: number[];\r\n    imageViewTimes: Record<number, number>;\r\n  }) => void;\r\n  initialProgress?: {\r\n    imagesViewed?: number[];\r\n    imageViewTimes?: Record<number, number>;\r\n  };\r\n}\r\n\r\nexport const ImageSlidesViewer: React.FC<ImageSlidesViewerProps> = ({\r\n  urls,\r\n  title,\r\n  onProgressUpdate,\r\n  initialProgress\r\n}) => {\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [imagesViewed, setImagesViewed] = useState<Set<number>>(\r\n    new Set(initialProgress?.imagesViewed || [])\r\n  );\r\n  const [imageViewTimes, setImageViewTimes] = useState<Record<number, number>>(\r\n    initialProgress?.imageViewTimes || {}\r\n  );\r\n  const [imageStartTime, setImageStartTime] = useState<number>(Date.now());\r\n  const [showGrid, setShowGrid] = useState(false);\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Track image view time\r\n    const interval = setInterval(() => {\r\n      const newImageViewTimes = {\r\n        ...imageViewTimes,\r\n        [currentIndex]: (imageViewTimes[currentIndex] || 0) + 1\r\n      };\r\n      setImageViewTimes(newImageViewTimes);\r\n      \r\n      const newImagesViewed = new Set(imagesViewed).add(currentIndex);\r\n      setImagesViewed(newImagesViewed);\r\n      \r\n      onProgressUpdate({\r\n        imagesViewed: Array.from(newImagesViewed),\r\n        imageViewTimes: newImageViewTimes\r\n      });\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [currentIndex, imageStartTime, imageViewTimes, imagesViewed, onProgressUpdate]);\r\n\r\n  useEffect(() => {\r\n    // Reset timer when image changes\r\n    setImageStartTime(Date.now());\r\n    \r\n    // Mark image as viewed\r\n    const newImagesViewed = new Set(imagesViewed).add(currentIndex);\r\n    setImagesViewed(newImagesViewed);\r\n  }, [currentIndex, imagesViewed]);\r\n\r\n  const handlePrevious = useCallback(() => {\r\n    setCurrentIndex((prev) => Math.max(0, prev - 1));\r\n  }, []);\r\n\r\n  const handleNext = useCallback(() => {\r\n    setCurrentIndex((prev) => Math.min(urls.length - 1, prev + 1));\r\n  }, [urls.length]);\r\n\r\n  const handleImageClick = (index: number) => {\r\n    setCurrentIndex(index);\r\n    setShowGrid(false);\r\n  };\r\n\r\n  const handleKeyDown = useCallback((e: KeyboardEvent) => {\r\n    if (e.key === 'ArrowLeft') handlePrevious();\r\n    if (e.key === 'ArrowRight') handleNext();\r\n    if (e.key === 'Escape') setIsFullscreen(false);\r\n  }, [handlePrevious, handleNext]);\r\n\r\n  useEffect(() => {\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, [handleKeyDown]);\r\n\r\n  const progressPercent = urls.length > 0 ? Math.round((imagesViewed.size / urls.length) * 100) : 0;\r\n\r\n  return (\r\n    <div className={`flex flex-col bg-gray-900 rounded-lg overflow-hidden ${\r\n      isFullscreen ? 'fixed inset-0 z-50' : 'h-full'\r\n    }`}>\r\n      {/* Header */}\r\n      <div className=\"bg-gray-800 text-white p-4 flex items-center justify-between\">\r\n        <div>\r\n          <h3 className=\"font-semibold\">{title}</h3>\r\n          <p className=\"text-sm text-gray-400\">\r\n            Slide {currentIndex + 1} / {urls.length}\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center gap-2\">\r\n          <button\r\n            onClick={() => setShowGrid(!showGrid)}\r\n            className=\"p-2 rounded hover:bg-gray-700 transition-colors\"\r\n            title={showGrid ? 'Xem slide' : 'Xem t·ªïng quan'}\r\n          >\r\n            <Grid className=\"w-5 h-5\" />\r\n          </button>\r\n          <button\r\n            onClick={() => setIsFullscreen(!isFullscreen)}\r\n            className=\"p-2 rounded hover:bg-gray-700 transition-colors\"\r\n            title=\"To√†n m√†n h√¨nh\"\r\n          >\r\n            <Maximize2 className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Progress Bar */}\r\n      <div className=\"bg-gray-800 px-4 py-2 border-t border-gray-700\">\r\n        <div className=\"flex items-center justify-between text-sm text-white mb-1\">\r\n          <span>\r\n            üìä ƒê√£ xem: {imagesViewed.size}/{urls.length} slides ({progressPercent}%)\r\n          </span>\r\n          <span className=\"text-gray-400\">\r\n            ‚è±Ô∏è Th·ªùi gian slide n√†y: {imageViewTimes[currentIndex] || 0}s\r\n          </span>\r\n        </div>\r\n        <div className=\"w-full bg-gray-700 rounded-full h-2\">\r\n          <div\r\n            className=\"bg-blue-500 h-2 rounded-full transition-all\"\r\n            style={{ width: `${progressPercent}%` }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      {showGrid ? (\r\n        // Grid View\r\n        <div className=\"flex-1 overflow-auto p-4 bg-gray-900\">\r\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n            {urls.map((url, index) => (\r\n              <button\r\n                key={index}\r\n                onClick={() => handleImageClick(index)}\r\n                className={`relative aspect-video rounded-lg overflow-hidden border-2 transition-all ${\r\n                  index === currentIndex\r\n                    ? 'border-blue-500 ring-2 ring-blue-500'\r\n                    : imagesViewed.has(index)\r\n                    ? 'border-green-500'\r\n                    : 'border-gray-600 hover:border-gray-500'\r\n                }`}\r\n              >\r\n                <img\r\n                  src={url}\r\n                  alt={`Slide ${index + 1}`}\r\n                  className=\"w-full h-full object-cover\"\r\n                />\r\n                <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center text-white font-semibold\">\r\n                  {index + 1}\r\n                </div>\r\n                {imagesViewed.has(index) && (\r\n                  <div className=\"absolute top-2 right-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center\">\r\n                    <svg className=\"w-4 h-4 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                      <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                  </div>\r\n                )}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        // Slide View\r\n        <div className=\"flex-1 flex items-center justify-center bg-black relative\">\r\n          {/* Navigation Arrows */}\r\n          <button\r\n            onClick={handlePrevious}\r\n            disabled={currentIndex === 0}\r\n            className=\"absolute left-4 z-10 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 disabled:opacity-30 disabled:cursor-not-allowed transition-all\"\r\n          >\r\n            <ChevronLeft className=\"w-8 h-8\" />\r\n          </button>\r\n\r\n          <button\r\n            onClick={handleNext}\r\n            disabled={currentIndex === urls.length - 1}\r\n            className=\"absolute right-4 z-10 p-3 bg-black/50 text-white rounded-full hover:bg-black/70 disabled:opacity-30 disabled:cursor-not-allowed transition-all\"\r\n          >\r\n            <ChevronRight className=\"w-8 h-8\" />\r\n          </button>\r\n\r\n          {/* Current Image */}\r\n          <img\r\n            src={urls[currentIndex]}\r\n            alt={`Slide ${currentIndex + 1}`}\r\n            className=\"max-w-full max-h-full object-contain\"\r\n          />\r\n\r\n          {/* Slide Number Overlay */}\r\n          <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black/70 text-white px-4 py-2 rounded-full text-sm\">\r\n            {currentIndex + 1} / {urls.length}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Thumbnail Strip */}\r\n      {!showGrid && (\r\n        <div className=\"bg-gray-800 p-2 overflow-x-auto\">\r\n          <div className=\"flex gap-2\">\r\n            {urls.map((url, index) => (\r\n              <button\r\n                key={index}\r\n                onClick={() => setCurrentIndex(index)}\r\n                className={`relative flex-shrink-0 w-20 h-14 rounded overflow-hidden border-2 transition-all ${\r\n                  index === currentIndex\r\n                    ? 'border-blue-500 ring-2 ring-blue-500'\r\n                    : imagesViewed.has(index)\r\n                    ? 'border-green-500'\r\n                    : 'border-gray-600 hover:border-gray-500'\r\n                }`}\r\n              >\r\n                <img\r\n                  src={url}\r\n                  alt={`Slide ${index + 1}`}\r\n                  className=\"w-full h-full object-cover\"\r\n                />\r\n                {imagesViewed.has(index) && (\r\n                  <div className=\"absolute top-0 right-0 w-4 h-4 bg-green-500 rounded-full border-2 border-gray-800\" />\r\n                )}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\ResourceViewers\\LinkViewer.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Th·ªùi gian ƒë·ªçc: ~{estimatedTime} ph√∫t</span>","line":77,"column":21,"nodeType":"JSXText","endLine":77,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Th·ªùi gian ƒë·ªçc: ~{estimatedTime} ph√∫t</span>","line":77,"column":52,"nodeType":"JSXText","endLine":77,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>ƒê√£ xem: {formatTime(timeSpent)}</span>","line":82,"column":19,"nodeType":"JSXText","endLine":82,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"text-lg font-semibold text-gray-900 mb-2\">\r\n              Kh√¥ng th·ªÉ xem tr·ª±c ti·∫øp\r\n            </h4>","line":100,"column":70,"nodeType":"JSXText","endLine":102,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600 mb-6 max-w-md\">\r\n              Trang web n√†y kh√¥ng h·ªó tr·ª£ xem nh√∫ng. Vui l√≤ng nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ m·ªü trong tab m·ªõi.\r\n            </p>","line":103,"column":56,"nodeType":"JSXText","endLine":105,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n              onClick={handleOpenExternal}\r\n              className=\"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n            >\r\n              <ExternalLink className=\"w-5 h-5\" />\r\n              M·ªü trong tab m·ªõi\r\n            </button>","line":110,"column":51,"nodeType":"JSXText","endLine":112,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-700 mb-1\">\r\n                üìñ ƒê√£ ƒë·ªçc xong t√†i li·ªáu n√†y?\r\n              </p>","line":122,"column":57,"nodeType":"JSXText","endLine":124,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-gray-500\">\r\n                X√°c nh·∫≠n ƒë·ªÉ ti·∫øp t·ª•c (ho·∫∑c m·ªü trong tab m·ªõi ƒë·ªÉ ƒë·ªçc)\r\n              </p>","line":125,"column":52,"nodeType":"JSXText","endLine":127,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                onClick={handleOpenExternal}\r\n                className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm\"\r\n              >\r\n                M·ªü tab m·ªõi\r\n              </button>","line":133,"column":16,"nodeType":"JSXText","endLine":135,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                onClick={handleConfirm}\r\n                className=\"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium\"\r\n              >\r\n                ‚úì ƒê√£ ƒë·ªçc xong\r\n              </button>","line":139,"column":16,"nodeType":"JSXText","endLine":141,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium\">ƒê√£ x√°c nh·∫≠n ho√†n th√†nh</span>","line":147,"column":43,"nodeType":"JSXText","endLine":147,"endColumn":65}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { ExternalLink, CheckCircle, Clock } from 'lucide-react';\r\n\r\ninterface LinkViewerProps {\r\n  url: string;\r\n  title: string;\r\n  description?: string;\r\n  estimatedTime?: number;\r\n  onProgressUpdate: (progress: {\r\n    confirmed: boolean;\r\n    timeSpent: number;\r\n  }) => void;\r\n  initialProgress?: {\r\n    confirmed?: boolean;\r\n    timeSpent?: number;\r\n  };\r\n}\r\n\r\nexport const LinkViewer: React.FC<LinkViewerProps> = ({\r\n  url,\r\n  title,\r\n  description,\r\n  estimatedTime,\r\n  onProgressUpdate,\r\n  initialProgress\r\n}) => {\r\n  const [confirmed, setConfirmed] = useState(initialProgress?.confirmed || false);\r\n  const [timeSpent, setTimeSpent] = useState(initialProgress?.timeSpent || 0);\r\n  const [isIframeSupported, setIsIframeSupported] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Track time spent\r\n    const interval = setInterval(() => {\r\n      const newTimeSpent = timeSpent + 1;\r\n      setTimeSpent(newTimeSpent);\r\n      \r\n      onProgressUpdate({\r\n        confirmed,\r\n        timeSpent: newTimeSpent\r\n      });\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [timeSpent, confirmed, onProgressUpdate]);\r\n\r\n  const handleConfirm = () => {\r\n    setConfirmed(true);\r\n    onProgressUpdate({\r\n      confirmed: true,\r\n      timeSpent\r\n    });\r\n  };\r\n\r\n  const handleOpenExternal = () => {\r\n    window.open(url, '_blank', 'noopener,noreferrer');\r\n  };\r\n\r\n  const formatTime = (seconds: number) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-white rounded-lg overflow-hidden border border-gray-200\">\r\n      {/* Header */}\r\n      <div className=\"bg-gradient-to-r from-blue-50 to-purple-50 p-6 border-b border-gray-200\">\r\n        <h3 className=\"text-xl font-bold text-gray-900 mb-2\">{title}</h3>\r\n        {description && (\r\n          <p className=\"text-gray-600 mb-4\">{description}</p>\r\n        )}\r\n        \r\n        <div className=\"flex items-center gap-4 text-sm text-gray-700\">\r\n          {estimatedTime && (\r\n            <div className=\"flex items-center gap-2\">\r\n              <Clock className=\"w-4 h-4\" />\r\n              <span>Th·ªùi gian ƒë·ªçc: ~{estimatedTime} ph√∫t</span>\r\n            </div>\r\n          )}\r\n          <div className=\"flex items-center gap-2\">\r\n            <Clock className=\"w-4 h-4\" />\r\n            <span>ƒê√£ xem: {formatTime(timeSpent)}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"flex-1 overflow-hidden relative\">\r\n        {isIframeSupported ? (\r\n          <iframe\r\n            src={url}\r\n            className=\"w-full h-full border-0\"\r\n            title={title}\r\n            sandbox=\"allow-same-origin allow-scripts allow-popups allow-forms\"\r\n            onError={() => setIsIframeSupported(false)}\r\n          />\r\n        ) : (\r\n          <div className=\"flex flex-col items-center justify-center h-full p-8 text-center\">\r\n            <ExternalLink className=\"w-16 h-16 text-gray-400 mb-4\" />\r\n            <h4 className=\"text-lg font-semibold text-gray-900 mb-2\">\r\n              Kh√¥ng th·ªÉ xem tr·ª±c ti·∫øp\r\n            </h4>\r\n            <p className=\"text-gray-600 mb-6 max-w-md\">\r\n              Trang web n√†y kh√¥ng h·ªó tr·ª£ xem nh√∫ng. Vui l√≤ng nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ m·ªü trong tab m·ªõi.\r\n            </p>\r\n            <button\r\n              onClick={handleOpenExternal}\r\n              className=\"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n            >\r\n              <ExternalLink className=\"w-5 h-5\" />\r\n              M·ªü trong tab m·ªõi\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Confirmation Footer */}\r\n      <div className=\"bg-gray-50 border-t border-gray-200 p-4\">\r\n        {!confirmed ? (\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex-1\">\r\n              <p className=\"text-sm text-gray-700 mb-1\">\r\n                üìñ ƒê√£ ƒë·ªçc xong t√†i li·ªáu n√†y?\r\n              </p>\r\n              <p className=\"text-xs text-gray-500\">\r\n                X√°c nh·∫≠n ƒë·ªÉ ti·∫øp t·ª•c (ho·∫∑c m·ªü trong tab m·ªõi ƒë·ªÉ ƒë·ªçc)\r\n              </p>\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={handleOpenExternal}\r\n                className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm\"\r\n              >\r\n                M·ªü tab m·ªõi\r\n              </button>\r\n              <button\r\n                onClick={handleConfirm}\r\n                className=\"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium\"\r\n              >\r\n                ‚úì ƒê√£ ƒë·ªçc xong\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex items-center justify-center gap-2 text-green-600 py-2\">\r\n            <CheckCircle className=\"w-5 h-5\" />\r\n            <span className=\"font-medium\">ƒê√£ x√°c nh·∫≠n ho√†n th√†nh</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\ResourceViewers\\PDFViewer.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-700\">\r\n            üìñ ƒê√£ xem: {pagesViewed.size}/{totalPages} trang ({progressPercent}%)\r\n          </span>","line":164,"column":43,"nodeType":"JSXText","endLine":165,"endColumn":24},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-700\">\r\n            üìñ ƒê√£ xem: {pagesViewed.size}/{totalPages} trang ({progressPercent}%)\r\n          </span>","line":165,"column":55,"nodeType":"JSXText","endLine":165,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600\">\r\n            ‚è±Ô∏è Th·ªùi gian trang n√†y: {pageViewTimes[currentPage] || 0}s\r\n          </span>","line":167,"column":43,"nodeType":"JSXText","endLine":168,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600\">\r\n            ‚è±Ô∏è Th·ªùi gian trang n√†y: {pageViewTimes[currentPage] || 0}s\r\n          </span>","line":168,"column":70,"nodeType":"JSXText","endLine":169,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { ChevronLeft, ChevronRight, ZoomIn, ZoomOut, Download } from 'lucide-react';\r\n\r\ninterface PDFViewerProps {\r\n  url: string;\r\n  title: string;\r\n  onProgressUpdate: (progress: {\r\n    pagesViewed: number[];\r\n    pageViewTimes: Record<number, number>;\r\n  }) => void;\r\n  initialProgress?: {\r\n    pagesViewed?: number[];\r\n    pageViewTimes?: Record<number, number>;\r\n  };\r\n}\r\n\r\nexport const PDFViewer: React.FC<PDFViewerProps> = ({\r\n  url,\r\n  title,\r\n  onProgressUpdate,\r\n  initialProgress\r\n}) => {\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(0);\r\n  const [zoom, setZoom] = useState(1);\r\n  const [pagesViewed, setPagesViewed] = useState<Set<number>>(\r\n    new Set(initialProgress?.pagesViewed || [])\r\n  );\r\n  const [pageViewTimes, setPageViewTimes] = useState<Record<number, number>>(\r\n    initialProgress?.pageViewTimes || {}\r\n  );\r\n  const [pageStartTime] = useState<number>(Date.now());\r\n\r\n  useEffect(() => {\r\n    // Track page view time\r\n    const interval = setInterval(() => {\r\n      const newPageViewTimes = {\r\n        ...pageViewTimes,\r\n        [currentPage]: (pageViewTimes[currentPage] || 0) + 1\r\n      };\r\n      setPageViewTimes(newPageViewTimes);\r\n      \r\n      const newPagesViewed = new Set(pagesViewed).add(currentPage);\r\n      setPagesViewed(newPagesViewed);\r\n      \r\n      onProgressUpdate({\r\n        pagesViewed: Array.from(newPagesViewed),\r\n        pageViewTimes: newPageViewTimes\r\n      });\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [currentPage, pageStartTime, onProgressUpdate, pageViewTimes, pagesViewed]);\r\n\r\n  useEffect(() => {\r\n    // Mark page as viewed\r\n    const newPagesViewed = new Set(pagesViewed).add(currentPage);\r\n    setPagesViewed(newPagesViewed);\r\n  }, [currentPage, pagesViewed]);\r\n\r\n  const handlePrevPage = () => {\r\n    if (currentPage > 1) {\r\n      setCurrentPage(currentPage - 1);\r\n    }\r\n  };\r\n\r\n  const handleNextPage = () => {\r\n    if (currentPage < totalPages) {\r\n      setCurrentPage(currentPage + 1);\r\n    }\r\n  };\r\n\r\n  const handleZoomIn = () => {\r\n    setZoom(Math.min(zoom + 0.25, 3));\r\n  };\r\n\r\n  const handleZoomOut = () => {\r\n    setZoom(Math.max(zoom - 0.25, 0.5));\r\n  };\r\n\r\n  const handleDownload = () => {\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = title || 'document.pdf';\r\n    link.click();\r\n  };\r\n\r\n  const progressPercent = totalPages > 0 ? Math.round((pagesViewed.size / totalPages) * 100) : 0;\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-gray-100 rounded-lg overflow-hidden\">\r\n      {/* Toolbar */}\r\n      <div className=\"bg-white border-b border-gray-200 p-3 flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          {/* Navigation */}\r\n          <button\r\n            onClick={handlePrevPage}\r\n            disabled={currentPage === 1}\r\n            className=\"p-2 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            <ChevronLeft className=\"w-5 h-5\" />\r\n          </button>\r\n          \r\n          <div className=\"flex items-center gap-2\">\r\n            <input\r\n              type=\"number\"\r\n              min=\"1\"\r\n              max={totalPages}\r\n              value={currentPage}\r\n              onChange={(e) => {\r\n                const page = parseInt(e.target.value);\r\n                if (page >= 1 && page <= totalPages) {\r\n                  setCurrentPage(page);\r\n                }\r\n              }}\r\n              className=\"w-16 px-2 py-1 border border-gray-300 rounded text-center\"\r\n            />\r\n            <span className=\"text-gray-600\">/ {totalPages || '?'}</span>\r\n          </div>\r\n\r\n          <button\r\n            onClick={handleNextPage}\r\n            disabled={currentPage === totalPages}\r\n            className=\"p-2 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            <ChevronRight className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-3\">\r\n          {/* Zoom */}\r\n          <button\r\n            onClick={handleZoomOut}\r\n            className=\"p-2 rounded hover:bg-gray-100\"\r\n            disabled={zoom <= 0.5}\r\n          >\r\n            <ZoomOut className=\"w-5 h-5\" />\r\n          </button>\r\n          <span className=\"text-sm text-gray-600 w-12 text-center\">\r\n            {Math.round(zoom * 100)}%\r\n          </span>\r\n          <button\r\n            onClick={handleZoomIn}\r\n            className=\"p-2 rounded hover:bg-gray-100\"\r\n            disabled={zoom >= 3}\r\n          >\r\n            <ZoomIn className=\"w-5 h-5\" />\r\n          </button>\r\n\r\n          {/* Download */}\r\n          <button\r\n            onClick={handleDownload}\r\n            className=\"p-2 rounded hover:bg-gray-100\"\r\n            title=\"T·∫£i xu·ªëng\"\r\n          >\r\n            <Download className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Progress Bar */}\r\n      <div className=\"bg-blue-50 px-4 py-2 border-b border-gray-200\">\r\n        <div className=\"flex items-center justify-between text-sm mb-1\">\r\n          <span className=\"text-gray-700\">\r\n            üìñ ƒê√£ xem: {pagesViewed.size}/{totalPages} trang ({progressPercent}%)\r\n          </span>\r\n          <span className=\"text-gray-600\">\r\n            ‚è±Ô∏è Th·ªùi gian trang n√†y: {pageViewTimes[currentPage] || 0}s\r\n          </span>\r\n        </div>\r\n        <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n          <div\r\n            className=\"bg-blue-600 h-2 rounded-full transition-all\"\r\n            style={{ width: `${progressPercent}%` }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* PDF Viewer */}\r\n      <div className=\"flex-1 overflow-auto p-4 flex items-center justify-center\">\r\n        <div\r\n          style={{\r\n            transform: `scale(${zoom})`,\r\n            transformOrigin: 'top center',\r\n            transition: 'transform 0.2s'\r\n          }}\r\n        >\r\n          <iframe\r\n            src={`${url}#page=${currentPage}&toolbar=0&navpanes=0`}\r\n            className=\"w-full h-screen border border-gray-300 rounded shadow-lg\"\r\n            title={title}\r\n            onLoad={() => {\r\n              // Try to detect total pages (not always possible with iframe)\r\n              // This is a simplified version\r\n              if (!totalPages) {\r\n                setTotalPages(10); // Default fallback\r\n              }\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Page Thumbnails/Navigator */}\r\n      <div className=\"bg-white border-t border-gray-200 p-2 overflow-x-auto\">\r\n        <div className=\"flex gap-2\">\r\n          {Array.from({ length: totalPages || 10 }, (_, i) => i + 1).map(pageNum => (\r\n            <button\r\n              key={pageNum}\r\n              onClick={() => setCurrentPage(pageNum)}\r\n              className={`relative flex-shrink-0 w-12 h-16 border-2 rounded transition-all ${\r\n                pageNum === currentPage\r\n                  ? 'border-blue-500 bg-blue-50'\r\n                  : pagesViewed.has(pageNum)\r\n                  ? 'border-green-300 bg-green-50'\r\n                  : 'border-gray-300 bg-white'\r\n              }`}\r\n            >\r\n              <div className=\"flex items-center justify-center h-full text-xs font-medium\">\r\n                {pageNum}\r\n              </div>\r\n              {pagesViewed.has(pageNum) && (\r\n                <div className=\"absolute top-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white\" />\r\n              )}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\ResourceViewers\\VideoViewer.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"absolute bottom-4 left-4 right-4 bg-black/70 text-white text-sm px-3 py-2 rounded\">\r\n          ‚è±Ô∏è ƒê√£ xem: {formatTime(totalWatchedSeconds)} | \r\n          üìä Ti·∫øn ƒë·ªô: {Math.round((totalWatchedSeconds / (duration || 1)) * 100)}%\r\n        </div>","line":153,"column":108,"nodeType":"JSXText","endLine":154,"endColumn":22},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"absolute bottom-4 left-4 right-4 bg-black/70 text-white text-sm px-3 py-2 rounded\">\r\n          ‚è±Ô∏è ƒê√£ xem: {formatTime(totalWatchedSeconds)} | \r\n          üìä Ti·∫øn ƒë·ªô: {Math.round((totalWatchedSeconds / (duration || 1)) * 100)}%\r\n        </div>","line":154,"column":55,"nodeType":"JSXText","endLine":155,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm\">{playbackRate}x</span>","line":237,"column":57,"nodeType":"JSXText","endLine":237,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                    key={rate}\r\n                    onClick={() => handlePlaybackRateChange(rate)}\r\n                    className={`block w-full text-left px-3 py-1 rounded hover:bg-gray-700 text-sm ${\r\n                      rate === playbackRate ? 'text-blue-400' : ''\r\n                    }`}\r\n                  >\r\n                    {rate}x\r\n                  </button>","line":248,"column":27,"nodeType":"JSXText","endLine":249,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-2 text-xs text-gray-300\">\r\n          ‚è±Ô∏è T·ªïng th·ªùi gian xem: {formatTime(totalWatchedSeconds)} | \r\n          üìä Ti·∫øn ƒë·ªô: {Math.round((currentTime / duration) * 100)}%\r\n        </div>","line":265,"column":53,"nodeType":"JSXText","endLine":266,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-2 text-xs text-gray-300\">\r\n          ‚è±Ô∏è T·ªïng th·ªùi gian xem: {formatTime(totalWatchedSeconds)} | \r\n          üìä Ti·∫øn ƒë·ªô: {Math.round((currentTime / duration) * 100)}%\r\n        </div>","line":266,"column":67,"nodeType":"JSXText","endLine":267,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useEffect, useState } from 'react';\r\nimport { Play, Pause, Volume2, VolumeX, Maximize, Settings } from 'lucide-react';\r\n\r\ninterface VideoViewerProps {\r\n  url: string;\r\n  title: string;\r\n  onProgressUpdate: (progress: {\r\n    secondsWatched: number;\r\n    watchPercent: number;\r\n    lastWatchPosition: number;\r\n  }) => void;\r\n  initialProgress?: {\r\n    lastWatchPosition?: number;\r\n    secondsWatched?: number;\r\n  };\r\n}\r\n\r\nexport const VideoViewer: React.FC<VideoViewerProps> = ({\r\n  url,\r\n  title,\r\n  onProgressUpdate,\r\n  initialProgress\r\n}) => {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const progressIntervalRef = useRef<NodeJS.Timeout>();\r\n  \r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [isMuted, setIsMuted] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(0);\r\n  const [duration, setDuration] = useState(0);\r\n  const [volume, setVolume] = useState(1);\r\n  const [playbackRate, setPlaybackRate] = useState(1);\r\n  const [showControls, setShowControls] = useState(false);\r\n  const [totalWatchedSeconds, setTotalWatchedSeconds] = useState(\r\n    initialProgress?.secondsWatched || 0\r\n  );\r\n\r\n  // Extract video ID from YouTube URL\r\n  const getYouTubeVideoId = (url: string) => {\r\n    const regExp = /^.*(youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/;\r\n    const match = url.match(regExp);\r\n    return match && match[2].length === 11 ? match[2] : null;\r\n  };\r\n\r\n  const videoId = getYouTubeVideoId(url);\r\n  const isYouTube = !!videoId;\r\n\r\n  useEffect(() => {\r\n    if (videoRef.current && initialProgress?.lastWatchPosition) {\r\n      videoRef.current.currentTime = initialProgress.lastWatchPosition;\r\n    }\r\n  }, [initialProgress?.lastWatchPosition]);\r\n\r\n  useEffect(() => {\r\n    // Track progress every second when playing\r\n    if (isPlaying) {\r\n      progressIntervalRef.current = setInterval(() => {\r\n        if (videoRef.current) {\r\n          const current = videoRef.current.currentTime;\r\n          const total = videoRef.current.duration;\r\n          const watched = totalWatchedSeconds + 1;\r\n          \r\n          setTotalWatchedSeconds(watched);\r\n          setCurrentTime(current);\r\n          \r\n          onProgressUpdate({\r\n            secondsWatched: watched,\r\n            watchPercent: total > 0 ? Math.round((current / total) * 100) : 0,\r\n            lastWatchPosition: current\r\n          });\r\n        }\r\n      }, 1000);\r\n    } else {\r\n      if (progressIntervalRef.current) {\r\n        clearInterval(progressIntervalRef.current);\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (progressIntervalRef.current) {\r\n        clearInterval(progressIntervalRef.current);\r\n      }\r\n    };\r\n  }, [isPlaying, totalWatchedSeconds, onProgressUpdate]);\r\n\r\n  const handlePlayPause = () => {\r\n    if (videoRef.current) {\r\n      if (isPlaying) {\r\n        videoRef.current.pause();\r\n      } else {\r\n        videoRef.current.play();\r\n      }\r\n      setIsPlaying(!isPlaying);\r\n    }\r\n  };\r\n\r\n  const handleMuteToggle = () => {\r\n    if (videoRef.current) {\r\n      videoRef.current.muted = !isMuted;\r\n      setIsMuted(!isMuted);\r\n    }\r\n  };\r\n\r\n  const handleVolumeChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const newVolume = parseFloat(e.target.value);\r\n    if (videoRef.current) {\r\n      videoRef.current.volume = newVolume;\r\n      setVolume(newVolume);\r\n      setIsMuted(newVolume === 0);\r\n    }\r\n  };\r\n\r\n  const handleSeek = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const newTime = parseFloat(e.target.value);\r\n    if (videoRef.current) {\r\n      videoRef.current.currentTime = newTime;\r\n      setCurrentTime(newTime);\r\n    }\r\n  };\r\n\r\n  const handlePlaybackRateChange = (rate: number) => {\r\n    if (videoRef.current) {\r\n      videoRef.current.playbackRate = rate;\r\n      setPlaybackRate(rate);\r\n    }\r\n  };\r\n\r\n  const handleFullscreen = () => {\r\n    if (videoRef.current) {\r\n      if (videoRef.current.requestFullscreen) {\r\n        videoRef.current.requestFullscreen();\r\n      }\r\n    }\r\n  };\r\n\r\n  const formatTime = (seconds: number) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  if (isYouTube) {\r\n    // YouTube embed with API for tracking\r\n    return (\r\n      <div className=\"relative w-full\" style={{ paddingBottom: '56.25%' }}>\r\n        <iframe\r\n          src={`https://www.youtube.com/embed/${videoId}?enablejsapi=1&start=${Math.floor(initialProgress?.lastWatchPosition || 0)}`}\r\n          title={title}\r\n          className=\"absolute top-0 left-0 w-full h-full rounded-lg\"\r\n          allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\r\n          allowFullScreen\r\n        />\r\n        <div className=\"absolute bottom-4 left-4 right-4 bg-black/70 text-white text-sm px-3 py-2 rounded\">\r\n          ‚è±Ô∏è ƒê√£ xem: {formatTime(totalWatchedSeconds)} | \r\n          üìä Ti·∫øn ƒë·ªô: {Math.round((totalWatchedSeconds / (duration || 1)) * 100)}%\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Direct video player\r\n  return (\r\n    <div \r\n      className=\"relative w-full bg-black rounded-lg overflow-hidden\"\r\n      onMouseEnter={() => setShowControls(true)}\r\n      onMouseLeave={() => setShowControls(false)}\r\n    >\r\n      <video\r\n        ref={videoRef}\r\n        src={url}\r\n        className=\"w-full\"\r\n        onLoadedMetadata={(e) => setDuration(e.currentTarget.duration)}\r\n        onTimeUpdate={(e) => setCurrentTime(e.currentTarget.currentTime)}\r\n        onPlay={() => setIsPlaying(true)}\r\n        onPause={() => setIsPlaying(false)}\r\n      />\r\n\r\n      {/* Custom Controls */}\r\n      <div \r\n        className={`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 to-transparent p-4 transition-opacity ${\r\n          showControls ? 'opacity-100' : 'opacity-0'\r\n        }`}\r\n      >\r\n        {/* Progress Bar */}\r\n        <input\r\n          type=\"range\"\r\n          min=\"0\"\r\n          max={duration}\r\n          value={currentTime}\r\n          onChange={handleSeek}\r\n          className=\"w-full mb-2 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer\"\r\n          style={{\r\n            background: `linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(currentTime / duration) * 100}%, #4b5563 ${(currentTime / duration) * 100}%, #4b5563 100%)`\r\n          }}\r\n        />\r\n\r\n        <div className=\"flex items-center justify-between text-white\">\r\n          <div className=\"flex items-center gap-3\">\r\n            {/* Play/Pause */}\r\n            <button\r\n              onClick={handlePlayPause}\r\n              className=\"hover:text-blue-400 transition-colors\"\r\n            >\r\n              {isPlaying ? <Pause className=\"w-6 h-6\" /> : <Play className=\"w-6 h-6\" />}\r\n            </button>\r\n\r\n            {/* Volume */}\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={handleMuteToggle}\r\n                className=\"hover:text-blue-400 transition-colors\"\r\n              >\r\n                {isMuted ? <VolumeX className=\"w-5 h-5\" /> : <Volume2 className=\"w-5 h-5\" />}\r\n              </button>\r\n              <input\r\n                type=\"range\"\r\n                min=\"0\"\r\n                max=\"1\"\r\n                step=\"0.1\"\r\n                value={volume}\r\n                onChange={handleVolumeChange}\r\n                className=\"w-20 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer\"\r\n              />\r\n            </div>\r\n\r\n            {/* Time */}\r\n            <span className=\"text-sm\">\r\n              {formatTime(currentTime)} / {formatTime(duration)}\r\n            </span>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-3\">\r\n            {/* Playback Speed */}\r\n            <div className=\"relative group\">\r\n              <button className=\"hover:text-blue-400 transition-colors flex items-center gap-1\">\r\n                <Settings className=\"w-5 h-5\" />\r\n                <span className=\"text-sm\">{playbackRate}x</span>\r\n              </button>\r\n              <div className=\"absolute bottom-full right-0 mb-2 bg-gray-800 rounded-lg p-2 hidden group-hover:block\">\r\n                {[0.5, 0.75, 1, 1.25, 1.5, 2].map(rate => (\r\n                  <button\r\n                    key={rate}\r\n                    onClick={() => handlePlaybackRateChange(rate)}\r\n                    className={`block w-full text-left px-3 py-1 rounded hover:bg-gray-700 text-sm ${\r\n                      rate === playbackRate ? 'text-blue-400' : ''\r\n                    }`}\r\n                  >\r\n                    {rate}x\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Fullscreen */}\r\n            <button\r\n              onClick={handleFullscreen}\r\n              className=\"hover:text-blue-400 transition-colors\"\r\n            >\r\n              <Maximize className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats */}\r\n        <div className=\"mt-2 text-xs text-gray-300\">\r\n          ‚è±Ô∏è T·ªïng th·ªùi gian xem: {formatTime(totalWatchedSeconds)} | \r\n          üìä Ti·∫øn ƒë·ªô: {Math.round((currentTime / duration) * 100)}%\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\ResourceViewers\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\ReviewForm.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                ƒê√°nh gi√° c·ªßa b·∫°n\r\n              </label>","line":93,"column":79,"nodeType":"JSXText","endLine":95,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Nh·∫≠n x√©t (t√πy ch·ªçn)\r\n              </label>","line":129,"column":79,"nodeType":"JSXText","endLine":131,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-gray-500 mt-1\">\r\n                {comment.length}/500 k√Ω t·ª±\r\n              </p>","line":141,"column":33,"nodeType":"JSXText","endLine":142,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Star, Send, X } from 'lucide-react';\r\nimport { toast } from 'react-toastify';\r\nimport { reviewService } from '../services/reviewService';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\n\r\nimport { useTranslation } from 'react-i18next';\r\ninterface ReviewFormProps {\r\n  quizId: string;\r\n  onReviewSubmitted: () => void;\r\n  onClose: () => void;\r\n  existingReview?: {\r\n    id: string;\r\n    rating: number;\r\n    comment: string;\r\n  };\r\n}\r\n\r\nconst ReviewForm: React.FC<ReviewFormProps> = ({\r\n  quizId,\r\n  onReviewSubmitted,\r\n  onClose,\r\n  existingReview\r\n}) => {\r\n  const { t } = useTranslation();\r\n\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const [rating, setRating] = useState(existingReview?.rating || 0);\r\n  const [comment, setComment] = useState(existingReview?.comment || '');\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!user) {\r\n      toast.error('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒë√°nh gi√°');\r\n      return;\r\n    }\r\n\r\n    if (rating === 0) {\r\n      toast.error('Vui l√≤ng ch·ªçn s·ªë sao');\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    try {\r\n      if (existingReview) {\r\n        // Update existing review\r\n        await reviewService.updateReview(existingReview.id, {\r\n          rating,\r\n          comment\r\n        });\r\n        toast.success('C·∫≠p nh·∫≠t ƒë√°nh gi√° th√†nh c√¥ng!');\r\n      } else {\r\n        // Create new review\r\n        await reviewService.createReview({\r\n          quizId,\r\n          rating,\r\n          comment\r\n        }, user.uid, user.displayName || user.email || '');\r\n        toast.success('G·ª≠i ƒë√°nh gi√° th√†nh c√¥ng!');\r\n      }\r\n      \r\n      onReviewSubmitted();\r\n    } catch (error) {\r\n      console.error('Error submitting review:', error);\r\n      toast.error('C√≥ l·ªói khi g·ª≠i ƒë√°nh gi√°');\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\r\n        <div className=\"p-6\">\r\n          <div className=\"flex items-center justify-between mb-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900\">\r\n              {existingReview ? 'Ch·ªânh s·ª≠a ƒë√°nh gi√°' : 'Vi·∫øt ƒë√°nh gi√°'}\r\n            </h3>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"p-1 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            {/* Rating */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                ƒê√°nh gi√° c·ªßa b·∫°n\r\n              </label>\r\n              <div className=\"flex items-center space-x-1\">\r\n                {[1, 2, 3, 4, 5].map((star) => (\r\n                  <button\r\n                    key={star}\r\n                    type=\"button\"\r\n                    onClick={() => setRating(star)}\r\n                    className={`p-1 transition-colors ${\r\n                      star <= rating\r\n                        ? 'text-yellow-400 hover:text-yellow-500'\r\n                        : 'text-gray-300 hover:text-gray-400'\r\n                    }`}\r\n                  >\r\n                    <Star\r\n                      className={`w-8 h-8 ${\r\n                        star <= rating ? 'fill-current' : ''\r\n                      }`}\r\n                    />\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              {rating > 0 && (\r\n                <p className=\"text-sm text-gray-600 mt-1\">\r\n                  {rating === 1 && 'R·∫•t kh√¥ng h√†i l√≤ng'}\r\n                  {rating === 2 && 'Kh√¥ng h√†i l√≤ng'}\r\n                  {rating === 3 && 'B√¨nh th∆∞·ªùng'}\r\n                  {rating === 4 && 'H√†i l√≤ng'}\r\n                  {rating === 5 && 'R·∫•t h√†i l√≤ng'}\r\n                </p>\r\n              )}\r\n            </div>\r\n\r\n            {/* Comment */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Nh·∫≠n x√©t (t√πy ch·ªçn)\r\n              </label>\r\n              <textarea\r\n                value={comment}\r\n                onChange={(e) => setComment(e.target.value)}\r\n                rows={4}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\r\n                placeholder={t('placeholders.shareExperience')}\r\n                maxLength={500}\r\n              />\r\n              <p className=\"text-xs text-gray-500 mt-1\">\r\n                {comment.length}/500 k√Ω t·ª±\r\n              </p>\r\n            </div>\r\n\r\n            {/* Submit Button */}\r\n            <div className=\"flex items-center justify-end space-x-3\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={onClose}\r\n                className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors\"\r\n              >{t(\"common.cancel\")}\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={submitting || rating === 0}\r\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2\"\r\n              >\r\n                {submitting ? (\r\n                  <>\r\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\r\n                    <span>{t(\"admin.quickActions.modal.sending\")}</span>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Send className=\"w-4 h-4\" />\r\n                    <span>{existingReview ? 'C·∫≠p nh·∫≠t' : 'G·ª≠i ƒë√°nh gi√°'}</span>\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ReviewForm;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\components\\ReviewList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[860,863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[860,863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o</h3>","line":96,"column":64,"nodeType":"JSXText","endLine":96,"endColumn":84},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600\">H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë√°nh gi√° quiz n√†y!</p>","line":97,"column":38,"nodeType":"JSXText","endLine":97,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm text-gray-500\">\r\n                ({review.rating}/5 sao)\r\n              </span>","line":150,"column":33,"nodeType":"JSXText","endLine":151,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>H·ªØu √≠ch ({review.helpful?.length || 0})</span>","line":179,"column":25,"nodeType":"JSXText","endLine":179,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>B√°o c√°o</span>","line":187,"column":25,"nodeType":"JSXText","endLine":187,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-gray-500\">\r\n                  ƒê√£ ch·ªânh s·ª≠a {formatDate(review.updatedAt)}\r\n                </span>","line":192,"column":57,"nodeType":"JSXText","endLine":193,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Star, ThumbsUp, Flag, Calendar, User, MoreVertical } from 'lucide-react';\r\nimport { QuizReview } from '../types/review';\r\n\r\ninterface ReviewListProps {\r\n  reviews: QuizReview[];\r\n  loading: boolean;\r\n  onHelpfulClick?: (reviewId: string) => void;\r\n  onReportClick?: (reviewId: string) => void;\r\n}\r\n\r\nconst ReviewList: React.FC<ReviewListProps> = ({\r\n  reviews,\r\n  loading,\r\n  onHelpfulClick,\r\n  onReportClick\r\n}) => {\r\n  const [expandedReviews, setExpandedReviews] = useState<Set<string>>(new Set());\r\n\r\n  const toggleExpanded = (reviewId: string) => {\r\n    const newExpanded = new Set(expandedReviews);\r\n    if (newExpanded.has(reviewId)) {\r\n      newExpanded.delete(reviewId);\r\n    } else {\r\n      newExpanded.add(reviewId);\r\n    }\r\n    setExpandedReviews(newExpanded);\r\n  };\r\n\r\n  const formatDate = (date: any) => {\r\n    if (!date) return '';\r\n    const d = date.toDate ? date.toDate() : new Date(date);\r\n    return d.toLocaleDateString('vi-VN', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  const renderStars = (rating: number) => {\r\n    return (\r\n      <div className=\"flex items-center space-x-1\">\r\n        {[1, 2, 3, 4, 5].map((star) => (\r\n          <Star\r\n            key={star}\r\n            className={`w-4 h-4 ${\r\n              star <= rating\r\n                ? 'fill-yellow-400 text-yellow-400'\r\n                : 'text-gray-300'\r\n            }`}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const getRatingText = (rating: number) => {\r\n    switch (rating) {\r\n      case 1: return 'R·∫•t t·ªá';\r\n      case 2: return 'T·ªá';\r\n      case 3: return 'B√¨nh th∆∞·ªùng';\r\n      case 4: return 'T·ªët';\r\n      case 5: return 'R·∫•t t·ªët';\r\n      default: return '';\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        {[1, 2, 3].map((i) => (\r\n          <div key={i} className=\"animate-pulse\">\r\n            <div className=\"bg-gray-100 rounded-lg p-4\">\r\n              <div className=\"flex items-center space-x-3 mb-3\">\r\n                <div className=\"w-10 h-10 bg-gray-300 rounded-full\"></div>\r\n                <div className=\"flex-1\">\r\n                  <div className=\"h-4 bg-gray-300 rounded w-1/4 mb-1\"></div>\r\n                  <div className=\"h-3 bg-gray-300 rounded w-1/3\"></div>\r\n                </div>\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                <div className=\"h-4 bg-gray-300 rounded w-full\"></div>\r\n                <div className=\"h-4 bg-gray-300 rounded w-3/4\"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (reviews.length === 0) {\r\n    return (\r\n      <div className=\"text-center py-12\">\r\n        <Star className=\"w-16 h-16 text-gray-300 mx-auto mb-4\" />\r\n        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o</h3>\r\n        <p className=\"text-gray-600\">H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë√°nh gi√° quiz n√†y!</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {reviews.map((review) => {\r\n        const isExpanded = expandedReviews.has(review.id);\r\n        const shouldShowExpand = review.comment && review.comment.length > 200;\r\n        const displayComment = shouldShowExpand && !isExpanded \r\n          ? review.comment.substring(0, 200) + '...'\r\n          : review.comment;\r\n\r\n        return (\r\n          <div key={review.id} className=\"bg-white rounded-lg border border-gray-100 p-6 hover:shadow-md transition-shadow\">\r\n            {/* Header */}\r\n            <div className=\"flex items-start justify-between mb-4\">\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center\">\r\n                  {review.userAvatar ? (\r\n                    <img\r\n                      src={review.userAvatar}\r\n                      alt={review.userName}\r\n                      className=\"w-full h-full rounded-full object-cover\"\r\n                    />\r\n                  ) : (\r\n                    <User className=\"w-5 h-5 text-white\" />\r\n                  )}\r\n                </div>\r\n                <div>\r\n                  <h4 className=\"font-semibold text-gray-900\">{review.userName || 'Ng∆∞·ªùi d√πng ·∫©n danh'}</h4>\r\n                  <div className=\"flex items-center space-x-2 text-sm text-gray-500\">\r\n                    <Calendar className=\"w-3 h-3\" />\r\n                    <span>{formatDate(review.createdAt)}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"flex items-center space-x-2\">\r\n                <button className=\"p-1 text-gray-400 hover:text-gray-600 rounded\">\r\n                  <MoreVertical className=\"w-4 h-4\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Rating */}\r\n            <div className=\"flex items-center space-x-3 mb-4\">\r\n              {renderStars(review.rating)}\r\n              <span className=\"text-sm font-medium text-gray-700\">\r\n                {getRatingText(review.rating)}\r\n              </span>\r\n              <span className=\"text-sm text-gray-500\">\r\n                ({review.rating}/5 sao)\r\n              </span>\r\n            </div>\r\n\r\n            {/* Comment */}\r\n            {review.comment && (\r\n              <div className=\"mb-4\">\r\n                <p className=\"text-gray-700 leading-relaxed\">\r\n                  {displayComment}\r\n                </p>\r\n                {shouldShowExpand && (\r\n                  <button\r\n                    onClick={() => toggleExpanded(review.id)}\r\n                    className=\"mt-2 text-blue-600 hover:text-blue-700 text-sm font-medium\"\r\n                  >\r\n                    {isExpanded ? 'Thu g·ªçn' : 'Xem th√™m'}\r\n                  </button>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/* Actions */}\r\n            <div className=\"flex items-center justify-between pt-3 border-t border-gray-100\">\r\n              <div className=\"flex items-center space-x-4\">\r\n                <button\r\n                  onClick={() => onHelpfulClick?.(review.id)}\r\n                  className=\"flex items-center space-x-2 text-sm text-gray-600 hover:text-green-600 transition-colors\"\r\n                >\r\n                  <ThumbsUp className=\"w-4 h-4\" />\r\n                  <span>H·ªØu √≠ch ({review.helpful?.length || 0})</span>\r\n                </button>\r\n                \r\n                <button\r\n                  onClick={() => onReportClick?.(review.id)}\r\n                  className=\"flex items-center space-x-2 text-sm text-gray-600 hover:text-red-600 transition-colors\"\r\n                >\r\n                  <Flag className=\"w-4 h-4\" />\r\n                  <span>B√°o c√°o</span>\r\n                </button>\r\n              </div>\r\n\r\n              {review.updatedAt && review.updatedAt !== review.createdAt && (\r\n                <span className=\"text-xs text-gray-500\">\r\n                  ƒê√£ ch·ªânh s·ª≠a {formatDate(review.updatedAt)}\r\n                </span>\r\n              )}\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ReviewList;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\hooks\\useAutoSaveDraft.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\AdvancedAIGenerator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\FileUploadDemo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\FileUploadSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\HavePasswordStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\PrivacyStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\QuestionEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\QuestionsStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\QuizBulkImport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\QuizInfoStep.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium text-gray-700 mb-2\">Preview:</p>","line":208,"column":71,"nodeType":"JSXText","endLine":208,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-green-600\">‚úì</span>","line":280,"column":54,"nodeType":"JSXText","endLine":280,"endColumn":55}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { QuizFormData } from '../types';\r\nimport { categories, difficulties } from '../constants';\r\nimport RichTextEditor from '../../../../../shared/components/ui/RichTextEditor';\r\nimport RichTextViewer from '../../../../../shared/components/ui/RichTextViewer';\r\nimport ImageUploader from '../../../../../components/ImageUploader';\r\nimport { BookOpen, Clock, Tag, Star, FileText, ImageIcon, Lock, Key } from 'lucide-react';\r\n\r\ninterface QuizInfoStepProps {\r\n  quiz: QuizFormData;\r\n  setQuiz: React.Dispatch<React.SetStateAction<QuizFormData>>;\r\n}\r\n\r\nconst QuizInfoStep: React.FC<QuizInfoStepProps> = ({ quiz, setQuiz }) => {\r\n  const { t } = useTranslation();\r\n  \r\n  return (\r\n    <div className=\"space-y-8\">\r\n      {/* Header */}\r\n      <div className=\"text-center space-y-2\">\r\n        <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto\">\r\n          <BookOpen className=\"w-8 h-8 text-white\" />\r\n        </div>\r\n        <h2 className=\"text-2xl font-bold text-gray-900\">{t('createQuiz.info.basicInfo')}</h2>\r\n        <p className=\"text-gray-600\">{t('createQuiz.info.fillInfo')}</p>\r\n      </div>\r\n\r\n      {/* Form */}\r\n      <div className=\"space-y-6\">\r\n        {/* Title */}\r\n        <div className=\"space-y-2\">\r\n          <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n            <FileText className=\"w-4 h-4\" />\r\n            {t('createQuiz.info.titleLabel')}\r\n          </label>\r\n          <input\r\n            className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-lg\"\r\n            placeholder={t('createQuiz.info.titlePlaceholder')}\r\n            value={quiz.title}\r\n            onChange={e => setQuiz(q => ({ ...q, title: e.target.value }))}\r\n          />\r\n        </div>\r\n\r\n        {/* Description */}\r\n        <div className=\"space-y-2\">\r\n          <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n            <FileText className=\"w-4 h-4\" />\r\n            {t('createQuiz.info.descriptionLabel')}\r\n          </label>\r\n          <RichTextEditor\r\n            value={quiz.description}\r\n            onChange={(value: string) => setQuiz(q => ({ ...q, description: value }))}\r\n            placeholder={t('createQuiz.info.descriptionPlaceholder')}\r\n            height={200}\r\n          />\r\n        </div>\r\n\r\n        {/* Category & Difficulty */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n          <div className=\"space-y-2\">\r\n            <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n              <Tag className=\"w-4 h-4\" />\r\n              {t('createQuiz.info.categoryLabel')}\r\n            </label>\r\n            <select\r\n              className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n              value={quiz.category}\r\n              onChange={e => setQuiz(q => ({ ...q, category: e.target.value }))}\r\n            >\r\n              <option value=\"\">{t('createQuiz.info.categoryPlaceholder')}</option>\r\n              {categories.map(c => (\r\n                <option key={c.value} value={c.value}>{t(c.labelKey)}</option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n              <Star className=\"w-4 h-4\" />\r\n              {t('createQuiz.info.difficultyLabel')}\r\n            </label>\r\n            <select\r\n              className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n              value={quiz.difficulty}\r\n              onChange={e => setQuiz(q => ({ ...q, difficulty: e.target.value }))}\r\n            >\r\n              <option value=\"\">{t('createQuiz.info.difficultyPlaceholder')}</option>\r\n              {difficulties.map(d => (\r\n                <option key={d.value} value={d.value}>{t(d.labelKey)}</option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Duration only */}\r\n        <div className=\"space-y-2\">\r\n          <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n            <Clock className=\"w-4 h-4\" />\r\n            {t('createQuiz.info.durationLabel')}\r\n          </label>\r\n          <input\r\n            type=\"number\"\r\n            className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n            min={5}\r\n            max={120}\r\n            value={quiz.duration}\r\n            onChange={e => setQuiz(q => ({ ...q, duration: parseInt(e.target.value) || 15 }))}\r\n            placeholder={t('createQuiz.info.durationPlaceholder')}\r\n          />\r\n          <p className=\"text-sm text-gray-500\">{t('quizCreation.from5to120minutes')}</p>\r\n        </div>\r\n\r\n        {/* Tags */}\r\n        <div className=\"space-y-2\">\r\n          <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n            <Tag className=\"w-4 h-4\" />\r\n            {t('quizCreation.tagsOptional')}\r\n          </label>\r\n          <input\r\n            className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n            placeholder={t('placeholders.enterTags')}\r\n            value={quiz.tags?.join(', ') || ''}\r\n            onChange={e => setQuiz(q => ({ \r\n              ...q, \r\n              tags: e.target.value.split(',').map(tag => tag.trim()).filter(tag => tag) \r\n            }))}\r\n          />\r\n          <p className=\"text-sm text-gray-500\">{t('quizCreation.tagsExample')}</p>\r\n        </div>\r\n\r\n        {/* Cover Image Upload */}\r\n        <div className=\"space-y-2\">\r\n          <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n            <ImageIcon className=\"w-4 h-4\" />\r\n            {t('quizCreation.coverImage')}\r\n          </label>\r\n          \r\n          {/* Tab ch·ªçn Upload ho·∫∑c URL */}\r\n          <div className=\"flex gap-2 mb-3\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => {\r\n                const uploadMode = document.getElementById('upload-mode');\r\n                const urlMode = document.getElementById('url-mode');\r\n                if (uploadMode && urlMode) {\r\n                  uploadMode.classList.remove('hidden');\r\n                  urlMode.classList.add('hidden');\r\n                }\r\n              }}\r\n              className=\"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors\"\r\n            >\r\n              {t('quizCreation.uploadImage')}\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => {\r\n                const uploadMode = document.getElementById('upload-mode');\r\n                const urlMode = document.getElementById('url-mode');\r\n                if (uploadMode && urlMode) {\r\n                  uploadMode.classList.add('hidden');\r\n                  urlMode.classList.remove('hidden');\r\n                }\r\n              }}\r\n              className=\"px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors\"\r\n            >\r\n              {t('quizCreation.enterUrl')}\r\n            </button>\r\n          </div>\r\n\r\n          {/* Upload Mode */}\r\n          <div id=\"upload-mode\">\r\n            <ImageUploader\r\n              onUploadSuccess={(result) => {\r\n                if (result.success && result.originalUrl) {\r\n                  setQuiz(q => ({ ...q, imageUrl: result.originalUrl! }));\r\n                }\r\n              }}\r\n              onUploadError={(error) => {\r\n                console.error('Upload error:', error);\r\n              }}\r\n              options={{\r\n                folder: 'covers',\r\n                maxSizeKB: 3072, // 3MB\r\n                allowedTypes: ['image/jpeg', 'image/png', 'image/webp'],\r\n                generateThumbnails: true\r\n              }}\r\n              previewUrl={quiz.imageUrl || undefined}\r\n              label=\"\"\r\n              showThumbnails={false}\r\n              compressBeforeUpload={true}\r\n              instantUpload={true}\r\n              ultraFast={true}\r\n            />\r\n          </div>\r\n\r\n          {/* URL Mode */}\r\n          <div id=\"url-mode\" className=\"hidden\">\r\n            <input\r\n              type=\"url\"\r\n              value={quiz.imageUrl || ''}\r\n              onChange={(e) => setQuiz(q => ({ ...q, imageUrl: e.target.value }))}\r\n              placeholder={t('placeholders.imageUrl')}\r\n              className=\"w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n            />\r\n            {quiz.imageUrl && (\r\n              <div className=\"mt-3\">\r\n                <p className=\"text-sm font-medium text-gray-700 mb-2\">Preview:</p>\r\n                <img \r\n                  src={quiz.imageUrl} \r\n                  alt={t('createQuiz.info.previewImageAlt')} \r\n                  className=\"w-full h-48 object-cover rounded-lg border-2 border-gray-200\"\r\n                  onError={(e) => {\r\n                    (e.target as HTMLImageElement).src = 'https://via.placeholder.com/400x200?text=Invalid+Image+URL';\r\n                  }}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <p className=\"text-xs text-gray-500\">\r\n            {t('quizCreation.coverImageHint')}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Password Protection */}\r\n        <div className=\"space-y-3\">\r\n          <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n            <Lock className=\"w-4 h-4\" />\r\n            {t('quizCreation.quizSecurity')}\r\n          </label>\r\n          \r\n          {/* Have Password Checkbox */}\r\n          <div className=\"flex items-center gap-3 p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl border-2 border-purple-200\">\r\n            <input\r\n              type=\"checkbox\"\r\n              id=\"havePassword\"\r\n              checked={quiz.havePassword === 'password'}\r\n              onChange={(e) => {\r\n                setQuiz(q => ({\r\n                  ...q,\r\n                  havePassword: e.target.checked ? 'password' : 'public',\r\n                  password: e.target.checked ? q.password : ''\r\n                }));\r\n              }}\r\n              className=\"w-5 h-5 text-purple-600 rounded focus:ring-2 focus:ring-purple-500\"\r\n            />\r\n            <label htmlFor=\"havePassword\" className=\"flex-1 cursor-pointer\">\r\n              <div className=\"font-semibold text-purple-900 flex items-center gap-2\">\r\n                {t('quizCreation.requirePassword')}\r\n              </div>\r\n              <p className=\"text-sm text-purple-700 mt-1\">\r\n                {t('quizCreation.quizVisibleNeedPassword')}\r\n              </p>\r\n            </label>\r\n          </div>\r\n\r\n          {/* Password Input - Show when checkbox is checked */}\r\n          {quiz.havePassword === 'password' && (\r\n            <div className=\"ml-4 space-y-2 animate-in fade-in duration-300\">\r\n              <label className=\"flex items-center gap-2 text-sm font-medium text-gray-700\">\r\n                <Key className=\"w-4 h-4\" />\r\n                {t('quizCreation.passwordRequired')}\r\n              </label>\r\n              <div className=\"relative\">\r\n                <input\r\n                  type=\"password\"\r\n                  value={quiz.password || ''}\r\n                  onChange={(e) => setQuiz(q => ({ ...q, password: e.target.value }))}\r\n                  placeholder={t('placeholders.minPasswordLength')}\r\n                  minLength={6}\r\n                  className={`w-full px-4 py-3 pr-12 border-2 rounded-xl focus:outline-none focus:ring-2 transition-all ${\r\n                    quiz.password && quiz.password.length >= 6\r\n                      ? 'border-green-300 focus:border-green-500 focus:ring-green-500/20'\r\n                      : 'border-purple-200 focus:border-purple-500 focus:ring-purple-500/20'\r\n                  }`}\r\n                />\r\n                <div className=\"absolute right-3 top-1/2 -translate-y-1/2\">\r\n                  {quiz.password && quiz.password.length >= 6 ? (\r\n                    <span className=\"text-green-600\">‚úì</span>\r\n                  ) : (\r\n                    <Lock className=\"w-5 h-5 text-gray-400\" />\r\n                  )}\r\n                </div>\r\n              </div>\r\n              {quiz.password && quiz.password.length < 6 && (\r\n                <p className=\"text-sm text-red-600 flex items-center gap-2\">\r\n                  <span className=\"w-1 h-1 bg-red-600 rounded-full\" />\r\n                  {t('quizCreation.passwordMinLength')}\r\n                </p>\r\n              )}\r\n              <p className=\"text-xs text-gray-600\">\r\n                {t('quizCreation.passwordHint')}\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Additional Settings */}\r\n        <div className=\"space-y-3\">\r\n          <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n            <Star className=\"w-4 h-4\" />\r\n            {t('quizCreation.additionalSettings')}\r\n          </label>\r\n          \r\n          <div className=\"space-y-2\">\r\n            {/* Allow Retake */}\r\n            <div className=\"flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"allowRetake\"\r\n                checked={quiz.allowRetake !== false}\r\n                onChange={(e) => setQuiz(q => ({ ...q, allowRetake: e.target.checked }))}\r\n                className=\"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500\"\r\n              />\r\n              <label htmlFor=\"allowRetake\" className=\"flex-1 cursor-pointer\">\r\n                <div className=\"font-medium text-gray-900\">{t('quizCreation.allowRetake')}</div>\r\n                <p className=\"text-sm text-gray-600 mt-0.5\">\r\n                  {t('quizCreation.allowRetakeDesc')}\r\n                </p>\r\n              </label>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Preview */}\r\n      <div className=\"bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-2xl border border-blue-200\">\r\n        <h3 className=\"font-semibold text-blue-900 mb-3\">üìã {t('createQuiz.info.preview')}</h3>\r\n        <div className=\"space-y-2 text-sm\">\r\n          <p><strong>{t('createQuiz.info.previewLabels.title')}:</strong> {quiz.title || t('createQuiz.info.noTitle')}</p>\r\n          <div>\r\n            <strong>{t('createQuiz.info.previewLabels.description')}:</strong>{' '}\r\n            {quiz.description ? (\r\n              <RichTextViewer content={quiz.description} />\r\n            ) : (\r\n              <span>{t('createQuiz.info.noDescription')}</span>\r\n            )}\r\n          </div>\r\n          <p><strong>{t('createQuiz.info.previewLabels.category')}:</strong> {quiz.category ? t(`createQuiz.info.categoryOptions.${quiz.category}`) : t('createQuiz.info.noCategory')}</p>\r\n          <p><strong>{t('createQuiz.info.previewLabels.difficulty')}:</strong> {quiz.difficulty ? t(`difficulty.${quiz.difficulty as 'easy' | 'medium' | 'hard'}`) : t('createQuiz.info.noDifficulty')}</p>\r\n          <p><strong>{t('createQuiz.info.previewLabels.duration')}:</strong> {t('createQuiz.info.durationValue', { count: quiz.duration })}</p>\r\n          <p>\r\n            <strong>{t('createQuiz.info.previewLabels.privacy')}</strong>{' '}\r\n            <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded ${\r\n              quiz.isPublic === true \r\n                ? 'bg-blue-100 text-blue-700' \r\n                : 'bg-purple-100 text-purple-700'\r\n            }`}>\r\n              {quiz.isPublic === true ? (\r\n                <>\r\n                  {t('quizCreation.public')}\r\n                </>\r\n              ) : (\r\n                <>{t('quizCreation.private')}</>\r\n              )}\r\n            </span>\r\n          </p>\r\n          <p>\r\n            <strong>{t('createQuiz.info.previewLabels.retake')}:</strong>{' '}\r\n            {quiz.allowRetake !== false ? t('createQuiz.info.retakeAllowed') : t('createQuiz.info.retakeDisabled')}\r\n          </p>\r\n          {quiz.tags && quiz.tags.length > 0 && (\r\n            <p><strong>{t('createQuiz.info.previewLabels.tags')}:</strong> {quiz.tags.join(', ')}</p>\r\n          )}\r\n          {quiz.imageUrl && (\r\n            <div className=\"mt-3\">\r\n              <p><strong>{t('createQuiz.info.previewImage')}</strong></p>\r\n              <img src={quiz.imageUrl} alt={t('createQuiz.info.previewImageAlt')} className=\"mt-2 w-32 h-20 object-cover rounded-lg\" />\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizInfoStep;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\QuizInfoStep_new.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\QuizTypeStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\ResourcesStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3610,3613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3610,3613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6243,6246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6243,6246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>‚è±Ô∏è {resource.estimatedTime} ph√∫t</span>","line":346,"column":33,"nodeType":"JSXText","endLine":346,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>‚è±Ô∏è {resource.estimatedTime} ph√∫t</span>","line":346,"column":60,"nodeType":"JSXText","endLine":346,"endColumn":65}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * ResourcesStep - Step 3: Th√™m t√†i li·ªáu h·ªçc t·∫≠p (video/PDF/image/audio/YouTube)\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport { \r\n  Upload, \r\n  Video, \r\n  FileText, \r\n  Image as ImageIcon, \r\n  Music, \r\n  Link as LinkIcon,\r\n  Trash2,\r\n  Edit2,\r\n  Plus,\r\n  X\r\n} from 'lucide-react';\r\nimport { LearningResource, ResourceType } from '../../../types/learning';\r\nimport { uploadImage } from '../../../../../services/imageUploadService';\r\nimport { storage } from '../../../../../lib/firebase/config';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\nimport { toast } from 'react-toastify';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface ResourcesStepProps {\r\n  resources: LearningResource[];\r\n  onResourcesChange: (resources: LearningResource[]) => void;\r\n}\r\n\r\nconst ResourcesStep: React.FC<ResourcesStepProps> = ({ resources, onResourcesChange }) => {\r\n  const { t } = useTranslation();\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n\r\n  // Form state\r\n  const [formData, setFormData] = useState<Partial<LearningResource>>({\r\n    type: 'video',\r\n    title: '',\r\n    description: '',\r\n    url: '',\r\n    required: false,\r\n    threshold: {},\r\n    learningOutcomes: [],\r\n    order: resources.length\r\n  });\r\n\r\n  const handleAddResource = () => {\r\n    setShowForm(true);\r\n    setEditingId(null);\r\n    setFormData({\r\n      type: 'video',\r\n      title: '',\r\n      description: '',\r\n      url: '',\r\n      required: false,\r\n      threshold: {},\r\n      learningOutcomes: [],\r\n      order: resources.length\r\n    });\r\n  };\r\n\r\n  const handleEditResource = (resource: LearningResource) => {\r\n    setShowForm(true);\r\n    setEditingId(resource.id);\r\n    setFormData(resource);\r\n  };\r\n\r\n  const handleDeleteResource = (id: string) => {\r\n    if (confirm(t('resources.confirmDelete'))) {\r\n      onResourcesChange(resources.filter(r => r.id !== id));\r\n      toast.success(t('resources.success.deleted'));\r\n    }\r\n  };\r\n\r\n  const handleFileUpload = async (file: File, type: ResourceType) => {\r\n    setUploading(true);\r\n    try {\r\n      // Validate file size based on type\r\n      const maxSizes = {\r\n        video: 50 * 1024 * 1024, // 50MB\r\n        pdf: 10 * 1024 * 1024,   // 10MB\r\n        audio: 10 * 1024 * 1024, // 10MB\r\n        image: 5 * 1024 * 1024,  // 5MB\r\n        link: 0,\r\n        slides: 5 * 1024 * 1024\r\n      };\r\n\r\n      if (file.size > maxSizes[type]) {\r\n        const sizeMB = (maxSizes[type] / (1024 * 1024)).toFixed(0);\r\n        toast.error(t('resources.errors.fileTooLarge', { size: sizeMB, type }));\r\n        setUploading(false);\r\n        return;\r\n      }\r\n\r\n      // Validate file type strictly\r\n      const validTypes: Record<ResourceType, string[]> = {\r\n        video: ['video/mp4', 'video/webm', 'video/ogg', 'video/quicktime', 'video/x-msvideo'],\r\n        pdf: ['application/pdf'],\r\n        audio: ['audio/mpeg', 'audio/mp3', 'audio/wav', 'audio/ogg', 'audio/m4a'],\r\n        image: ['image/jpeg', 'image/png', 'image/webp', 'image/gif'],\r\n        link: [],\r\n        slides: ['image/jpeg', 'image/png', 'image/webp']\r\n      };\r\n\r\n      if (validTypes[type] && !validTypes[type].includes(file.type) && type !== 'link') {\r\n        toast.error(t('resources.errors.invalidFormat', { type }));\r\n        setUploading(false);\r\n        return;\r\n      }\r\n\r\n      // Use uploadImage for images, otherwise use direct Firebase upload\r\n      if (type === 'image') {\r\n        const result = await uploadImage(file, {\r\n          folder: 'temp' as any,\r\n          maxSizeKB: 5120,\r\n          generateThumbnails: true\r\n        });\r\n\r\n        if (result.success) {\r\n          setFormData(prev => ({\r\n            ...prev,\r\n            url: result.originalUrl,\r\n            thumbnailUrl: result.thumbnailUrls?.medium\r\n          }));\r\n          toast.success(t('resources.success.imageUploaded'));\r\n        } else {\r\n          toast.error(result.error || t('resources.errors.uploadFailed'));\r\n        }\r\n      } else {\r\n        // For video, pdf, audio - upload to Firebase Storage directly\r\n        console.log('üì§ Starting upload for:', type, file.name);\r\n        \r\n        // T·∫°o quizId t·∫°m th·ªùi n·∫øu ch∆∞a c√≥ (d√πng timestamp)\r\n        const tempQuizId = 'draft_' + Date.now();\r\n        \r\n        // C·∫•u tr√∫c th∆∞ m·ª•c r√µ r√†ng theo ch·ª©c nƒÉng\r\n        const folder = type === 'video' ? `learning-resources/videos/${tempQuizId}` : \r\n                      type === 'pdf' ? `learning-resources/pdfs/${tempQuizId}` : \r\n                      type === 'audio' ? `learning-resources/audios/${tempQuizId}` :\r\n                      `learning-resources/images/${tempQuizId}`;\r\n        \r\n        const timestamp = Date.now();\r\n        const fileName = `${timestamp}_${file.name}`;\r\n        const fullPath = `${folder}/${fileName}`;\r\n        \r\n        console.log('ÔøΩ Upload path:', fullPath);\r\n        console.log('üì¶ File info:', {\r\n          name: file.name,\r\n          type: file.type,\r\n          size: `${(file.size / 1024 / 1024).toFixed(2)} MB`\r\n        });\r\n        \r\n        const storageRef = ref(storage, fullPath);\r\n        \r\n        // Upload file with metadata\r\n        const metadata = {\r\n          contentType: file.type,\r\n          customMetadata: {\r\n            uploadedBy: 'user',\r\n            originalName: file.name,\r\n            uploadedAt: new Date().toISOString()\r\n          }\r\n        };\r\n        \r\n        console.log('‚¨ÜÔ∏è Uploading to Firebase Storage...');\r\n        \r\n        await uploadBytes(storageRef, file, metadata);\r\n        \r\n        console.log('‚úÖ Upload complete, getting download URL...');\r\n        \r\n        // Get download URL\r\n        const downloadURL = await getDownloadURL(storageRef);\r\n        \r\n        console.log('üîó Download URL:', downloadURL);\r\n        \r\n        setFormData(prev => ({\r\n          ...prev,\r\n          url: downloadURL\r\n        }));\r\n        \r\n        const successKey = type === 'video' ? 'resources.success.videoUploaded' :\r\n                          type === 'pdf' ? 'resources.success.pdfUploaded' :\r\n                          'resources.success.audioUploaded';\r\n        toast.success(t(successKey));\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Upload error:', error);\r\n      toast.error(t('resources.errors.uploadError', { error: error.message }));\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleSaveResource = () => {\r\n    // Validation\r\n    if (!formData.title?.trim()) {\r\n      toast.error(t('resources.errors.titleRequired'));\r\n      return;\r\n    }\r\n    if (!formData.url?.trim()) {\r\n      toast.error(t('resources.errors.urlRequired'));\r\n      return;\r\n    }\r\n\r\n    const newResource: LearningResource = {\r\n      id: editingId || `res_${Date.now()}`,\r\n      type: formData.type!,\r\n      title: formData.title!,\r\n      description: formData.description || '',\r\n      url: formData.url!,\r\n      required: formData.required || false,\r\n      threshold: formData.threshold || {},\r\n      learningOutcomes: formData.learningOutcomes || [],\r\n      order: formData.order || resources.length,\r\n      thumbnailUrl: formData.thumbnailUrl,\r\n      whyWatch: formData.whyWatch,\r\n      estimatedTime: formData.estimatedTime,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date()\r\n    };\r\n\r\n    if (editingId) {\r\n      // Update existing\r\n      onResourcesChange(resources.map(r => r.id === editingId ? newResource : r));\r\n      toast.success(t('resources.success.updated'));\r\n    } else {\r\n      // Add new\r\n      onResourcesChange([...resources, newResource]);\r\n      toast.success(t('resources.success.added'));\r\n    }\r\n\r\n    setShowForm(false);\r\n    setEditingId(null);\r\n  };\r\n\r\n  const getResourceIcon = (type: ResourceType) => {\r\n    switch (type) {\r\n      case 'video': return <Video className=\"w-5 h-5\" />;\r\n      case 'pdf': return <FileText className=\"w-5 h-5\" />;\r\n      case 'image': return <ImageIcon className=\"w-5 h-5\" />;\r\n      case 'link': return <LinkIcon className=\"w-5 h-5\" />;\r\n      default: return <Music className=\"w-5 h-5\" />;\r\n    }\r\n  };\r\n\r\n  const getTypeLabel = (type: ResourceType) => {\r\n    const labels: Record<ResourceType, string> = {\r\n      video: t('resources.types.video'),\r\n      pdf: t('resources.types.pdf'),\r\n      image: t('resources.types.image'),\r\n      audio: t('resources.types.audio'),\r\n      link: t('resources.types.link'),\r\n      slides: t('resources.types.slides')\r\n    };\r\n    return labels[type];\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">\r\n            üìö {t('resources.title')} <span className=\"text-red-500\">*</span>\r\n          </h3>\r\n          <p className=\"text-sm text-gray-600 mt-1\">\r\n            {t('resources.subtitle')}\r\n          </p>\r\n        </div>\r\n        <button\r\n          onClick={handleAddResource}\r\n          className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n        >\r\n          <Plus className=\"w-4 h-4\" />\r\n          {t('resources.addResource')}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Resources List */}\r\n      {resources.length === 0 ? (\r\n        <div className=\"text-center py-12 bg-red-50 rounded-lg border-2 border-dashed border-red-300\">\r\n          <Upload className=\"w-12 h-12 mx-auto text-red-400 mb-3\" />\r\n          <p className=\"text-red-600 font-semibold mb-2\">{t('resources.emptyState.warning')}</p>\r\n          <p className=\"text-sm text-gray-600 mb-4\">\r\n            {t('resources.emptyState.description')}<br/>\r\n            {t('resources.emptyState.cannotContinue')}\r\n          </p>\r\n          <button\r\n            onClick={handleAddResource}\r\n            className=\"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium\"\r\n          >\r\n            + {t('resources.firstResource')}\r\n          </button>\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-3\">\r\n          {resources.map((resource, index) => (\r\n            <div\r\n              key={resource.id}\r\n              className=\"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow\"\r\n            >\r\n              <div className=\"flex items-start gap-4\">\r\n                {/* Icon */}\r\n                <div className={`p-3 rounded-lg ${\r\n                  resource.type === 'video' ? 'bg-purple-100 text-purple-600' :\r\n                  resource.type === 'pdf' ? 'bg-red-100 text-red-600' :\r\n                  resource.type === 'image' ? 'bg-blue-100 text-blue-600' :\r\n                  'bg-green-100 text-green-600'\r\n                }`}>\r\n                  {getResourceIcon(resource.type)}\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"flex items-start justify-between gap-2\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-2 mb-1\">\r\n                        <h4 className=\"font-semibold text-gray-900\">\r\n                          {index + 1}. {resource.title}\r\n                        </h4>\r\n                        {resource.required && (\r\n                          <span className=\"px-2 py-0.5 bg-red-100 text-red-700 text-xs font-medium rounded\">\r\n                            {t('resources.required')}\r\n                          </span>\r\n                        )}\r\n                        {!resource.required && (\r\n                          <span className=\"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs font-medium rounded\">\r\n                            {t('resources.recommended')}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                      \r\n                      {resource.description && (\r\n                        <p className=\"text-sm text-gray-600 mb-2\">\r\n                          {resource.description}\r\n                        </p>\r\n                      )}\r\n\r\n                      <div className=\"flex items-center gap-4 text-xs text-gray-500\">\r\n                        <span className=\"flex items-center gap-1\">\r\n                          {getResourceIcon(resource.type)}\r\n                          {getTypeLabel(resource.type)}\r\n                        </span>\r\n                        {resource.estimatedTime && (\r\n                          <span>‚è±Ô∏è {resource.estimatedTime} ph√∫t</span>\r\n                        )}\r\n                        {resource.whyWatch && (\r\n                          <span className=\"truncate max-w-xs\">\r\n                            üí° {resource.whyWatch}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button\r\n                        onClick={() => handleEditResource(resource)}\r\n                        className=\"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors\"\r\n                        title={t('resources.editButton')}\r\n                      >\r\n                        <Edit2 className=\"w-4 h-4\" />\r\n                      </button>\r\n                      <button\r\n                        onClick={() => handleDeleteResource(resource.id)}\r\n                        className=\"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors\"\r\n                        title={t('resources.deleteButton')}\r\n                      >\r\n                        <Trash2 className=\"w-4 h-4\" />\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {/* Add/Edit Form Modal */}\r\n      {showForm && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between p-6 border-b\">\r\n              <h3 className=\"text-xl font-bold text-gray-900\">\r\n                {editingId ? t('resources.editResource') : t('resources.newResource')}\r\n              </h3>\r\n              <button\r\n                onClick={() => setShowForm(false)}\r\n                className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n              >\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Form Content */}\r\n            <div className=\"p-6 space-y-4\">\r\n              {/* Resource Type */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('resources.form.typeLabel')}\r\n                </label>\r\n                <div className=\"grid grid-cols-2 sm:grid-cols-5 gap-2\">\r\n                  {(['video', 'pdf', 'image', 'audio', 'link'] as ResourceType[]).map(type => (\r\n                    <button\r\n                      key={type}\r\n                      type=\"button\"\r\n                      onClick={() => setFormData(prev => ({ ...prev, type }))}\r\n                      className={`p-3 rounded-lg border-2 transition-all ${\r\n                        formData.type === type\r\n                          ? 'border-blue-600 bg-blue-50 text-blue-700'\r\n                          : 'border-gray-200 hover:border-gray-300'\r\n                      }`}\r\n                    >\r\n                      <div className=\"flex flex-col items-center gap-1\">\r\n                        {getResourceIcon(type)}\r\n                        <span className=\"text-xs font-medium\">\r\n                          {getTypeLabel(type)}\r\n                        </span>\r\n                      </div>\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Title */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('resources.form.titleLabel')}\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.title || ''}\r\n                  onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}\r\n                  placeholder={t('resources.form.titlePlaceholder')}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                />\r\n              </div>\r\n\r\n              {/* Description */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('resources.form.descriptionLabel')}\r\n                </label>\r\n                <textarea\r\n                  value={formData.description || ''}\r\n                  onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\r\n                  placeholder={t('resources.form.descriptionPlaceholder')}\r\n                  rows={2}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                />\r\n              </div>\r\n\r\n              {/* URL or Upload - CHIA LU·ªíNG R√ï R√ÄNG */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {formData.type === 'link' ? t('resources.form.urlLabel.link') : \r\n                   formData.type === 'video' ? t('resources.form.urlLabel.video') :\r\n                   formData.type === 'pdf' ? t('resources.form.urlLabel.pdf') :\r\n                   formData.type === 'audio' ? t('resources.form.urlLabel.audio') :\r\n                   t('resources.form.urlLabel.image')}\r\n                </label>\r\n                \r\n                {formData.type === 'link' ? (\r\n                  // LINK - CH·ªà NH·∫¨P URL\r\n                  <div>\r\n                    <input\r\n                      type=\"url\"\r\n                      value={formData.url || ''}\r\n                      onChange={(e) => setFormData(prev => ({ ...prev, url: e.target.value }))}\r\n                      placeholder={t('resources.form.urlPlaceholder.link')}\r\n                      className=\"w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    />\r\n                    <p className=\"text-xs text-gray-500 mt-2\">\r\n                      {t('resources.form.linkHint')}\r\n                    </p>\r\n                  </div>\r\n                ) : formData.type === 'video' ? (\r\n                  // VIDEO - CH·ªà CH·∫§P NH·∫¨N VIDEO FILES\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"border-2 border-dashed border-blue-300 rounded-lg p-4 bg-blue-50\">\r\n                      <input\r\n                        type=\"file\"\r\n                        accept=\"video/mp4,video/webm,video/ogg,video/quicktime,video/x-msvideo\"\r\n                        onChange={(e) => {\r\n                          const file = e.target.files?.[0];\r\n                          if (file) {\r\n                            // Validate file type\r\n                            if (!file.type.startsWith('video/')) {\r\n                              toast.error(t('resources.errors.videoOnly'));\r\n                              e.target.value = '';\r\n                              return;\r\n                            }\r\n                            handleFileUpload(file, 'video');\r\n                          }\r\n                        }}\r\n                        disabled={uploading}\r\n                        className=\"w-full text-sm\"\r\n                      />\r\n                      <p className=\"text-xs text-blue-600 mt-2 font-medium\">\r\n                        {t('resources.form.acceptedFormats.video')}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-center text-sm text-gray-500\">{t('resources.form.orDivider')}</div>\r\n                    <input\r\n                      type=\"url\"\r\n                      value={formData.url || ''}\r\n                      onChange={(e) => setFormData(prev => ({ ...prev, url: e.target.value }))}\r\n                      placeholder={t('resources.form.urlPlaceholder.video')}\r\n                      disabled={uploading}\r\n                      className=\"w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                    />\r\n                  </div>\r\n                ) : formData.type === 'pdf' ? (\r\n                  // PDF - CH·ªà CH·∫§P NH·∫¨N PDF FILES\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"border-2 border-dashed border-red-300 rounded-lg p-4 bg-red-50\">\r\n                      <input\r\n                        type=\"file\"\r\n                        accept=\".pdf,application/pdf\"\r\n                        onChange={(e) => {\r\n                          const file = e.target.files?.[0];\r\n                          if (file) {\r\n                            // Validate file type\r\n                            if (file.type !== 'application/pdf' && !file.name.endsWith('.pdf')) {\r\n                              toast.error(t('resources.errors.pdfOnly'));\r\n                              e.target.value = '';\r\n                              return;\r\n                            }\r\n                            handleFileUpload(file, 'pdf');\r\n                          }\r\n                        }}\r\n                        disabled={uploading}\r\n                        className=\"w-full text-sm\"\r\n                      />\r\n                      <p className=\"text-xs text-red-600 mt-2 font-medium\">\r\n                        {t('resources.form.acceptedFormats.pdf')}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-center text-sm text-gray-500\">{t('resources.form.orDivider')}</div>\r\n                    <input\r\n                      type=\"url\"\r\n                      value={formData.url || ''}\r\n                      onChange={(e) => setFormData(prev => ({ ...prev, url: e.target.value }))}\r\n                      placeholder={t('resources.form.urlPlaceholder.pdf')}\r\n                      disabled={uploading}\r\n                      className=\"w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                    />\r\n                  </div>\r\n                ) : formData.type === 'audio' ? (\r\n                  // AUDIO - CH·ªà CH·∫§P NH·∫¨N AUDIO FILES\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"border-2 border-dashed border-green-300 rounded-lg p-4 bg-green-50\">\r\n                      <input\r\n                        type=\"file\"\r\n                        accept=\"audio/mp3,audio/mpeg,audio/wav,audio/ogg,audio/m4a\"\r\n                        onChange={(e) => {\r\n                          const file = e.target.files?.[0];\r\n                          if (file) {\r\n                            // Validate file type\r\n                            if (!file.type.startsWith('audio/')) {\r\n                              toast.error(t('resources.errors.audioOnly'));\r\n                              e.target.value = '';\r\n                              return;\r\n                            }\r\n                            handleFileUpload(file, 'audio');\r\n                          }\r\n                        }}\r\n                        disabled={uploading}\r\n                        className=\"w-full text-sm\"\r\n                      />\r\n                      <p className=\"text-xs text-green-600 mt-2 font-medium\">\r\n                        {t('resources.form.acceptedFormats.audio')}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-center text-sm text-gray-500\">{t('resources.form.orDivider')}</div>\r\n                    <input\r\n                      type=\"url\"\r\n                      value={formData.url || ''}\r\n                      onChange={(e) => setFormData(prev => ({ ...prev, url: e.target.value }))}\r\n                      placeholder={t('resources.form.urlPlaceholder.audio')}\r\n                      disabled={uploading}\r\n                      className=\"w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                    />\r\n                  </div>\r\n                ) : (\r\n                  // IMAGE - CH·ªà CH·∫§P NH·∫¨N IMAGE FILES\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"border-2 border-dashed border-purple-300 rounded-lg p-4 bg-purple-50\">\r\n                      <input\r\n                        type=\"file\"\r\n                        accept=\"image/jpeg,image/jpg,image/png,image/webp,image/gif\"\r\n                        onChange={(e) => {\r\n                          const file = e.target.files?.[0];\r\n                          if (file) {\r\n                            // Validate file type\r\n                            if (!file.type.startsWith('image/')) {\r\n                              toast.error(t('resources.errors.imageOnly'));\r\n                              e.target.value = '';\r\n                              return;\r\n                            }\r\n                            handleFileUpload(file, 'image');\r\n                          }\r\n                        }}\r\n                        disabled={uploading}\r\n                        className=\"w-full text-sm\"\r\n                      />\r\n                      <p className=\"text-xs text-purple-600 mt-2 font-medium\">\r\n                        {t('resources.form.acceptedFormats.image')}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-center text-sm text-gray-500\">{t('resources.form.orDivider')}</div>\r\n                    <input\r\n                      type=\"url\"\r\n                      value={formData.url || ''}\r\n                      onChange={(e) => setFormData(prev => ({ ...prev, url: e.target.value }))}\r\n                      placeholder={t('resources.form.urlPlaceholder.image')}\r\n                      disabled={uploading}\r\n                      className=\"w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\r\n                    />\r\n                  </div>\r\n                )}\r\n                \r\n                {uploading && (\r\n                  <div className=\"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent\"></div>\r\n                      <span className=\"text-sm text-blue-600 font-medium\">{t('resources.form.uploading')}</span>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {formData.url && !uploading && (\r\n                  <div className=\"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg\">\r\n                    <p className=\"text-sm text-green-700 font-medium\">{t('resources.form.urlReady')}</p>\r\n                    <p className=\"text-xs text-green-600 truncate\">{formData.url}</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Required */}\r\n              <div className=\"flex items-center gap-3 p-4 bg-gray-50 rounded-lg\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id=\"required\"\r\n                  checked={formData.required || false}\r\n                  onChange={(e) => setFormData(prev => ({ ...prev, required: e.target.checked }))}\r\n                  className=\"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500\"\r\n                />\r\n                <label htmlFor=\"required\" className=\"flex-1 text-sm text-gray-700\">\r\n                  <span className=\"font-medium\">{t('resources.form.requiredLabel')}</span>\r\n                  <p className=\"text-xs text-gray-500 mt-0.5\">\r\n                    {t('resources.form.requiredDescription')}\r\n                  </p>\r\n                </label>\r\n              </div>\r\n\r\n              {/* Why Watch */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('resources.form.whyWatchLabel')}\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={formData.whyWatch || ''}\r\n                  onChange={(e) => setFormData(prev => ({ ...prev, whyWatch: e.target.value }))}\r\n                  placeholder={t('resources.form.whyWatchPlaceholder')}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                />\r\n              </div>\r\n\r\n              {/* Estimated Time */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  {t('resources.form.estimatedTimeLabel')}\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  value={formData.estimatedTime || ''}\r\n                  onChange={(e) => setFormData(prev => ({ ...prev, estimatedTime: parseInt(e.target.value) || undefined }))}\r\n                  placeholder={t('resources.form.estimatedTimePlaceholder')}\r\n                  min=\"1\"\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Footer */}\r\n            <div className=\"flex items-center justify-end gap-3 p-6 border-t bg-gray-50\">\r\n              <button\r\n                onClick={() => setShowForm(false)}\r\n                className=\"px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg transition-colors\"\r\n              >\r\n                {t('resources.cancelButton')}\r\n              </button>\r\n              <button\r\n                onClick={handleSaveResource}\r\n                disabled={uploading}\r\n                className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors\"\r\n              >\r\n                {uploading ? t('resources.form.uploading') : editingId ? t('resources.updateButton') : t('resources.saveButton')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResourcesStep;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\ReviewStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\SimpleAIGenerator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\components\\SortableItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\CreateQuizPage\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\EditQuizPage.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n            onClick={() => navigate('/admin')}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-800 mb-4\"\r\n          >\r\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n            Quay l·∫°i Admin\r\n          </button>","line":124,"column":51,"nodeType":"JSXText","endLine":126,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n              ‚úèÔ∏è Ch·ªânh s·ª≠a Quiz\r\n            </h1>","line":129,"column":67,"nodeType":"JSXText","endLine":131,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600\">\r\n              ID: <code className=\"bg-gray-100 px-2 py-1 rounded\">{id}</code>\r\n            </p>","line":132,"column":42,"nodeType":"JSXText","endLine":133,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Ti√™u ƒë·ªÅ Quiz\r\n              </label>","line":143,"column":79,"nodeType":"JSXText","endLine":145,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">üìä Th√¥ng tin Quiz</h3>","line":238,"column":68,"nodeType":"JSXText","endLine":238,"endColumn":85},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium text-gray-700\">S·ªë c√¢u h·ªèi:</span>","line":242,"column":59,"nodeType":"JSXText","endLine":242,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium text-gray-700\">Ng∆∞·ªùi t·∫°o:</span>","line":247,"column":59,"nodeType":"JSXText","endLine":247,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium text-gray-700\">Ng√†y t·∫°o:</span>","line":252,"column":59,"nodeType":"JSXText","endLine":252,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium text-gray-700\">L·∫ßn s·ª≠a cu·ªëi:</span>","line":259,"column":59,"nodeType":"JSXText","endLine":259,"endColumn":72}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { getQuizById } from '../api';\r\nimport { updateQuiz } from '../api';\r\nimport { Quiz } from '../types';\r\nimport { toast } from 'react-toastify';\r\nimport { ArrowLeft, Save, Loader2 } from 'lucide-react';\r\n\r\nimport { useTranslation } from 'react-i18next';\r\nconst EditQuizPage: React.FC = () => {\r\n  const { t } = useTranslation();\r\n\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const [quiz, setQuiz] = useState<Quiz | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    title: '',\r\n    description: '',\r\n    category: '',\r\n    difficulty: 'medium' as 'easy' | 'medium' | 'hard',\r\n    status: 'pending' as 'pending' | 'approved' | 'rejected' | 'draft'\r\n  });\r\n\r\n  const loadQuiz = useCallback(async () => {\r\n    if (!id) return;\r\n    \r\n    setLoading(true);\r\n    try {\r\n      const quizData = await getQuizById(id);\r\n      if (quizData) {\r\n        setQuiz(quizData);\r\n        setFormData({\r\n          title: quizData.title || '',\r\n          description: quizData.description || '',\r\n          category: quizData.category || '',\r\n          difficulty: quizData.difficulty || 'medium',\r\n          status: quizData.status || 'pending'\r\n        });\r\n      } else {\r\n        toast.error('Kh√¥ng t√¨m th·∫•y quiz n√†y');\r\n        navigate('/admin');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading quiz:', error);\r\n      toast.error('L·ªói khi t·∫£i quiz');\r\n      navigate('/admin');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [id, navigate]);\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      loadQuiz();\r\n    }\r\n  }, [id, loadQuiz]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!id || !quiz) return;\r\n\r\n    setSaving(true);\r\n    try {\r\n      const updatedQuiz = {\r\n        ...quiz,\r\n        ...formData,\r\n        updatedAt: new Date()\r\n      };\r\n\r\n      await updateQuiz(id, updatedQuiz);\r\n      toast.success('C·∫≠p nh·∫≠t quiz th√†nh c√¥ng!');\r\n      navigate('/admin');\r\n    } catch (error) {\r\n      console.error('Error updating quiz:', error);\r\n      toast.error('L·ªói khi c·∫≠p nh·∫≠t quiz');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (field: string, value: string) => {\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [field]: value\r\n    }));\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 py-8\">\r\n        <div className=\"max-w-4xl mx-auto px-4\">\r\n          <div className=\"flex items-center justify-center py-12\">\r\n            <Loader2 className=\"w-8 h-8 animate-spin text-blue-600 mr-3\" />\r\n            <span className=\"text-lg text-gray-600\">ƒêang t·∫£i quiz...</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!quiz) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 py-8\">\r\n        <div className=\"max-w-4xl mx-auto px-4\">\r\n          <div className=\"text-center py-12\">\r\n            <p className=\"text-gray-500\">{t(\"quizList.empty.noQuizFound\")}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 py-8\">\r\n      <div className=\"max-w-4xl mx-auto px-4\">\r\n        {/* Header */}\r\n        <div className=\"mb-8\">\r\n          <button\r\n            onClick={() => navigate('/admin')}\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-800 mb-4\"\r\n          >\r\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n            Quay l·∫°i Admin\r\n          </button>\r\n          \r\n          <div className=\"bg-white rounded-lg p-6 shadow-sm\">\r\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n              ‚úèÔ∏è Ch·ªânh s·ª≠a Quiz\r\n            </h1>\r\n            <p className=\"text-gray-600\">\r\n              ID: <code className=\"bg-gray-100 px-2 py-1 rounded\">{id}</code>\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Edit Form */}\r\n        <div className=\"bg-white rounded-lg shadow-sm\">\r\n          <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\r\n            {/* Title */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Ti√™u ƒë·ªÅ Quiz\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={formData.title}\r\n                onChange={(e) => handleInputChange('title', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                required\r\n              />\r\n            </div>\r\n\r\n            {/* Description */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t(\"admin.preview.description\")}\r\n              </label>\r\n              <textarea\r\n                value={formData.description}\r\n                onChange={(e) => handleInputChange('description', e.target.value)}\r\n                rows={4}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                required\r\n              />\r\n            </div>\r\n\r\n            {/* Category */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t(\"admin.preview.category\")}\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={formData.category}\r\n                onChange={(e) => handleInputChange('category', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                required\r\n              />\r\n            </div>\r\n\r\n            {/* Difficulty */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t(\"admin.preview.difficulty\")}\r\n              </label>\r\n              <select\r\n                value={formData.difficulty}\r\n                onChange={(e) => handleInputChange('difficulty', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n              >\r\n                <option value=\"easy\">{t(\"difficulty.easy\")}</option>\r\n                <option value=\"medium\">{t(\"difficulty.medium\")}</option>\r\n                <option value=\"hard\">{t(\"difficulty.hard\")}</option>\r\n              </select>\r\n            </div>\r\n\r\n            {/* Status */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">{t(\"admin.preview.status\")}\r\n              </label>\r\n              <select\r\n                value={formData.status}\r\n                onChange={(e) => handleInputChange('status', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n              >\r\n                <option value=\"pending\">{t(\"admin.quizManagement.filter.pending\")}</option>\r\n                <option value=\"approved\">{t(\"admin.quizManagement.filter.approved\")}</option>\r\n                <option value=\"rejected\">{t(\"status.rejected\")}</option>\r\n              </select>\r\n            </div>\r\n\r\n            {/* Actions */}\r\n            <div className=\"flex items-center justify-between pt-6 border-t border-gray-200\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => navigate('/admin')}\r\n                className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200\"\r\n              >{t(\"common.cancel\")}\r\n              </button>\r\n              \r\n              <button\r\n                type=\"submit\"\r\n                disabled={saving}\r\n                className=\"inline-flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50\"\r\n              >\r\n                {saving ? (\r\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                ) : (\r\n                  <Save className=\"w-4 h-4 mr-2\" />\r\n                )}\r\n                {saving ? 'ƒêang l∆∞u...' : 'L∆∞u thay ƒë·ªïi'}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n        {/* Quiz Info */}\r\n        <div className=\"mt-8 bg-white rounded-lg p-6 shadow-sm\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">üìä Th√¥ng tin Quiz</h3>\r\n          \r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n            <div>\r\n              <span className=\"font-medium text-gray-700\">S·ªë c√¢u h·ªèi:</span>\r\n              <span className=\"ml-2 text-gray-600\">{quiz.questions?.length || 0}</span>\r\n            </div>\r\n            \r\n            <div>\r\n              <span className=\"font-medium text-gray-700\">Ng∆∞·ªùi t·∫°o:</span>\r\n              <span className=\"ml-2 text-gray-600\">{quiz.createdBy || 'N/A'}</span>\r\n            </div>\r\n            \r\n            <div>\r\n              <span className=\"font-medium text-gray-700\">Ng√†y t·∫°o:</span>\r\n              <span className=\"ml-2 text-gray-600\">\r\n                {quiz.createdAt ? new Date(quiz.createdAt).toLocaleDateString('vi-VN') : 'N/A'}\r\n              </span>\r\n            </div>\r\n            \r\n            <div>\r\n              <span className=\"font-medium text-gray-700\">L·∫ßn s·ª≠a cu·ªëi:</span>\r\n              <span className=\"ml-2 text-gray-600\">\r\n                {quiz.updatedAt ? new Date(quiz.updatedAt).toLocaleDateString('vi-VN') : 'Ch∆∞a s·ª≠a'}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EditQuizPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\EditQuizPageAdvanced.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10022,10025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10022,10025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600\">Ch·ªânh s·ª≠a th√¥ng tin quiz c·ªßa b·∫°n</p>","line":313,"column":48,"nodeType":"JSXText","endLine":313,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                      <FileText className=\"w-4 h-4\" />\r\n                      M√¥ t·∫£ quiz *\r\n                    </label>","line":334,"column":55,"nodeType":"JSXText","endLine":336,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":371,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15046,15049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15046,15049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":404,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":404,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16865,16868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16865,16868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-3xl font-bold text-gray-900\">Questions ({questions.length})</h2>","line":421,"column":68,"nodeType":"JSXText","endLine":421,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                    onClick={addQuestion}\r\n                    className=\"flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-2xl hover:from-green-700 hover:to-emerald-700 transition-all shadow-lg font-semibold\"\r\n                  >\r\n                    <Plus className=\"w-6 h-6\" />\r\n                    Add Question\r\n                  </button>","line":426,"column":49,"nodeType":"JSXText","endLine":428,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-2xl font-bold text-gray-900 mb-4\">No Questions Yet</h3>","line":433,"column":75,"nodeType":"JSXText","endLine":433,"endColumn":91},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600 mb-8 text-lg\">Start building your quiz by adding questions.</p>","line":434,"column":63,"nodeType":"JSXText","endLine":434,"endColumn":108},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                      onClick={addQuestion}\r\n                      className=\"px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-2xl hover:from-blue-700 hover:to-purple-700 transition-all font-semibold\"\r\n                    >\r\n                      Add First Question\r\n                    </button>","line":438,"column":22,"nodeType":"JSXText","endLine":440,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-3xl font-bold text-gray-900 mb-8\">Quiz Settings</h2>","line":463,"column":69,"nodeType":"JSXText","endLine":463,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"block text-sm font-semibold text-gray-700\">Time Limit (minutes)</label>","line":466,"column":80,"nodeType":"JSXText","endLine":466,"endColumn":100},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"block text-sm font-semibold text-gray-700\">Passing Score (%)</label>","line":477,"column":80,"nodeType":"JSXText","endLine":477,"endColumn":97}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { getQuizById, updateQuiz } from '../api';\r\nimport { Quiz, Question } from '../types';\r\nimport { QuestionEditor } from '../components/QuestionEditor';\r\nimport { toast } from 'react-toastify';\r\nimport { \r\n  ArrowLeft, Save, Loader2, Plus, \r\n  BookOpen, Target, MessageSquare, AlertCircle,\r\n  FileText, Tag, Star, Clock\r\n} from 'lucide-react';\r\nimport { db } from '../../../firebase/config';\r\nimport { addDoc, collection, serverTimestamp } from 'firebase/firestore';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\n\r\nimport { useTranslation } from 'react-i18next';\r\n// Import categories and difficulties from CreateQuizPage\r\nconst categories = [\r\n  { value: 'general', label: '' },\r\n  { value: 'science', label: '' },\r\n  { value: 'history', label: '' },\r\n  { value: 'geography', label: '' },\r\n  { value: 'literature', label: '' },\r\n  { value: 'math', label: '' },\r\n  { value: 'technology', label: '' },\r\n  { value: 'sports', label: '' },\r\n  { value: 'entertainment', label: '' },\r\n  { value: 'food', label: '' }\r\n];\r\n\r\nconst difficulties = [\r\n  { value: 'easy', label: '', color: 'bg-green-100 text-green-800' },\r\n  { value: 'medium', label: '', color: 'bg-yellow-100 text-yellow-800' },\r\n  { value: 'hard', label: '', color: 'bg-red-100 text-red-800' }\r\n];\r\n\r\nconst EditQuizPageAdvanced: React.FC = () => {\r\n  const { t } = useTranslation();\r\n\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const [quiz, setQuiz] = useState<Quiz | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [activeTab, setActiveTab] = useState<'info' | 'questions' | 'settings'>('info');\r\n  const [editingQuestionId, setEditingQuestionId] = useState<string | null>(null);\r\n\r\n  const [quizInfo, setQuizInfo] = useState({\r\n    title: '',\r\n    description: '',\r\n    category: '',\r\n    difficulty: 'medium' as 'easy' | 'medium' | 'hard',\r\n    status: 'pending' as 'pending' | 'approved' | 'rejected' | 'draft',\r\n    timeLimit: 30,\r\n    passingScore: 70,\r\n    tags: [] as string[],\r\n    isPublished: false\r\n  });\r\n\r\n  const [questions, setQuestions] = useState<Question[]>([]);\r\n\r\n  const loadQuiz = useCallback(async () => {\r\n    if (!id) return;\r\n    \r\n    setLoading(true);\r\n    try {\r\n      const quizData = await getQuizById(id);\r\n      if (quizData) {\r\n        setQuiz(quizData);\r\n        setQuizInfo({\r\n          title: quizData.title || '',\r\n          description: quizData.description || '',\r\n          category: quizData.category || '',\r\n          difficulty: quizData.difficulty || 'medium',\r\n          status: quizData.status || 'pending',\r\n          timeLimit: quizData.duration || 30,\r\n          passingScore: 70,\r\n          tags: quizData.tags || [],\r\n          isPublished: quizData.isPublished || false\r\n        });\r\n        setQuestions(quizData.questions || []);\r\n      } else {\r\n        toast.error(t('editQuiz.notFound'));\r\n        navigate('/admin/stats-test');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading quiz:', error);\r\n      toast.error(t('editQuiz.loadFailed'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [id, t, navigate]);\r\n\r\n  useEffect(() => {\r\n    if (id) loadQuiz();\r\n  }, [id, loadQuiz]);\r\n\r\n  const handleSave = async () => {\r\n    if (!id || !quiz) return;\r\n\r\n    if (!quizInfo.title.trim()) {\r\n      toast.error(t('editQuiz.titleRequired'));\r\n      return;\r\n    }\r\n\r\n    if (questions.length === 0) {\r\n      toast.error(t('editQuiz.questionRequired'));\r\n      return;\r\n    }\r\n\r\n    setSaving(true);\r\n    try {\r\n      const updatedQuiz: Quiz = {\r\n        ...quiz,\r\n        ...quizInfo,\r\n        duration: quizInfo.timeLimit,\r\n        questions,\r\n        updatedAt: new Date()\r\n      };\r\n\r\n      // ‚úÖ HANDLE RESUBMISSION AFTER EDIT APPROVAL\r\n      if (quiz.needsReApproval) {\r\n        // Quiz was edited after admin approval, resubmit for approval\r\n        updatedQuiz.status = 'pending';\r\n        updatedQuiz.canEdit = false;\r\n        updatedQuiz.isApproved = false;\r\n        updatedQuiz.needsReApproval = false;\r\n        updatedQuiz.resubmittedAt = new Date();\r\n        \r\n        // Create notification for admin about resubmission\r\n        await addDoc(collection(db, 'notifications'), {\r\n          userId: 'admin', // Or get actual admin IDs\r\n          type: 'quiz_resubmitted',\r\n          title: t('editQuiz.notifications.resubmitted'),\r\n          message: t('editQuiz.notifications.resubmittedMessage', { title: updatedQuiz.title }),\r\n          quizId: id,\r\n          createdBy: user?.uid,\r\n          createdByName: user?.displayName || user?.email,\r\n          createdAt: serverTimestamp(),\r\n          read: false\r\n        });\r\n        \r\n        toast.success(t('editQuiz.resubmitSuccess'));\r\n      } else {\r\n        toast.success(t('editQuiz.updateSuccess'));\r\n      }\r\n\r\n      await updateQuiz(id, updatedQuiz);\r\n      navigate('/admin/stats-test');\r\n    } catch (error) {\r\n      console.error('Error updating quiz:', error);\r\n      toast.error(t('editQuiz.updateFailed'));\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const addQuestion = () => {\r\n    const newQuestion: Question = {\r\n      id: `q_${Date.now()}`,\r\n      text: '',\r\n      type: 'multiple',\r\n      answers: [\r\n        { id: 'a1', text: '', isCorrect: true },\r\n        { id: 'a2', text: '', isCorrect: false },\r\n        { id: 'a3', text: '', isCorrect: false },\r\n        { id: 'a4', text: '', isCorrect: false }\r\n      ],\r\n      explanation: '',\r\n      points: 10,\r\n      difficulty: 'medium'\r\n    };\r\n    setQuestions([...questions, newQuestion]);\r\n    setEditingQuestionId(newQuestion.id);\r\n  };\r\n\r\n  const deleteQuestion = (questionId: string) => {\r\n    if (window.confirm(t('editQuiz.confirmDeleteQuestion'))) {\r\n      setQuestions(questions.filter(q => q.id !== questionId));\r\n      if (editingQuestionId === questionId) {\r\n        setEditingQuestionId(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  const updateQuestion = (questionId: string, updatedQuestion: Partial<Question>) => {\r\n    setQuestions(questions.map(q => \r\n      q.id === questionId ? { ...q, ...updatedQuestion } : q\r\n    ));\r\n  };\r\n\r\n  const moveQuestion = (index: number, direction: 'up' | 'down') => {\r\n    const newQuestions = [...questions];\r\n    const targetIndex = direction === 'up' ? index - 1 : index + 1;\r\n    \r\n    if (targetIndex >= 0 && targetIndex < newQuestions.length) {\r\n      [newQuestions[index], newQuestions[targetIndex]] = [newQuestions[targetIndex], newQuestions[index]];\r\n      setQuestions(newQuestions);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <Loader2 className=\"w-8 h-8 animate-spin text-blue-600 mx-auto\" />\r\n          <p className=\"mt-4 text-gray-600\">{t('editQuiz.loading')}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!quiz) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <AlertCircle className=\"w-16 h-16 text-red-500 mx-auto mb-4\" />\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">{t('editQuiz.notFoundTitle')}</h2>\r\n          <p className=\"text-gray-600 mb-6\">{t('editQuiz.notFoundDesc')}</p>\r\n          <button\r\n            onClick={() => navigate('/admin/stats-test')}\r\n            className=\"px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors\"\r\n          >\r\n            {t('editQuiz.backToAdmin')}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const tabs = [\r\n    { id: 'info', label: t('editQuiz.tabs.info'), icon: BookOpen },\r\n    { id: 'questions', label: t('editQuiz.tabs.questions'), icon: MessageSquare, count: questions.length },\r\n    { id: 'settings', label: t('editQuiz.tabs.settings'), icon: Target }\r\n  ];\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50\">\r\n      <div className=\"max-w-7xl mx-auto px-4 py-8\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-8\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <button\r\n              onClick={() => navigate('/admin/stats-test')}\r\n              className=\"p-3 text-gray-600 hover:text-gray-900 hover:bg-white rounded-2xl transition-all shadow-sm\"\r\n            >\r\n              <ArrowLeft className=\"w-6 h-6\" />\r\n            </button>\r\n            <div>\r\n              <h1 className=\"text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\r\n                {t('editQuiz.title')}\r\n              </h1>\r\n              <p className=\"text-gray-600 text-lg\">{t('editQuiz.subtitle')}</p>\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={handleSave}\r\n            disabled={saving}\r\n            className=\"flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-2xl hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg disabled:opacity-50 font-semibold\"\r\n          >\r\n            {saving ? (\r\n              <Loader2 className=\"w-6 h-6 animate-spin\" />\r\n            ) : (\r\n              <Save className=\"w-6 h-6\" />\r\n            )}\r\n            {saving ? t('editQuiz.buttons.saving') : t('editQuiz.buttons.save')}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Tabs */}\r\n        <div className=\"mb-8\">\r\n          <nav className=\"flex space-x-2 bg-white/80 backdrop-blur-sm rounded-3xl p-2 shadow-lg border border-white/20\">\r\n            {tabs.map((tab) => {\r\n              const Icon = tab.icon;\r\n              return (\r\n                <button\r\n                  key={tab.id}\r\n                  onClick={() => setActiveTab(tab.id as any)}\r\n                  className={`flex items-center gap-3 px-8 py-4 rounded-2xl font-semibold transition-all ${\r\n                    activeTab === tab.id\r\n                      ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg'\r\n                      : 'text-gray-600 hover:text-gray-900 hover:bg-white/60'\r\n                  }`}\r\n                >\r\n                  <Icon className=\"w-6 h-6\" />\r\n                  {tab.label}\r\n                  {'count' in tab && tab.count !== undefined && (\r\n                    <span className={`px-3 py-1 text-sm rounded-full font-bold ${\r\n                      activeTab === tab.id ? 'bg-white text-blue-600' : 'bg-blue-100 text-blue-600'\r\n                    }`}>\r\n                      {tab.count}\r\n                    </span>\r\n                  )}\r\n                </button>\r\n              );\r\n            })}\r\n          </nav>\r\n        </div>\r\n\r\n        {/* Tab Content */}\r\n        <div>\r\n          {activeTab === 'info' && (\r\n            <div className=\"bg-white/80 backdrop-blur-sm rounded-3xl shadow-xl p-8 border border-white/20\">\r\n              <div className=\"space-y-8\">\r\n                {/* Header */}\r\n                <div className=\"text-center space-y-2\">\r\n                  <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto\">\r\n                    <BookOpen className=\"w-8 h-8 text-white\" />\r\n                  </div>\r\n                  <h2 className=\"text-2xl font-bold text-gray-900\">{t(\"createQuiz.info.basicInfo\")}</h2>\r\n                  <p className=\"text-gray-600\">Ch·ªânh s·ª≠a th√¥ng tin quiz c·ªßa b·∫°n</p>\r\n                </div>\r\n\r\n                {/* Form */}\r\n                <div className=\"space-y-6\">\r\n                  {/* Title */}\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                      <FileText className=\"w-4 h-4\" />{t(\"createQuiz.info.titleLabel\")}\r\n                    </label>\r\n                    <input\r\n                      className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-lg\"\r\n                      placeholder={t(\"createQuiz.info.titlePlaceholder\")}\r\n                      value={quizInfo.title}\r\n                      onChange={(e) => setQuizInfo({ ...quizInfo, title: e.target.value })}\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Description */}\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                      <FileText className=\"w-4 h-4\" />\r\n                      M√¥ t·∫£ quiz *\r\n                    </label>\r\n                    <textarea\r\n                      className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none\"\r\n                      placeholder={t('placeholders.quizDescription')}\r\n                      rows={4}\r\n                      value={quizInfo.description}\r\n                      onChange={(e) => setQuizInfo({ ...quizInfo, description: e.target.value })}\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Category & Difficulty */}\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                        <Tag className=\"w-4 h-4\" />{t(\"createQuiz.info.categoryLabel\")}\r\n                      </label>\r\n                      <select\r\n                        className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n                        value={quizInfo.category}\r\n                        onChange={(e) => setQuizInfo({ ...quizInfo, category: e.target.value })}\r\n                      >\r\n                        <option value=\"\">{t(\"createQuiz.info.categoryPlaceholder\")}</option>\r\n                        {categories.map(c => (\r\n                          <option key={c.value} value={c.value}>{c.label}</option>\r\n                        ))}\r\n                      </select>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                        <Star className=\"w-4 h-4\" />{t(\"createQuiz.info.difficultyLabel\")}\r\n                      </label>\r\n                      <select\r\n                        className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n                        value={quizInfo.difficulty}\r\n                        onChange={(e) => setQuizInfo({ ...quizInfo, difficulty: e.target.value as any })}\r\n                      >\r\n                        {difficulties.map(d => (\r\n                          <option key={d.value} value={d.value}>{d.label}</option>\r\n                        ))}\r\n                      </select>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Time Limit & Status */}\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                        <Clock className=\"w-4 h-4\" />\r\n                        {t('quizCreation.timeMinutes')}\r\n                      </label>\r\n                      <input\r\n                        type=\"number\"\r\n                        min=\"1\"\r\n                        max=\"180\"\r\n                        className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n                        value={quizInfo.timeLimit}\r\n                        onChange={(e) => setQuizInfo({ ...quizInfo, timeLimit: parseInt(e.target.value) || 30 })}\r\n                      />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"flex items-center gap-2 text-sm font-semibold text-gray-700\">\r\n                        <Target className=\"w-4 h-4\" />{t(\"admin.preview.status\")}\r\n                      </label>\r\n                      <select\r\n                        className=\"w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n                        value={quizInfo.status}\r\n                        onChange={(e) => setQuizInfo({ ...quizInfo, status: e.target.value as any })}\r\n                      >\r\n                        <option value=\"pending\">{t('quizCreation.pending')}</option>\r\n                        <option value=\"approved\">{t('quizCreation.approved')}</option>\r\n                        <option value=\"rejected\">{t('quizCreation.rejected')}</option>\r\n                      </select>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === 'questions' && (\r\n            <div className=\"space-y-8\">\r\n              <div className=\"bg-white/80 backdrop-blur-sm rounded-3xl shadow-xl p-8 border border-white/20\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h2 className=\"text-3xl font-bold text-gray-900\">Questions ({questions.length})</h2>\r\n                  <button\r\n                    onClick={addQuestion}\r\n                    className=\"flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-2xl hover:from-green-700 hover:to-emerald-700 transition-all shadow-lg font-semibold\"\r\n                  >\r\n                    <Plus className=\"w-6 h-6\" />\r\n                    Add Question\r\n                  </button>\r\n                </div>\r\n                {questions.length === 0 && (\r\n                  <div className=\"text-center py-16\">\r\n                    <MessageSquare className=\"w-20 h-20 text-gray-300 mx-auto mb-6\" />\r\n                    <h3 className=\"text-2xl font-bold text-gray-900 mb-4\">No Questions Yet</h3>\r\n                    <p className=\"text-gray-600 mb-8 text-lg\">Start building your quiz by adding questions.</p>\r\n                    <button\r\n                      onClick={addQuestion}\r\n                      className=\"px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-2xl hover:from-blue-700 hover:to-purple-700 transition-all font-semibold\"\r\n                    >\r\n                      Add First Question\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {questions.map((question, index) => (\r\n                <QuestionEditor\r\n                  key={question.id}\r\n                  question={question}\r\n                  index={index}\r\n                  isEditing={editingQuestionId === question.id}\r\n                  onEdit={setEditingQuestionId}\r\n                  onUpdate={updateQuestion}\r\n                  onDelete={deleteQuestion}\r\n                  onMove={moveQuestion}\r\n                  totalQuestions={questions.length}\r\n                />\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === 'settings' && (\r\n            <div className=\"bg-white/80 backdrop-blur-sm rounded-3xl shadow-xl p-8 border border-white/20\">\r\n              <h2 className=\"text-3xl font-bold text-gray-900 mb-8\">Quiz Settings</h2>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"block text-sm font-semibold text-gray-700\">Time Limit (minutes)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={quizInfo.timeLimit}\r\n                    onChange={(e) => setQuizInfo({ ...quizInfo, timeLimit: parseInt(e.target.value) || 30 })}\r\n                    min=\"1\"\r\n                    max=\"180\"\r\n                    className=\"w-full p-4 border-2 border-gray-200 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-2\">\r\n                  <label className=\"block text-sm font-semibold text-gray-700\">Passing Score (%)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={quizInfo.passingScore}\r\n                    onChange={(e) => setQuizInfo({ ...quizInfo, passingScore: parseInt(e.target.value) || 70 })}\r\n                    min=\"0\"\r\n                    max=\"100\"\r\n                    className=\"w-full p-4 border-2 border-gray-200 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors\"\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"mt-8\">\r\n                <label className=\"flex items-center gap-4\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={quizInfo.isPublished}\r\n                    onChange={(e) => setQuizInfo({ ...quizInfo, isPublished: e.target.checked })}\r\n                    className=\"w-6 h-6 text-blue-600 rounded-lg focus:ring-blue-500\"\r\n                  />\r\n                  <span className=\"text-lg font-semibold text-gray-700\">{t('quizCreation.published')}</span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EditQuizPageAdvanced;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\FavoritesPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1103,1106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1103,1106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { RootState } from '../../../lib/store';\r\nimport { doc, getDoc } from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport QuizList from './QuizList';\r\nimport { Quiz } from '../types';\r\nimport { fetchQuizzes } from '../store';\r\n\r\nconst FavoritesPage: React.FC = () => {\r\n  const { t } = useTranslation();\r\n  const user = useSelector((state: RootState) => state.auth.user);\r\n  const allQuizzes = useSelector((state: RootState) => state.quiz.quizzes);\r\n  const quizLoading = useSelector((state: RootState) => state.quiz.loading || state.quiz.isLoading);\r\n  const dispatch = useDispatch();\r\n  const [favoriteQuizzes, setFavoriteQuizzes] = useState<Quiz[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    if (allQuizzes.length === 0 && !quizLoading) {\r\n      dispatch(fetchQuizzes({ user }) as any)\r\n        .unwrap()\r\n        .catch(() => {\r\n          setError(t('favorites.loadError'));\r\n          setLoading(false);\r\n        });\r\n      return;\r\n    }\r\n    const fetchFavorites = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const favRef = doc(db, 'user_favorites', user.uid);\r\n        const favSnap = await getDoc(favRef);\r\n        if (favSnap.exists()) {\r\n          const quizIds = favSnap.data().quizIds || [];\r\n          setFavoriteQuizzes(allQuizzes.filter(q => quizIds.includes(q.id)));\r\n        } else {\r\n          setFavoriteQuizzes([]);\r\n        }\r\n        setError(null);\r\n      } catch (e) {\r\n        setError(t('favorites.fetchError'));\r\n      }\r\n      setLoading(false);\r\n    };\r\n    fetchFavorites();\r\n  }, [user, allQuizzes, quizLoading, dispatch, t]);\r\n\r\n  if (!user) return <div className=\"p-8 text-center\">{t('favorites.loginRequired')}</div>;\r\n  if (error) return <div className=\"p-8 text-center text-red-600\">{error}</div>;\r\n  if (loading || quizLoading) return <div className=\"p-8 text-center\">{t('loading')}</div>;\r\n\r\n  return <QuizList quizzes={favoriteQuizzes} title={t('favorites.title')} />;\r\n};\r\n\r\nexport default FavoritesPage; ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\LeaderboardPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":332,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12709,12712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12709,12712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { collection, getDocs, query, orderBy, where } from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { FaCrown, FaUserCircle, FaTrophy, FaMedal, FaAward, FaFire, FaStar } from 'react-icons/fa';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\n\r\ninterface UserStat {\r\n  userId: string;\r\n  displayName: string;\r\n  email?: string;\r\n  totalScore: number;\r\n  totalAttempts: number;\r\n  averageScore: number;\r\n  perfectScores: number;\r\n  recentActivity: string;\r\n  badge: string;\r\n  rank?: number;\r\n}\r\n\r\ninterface QuizStat {\r\n  id: string;\r\n  title: string;\r\n  description?: string;\r\n  category: string;\r\n  difficulty: string;\r\n  totalAttempts: number;\r\n  averageScore: number;\r\n  totalCompletions: number;\r\n  createdBy?: string;\r\n  isPublished: boolean;\r\n  recentActivity: string;\r\n}\r\n\r\ninterface OverallStats {\r\n  totalUsers: number;\r\n  totalQuizzes: number;\r\n  totalAttempts: number;\r\n  averageScore: number;\r\n  activeToday: number;\r\n  perfectScoresCount: number;\r\n}\r\n\r\nconst LeaderboardPage: React.FC = () => {\r\n  // Safe translation hook with error handling\r\n  const { t, ready } = useTranslation();\r\n  \r\n  const [topUsers, setTopUsers] = useState<UserStat[]>([]);\r\n  const [topQuizzes, setTopQuizzes] = useState<QuizStat[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [stats, setStats] = useState<OverallStats | null>(null);\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const [timeFilter, setTimeFilter] = useState<'all' | 'week' | 'month'>('all');\r\n  const [search, setSearch] = useState('');\r\n  const [currentUserRank, setCurrentUserRank] = useState<number | null>(null);\r\n  \r\n  // Pagination states\r\n  const [showAllUsers, setShowAllUsers] = useState(false);\r\n  const [showAllQuizzes, setShowAllQuizzes] = useState(false);\r\n\r\n  // Calculate comprehensive leaderboard data - Move before conditional return\r\n  useEffect(() => {\r\n    if (!ready) return; // Skip if i18n not ready\r\n    \r\n    const fetchLeaderboardData = async () => {\r\n      setLoading(true);\r\n      try {\r\n        console.log('üèÜ Fetching leaderboard data...');\r\n        \r\n        // Get all quiz results\r\n        const resultsQuery = query(collection(db, 'quizResults'), orderBy('completedAt', 'desc'));\r\n        const resultsSnapshot = await getDocs(resultsQuery);\r\n        \r\n        // Get all quizzes\r\n        const quizzesQuery = query(collection(db, 'quizzes'), where('isPublished', '==', true));\r\n        const quizzesSnapshot = await getDocs(quizzesQuery);\r\n        \r\n        // Get all users\r\n        const usersQuery = query(collection(db, 'users'));\r\n        const usersSnapshot = await getDocs(usersQuery);\r\n        \r\n        console.log('üìä Found:', {\r\n          results: resultsSnapshot.size,\r\n          quizzes: quizzesSnapshot.size,\r\n          users: usersSnapshot.size\r\n        });\r\n\r\n        // Process users data\r\n        const usersMap = new Map();\r\n        usersSnapshot.forEach(doc => {\r\n          const userData = doc.data();\r\n          usersMap.set(doc.id, {\r\n            id: doc.id,\r\n            displayName: userData.displayName || userData.email?.split('@')[0] || t('leaderboard.anonymous'),\r\n            email: userData.email,\r\n            ...userData\r\n          });\r\n        });\r\n\r\n        // Process quizzes data\r\n        const quizzesMap = new Map();\r\n        quizzesSnapshot.forEach(doc => {\r\n          const quizData = doc.data();\r\n          quizzesMap.set(doc.id, {\r\n            id: doc.id,\r\n            title: quizData.title || t('leaderboard.untitledQuiz'),\r\n            description: quizData.description || '',\r\n            category: quizData.category || 'general',\r\n            difficulty: quizData.difficulty || 'medium',\r\n            createdBy: quizData.createdBy,\r\n            isPublished: quizData.isPublished,\r\n            ...quizData\r\n          });\r\n        });\r\n\r\n        // Calculate user statistics\r\n        const userStats = new Map<string, UserStat>();\r\n        const quizStats = new Map<string, QuizStat>();\r\n        let totalScore = 0;\r\n        let totalAttempts = 0;\r\n        let perfectScoresCount = 0;\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n\r\n        resultsSnapshot.forEach(doc => {\r\n          const result = doc.data();\r\n          const completedAt = result.completedAt?.toDate?.() || new Date(result.completedAt);\r\n          \r\n          // User statistics\r\n          const userId = result.userId;\r\n          if (!userStats.has(userId)) {\r\n            const userData = usersMap.get(userId) || {};\r\n            userStats.set(userId, {\r\n              userId,\r\n              displayName: userData.displayName || result.userName || t('leaderboard.anonymous'),\r\n              email: userData.email || result.userEmail,\r\n              totalScore: 0,\r\n              totalAttempts: 0,\r\n              averageScore: 0,\r\n              perfectScores: 0,\r\n              recentActivity: completedAt.toLocaleDateString('vi-VN'),\r\n              badge: 'beginner'\r\n            });\r\n          }\r\n\r\n          const userStat = userStats.get(userId)!;\r\n          userStat.totalAttempts++;\r\n          userStat.totalScore += result.score || 0;\r\n          \r\n          if (result.score === 100) {\r\n            userStat.perfectScores++;\r\n            perfectScoresCount++;\r\n          }\r\n          \r\n          if (completedAt > new Date(userStat.recentActivity)) {\r\n            userStat.recentActivity = completedAt.toLocaleDateString('vi-VN');\r\n          }\r\n\r\n          // Quiz statistics\r\n          const quizId = result.quizId;\r\n          if (!quizStats.has(quizId)) {\r\n            const quizData = quizzesMap.get(quizId) || {};\r\n            quizStats.set(quizId, {\r\n              id: quizId,\r\n              title: quizData.title || t('leaderboard.unknownQuiz'),\r\n              description: quizData.description || '',\r\n              category: quizData.category || 'general',\r\n              difficulty: quizData.difficulty || 'medium',\r\n              totalAttempts: 0,\r\n              averageScore: 0,\r\n              totalCompletions: 0,\r\n              createdBy: quizData.createdBy,\r\n              isPublished: quizData.isPublished,\r\n              recentActivity: completedAt.toLocaleDateString('vi-VN')\r\n            });\r\n          }\r\n\r\n          const quizStat = quizStats.get(quizId)!;\r\n          quizStat.totalAttempts++;\r\n          quizStat.totalCompletions++;\r\n          quizStat.averageScore = ((quizStat.averageScore * (quizStat.totalAttempts - 1)) + (result.score || 0)) / quizStat.totalAttempts;\r\n          \r\n          if (completedAt > new Date(quizStat.recentActivity)) {\r\n            quizStat.recentActivity = completedAt.toLocaleDateString('vi-VN');\r\n          }\r\n\r\n          totalScore += result.score || 0;\r\n          totalAttempts++;\r\n        });\r\n\r\n        // Calculate user averages and assign badges\r\n        userStats.forEach(userStat => {\r\n          userStat.averageScore = userStat.totalAttempts > 0 ? userStat.totalScore / userStat.totalAttempts : 0;\r\n          \r\n          // Assign badges based on performance\r\n          if (userStat.averageScore >= 90 && userStat.totalAttempts >= 10) {\r\n            userStat.badge = 'legendary';\r\n          } else if (userStat.averageScore >= 80 && userStat.totalAttempts >= 5) {\r\n            userStat.badge = 'expert';\r\n          } else if (userStat.averageScore >= 70 && userStat.totalAttempts >= 3) {\r\n            userStat.badge = 'advanced';\r\n          } else if (userStat.totalAttempts >= 2) {\r\n            userStat.badge = 'intermediate';\r\n          } else {\r\n            userStat.badge = 'beginner';\r\n          }\r\n        });\r\n\r\n        // Sort and rank users - NEW PRIORITY: Quiz count -> Score -> Total time\r\n        const sortedUsers = Array.from(userStats.values())\r\n          .sort((a, b) => {\r\n            // Primary: Total quiz attempts (more quizzes = higher rank)\r\n            if (a.totalAttempts !== b.totalAttempts) {\r\n              return b.totalAttempts - a.totalAttempts;\r\n            }\r\n            // Secondary: Average score \r\n            if (Math.abs(a.averageScore - b.averageScore) > 1) {\r\n              return b.averageScore - a.averageScore;\r\n            }\r\n            // Tertiary: Perfect scores count\r\n            return b.perfectScores - a.perfectScores;\r\n          })\r\n          .map((user, index) => ({ ...user, rank: index + 1 }));\r\n\r\n        // Sort quizzes by popularity\r\n        const sortedQuizzes = Array.from(quizStats.values())\r\n          .sort((a, b) => b.totalAttempts - a.totalAttempts);\r\n\r\n        setTopUsers(sortedUsers);\r\n        setTopQuizzes(sortedQuizzes);\r\n\r\n        // Find current user rank\r\n        if (user) {\r\n          const userIndex = sortedUsers.findIndex(u => u.userId === user.uid);\r\n          setCurrentUserRank(userIndex >= 0 ? userIndex + 1 : null);\r\n        }\r\n\r\n        // Calculate overall statistics\r\n        const activeToday = Array.from(userStats.values()).filter(u => {\r\n          const lastActivity = new Date(u.recentActivity);\r\n          return lastActivity >= today;\r\n        }).length;\r\n\r\n        setStats({\r\n          totalUsers: userStats.size,\r\n          totalQuizzes: quizStats.size,\r\n          totalAttempts,\r\n          averageScore: totalAttempts > 0 ? Math.round((totalScore / totalAttempts) * 10) / 10 : 0,\r\n          activeToday,\r\n          perfectScoresCount\r\n        });\r\n\r\n        console.log('‚úÖ Leaderboard data processed successfully');\r\n        \r\n      } catch (error) {\r\n        console.error('‚ùå Error fetching leaderboard data:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchLeaderboardData();\r\n  }, [user, ready, t]);\r\n\r\n  // Don't render until i18n is ready - Moved after hooks\r\n  if (!ready) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">{t('leaderboard.loading')}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Filter users by search\r\n  const filteredUsers = topUsers.filter(u => {\r\n    const keyword = search.toLowerCase();\r\n    return (\r\n      (u.displayName && u.displayName.toLowerCase().includes(keyword)) ||\r\n      (u.email && u.email.toLowerCase().includes(keyword)) ||\r\n      (u.userId && u.userId.toLowerCase().includes(keyword))\r\n    );\r\n  });\r\n\r\n  const getBadgeIcon = (badge: string) => {\r\n    switch (badge) {\r\n      case 'legendary': return <FaCrown className=\"w-5 h-5 text-yellow-500\" />;\r\n      case 'expert': return <FaTrophy className=\"w-5 h-5 text-purple-500\" />;\r\n      case 'advanced': return <FaMedal className=\"w-5 h-5 text-blue-500\" />;\r\n      case 'intermediate': return <FaAward className=\"w-5 h-5 text-green-500\" />;\r\n      default: return <FaStar className=\"w-5 h-5 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  const getBadgeColor = (badge: string) => {\r\n    switch (badge) {\r\n      case 'legendary': return 'bg-yellow-100 text-yellow-800 border-yellow-300';\r\n      case 'expert': return 'bg-purple-100 text-purple-800 border-purple-300';\r\n      case 'advanced': return 'bg-blue-100 text-blue-800 border-blue-300';\r\n      case 'intermediate': return 'bg-green-100 text-green-800 border-green-300';\r\n      default: return 'bg-gray-100 text-gray-800 border-gray-300';\r\n    }\r\n  };\r\n\r\n  const getDifficultyColor = (difficulty: string) => {\r\n    switch (difficulty) {\r\n      case 'easy': return 'bg-green-100 text-green-800';\r\n      case 'hard': return 'bg-red-100 text-red-800';\r\n      default: return 'bg-yellow-100 text-yellow-800';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 py-8\">\r\n      <div className=\"max-w-6xl mx-auto px-4\">\r\n        <h1 className=\"text-4xl font-bold text-gray-900 mb-8 text-center flex items-center justify-center gap-3\">\r\n          <FaTrophy className=\"text-yellow-500\" />\r\n          {t('leaderboard.title')}\r\n          <FaTrophy className=\"text-yellow-500\" />\r\n        </h1>\r\n        \r\n        {/* Filters and Search */}\r\n        <div className=\"flex flex-col md:flex-row items-center justify-between gap-4 mb-8\">\r\n          <div className=\"flex gap-4 items-center\">\r\n            <label className=\"font-medium text-gray-700\">{t('leaderboard.time')}:</label>\r\n            <select\r\n              className=\"border border-gray-300 rounded-lg px-3 py-2 bg-white\"\r\n              value={timeFilter}\r\n              onChange={e => setTimeFilter(e.target.value as any)}\r\n            >\r\n              <option value=\"all\">{t('leaderboard.filters.allTime')}</option>\r\n              <option value=\"week\">{t('leaderboard.filters.thisWeek')}</option>\r\n              <option value=\"month\">{t('leaderboard.filters.thisMonth')}</option>\r\n            </select>\r\n          </div>\r\n          <input\r\n            className=\"border border-gray-300 rounded-lg px-4 py-2 w-full md:w-80 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n            placeholder={t('leaderboard.searchPlayers')}\r\n            value={search}\r\n            onChange={e => setSearch(e.target.value)}\r\n          />\r\n        </div>\r\n\r\n        {/* Overall Statistics */}\r\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8\">\r\n          <div className=\"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-4 text-center shadow-lg\">\r\n            <div className=\"text-2xl font-bold\">{stats?.totalUsers || '--'}</div>\r\n            <div className=\"text-blue-100 text-sm\">{t('leaderboard.players')}</div>\r\n          </div>\r\n          <div className=\"bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-4 text-center shadow-lg\">\r\n            <div className=\"text-2xl font-bold\">{stats?.totalQuizzes || '--'}</div>\r\n            <div className=\"text-green-100 text-sm\">{t('nav.quizzes')}</div>\r\n          </div>\r\n          <div className=\"bg-gradient-to-br from-yellow-500 to-yellow-600 text-white rounded-xl p-4 text-center shadow-lg\">\r\n            <div className=\"text-2xl font-bold\">{stats?.totalAttempts || '--'}</div>\r\n            <div className=\"text-yellow-100 text-sm\">{t('leaderboard.plays')}</div>\r\n          </div>\r\n          <div className=\"bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-4 text-center shadow-lg\">\r\n            <div className=\"text-2xl font-bold\">{stats?.averageScore || '--'}%</div>\r\n            <div className=\"text-purple-100 text-sm\">{t('leaderboard.avgScore')}</div>\r\n          </div>\r\n          <div className=\"bg-gradient-to-br from-red-500 to-red-600 text-white rounded-xl p-4 text-center shadow-lg\">\r\n            <div className=\"text-2xl font-bold\">{stats?.activeToday || '--'}</div>\r\n            <div className=\"text-red-100 text-sm\">{t('leaderboard.activeToday')}</div>\r\n          </div>\r\n          <div className=\"bg-gradient-to-br from-indigo-500 to-indigo-600 text-white rounded-xl p-4 text-center shadow-lg\">\r\n            <div className=\"text-2xl font-bold\">{stats?.perfectScoresCount || '--'}</div>\r\n            <div className=\"text-indigo-100 text-sm\">{t('leaderboard.perfectScores')}</div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Top Users Section */}\r\n        <div className=\"mb-10\">\r\n            <h2 className=\"text-2xl font-bold mb-6 text-center flex items-center justify-center gap-2\">\r\n            <FaCrown className=\"text-yellow-500\" />\r\n            {t('leaderboard.topPlayers')}\r\n          </h2>\r\n          \r\n          <div className=\"bg-white rounded-2xl shadow-lg p-6\">\r\n            {loading ? (\r\n              <div className=\"space-y-4\">\r\n                {Array.from({length: 5}).map((_, i) => (\r\n                  <div key={i} className=\"animate-pulse flex items-center gap-4\">\r\n                    <div className=\"w-12 h-12 bg-gray-300 rounded-full\"></div>\r\n                    <div className=\"flex-1 space-y-2\">\r\n                      <div className=\"h-4 bg-gray-300 rounded w-3/4\"></div>\r\n                      <div className=\"h-3 bg-gray-300 rounded w-1/2\"></div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : filteredUsers.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <FaUserCircle className=\"w-16 h-16 text-gray-400 mx-auto mb-4\" />\r\n                <h3 className=\"text-lg font-semibold text-gray-600 mb-2\">{t('leaderboard.noData')}</h3>\r\n                <p className=\"text-gray-500\">{t('leaderboard.playToAppear')}</p>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                {/* Top 5 Winners - Enhanced Display */}\r\n                <div className=\"mb-8\">\r\n                  {/* Top 3 Podium */}\r\n                  <div className=\"flex justify-center items-end gap-6 mb-6\">\r\n                    {filteredUsers.slice(0, 3).map((user, idx) => (\r\n                      <div key={user.userId} className={`text-center ${idx === 0 ? 'order-2' : idx === 1 ? 'order-1' : 'order-3'}`}>\r\n                        <div className={`relative mb-4 ${idx === 0 ? 'transform scale-110' : ''}`}>\r\n                          <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold text-white mx-auto ${\r\n                            idx === 0 ? 'bg-gradient-to-br from-yellow-400 to-yellow-600' :\r\n                            idx === 1 ? 'bg-gradient-to-br from-gray-400 to-gray-600' :\r\n                            'bg-gradient-to-br from-orange-400 to-orange-600'\r\n                          }`}>\r\n                            {user.displayName.charAt(0).toUpperCase()}\r\n                          </div>\r\n                          <div className=\"absolute -top-3 -right-2\">\r\n                            {getBadgeIcon(user.badge)}\r\n                          </div>\r\n                          {idx === 0 && <FaCrown className=\"absolute -top-6 left-1/2 transform -translate-x-1/2 text-2xl text-yellow-500\" />}\r\n                        </div>\r\n                        <div className=\"font-bold text-gray-900 truncate max-w-24\">{user.displayName}</div>\r\n                        <div className={`text-sm font-semibold ${\r\n                          idx === 0 ? 'text-yellow-600' : idx === 1 ? 'text-gray-600' : 'text-orange-600'\r\n                        }`}>\r\n                          üéØ {user.totalAttempts} {t('nav.quizzes')}\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500\">{Math.round(user.averageScore)}% {t('leaderboard.avgShort')}</div>\r\n                        <div className={`mt-2 px-2 py-1 rounded-full text-xs font-bold ${\r\n                          idx === 0 ? 'bg-yellow-100 text-yellow-800' :\r\n                          idx === 1 ? 'bg-gray-100 text-gray-800' :\r\n                          'bg-orange-100 text-orange-800'\r\n                        }`}>\r\n                          #{idx + 1}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n\r\n                  {/* Top 4-5 in cards */}\r\n                  {filteredUsers.length >= 4 && (\r\n                    <div className=\"flex justify-center gap-4\">\r\n                      {filteredUsers.slice(3, 5).map((user, idx) => (\r\n                        <div key={user.userId} className=\"bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-4 flex items-center gap-3 min-w-64\">\r\n                          <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold\">\r\n                            {user.displayName.charAt(0).toUpperCase()}\r\n                          </div>\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"font-semibold text-gray-900 flex items-center gap-2\">\r\n                              #{idx + 4} {user.displayName}\r\n                              {getBadgeIcon(user.badge)}\r\n                            </div>\r\n                              <div className=\"text-sm text-blue-600 font-medium\">\r\n                              üéØ {user.totalAttempts} {t('nav.quizzes')} ‚Ä¢ {Math.round(user.averageScore)}% {t('leaderboard.avgShort')}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Rest of leaderboard - Starting from 6th place */}\r\n                <div className=\"space-y-2\">\r\n                  {(showAllUsers ? filteredUsers.slice(5) : filteredUsers.slice(5, 20)).map((user, idx) => (\r\n                    <div key={user.userId} className={`flex items-center gap-4 p-3 rounded-lg transition-colors ${\r\n                      currentUserRank === idx + 6 ? 'bg-blue-50 border-2 border-blue-200' : 'hover:bg-gray-50'\r\n                    }`}>\r\n                      <div className=\"flex items-center gap-3 flex-1\">\r\n                        <span className=\"font-bold text-lg text-blue-600 w-8\">#{idx + 6}</span>\r\n                        <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold\">\r\n                          {user.displayName.charAt(0).toUpperCase()}\r\n                        </div>\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"font-semibold text-gray-900 flex items-center gap-2\">\r\n                            {user.displayName}\r\n                            <span className={`px-2 py-1 rounded-full text-xs border ${getBadgeColor(user.badge)}`}>\r\n                              {t(`leaderboard.badges.${user.badge}`)}\r\n                            </span>\r\n                          </div>\r\n                            <div className=\"text-sm text-gray-500\">\r\n                              üéØ {user.totalAttempts} {t('nav.quizzes')} ‚Ä¢ {user.perfectScores} {t('leaderboard.perfect100')} ‚Ä¢ {t('leaderboard.activity')}: {user.recentActivity}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <div className=\"font-bold text-lg text-blue-600\">üéØ {user.totalAttempts}</div>\r\n                        <div className=\"text-sm text-gray-500\">{Math.round(user.averageScore)}% {t('leaderboard.avgShort')}</div>\r\n                      </div>\r\n                      <div className=\"text-gray-400\">\r\n                        {getBadgeIcon(user.badge)}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n\r\n                {/* Show More Button */}\r\n                {filteredUsers.length > 20 && (\r\n                  <div className=\"text-center mt-6\">\r\n                    <button\r\n                      onClick={() => setShowAllUsers(!showAllUsers)}\r\n                      className=\"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold\"\r\n                    >\r\n                      {showAllUsers ? t('leaderboard.collapse') : t('leaderboard.viewAllCount')}\r\n                    </button>\r\n                    {user && (\r\n                      <div className=\"text-sm text-blue-700 mt-2\">{user.displayName || user.email}</div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Top Quizzes Section */}\r\n        <div>\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n            <h2 className=\"text-2xl font-bold text-center flex items-center gap-2\">\r\n              <FaFire className=\"text-red-500\" />\r\n                {t('leaderboard.topQuizzes')}\r\n            </h2>\r\n            {topQuizzes.length > 12 && (\r\n              <button\r\n                onClick={() => setShowAllQuizzes(!showAllQuizzes)}\r\n                className=\"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold\"\r\n              >\r\n                {showAllQuizzes ? t('leaderboard.collapse') : t('leaderboard.viewAllCount')}\r\n              </button>\r\n            )}\r\n            </div>\r\n            {topQuizzes.length === 0 ? (\r\n              <div className=\"text-center text-gray-500\">\r\n                <p className=\"text-gray-500\">{t('leaderboard.createFirstQuiz')}</p>\r\n              </div>\r\n            ) : (\r\n              (showAllQuizzes ? topQuizzes : topQuizzes.slice(0, 12)).map((quiz, idx) => (\r\n                <div key={quiz.id} className=\"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow border-l-4 border-blue-500\">\r\n                  <div className=\"flex items-start justify-between mb-4\">\r\n                    <div className=\"flex-1\">\r\n                      <h3 className=\"font-bold text-lg text-gray-900 mb-2 line-clamp-2\">{quiz.title}</h3>\r\n                      <p className=\"text-gray-600 text-sm line-clamp-2 mb-3\">{quiz.description}</p>\r\n                    </div>\r\n                    <span className=\"bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded-full\">\r\n                      #{idx + 1}\r\n                    </span>\r\n                  </div>\r\n                  \r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getDifficultyColor(quiz.difficulty)}`}>\r\n                      {quiz.difficulty === 'easy' ? t('difficulty.easy') : quiz.difficulty === 'hard' ? t('difficulty.hard') : t('difficulty.medium')}\r\n                    </span>\r\n                    <span className=\"text-gray-500 text-sm capitalize\">{quiz.category}</span>\r\n                  </div>\r\n                  \r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex justify-between items-center\">\r\n                      <span className=\"text-gray-600 text-sm\">{t('leaderboard.plays')}:</span>\r\n                      <span className=\"font-semibold text-blue-600\">{quiz.totalAttempts}</span>\r\n                    </div>\r\n                    <div className=\"flex justify-between items-center\">\r\n                      <span className=\"text-gray-600 text-sm\">{t('leaderboard.avgScore')}:</span>\r\n                      <span className=\"font-semibold text-green-600\">{Math.round(quiz.averageScore)}%</span>\r\n                    </div>\r\n                    <div className=\"flex justify-between items-center\">\r\n                      <span className=\"text-gray-600 text-sm\">{t('leaderboard.activity')}:</span>\r\n                      <span className=\"text-gray-500 text-xs\">{quiz.recentActivity}</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n  );\r\n};\r\n\r\nexport default LeaderboardPage;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\LearningMaterialsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1246,1249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1246,1249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1312,1315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1312,1315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2706,2709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2706,2709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4129,4132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4129,4132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { toast } from 'react-toastify';\r\nimport { \r\n  Play, \r\n  FileText, \r\n  Image as ImageIcon, \r\n  Link as LinkIcon, \r\n  CheckCircle2, \r\n  Lock, \r\n  AlertCircle,\r\n  ArrowRight,\r\n  Clock\r\n} from 'lucide-react';\r\nimport { Quiz } from '../types';\r\nimport { getQuizById } from '../api';\r\nimport { \r\n  getLearningSession, \r\n  checkGatingStatus,\r\n  updateResourceProgress\r\n} from '../services/learningService';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\nimport { VideoViewer, PDFViewer, ImageSlidesViewer, LinkViewer } from '../components/ResourceViewers';\r\n\r\n// Simplified resource type for UI\r\ninterface SimpleResource {\r\n  id: string;\r\n  type: 'video' | 'pdf' | 'image' | 'link' | 'slides';\r\n  title: string;\r\n  description?: string;\r\n  url: string;\r\n  required: boolean;\r\n  thumbnailUrl?: string;\r\n  whyWatch?: string;\r\n  estimatedTime?: number;\r\n  order?: number;\r\n}\r\n\r\ninterface GatingResult {\r\n  ready: boolean;\r\n  requiredCount: number;\r\n  completedCount: number;\r\n  completionPercent: number;\r\n  missingResources: any[];\r\n  warnings: string[];\r\n  viewedResources?: Record<string, any>;\r\n}\r\n\r\nconst LearningMaterialsPage: React.FC = () => {\r\n  const { id: quizId } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation();\r\n  const currentUser = useSelector((state: RootState) => state.auth.user);\r\n  \r\n  const [quiz, setQuiz] = useState<Quiz | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [gatingStatus, setGatingStatus] = useState<GatingResult | null>(null);\r\n  const [selectedResource, setSelectedResource] = useState<SimpleResource | null>(null);\r\n\r\n  const loadQuizAndSession = useCallback(async () => {\r\n    if (!quizId || !currentUser?.uid) return;\r\n    \r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Load quiz data\r\n      const quizData = await getQuizById(quizId);\r\n      if (!quizData) {\r\n        toast.error(t('quiz.errors.notFound'));\r\n        navigate('/quizzes');\r\n        return;\r\n      }\r\n      setQuiz(quizData);\r\n\r\n      // Check if quiz has learning resources\r\n      const resources = quizData.resources || [];\r\n      if (resources.length === 0) {\r\n        // No materials - redirect directly to quiz\r\n        navigate(`/quiz/${quizId}/play`);\r\n        return;\r\n      }\r\n\r\n      // Load learning session and check gating\r\n      const session = await getLearningSession(quizId, currentUser.uid);\r\n      const status = await checkGatingStatus(currentUser.uid, quizId, resources as any);\r\n      \r\n      // Add viewedResources and completionPercent\r\n      const completionPercent = status.requiredCount > 0 \r\n        ? Math.round((status.completedCount / status.requiredCount) * 100)\r\n        : 100;\r\n      \r\n      setGatingStatus({\r\n        ...status,\r\n        completionPercent,\r\n        viewedResources: session?.viewedResources\r\n      });\r\n\r\n      // Auto-select first incomplete required resource\r\n      const firstIncomplete = resources.find((r: SimpleResource) => \r\n        r.required && !session?.viewedResources?.[r.id]?.completed\r\n      );\r\n      if (firstIncomplete) {\r\n        setSelectedResource(firstIncomplete);\r\n      } else if (resources.length > 0) {\r\n        setSelectedResource(resources[0]);\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Failed to load learning materials:', error);\r\n      toast.error(t('errors.loadFailed'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [quizId, currentUser, t, navigate]);\r\n\r\n  useEffect(() => {\r\n    loadQuizAndSession();\r\n  }, [loadQuizAndSession]);\r\n\r\n  const handleStartQuiz = () => {\r\n    if (!gatingStatus?.ready) {\r\n      toast.warning(t('learning.gating.notReady'));\r\n      return;\r\n    }\r\n    navigate(`/quiz/${quizId}/play`);\r\n  };\r\n\r\n  const handleResourceClick = (resource: SimpleResource) => {\r\n    setSelectedResource(resource);\r\n  };\r\n\r\n  const handleResourceProgressUpdate = async (resourceId: string, progress: any) => {\r\n    if (!quizId || !currentUser?.uid) return;\r\n    \r\n    try {\r\n      await updateResourceProgress(quizId, currentUser.uid, resourceId, progress);\r\n      // Reload gating status after progress update\r\n      await loadQuizAndSession();\r\n    } catch (error) {\r\n      console.error('Failed to update resource progress:', error);\r\n    }\r\n  };\r\n\r\n  const getResourceIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'video': return <Play className=\"w-5 h-5\" />;\r\n      case 'pdf': return <FileText className=\"w-5 h-5\" />;\r\n      case 'image':\r\n      case 'slides': return <ImageIcon className=\"w-5 h-5\" />;\r\n      case 'link': return <LinkIcon className=\"w-5 h-5\" />;\r\n      default: return <FileText className=\"w-5 h-5\" />;\r\n    }\r\n  };\r\n\r\n  const getResourceTypeBadge = (type: string) => {\r\n    const colors: Record<string, string> = {\r\n      video: 'bg-red-100 text-red-700 border-red-300',\r\n      pdf: 'bg-blue-100 text-blue-700 border-blue-300',\r\n      image: 'bg-green-100 text-green-700 border-green-300',\r\n      slides: 'bg-purple-100 text-purple-700 border-purple-300',\r\n      link: 'bg-yellow-100 text-yellow-700 border-yellow-300'\r\n    };\r\n    return colors[type] || 'bg-gray-100 text-gray-700 border-gray-300';\r\n  };\r\n\r\n  const formatEstimatedTime = (minutes?: number) => {\r\n    if (!minutes) return null;\r\n    if (minutes < 60) return `${minutes} min`;\r\n    const hours = Math.floor(minutes / 60);\r\n    const mins = minutes % 60;\r\n    return mins > 0 ? `${hours}h ${mins}min` : `${hours}h`;\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{t('common.loading')}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!quiz) return null;\r\n\r\n  const resources = quiz.resources || [];\r\n  const requiredResources = resources.filter((r: SimpleResource) => r.required);\r\n  const optionalResources = resources.filter((r: SimpleResource) => !r.required);\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {/* Header */}\r\n      <div className=\"bg-white border-b border-gray-200 sticky top-0 z-10\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex-1\">\r\n              <h1 className=\"text-2xl font-bold text-gray-900\">{quiz.title}</h1>\r\n              <p className=\"text-sm text-gray-600 mt-1\">{t('learning.materials.title')}</p>\r\n            </div>\r\n            \r\n            {/* Progress & Start Button */}\r\n            <div className=\"flex items-center gap-4\">\r\n              {gatingStatus && (\r\n                <div className=\"text-right\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"text-sm font-medium text-gray-700\">\r\n                      {t('learning.progress')}: {gatingStatus.completionPercent}%\r\n                    </div>\r\n                    {gatingStatus.ready ? (\r\n                      <CheckCircle2 className=\"w-5 h-5 text-green-500\" />\r\n                    ) : (\r\n                      <Lock className=\"w-5 h-5 text-gray-400\" />\r\n                    )}\r\n                  </div>\r\n                  <div className=\"w-32 bg-gray-200 rounded-full h-2 mt-1\">\r\n                    <div \r\n                      className={`h-2 rounded-full transition-all ${\r\n                        gatingStatus.ready ? 'bg-green-500' : 'bg-blue-500'\r\n                      }`}\r\n                      style={{ width: `${gatingStatus.completionPercent}%` }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              )}\r\n              \r\n              <button\r\n                onClick={handleStartQuiz}\r\n                disabled={!gatingStatus?.ready}\r\n                className={`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition-all ${\r\n                  gatingStatus?.ready\r\n                    ? 'bg-blue-600 text-white hover:bg-blue-700'\r\n                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'\r\n                }`}\r\n              >\r\n                {gatingStatus?.ready ? (\r\n                  <>\r\n                    {t('quiz.start')}\r\n                    <ArrowRight className=\"w-5 h-5\" />\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Lock className=\"w-5 h-5\" />\r\n                    {t('learning.locked')}\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n          {/* Sidebar - Resource List */}\r\n          <div className=\"lg:col-span-1\">\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 sticky top-24\">\r\n              <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">\r\n                {t('learning.materials.list')}\r\n              </h2>\r\n\r\n              {/* Required Resources */}\r\n              {requiredResources.length > 0 && (\r\n                <div className=\"mb-6\">\r\n                  <h3 className=\"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2\">\r\n                    <AlertCircle className=\"w-4 h-4 text-red-500\" />\r\n                    {t('learning.required')} ({requiredResources.length})\r\n                  </h3>\r\n                  <div className=\"space-y-2\">\r\n                    {requiredResources.map((resource: SimpleResource, index: number) => {\r\n                      const progress = gatingStatus?.viewedResources?.[resource.id];\r\n                      const isCompleted = progress?.completed || false;\r\n                      const isSelected = selectedResource?.id === resource.id;\r\n                      \r\n                      return (\r\n                        <button\r\n                          key={resource.id}\r\n                          onClick={() => handleResourceClick(resource)}\r\n                          className={`w-full text-left p-3 rounded-lg border-2 transition-all ${\r\n                            isSelected\r\n                              ? 'border-blue-500 bg-blue-50'\r\n                              : 'border-gray-200 hover:border-gray-300'\r\n                          }`}\r\n                        >\r\n                          <div className=\"flex items-start gap-3\">\r\n                            <div className={`p-2 rounded-lg ${\r\n                              isCompleted ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-600'\r\n                            }`}>\r\n                              {isCompleted ? (\r\n                                <CheckCircle2 className=\"w-4 h-4\" />\r\n                              ) : (\r\n                                getResourceIcon(resource.type)\r\n                              )}\r\n                            </div>\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <p className=\"font-medium text-sm text-gray-900 truncate\">\r\n                                {index + 1}. {resource.title}\r\n                              </p>\r\n                              {resource.estimatedTime && (\r\n                                <div className=\"flex items-center gap-1 text-xs text-gray-500 mt-1\">\r\n                                  <Clock className=\"w-3 h-3\" />\r\n                                  {formatEstimatedTime(resource.estimatedTime)}\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Optional Resources */}\r\n              {optionalResources.length > 0 && (\r\n                <div>\r\n                  <h3 className=\"text-sm font-medium text-gray-700 mb-3\">\r\n                    {t('learning.optional')} ({optionalResources.length})\r\n                  </h3>\r\n                  <div className=\"space-y-2\">\r\n                    {optionalResources.map((resource: SimpleResource) => {\r\n                      const progress = gatingStatus?.viewedResources?.[resource.id];\r\n                      const isCompleted = progress?.completed || false;\r\n                      const isSelected = selectedResource?.id === resource.id;\r\n                      \r\n                      return (\r\n                        <button\r\n                          key={resource.id}\r\n                          onClick={() => handleResourceClick(resource)}\r\n                          className={`w-full text-left p-3 rounded-lg border transition-all ${\r\n                            isSelected\r\n                              ? 'border-blue-500 bg-blue-50'\r\n                              : 'border-gray-200 hover:border-gray-300'\r\n                          }`}\r\n                        >\r\n                          <div className=\"flex items-start gap-3\">\r\n                            <div className={`p-2 rounded-lg ${\r\n                              isCompleted ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-600'\r\n                            }`}>\r\n                              {isCompleted ? (\r\n                                <CheckCircle2 className=\"w-4 h-4\" />\r\n                              ) : (\r\n                                getResourceIcon(resource.type)\r\n                              )}\r\n                            </div>\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <p className=\"font-medium text-sm text-gray-900 truncate\">\r\n                                {resource.title}\r\n                              </p>\r\n                              {resource.estimatedTime && (\r\n                                <div className=\"flex items-center gap-1 text-xs text-gray-500 mt-1\">\r\n                                  <Clock className=\"w-3 h-3\" />\r\n                                  {formatEstimatedTime(resource.estimatedTime)}\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Main Content - Resource Viewer */}\r\n          <div className=\"lg:col-span-2\">\r\n            {selectedResource ? (\r\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden\">\r\n                {/* Resource Header */}\r\n                <div className=\"border-b border-gray-200 p-6\">\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-3 mb-2\">\r\n                        <span className={`px-3 py-1 rounded-lg text-xs font-semibold border-2 uppercase ${\r\n                          getResourceTypeBadge(selectedResource.type)\r\n                        }`}>\r\n                          {selectedResource.type}\r\n                        </span>\r\n                        {selectedResource.required && (\r\n                          <span className=\"px-3 py-1 rounded-lg text-xs font-semibold border-2 bg-red-100 text-red-700 border-red-300 uppercase\">\r\n                            {t('learning.required')}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                      <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n                        {selectedResource.title}\r\n                      </h2>\r\n                      {selectedResource.description && (\r\n                        <p className=\"text-gray-600\">{selectedResource.description}</p>\r\n                      )}\r\n                      {selectedResource.whyWatch && (\r\n                        <div className=\"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200\">\r\n                          <p className=\"text-sm text-blue-900\">\r\n                            <strong>{t('learning.whyWatch')}:</strong> {selectedResource.whyWatch}\r\n                          </p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Resource Content */}\r\n                <div className=\"p-6\">\r\n                  {selectedResource.type === 'video' && (\r\n                    <VideoViewer\r\n                      url={selectedResource.url}\r\n                      title={selectedResource.title}\r\n                      onProgressUpdate={(progress) => \r\n                        handleResourceProgressUpdate(selectedResource.id, progress)\r\n                      }\r\n                      initialProgress={gatingStatus?.viewedResources?.[selectedResource.id]}\r\n                    />\r\n                  )}\r\n                  \r\n                  {selectedResource.type === 'pdf' && (\r\n                    <PDFViewer\r\n                      url={selectedResource.url}\r\n                      title={selectedResource.title}\r\n                      onProgressUpdate={(progress) => \r\n                        handleResourceProgressUpdate(selectedResource.id, progress)\r\n                      }\r\n                      initialProgress={gatingStatus?.viewedResources?.[selectedResource.id]}\r\n                    />\r\n                  )}\r\n                  \r\n                  {(selectedResource.type === 'image' || selectedResource.type === 'slides') && (\r\n                    <ImageSlidesViewer\r\n                      urls={[selectedResource.url]} // TODO: Support multiple images\r\n                      title={selectedResource.title}\r\n                      onProgressUpdate={(progress) => \r\n                        handleResourceProgressUpdate(selectedResource.id, progress)\r\n                      }\r\n                      initialProgress={gatingStatus?.viewedResources?.[selectedResource.id]}\r\n                    />\r\n                  )}\r\n                  \r\n                  {selectedResource.type === 'link' && (\r\n                    <LinkViewer\r\n                      url={selectedResource.url}\r\n                      title={selectedResource.title}\r\n                      description={selectedResource.description}\r\n                      estimatedTime={selectedResource.estimatedTime}\r\n                      onProgressUpdate={(progress) => \r\n                        handleResourceProgressUpdate(selectedResource.id, progress)\r\n                      }\r\n                      initialProgress={gatingStatus?.viewedResources?.[selectedResource.id]}\r\n                    />\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center\">\r\n                <FileText className=\"w-16 h-16 text-gray-400 mx-auto mb-4\" />\r\n                <p className=\"text-gray-600\">{t('learning.selectResource')}</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LearningMaterialsPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\MyQuizzesPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizDetailedStats.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1310,1313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1310,1313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1353,1356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1353,1356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1772,1775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1772,1775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1789,1792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1789,1792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4384,4387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4384,4387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9655,9658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9655,9658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9774,9777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9774,9777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600 mb-4\">Kh√¥ng t√¨m th·∫•y quiz</p>","line":380,"column":45,"nodeType":"JSXText","endLine":380,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n            onClick={() => navigate(ROUTES.CREATOR_MY_QUIZZES)}\r\n            className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\r\n          >\r\n            Quay l·∫°i\r\n          </button>","line":384,"column":12,"nodeType":"JSXText","endLine":386,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium\">Quay l·∫°i My Quizzes</span>","line":457,"column":43,"nodeType":"JSXText","endLine":457,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-medium flex items-center gap-1\">\r\n                      <Lock className=\"w-4 h-4\" />\r\n                      Password\r\n                    </span>","line":467,"column":51,"nodeType":"JSXText","endLine":469,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium flex items-center gap-1\">\r\n                      <BookOpen className=\"w-4 h-4\" />\r\n                      With Materials\r\n                    </span>","line":473,"column":55,"nodeType":"JSXText","endLine":475,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600\">\r\n                    <Brain className=\"w-4 h-4 inline mr-1\" />\r\n                    {quiz.questions.length} c√¢u h·ªèi\r\n                  </span>","line":492,"column":44,"nodeType":"JSXText","endLine":493,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                onClick={() => navigate(`/quiz-preview/${quiz.id}`)}\r\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 font-medium\"\r\n              >\r\n                <Eye className=\"w-4 h-4\" />\r\n                Xem Quiz\r\n              </button>","line":511,"column":44,"nodeType":"JSXText","endLine":513,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                onClick={handleExport}\r\n                className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 font-medium\"\r\n              >\r\n                <Download className=\"w-4 h-4\" />\r\n                Xu·∫•t b√°o c√°o\r\n              </button>","line":518,"column":49,"nodeType":"JSXText","endLine":520,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":523,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":523,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17730,17733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17730,17733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"7days\">7 ng√†y qua</option>","line":526,"column":39,"nodeType":"JSXText","endLine":526,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"30days\">30 ng√†y qua</option>","line":527,"column":40,"nodeType":"JSXText","endLine":527,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <option value=\"all\">T·∫•t c·∫£ th·ªùi gian</option>","line":528,"column":37,"nodeType":"JSXText","endLine":528,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-blue-100 text-sm font-medium\">L∆∞·ª£t xem</p>","line":543,"column":62,"nodeType":"JSXText","endLine":543,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-purple-100 text-sm font-medium\">L∆∞·ª£t l√†m b√†i</p>","line":553,"column":64,"nodeType":"JSXText","endLine":553,"endColumn":76},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-green-100 text-sm font-medium\">T·ª∑ l·ªá ho√†n th√†nh</p>","line":563,"column":63,"nodeType":"JSXText","endLine":563,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-orange-100 text-sm font-medium\">ƒêi·ªÉm trung b√¨nh</p>","line":573,"column":64,"nodeType":"JSXText","endLine":573,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-teal-100 text-sm font-medium\">T·ª∑ l·ªá ƒë·∫°t (‚â•60%)</p>","line":583,"column":62,"nodeType":"JSXText","endLine":583,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-pink-100 text-sm font-medium\">ƒêi·ªÉm cao nh·∫•t</p>","line":593,"column":62,"nodeType":"JSXText","endLine":593,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-indigo-100 text-sm font-medium\">Th·ªùi gian TB</p>","line":603,"column":64,"nodeType":"JSXText","endLine":603,"endColumn":76},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-cyan-100 text-sm font-medium\">Ho√†n th√†nh</p>","line":613,"column":62,"nodeType":"JSXText","endLine":613,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\r\n              <TrendingUp className=\"w-6 h-6 text-blue-600\" />\r\n              Xu h∆∞·ªõng l√†m b√†i theo ng√†y\r\n            </h3>","line":622,"column":63,"nodeType":"JSXText","endLine":624,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\r\n              <PieChart className=\"w-6 h-6 text-purple-600\" />\r\n              Ph√¢n b·ªë ƒëi·ªÉm s·ªë\r\n            </h3>","line":650,"column":63,"nodeType":"JSXText","endLine":652,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\r\n              <BarChart3 className=\"w-6 h-6 text-green-600\" />\r\n              ƒê·ªô kh√≥ c√¢u h·ªèi (Top 10 kh√≥ nh·∫•t)\r\n            </h3>","line":693,"column":63,"nodeType":"JSXText","endLine":695,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-blue-600 font-bold\">C√¢u {index + 1}:</span>","line":702,"column":67,"nodeType":"JSXText","endLine":702,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Ch∆∞a c√≥ d·ªØ li·ªáu ph√¢n t√≠ch c√¢u h·ªèi</p>","line":729,"column":22,"nodeType":"JSXText","endLine":729,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\r\n              <Trophy className=\"w-6 h-6 text-yellow-600\" />\r\n              Top 10 h·ªçc vi√™n xu·∫•t s·∫Øc\r\n            </h3>","line":738,"column":61,"nodeType":"JSXText","endLine":740,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-center text-gray-500 py-8\">Ch∆∞a c√≥ d·ªØ li·ªáu</p>","line":768,"column":63,"nodeType":"JSXText","endLine":768,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\r\n            <Calendar className=\"w-6 h-6 text-blue-600\" />\r\n            20 k·∫øt qu·∫£ g·∫ßn nh·∫•t\r\n          </h3>","line":777,"column":59,"nodeType":"JSXText","endLine":779,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <th className=\"px-4 py-3 text-left text-sm font-semibold text-gray-700\">H·ªçc vi√™n</th>","line":784,"column":91,"nodeType":"JSXText","endLine":784,"endColumn":99},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <th className=\"px-4 py-3 text-center text-sm font-semibold text-gray-700\">ƒêi·ªÉm</th>","line":785,"column":93,"nodeType":"JSXText","endLine":785,"endColumn":97},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <th className=\"px-4 py-3 text-center text-sm font-semibold text-gray-700\">ƒê√∫ng/T·ªïng</th>","line":786,"column":93,"nodeType":"JSXText","endLine":786,"endColumn":102},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <th className=\"px-4 py-3 text-center text-sm font-semibold text-gray-700\">Th·ªùi gian</th>","line":787,"column":93,"nodeType":"JSXText","endLine":787,"endColumn":102},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <th className=\"px-4 py-3 text-center text-sm font-semibold text-gray-700\">Ng√†y l√†m</th>","line":788,"column":93,"nodeType":"JSXText","endLine":788,"endColumn":101},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <th className=\"px-4 py-3 text-center text-sm font-semibold text-gray-700\">K·∫øt qu·∫£</th>","line":789,"column":93,"nodeType":"JSXText","endLine":789,"endColumn":100},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"inline-flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-semibold\">\r\n                              <CheckCircle className=\"w-3.5 h-3.5\" />\r\n                              ƒê·∫°t\r\n                            </span>","line":825,"column":70,"nodeType":"JSXText","endLine":827,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold\">\r\n                              <XCircle className=\"w-3.5 h-3.5\" />\r\n                              Ch∆∞a ƒë·∫°t\r\n                            </span>","line":830,"column":66,"nodeType":"JSXText","endLine":832,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <td colSpan={6} className=\"px-4 py-8 text-center text-gray-500\">\r\n                      Ch∆∞a c√≥ k·∫øt qu·∫£ n√†o\r\n                    </td>","line":840,"column":85,"nodeType":"JSXText","endLine":842,"endColumn":21}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'calculateStats'. Either include it or remove the dependency array.","line":215,"column":6,"nodeType":"ArrayExpression","endLine":215,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [id, user, calculateStats, timeRange, navigate]","fix":{"range":[5964,5995],"text":"[id, user, calculateStats, timeRange, navigate]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":44,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\nimport { ROUTES } from '../../../config/routes';\r\nimport { doc, getDoc, collection, query, where, getDocs, orderBy } from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { \r\n  TrendingUp, \r\n  Users, \r\n  Target, \r\n  Clock, \r\n  Award, \r\n  BarChart3,\r\n  PieChart,\r\n  Calendar,\r\n  Eye,\r\n  CheckCircle,\r\n  XCircle,\r\n  ArrowLeft,\r\n  Download,\r\n  Lock,\r\n  BookOpen,\r\n  Brain,\r\n  Star,\r\n  Trophy,\r\n  Activity\r\n} from 'lucide-react';\r\n/* \r\nimport { Line, Bar, Doughnut } from 'react-chartjs-2';\r\nimport {\r\n  Chart as ChartJS,\r\n  CategoryScale,\r\n  LinearScale,\r\n  PointElement,\r\n  LineElement,\r\n  BarElement,\r\n  ArcElement,\r\n  RadialLinearScale,\r\n  Title,\r\n  Tooltip,\r\n  Legend,\r\n  Filler\r\n} from 'chart.js';\r\n\r\n// Register ChartJS components\r\nChartJS.register(\r\n  CategoryScale,\r\n  LinearScale,\r\n  PointElement,\r\n  LineElement,\r\n  BarElement,\r\n  ArcElement,\r\n  RadialLinearScale,\r\n  Title,\r\n  Tooltip,\r\n  Legend,\r\n  Filler\r\n);\r\n*/\r\n\r\ninterface Quiz {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  category: string;\r\n  difficulty: string;\r\n  questions: any[];\r\n  createdBy: string;\r\n  createdAt: any;\r\n  status: string;\r\n  havePassword?: 'public' | 'password';\r\n  quizType?: 'with-materials' | 'standard';\r\n  imageUrl?: string;\r\n  views?: number;\r\n  attempts?: number;\r\n  completions?: number;\r\n  averageScore?: number;\r\n}\r\n\r\ninterface QuizResult {\r\n  id: string;\r\n  userId: string;\r\n  userName?: string;\r\n  score: number;\r\n  totalQuestions: number;\r\n  correctAnswers: number;\r\n  timeSpent: number;\r\n  completedAt: any;\r\n  answers: any[];\r\n}\r\n\r\ninterface Stats {\r\n  totalViews: number;\r\n  totalAttempts: number;\r\n  totalCompletions: number;\r\n  completionRate: number;\r\n  averageScore: number;\r\n  averageTimeSpent: number;\r\n  highestScore: number;\r\n  lowestScore: number;\r\n  passRate: number;\r\n  recentResults: QuizResult[];\r\n  scoreDistribution: { range: string; count: number }[];\r\n  dailyAttempts: { date: string; count: number }[];\r\n  questionStats: { questionId: string; correctRate: number; question: string }[];\r\n  topPerformers: { userName: string; score: number; date: string }[];\r\n}\r\n\r\nconst QuizDetailedStats: React.FC = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  \r\n  const [quiz, setQuiz] = useState<Quiz | null>(null);\r\n  const [stats, setStats] = useState<Stats | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [timeRange, setTimeRange] = useState<'7days' | '30days' | 'all'>('30days');\r\n\r\n  const fetchQuizAndStats = useCallback(async () => {\r\n    if (!id || !user) return;\r\n    \r\n    setLoading(true);\r\n    try {\r\n      // Fetch quiz\r\n      const quizDoc = await getDoc(doc(db, 'quizzes', id));\r\n      if (!quizDoc.exists()) {\r\n        throw new Error('Quiz not found');\r\n      }\r\n      \r\n      const quizData = { id: quizDoc.id, ...quizDoc.data() } as Quiz;\r\n      \r\n      // Check if user owns this quiz\r\n      if (quizData.createdBy !== user.uid) {\r\n        throw new Error('Unauthorized');\r\n      }\r\n      \r\n      setQuiz(quizData);\r\n\r\n      // Fetch results - with fallback if index is still building\r\n      let results: QuizResult[] = [];\r\n      \r\n      try {\r\n        let resultsQuery;\r\n        \r\n        if (timeRange !== 'all') {\r\n          const days = timeRange === '7days' ? 7 : 30;\r\n          const startDate = new Date();\r\n          startDate.setDate(startDate.getDate() - days);\r\n          \r\n          resultsQuery = query(\r\n            collection(db, 'quizResults'),\r\n            where('quizId', '==', id),\r\n            where('completedAt', '>=', startDate),\r\n            orderBy('completedAt', 'desc')\r\n          );\r\n        } else {\r\n          resultsQuery = query(\r\n            collection(db, 'quizResults'),\r\n            where('quizId', '==', id),\r\n            orderBy('completedAt', 'desc')\r\n          );\r\n        }\r\n\r\n        const resultsSnapshot = await getDocs(resultsQuery);\r\n        results = resultsSnapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        })) as QuizResult[];\r\n        \r\n      } catch (indexError: any) {\r\n        // If index is still building, fall back to fetching all results and filtering client-side\r\n        console.warn('Index still building, using fallback query:', indexError.message);\r\n        \r\n        const fallbackQuery = query(\r\n          collection(db, 'quizResults'),\r\n          where('quizId', '==', id)\r\n        );\r\n        \r\n        const resultsSnapshot = await getDocs(fallbackQuery);\r\n        let allResults = resultsSnapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        })) as QuizResult[];\r\n        \r\n        // Filter by time range client-side\r\n        if (timeRange !== 'all') {\r\n          const days = timeRange === '7days' ? 7 : 30;\r\n          const startDate = new Date();\r\n          startDate.setDate(startDate.getDate() - days);\r\n          \r\n          allResults = allResults.filter(result => \r\n            result.completedAt && new Date(result.completedAt) >= startDate\r\n          );\r\n        }\r\n        \r\n        // Sort client-side\r\n        results = allResults.sort((a, b) => {\r\n          const dateA = a.completedAt ? new Date(a.completedAt).getTime() : 0;\r\n          const dateB = b.completedAt ? new Date(b.completedAt).getTime() : 0;\r\n          return dateB - dateA;\r\n        });\r\n      }\r\n\r\n      // Calculate stats\r\n      const calculatedStats = calculateStats(results, quizData);\r\n      setStats(calculatedStats);\r\n      \r\n    } catch (error) {\r\n      console.error('Error fetching quiz stats:', error);\r\n      navigate(ROUTES.CREATOR_MY_QUIZZES);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [id, user, timeRange, navigate]); // eslint-disable-line react-hooks/exhaustive-deps\r\n  // calculateStats is a stable function defined below, doesn't need to be in dependencies\r\n\r\n  useEffect(() => {\r\n    if (id && user) {\r\n      fetchQuizAndStats();\r\n    }\r\n  }, [id, user, timeRange, fetchQuizAndStats]);\r\n\r\n  const calculateStats = (results: QuizResult[], quizData: Quiz): Stats => {\r\n    // Default score ranges\r\n    const defaultScoreDistribution = [\r\n      { range: '0-20%', count: 0 },\r\n      { range: '21-40%', count: 0 },\r\n      { range: '41-60%', count: 0 },\r\n      { range: '61-80%', count: 0 },\r\n      { range: '81-100%', count: 0 }\r\n    ];\r\n\r\n    // Default daily attempts (last 30 days)\r\n    const defaultDailyAttempts: { date: string; count: number }[] = [];\r\n    for (let i = 29; i >= 0; i--) {\r\n      const date = new Date();\r\n      date.setDate(date.getDate() - i);\r\n      const dateStr = date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit' });\r\n      defaultDailyAttempts.push({ date: dateStr, count: 0 });\r\n    }\r\n\r\n    if (results.length === 0) {\r\n      return {\r\n        totalViews: quizData.views || 0,\r\n        totalAttempts: 0,\r\n        totalCompletions: 0,\r\n        completionRate: 0,\r\n        averageScore: 0,\r\n        averageTimeSpent: 0,\r\n        highestScore: 0,\r\n        lowestScore: 0,\r\n        passRate: 0,\r\n        recentResults: [],\r\n        scoreDistribution: defaultScoreDistribution,\r\n        dailyAttempts: defaultDailyAttempts,\r\n        questionStats: [],\r\n        topPerformers: []\r\n      };\r\n    }\r\n\r\n    const totalAttempts = results.length;\r\n    const completedResults = results.filter(r => r.score !== undefined);\r\n    const totalCompletions = completedResults.length;\r\n    \r\n    const scores = completedResults.map(r => (r.score / r.totalQuestions) * 100);\r\n    const averageScore = scores.reduce((a, b) => a + b, 0) / scores.length || 0;\r\n    const highestScore = Math.max(...scores, 0);\r\n    const lowestScore = Math.min(...scores, 100);\r\n    \r\n    const passRate = (scores.filter(s => s >= 60).length / scores.length) * 100 || 0;\r\n    \r\n    const timeSpents = completedResults.map(r => r.timeSpent || 0).filter(t => t > 0);\r\n    const averageTimeSpent = timeSpents.reduce((a, b) => a + b, 0) / timeSpents.length || 0;\r\n\r\n    // Score distribution\r\n    const scoreRanges = [\r\n      { range: '0-20%', min: 0, max: 20 },\r\n      { range: '21-40%', min: 21, max: 40 },\r\n      { range: '41-60%', min: 41, max: 60 },\r\n      { range: '61-80%', min: 61, max: 80 },\r\n      { range: '81-100%', min: 81, max: 100 }\r\n    ];\r\n    \r\n    const scoreDistribution = scoreRanges.map(range => ({\r\n      range: range.range,\r\n      count: scores.filter(s => s >= range.min && s <= range.max).length\r\n    }));\r\n\r\n    // Daily attempts (last 7 or 30 days)\r\n    const days = timeRange === '7days' ? 7 : timeRange === '30days' ? 30 : 90;\r\n    const dailyAttempts: { date: string; count: number }[] = [];\r\n    \r\n    for (let i = days - 1; i >= 0; i--) {\r\n      const date = new Date();\r\n      date.setDate(date.getDate() - i);\r\n      const dateStr = date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit' });\r\n      \r\n      const count = results.filter(r => {\r\n        const resultDate = r.completedAt?.toDate ? r.completedAt.toDate() : new Date(r.completedAt);\r\n        return resultDate.toDateString() === date.toDateString();\r\n      }).length;\r\n      \r\n      dailyAttempts.push({ date: dateStr, count });\r\n    }\r\n\r\n    // Question stats\r\n    const questionStats = quizData.questions.map((q, index) => {\r\n      const questionId = q.id || `q${index}`;\r\n      const answersForQuestion = results.flatMap(r => \r\n        r.answers?.filter((a: any) => a.questionId === questionId) || []\r\n      );\r\n      \r\n      const correctCount = answersForQuestion.filter((a: any) => a.isCorrect).length;\r\n      const correctRate = answersForQuestion.length > 0 \r\n        ? (correctCount / answersForQuestion.length) * 100 \r\n        : 0;\r\n      \r\n      return {\r\n        questionId,\r\n        question: q.text || 'Untitled Question',\r\n        correctRate: Math.round(correctRate)\r\n      };\r\n    }).sort((a, b) => a.correctRate - b.correctRate);\r\n\r\n    // Top performers\r\n    const topPerformers = completedResults\r\n      .sort((a, b) => b.score - a.score)\r\n      .slice(0, 10)\r\n      .map(r => ({\r\n        userName: r.userName || 'Anonymous',\r\n        score: Math.round((r.score / r.totalQuestions) * 100),\r\n        date: r.completedAt?.toDate ? r.completedAt.toDate().toLocaleDateString('vi-VN') : 'N/A'\r\n      }));\r\n\r\n    return {\r\n      totalViews: quizData.views || 0,\r\n      totalAttempts,\r\n      totalCompletions,\r\n      completionRate: (totalCompletions / totalAttempts) * 100 || 0,\r\n      averageScore: Math.round(averageScore),\r\n      averageTimeSpent: Math.round(averageTimeSpent),\r\n      highestScore: Math.round(highestScore),\r\n      lowestScore: Math.round(lowestScore),\r\n      passRate: Math.round(passRate),\r\n      recentResults: results.slice(0, 20),\r\n      scoreDistribution,\r\n      dailyAttempts,\r\n      questionStats,\r\n      topPerformers\r\n    };\r\n  };\r\n\r\n  const formatTime = (seconds: number) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  const handleExport = () => {\r\n    // TODO: Implement export to CSV/Excel\r\n    alert('T√≠nh nƒÉng xu·∫•t b√°o c√°o ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn');\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600 font-medium\">ƒêang t·∫£i th·ªëng k√™...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!quiz || !stats) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-600 mb-4\">Kh√¥ng t√¨m th·∫•y quiz</p>\r\n          <button\r\n            onClick={() => navigate(ROUTES.CREATOR_MY_QUIZZES)}\r\n            className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\r\n          >\r\n            Quay l·∫°i\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Chart data (commented - using tables instead)\r\n  /*\r\n  const lineChartData = {\r\n    labels: stats.dailyAttempts.map(d => d.date),\r\n    datasets: [\r\n      {\r\n        label: 'L∆∞·ª£t l√†m b√†i',\r\n        data: stats.dailyAttempts.map(d => d.count),\r\n        borderColor: 'rgb(59, 130, 246)',\r\n        backgroundColor: 'rgba(59, 130, 246, 0.1)',\r\n        tension: 0.4,\r\n        fill: true,\r\n      }\r\n    ]\r\n  };\r\n\r\n  const scoreDistributionData = {\r\n    labels: stats.scoreDistribution.map(d => d.range),\r\n    datasets: [\r\n      {\r\n        label: 'S·ªë h·ªçc vi√™n',\r\n        data: stats.scoreDistribution.map(d => d.count),\r\n        backgroundColor: [\r\n          'rgba(239, 68, 68, 0.8)',\r\n          'rgba(249, 115, 22, 0.8)',\r\n          'rgba(234, 179, 8, 0.8)',\r\n          'rgba(34, 197, 94, 0.8)',\r\n          'rgba(59, 130, 246, 0.8)',\r\n        ],\r\n        borderColor: [\r\n          'rgb(239, 68, 68)',\r\n          'rgb(249, 115, 22)',\r\n          'rgb(234, 179, 8)',\r\n          'rgb(34, 197, 94)',\r\n          'rgb(59, 130, 246)',\r\n        ],\r\n        borderWidth: 2\r\n      }\r\n    ]\r\n  };\r\n\r\n  const questionDifficultyData = {\r\n    labels: stats.questionStats.slice(0, 10).map(q => `C√¢u ${stats.questionStats.indexOf(q) + 1}`),\r\n    datasets: [\r\n      {\r\n        label: 'T·ª∑ l·ªá ƒë√∫ng (%)',\r\n        data: stats.questionStats.slice(0, 10).map(q => q.correctRate),\r\n        backgroundColor: 'rgba(139, 92, 246, 0.8)',\r\n        borderColor: 'rgb(139, 92, 246)',\r\n        borderWidth: 2\r\n      }\r\n    ]\r\n  };\r\n  */\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-purple-50 py-8\">\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n        {/* Header */}\r\n        <div className=\"mb-8\">\r\n          <button\r\n            onClick={() => navigate(ROUTES.CREATOR_MY_QUIZZES)}\r\n            className=\"mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors group\"\r\n          >\r\n            <ArrowLeft className=\"w-5 h-5 group-hover:-translate-x-1 transition-transform\" />\r\n            <span className=\"font-medium\">Quay l·∫°i My Quizzes</span>\r\n          </button>\r\n\r\n          <div className=\"bg-white rounded-2xl shadow-lg border border-gray-200 p-6\">\r\n            <div className=\"flex items-start justify-between\">\r\n              <div className=\"flex-1\">\r\n                <div className=\"flex items-center gap-3 mb-3\">\r\n                  <h1 className=\"text-3xl font-bold text-gray-900\">{quiz.title}</h1>\r\n                  {quiz.havePassword === 'password' && (\r\n                    <span className=\"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-medium flex items-center gap-1\">\r\n                      <Lock className=\"w-4 h-4\" />\r\n                      Password\r\n                    </span>\r\n                  )}\r\n                  {quiz.quizType === 'with-materials' && (\r\n                    <span className=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium flex items-center gap-1\">\r\n                      <BookOpen className=\"w-4 h-4\" />\r\n                      With Materials\r\n                    </span>\r\n                  )}\r\n                </div>\r\n                <p className=\"text-gray-600 mb-4\">{quiz.description}</p>\r\n                <div className=\"flex items-center gap-4 text-sm\">\r\n                  <span className=\"px-3 py-1 bg-gray-100 text-gray-700 rounded-lg font-medium\">\r\n                    üìö {quiz.category}\r\n                  </span>\r\n                  <span className={`px-3 py-1 rounded-lg font-medium ${\r\n                    quiz.difficulty === 'easy' ? 'bg-green-100 text-green-700' :\r\n                    quiz.difficulty === 'medium' ? 'bg-yellow-100 text-yellow-700' :\r\n                    'bg-red-100 text-red-700'\r\n                  }`}>\r\n                    {quiz.difficulty === 'easy' ? '‚≠ê D·ªÖ' : quiz.difficulty === 'medium' ? '‚≠ê‚≠ê Trung b√¨nh' : '‚≠ê‚≠ê‚≠ê Kh√≥'}\r\n                  </span>\r\n                  <span className=\"text-gray-600\">\r\n                    <Brain className=\"w-4 h-4 inline mr-1\" />\r\n                    {quiz.questions.length} c√¢u h·ªèi\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              {quiz.imageUrl && (\r\n                <img\r\n                  src={quiz.imageUrl}\r\n                  alt={quiz.title}\r\n                  className=\"w-32 h-32 rounded-xl object-cover ml-6\"\r\n                />\r\n              )}\r\n            </div>\r\n\r\n            {/* Quick Actions */}\r\n            <div className=\"flex gap-3 mt-6 pt-6 border-t border-gray-200\">\r\n              <button\r\n                onClick={() => navigate(`/quiz-preview/${quiz.id}`)}\r\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 font-medium\"\r\n              >\r\n                <Eye className=\"w-4 h-4\" />\r\n                Xem Quiz\r\n              </button>\r\n              <button\r\n                onClick={handleExport}\r\n                className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 font-medium\"\r\n              >\r\n                <Download className=\"w-4 h-4\" />\r\n                Xu·∫•t b√°o c√°o\r\n              </button>\r\n              <select\r\n                value={timeRange}\r\n                onChange={(e) => setTimeRange(e.target.value as any)}\r\n                className=\"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white\"\r\n              >\r\n                <option value=\"7days\">7 ng√†y qua</option>\r\n                <option value=\"30days\">30 ng√†y qua</option>\r\n                <option value=\"all\">T·∫•t c·∫£ th·ªùi gian</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Grid */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\r\n          {/* Total Views */}\r\n          <div className=\"bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 text-white shadow-lg\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <Eye className=\"w-8 h-8 opacity-80\" />\r\n              <Activity className=\"w-6 h-6 opacity-60\" />\r\n            </div>\r\n            <h3 className=\"text-3xl font-bold mb-1\">{stats.totalViews.toLocaleString()}</h3>\r\n            <p className=\"text-blue-100 text-sm font-medium\">L∆∞·ª£t xem</p>\r\n          </div>\r\n\r\n          {/* Total Attempts */}\r\n          <div className=\"bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-6 text-white shadow-lg\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <Users className=\"w-8 h-8 opacity-80\" />\r\n              <TrendingUp className=\"w-6 h-6 opacity-60\" />\r\n            </div>\r\n            <h3 className=\"text-3xl font-bold mb-1\">{stats.totalAttempts.toLocaleString()}</h3>\r\n            <p className=\"text-purple-100 text-sm font-medium\">L∆∞·ª£t l√†m b√†i</p>\r\n          </div>\r\n\r\n          {/* Completion Rate */}\r\n          <div className=\"bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-6 text-white shadow-lg\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <CheckCircle className=\"w-8 h-8 opacity-80\" />\r\n              <Target className=\"w-6 h-6 opacity-60\" />\r\n            </div>\r\n            <h3 className=\"text-3xl font-bold mb-1\">{stats.completionRate.toFixed(1)}%</h3>\r\n            <p className=\"text-green-100 text-sm font-medium\">T·ª∑ l·ªá ho√†n th√†nh</p>\r\n          </div>\r\n\r\n          {/* Average Score */}\r\n          <div className=\"bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl p-6 text-white shadow-lg\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <Award className=\"w-8 h-8 opacity-80\" />\r\n              <Star className=\"w-6 h-6 opacity-60\" />\r\n            </div>\r\n            <h3 className=\"text-3xl font-bold mb-1\">{stats.averageScore}%</h3>\r\n            <p className=\"text-orange-100 text-sm font-medium\">ƒêi·ªÉm trung b√¨nh</p>\r\n          </div>\r\n\r\n          {/* Pass Rate */}\r\n          <div className=\"bg-gradient-to-br from-teal-500 to-teal-600 rounded-2xl p-6 text-white shadow-lg\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <Trophy className=\"w-8 h-8 opacity-80\" />\r\n              <CheckCircle className=\"w-6 h-6 opacity-60\" />\r\n            </div>\r\n            <h3 className=\"text-3xl font-bold mb-1\">{stats.passRate}%</h3>\r\n            <p className=\"text-teal-100 text-sm font-medium\">T·ª∑ l·ªá ƒë·∫°t (‚â•60%)</p>\r\n          </div>\r\n\r\n          {/* Highest Score */}\r\n          <div className=\"bg-gradient-to-br from-pink-500 to-pink-600 rounded-2xl p-6 text-white shadow-lg\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <TrendingUp className=\"w-8 h-8 opacity-80\" />\r\n              <Star className=\"w-6 h-6 opacity-60\" />\r\n            </div>\r\n            <h3 className=\"text-3xl font-bold mb-1\">{stats.highestScore}%</h3>\r\n            <p className=\"text-pink-100 text-sm font-medium\">ƒêi·ªÉm cao nh·∫•t</p>\r\n          </div>\r\n\r\n          {/* Average Time */}\r\n          <div className=\"bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl p-6 text-white shadow-lg\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <Clock className=\"w-8 h-8 opacity-80\" />\r\n              <Activity className=\"w-6 h-6 opacity-60\" />\r\n            </div>\r\n            <h3 className=\"text-3xl font-bold mb-1\">{formatTime(stats.averageTimeSpent)}</h3>\r\n            <p className=\"text-indigo-100 text-sm font-medium\">Th·ªùi gian TB</p>\r\n          </div>\r\n\r\n          {/* Completions */}\r\n          <div className=\"bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-2xl p-6 text-white shadow-lg\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <BarChart3 className=\"w-8 h-8 opacity-80\" />\r\n              <CheckCircle className=\"w-6 h-6 opacity-60\" />\r\n            </div>\r\n            <h3 className=\"text-3xl font-bold mb-1\">{stats.totalCompletions.toLocaleString()}</h3>\r\n            <p className=\"text-cyan-100 text-sm font-medium\">Ho√†n th√†nh</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Visualization */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\r\n          {/* Daily Attempts Bar Chart */}\r\n          <div className=\"bg-white rounded-2xl shadow-lg border border-gray-200 p-6\">\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\r\n              <TrendingUp className=\"w-6 h-6 text-blue-600\" />\r\n              Xu h∆∞·ªõng l√†m b√†i theo ng√†y\r\n            </h3>\r\n            <div className=\"space-y-3\">\r\n              {stats.dailyAttempts.map((day, index) => {\r\n                const maxCount = Math.max(...stats.dailyAttempts.map(d => d.count), 1);\r\n                const widthPercent = day.count > 0 ? Math.max((day.count / maxCount) * 100, 10) : 0;\r\n                \r\n                return (\r\n                  <div key={index} className=\"flex items-center gap-3\">\r\n                    <span className=\"text-sm font-medium text-gray-600 w-16\">{day.date}</span>\r\n                    <div className=\"flex-1 bg-gray-100 rounded-full h-8 overflow-hidden\">\r\n                      <div \r\n                        className=\"bg-gradient-to-r from-blue-500 to-blue-600 h-full flex items-center justify-end px-3 text-white text-sm font-semibold transition-all duration-500\"\r\n                        style={{ width: `${widthPercent}%` }}\r\n                      >\r\n                        {day.count > 0 && day.count}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Score Distribution */}\r\n          <div className=\"bg-white rounded-2xl shadow-lg border border-gray-200 p-6\">\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\r\n              <PieChart className=\"w-6 h-6 text-purple-600\" />\r\n              Ph√¢n b·ªë ƒëi·ªÉm s·ªë\r\n            </h3>\r\n            <div className=\"space-y-4\">\r\n              {stats.scoreDistribution.map((range, index) => {\r\n                const colors = [\r\n                  { bg: 'bg-red-500', text: 'text-red-700', light: 'bg-red-100' },\r\n                  { bg: 'bg-orange-500', text: 'text-orange-700', light: 'bg-orange-100' },\r\n                  { bg: 'bg-yellow-500', text: 'text-yellow-700', light: 'bg-yellow-100' },\r\n                  { bg: 'bg-green-500', text: 'text-green-700', light: 'bg-green-100' },\r\n                  { bg: 'bg-blue-500', text: 'text-blue-700', light: 'bg-blue-100' }\r\n                ];\r\n                const color = colors[index];\r\n                const percentage = stats.totalCompletions > 0 ? (range.count / stats.totalCompletions * 100).toFixed(1) : 0;\r\n                const maxCount = Math.max(...stats.scoreDistribution.map(r => r.count), 1);\r\n                const widthPercent = range.count > 0 ? Math.max((range.count / maxCount) * 100, 15) : 0;\r\n                \r\n                return (\r\n                  <div key={range.range} className=\"flex items-center gap-3\">\r\n                    <span className={`text-sm font-medium w-20 px-3 py-1 rounded-lg ${color.light} ${color.text}`}>\r\n                      {range.range}\r\n                    </span>\r\n                    <div className=\"flex-1 bg-gray-100 rounded-full h-10 overflow-hidden\">\r\n                      <div \r\n                        className={`${color.bg} h-full flex items-center justify-between px-4 text-white text-sm font-semibold transition-all duration-500`}\r\n                        style={{ width: `${widthPercent}%` }}\r\n                      >\r\n                        <span>{range.count} HV</span>\r\n                        <span>{percentage}%</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Analysis Row 2 */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\r\n          {/* Question Difficulty Analysis */}\r\n          <div className=\"bg-white rounded-2xl shadow-lg border border-gray-200 p-6\">\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\r\n              <BarChart3 className=\"w-6 h-6 text-green-600\" />\r\n              ƒê·ªô kh√≥ c√¢u h·ªèi (Top 10 kh√≥ nh·∫•t)\r\n            </h3>\r\n            <div className=\"space-y-3 max-h-96 overflow-y-auto\">\r\n              {stats.questionStats.length > 0 ? (\r\n                stats.questionStats.slice(0, 10).map((q, index) => (\r\n                  <div key={q.questionId} className=\"border-b border-gray-100 pb-3 last:border-0\">\r\n                    <div className=\"flex items-start justify-between mb-2\">\r\n                      <p className=\"text-sm text-gray-700 font-medium flex-1 pr-4\">\r\n                        <span className=\"text-blue-600 font-bold\">C√¢u {index + 1}:</span> {q.question}\r\n                      </p>\r\n                      <span className={`text-sm font-bold px-3 py-1 rounded-lg ${\r\n                        q.correctRate >= 80 ? 'bg-green-100 text-green-700' :\r\n                        q.correctRate >= 60 ? 'bg-blue-100 text-blue-700' :\r\n                        q.correctRate >= 40 ? 'bg-yellow-100 text-yellow-700' :\r\n                        'bg-red-100 text-red-700'\r\n                      }`}>\r\n                        {q.correctRate}%\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                      <div \r\n                        className={`h-full rounded-full transition-all duration-500 ${\r\n                          q.correctRate >= 80 ? 'bg-green-500' :\r\n                          q.correctRate >= 60 ? 'bg-blue-500' :\r\n                          q.correctRate >= 40 ? 'bg-yellow-500' :\r\n                          'bg-red-500'\r\n                        }`}\r\n                        style={{ width: `${q.correctRate}%` }}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                ))\r\n              ) : (\r\n                <div className=\"text-center py-8 text-gray-500\">\r\n                  <BarChart3 className=\"w-12 h-12 mx-auto mb-3 text-gray-400\" />\r\n                  <p>Ch∆∞a c√≥ d·ªØ li·ªáu ph√¢n t√≠ch c√¢u h·ªèi</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Top Performers */}\r\n          <div className=\"bg-white rounded-2xl shadow-lg border border-gray-200 p-6\">\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\r\n              <Trophy className=\"w-6 h-6 text-yellow-600\" />\r\n              Top 10 h·ªçc vi√™n xu·∫•t s·∫Øc\r\n            </h3>\r\n            <div className=\"space-y-3 max-h-96 overflow-y-auto\">\r\n              {stats.topPerformers.length > 0 ? (\r\n                stats.topPerformers.map((performer, index) => (\r\n                  <div \r\n                    key={index}\r\n                    className=\"flex items-center justify-between p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl border border-yellow-200 hover:shadow-md transition-shadow\"\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-white ${\r\n                        index === 0 ? 'bg-yellow-500' :\r\n                        index === 1 ? 'bg-gray-400' :\r\n                        index === 2 ? 'bg-orange-600' :\r\n                        'bg-blue-500'\r\n                      }`}>\r\n                        {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : index + 1}\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-semibold text-gray-900\">{performer.userName}</p>\r\n                        <p className=\"text-sm text-gray-600\">{performer.date}</p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      <p className=\"text-2xl font-bold text-gray-900\">{performer.score}%</p>\r\n                    </div>\r\n                  </div>\r\n                ))\r\n              ) : (\r\n                <p className=\"text-center text-gray-500 py-8\">Ch∆∞a c√≥ d·ªØ li·ªáu</p>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Recent Results Table */}\r\n        <div className=\"bg-white rounded-2xl shadow-lg border border-gray-200 p-6\">\r\n          <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\r\n            <Calendar className=\"w-6 h-6 text-blue-600\" />\r\n            20 k·∫øt qu·∫£ g·∫ßn nh·∫•t\r\n          </h3>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full\">\r\n              <thead>\r\n                <tr className=\"border-b-2 border-gray-200\">\r\n                  <th className=\"px-4 py-3 text-left text-sm font-semibold text-gray-700\">H·ªçc vi√™n</th>\r\n                  <th className=\"px-4 py-3 text-center text-sm font-semibold text-gray-700\">ƒêi·ªÉm</th>\r\n                  <th className=\"px-4 py-3 text-center text-sm font-semibold text-gray-700\">ƒê√∫ng/T·ªïng</th>\r\n                  <th className=\"px-4 py-3 text-center text-sm font-semibold text-gray-700\">Th·ªùi gian</th>\r\n                  <th className=\"px-4 py-3 text-center text-sm font-semibold text-gray-700\">Ng√†y l√†m</th>\r\n                  <th className=\"px-4 py-3 text-center text-sm font-semibold text-gray-700\">K·∫øt qu·∫£</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {stats.recentResults.length > 0 ? (\r\n                  stats.recentResults.map((result, index) => {\r\n                    const scorePercent = Math.round((result.score / result.totalQuestions) * 100);\r\n                    const passed = scorePercent >= 60;\r\n                    \r\n                    return (\r\n                      <tr key={result.id} className={`border-b border-gray-100 hover:bg-gray-50 transition-colors ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`}>\r\n                        <td className=\"px-4 py-4 text-sm text-gray-900 font-medium\">\r\n                          {result.userName || 'Anonymous'}\r\n                        </td>\r\n                        <td className=\"px-4 py-4 text-center\">\r\n                          <span className={`px-3 py-1 rounded-full text-sm font-bold ${\r\n                            scorePercent >= 80 ? 'bg-green-100 text-green-700' :\r\n                            scorePercent >= 60 ? 'bg-blue-100 text-blue-700' :\r\n                            scorePercent >= 40 ? 'bg-yellow-100 text-yellow-700' :\r\n                            'bg-red-100 text-red-700'\r\n                          }`}>\r\n                            {scorePercent}%\r\n                          </span>\r\n                        </td>\r\n                        <td className=\"px-4 py-4 text-center text-sm text-gray-600\">\r\n                          {result.correctAnswers}/{result.totalQuestions}\r\n                        </td>\r\n                        <td className=\"px-4 py-4 text-center text-sm text-gray-600\">\r\n                          {formatTime(result.timeSpent || 0)}\r\n                        </td>\r\n                        <td className=\"px-4 py-4 text-center text-sm text-gray-600\">\r\n                          {result.completedAt?.toDate ? result.completedAt.toDate().toLocaleString('vi-VN') : 'N/A'}\r\n                        </td>\r\n                        <td className=\"px-4 py-4 text-center\">\r\n                          {passed ? (\r\n                            <span className=\"inline-flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-semibold\">\r\n                              <CheckCircle className=\"w-3.5 h-3.5\" />\r\n                              ƒê·∫°t\r\n                            </span>\r\n                          ) : (\r\n                            <span className=\"inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold\">\r\n                              <XCircle className=\"w-3.5 h-3.5\" />\r\n                              Ch∆∞a ƒë·∫°t\r\n                            </span>\r\n                          )}\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })\r\n                ) : (\r\n                  <tr>\r\n                    <td colSpan={6} className=\"px-4 py-8 text-center text-gray-500\">\r\n                      Ch∆∞a c√≥ k·∫øt qu·∫£ n√†o\r\n                    </td>\r\n                  </tr>\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizDetailedStats;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1011,1014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1011,1014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"Ôªøimport React, { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { AppDispatch, RootState } from '../../../lib/store';\r\nimport { ROUTES } from '../../../config/routes';\r\nimport QuizCard, { QuizCardSkeleton } from '../components/QuizCard';\r\nimport QuizStats from '../components/QuizStats';\r\nimport { Quiz } from '../types';\r\nimport { fetchQuizzes } from '../store';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { toast } from 'react-toastify';\r\nimport PasswordModal from '../../../shared/components/ui/PasswordModal';\r\n\r\nconst QuizList: React.FC<{ quizzes?: Quiz[]; title?: string }> = ({ quizzes: propQuizzes, title }) => {\r\n  // Always call hooks at the top - Fix React Hooks rules\r\n  const { t } = useTranslation();\r\n  const translate = useCallback(\r\n    (key: string, fallback: string, options?: Record<string, unknown>): string => {\r\n      const value = t(key, options as any);\r\n      if (typeof value === 'string') {\r\n        return value === key ? fallback : value;\r\n      }\r\n      return fallback;\r\n    },\r\n    [t]\r\n  );\r\n\r\n  const resultsFoundLabel = useMemo(\r\n    () => translate('quiz.resultsFound', 'ƒê√£ t√¨m th·∫•y'),\r\n    [translate]\r\n  );\r\n\r\n  const itemLabel = useMemo(\r\n    () => translate('quiz.itemLabel', 'quiz'),\r\n    [translate]\r\n  );\r\n\r\n  const searchPlaceholder = useMemo(\r\n    () => translate('quiz.searchPlaceholder', 'üîç T√¨m ki·∫øm quiz, danh m·ª•c, th·∫ª...'),\r\n    [translate]\r\n  );\r\n\r\n  const dispatch = useDispatch<AppDispatch>();\r\n  const navigate = useNavigate();\r\n  const storeQuizzes = useSelector((state: RootState) => state.quiz.quizzes);\r\n  const loading = useSelector((state: RootState) => state.quiz.loading || state.quiz.isLoading);\r\n  const error = useSelector((state: RootState) => state.quiz.error);\r\n  const user = useSelector((state: RootState) => state.auth.user);\r\n\r\n  // Use propQuizzes if provided, otherwise use store quizzes\r\n  const quizzes = propQuizzes || storeQuizzes;\r\n\r\n  const quizHasResources = useCallback(\r\n    (quiz: Quiz) => Array.isArray(quiz.resources) && quiz.resources.length > 0,\r\n    []\r\n  );\r\n\r\n  const approvedQuizzes = useMemo(\r\n    () => quizzes.filter(q => q.status === 'approved'),\r\n    [quizzes]\r\n  );\r\n\r\n  // Show specific error message for Firestore connection issues\r\n  const showFirestoreError = error && (\r\n    error.includes('ad blocker') || \r\n    error.includes('ERR_BLOCKED_BY_CLIENT') ||\r\n    error.includes('Kh√¥ng th·ªÉ k·∫øt n·ªëi Firestore')\r\n  );\r\n\r\n  const [retryCount, setRetryCount] = useState(0);\r\n  const maxRetries = 3;\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      if (!propQuizzes && quizzes.length === 0 && !loading) {\r\n        try {\r\n          await dispatch(fetchQuizzes({})).unwrap();\r\n        } catch (err) {\r\n          console.error('Quiz fetch error:', err);\r\n          if (err instanceof Error) {\r\n            console.error('Error message:', err.message);\r\n            const errorWithCode = err as { code?: string };\r\n            if (errorWithCode.code) {\r\n              console.error('Error code:', errorWithCode.code);\r\n            }\r\n          } else if (typeof err === 'object' && err !== null && 'code' in err) {\r\n            const errorWithCode = err as { code?: string };\r\n            if (errorWithCode.code) {\r\n              console.error('Error code:', errorWithCode.code);\r\n            }\r\n          }\r\n\r\n          if (retryCount < maxRetries) {\r\n            const delay = Math.min(1000 * Math.pow(2, retryCount), 10000);\r\n            setTimeout(() => {\r\n              setRetryCount(prev => prev + 1);\r\n            }, delay);\r\n          } else {\r\n            toast.error(translate('messages.serverError', 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng th·ª≠ l·∫°i sau.'));\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [dispatch, propQuizzes, quizzes.length, loading, retryCount, translate]);\r\n  const [search, setSearch] = useState('');\r\n  const [category, setCategory] = useState('all');\r\n  const [difficulty, setDifficulty] = useState('all');\r\n  const [sortBy, setSortBy] = useState('newest'); // newest, oldest, popular, difficulty\r\n  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid'); // grid, list\r\n  const [showCompleted, setShowCompleted] = useState(true);\r\n  const [showStats, setShowStats] = useState(false);\r\n  const [resourceFilter, setResourceFilter] = useState<'all' | 'with-resources' | 'no-resources'>('all'); // üÜï Filter for resources\r\n  \r\n  // üîí Password modal state\r\n  const [showPasswordModal, setShowPasswordModal] = useState(false);\r\n  const [selectedQuiz, setSelectedQuiz] = useState<Quiz | null>(null);\r\n\r\n  const handleQuizStart = (quiz: Quiz) => {\r\n    // üîí Check if quiz requires password\r\n    const requiresPassword = quiz.visibility === 'password' || quiz.havePassword === 'password';\r\n    \r\n    if (requiresPassword) {\r\n      // Show password modal immediately\r\n      setSelectedQuiz(quiz);\r\n      setShowPasswordModal(true);\r\n    } else {\r\n      // Navigate to preview page for public quizzes\r\n      navigate(`/quiz/${quiz.id}/preview`);\r\n    }\r\n  };\r\n  \r\n  // üîí Handle successful password verification\r\n  const handlePasswordSuccess = () => {\r\n    if (selectedQuiz) {\r\n      setShowPasswordModal(false);\r\n      // Navigate to preview page after successful password entry\r\n      navigate(`/quiz/${selectedQuiz.id}/preview`);\r\n    }\r\n  };\r\n  \r\n  // üîí Handle password modal close\r\n  const handlePasswordClose = () => {\r\n    setShowPasswordModal(false);\r\n    setSelectedQuiz(null);\r\n  };\r\n  \r\n  const categories = Array.from(new Set(quizzes.map(q => q.category)));\r\n  const difficulties = Array.from(new Set(quizzes.map(q => q.difficulty)));\r\n  const difficultyOrder: Record<Quiz['difficulty'], number> = {\r\n    easy: 1,\r\n    medium: 2,\r\n    hard: 3,\r\n  };\r\n  const difficultyOptionFallback = useCallback((level: Quiz['difficulty']) => {\r\n    switch (level) {\r\n      case 'easy':\r\n        return 'üòä D·ªÖ';\r\n      case 'medium':\r\n        return 'üòê Trung b√¨nh';\r\n      case 'hard':\r\n        return 'üò§ Kh√≥';\r\n      default:\r\n        return level;\r\n    }\r\n  }, []);\r\n  \r\n  // Ch·ªâ hi·ªÉn th·ªã quiz ƒë√£ ƒë∆∞·ª£c duy·ªát - C·∫¢ PUBLIC V√Ä PASSWORD ƒê·ªÄU HI·ªÇN TH·ªä üîí\r\n  let filtered = approvedQuizzes.filter(q => {\r\n    const hasResources = quizHasResources(q);\r\n\r\n    return (\r\n      (category === 'all' || q.category === category) &&\r\n      (difficulty === 'all' || q.difficulty === difficulty) &&\r\n      (showCompleted || !q.isCompleted) &&\r\n      q.title.toLowerCase().includes(search.toLowerCase()) &&\r\n      (resourceFilter === 'all' ||\r\n        (resourceFilter === 'with-resources' && hasResources) ||\r\n        (resourceFilter === 'no-resources' && !hasResources))\r\n    );\r\n  });\r\n\r\n  // Sorting logic\r\n  filtered = filtered.sort((a, b) => {\r\n    switch (sortBy) {\r\n      case 'newest':\r\n        return new Date(b.createdAt || 0).getTime() - new Date(a.createdAt || 0).getTime();\r\n      case 'oldest':\r\n        return new Date(a.createdAt || 0).getTime() - new Date(b.createdAt || 0).getTime();\r\n      case 'popular':\r\n        return (b.totalPlayers || 0) - (a.totalPlayers || 0);\r\n      case 'difficulty': {\r\n        return (difficultyOrder[a.difficulty] || 2) - (difficultyOrder[b.difficulty] || 2);\r\n      }\r\n      default:\r\n        return 0;\r\n    }\r\n  });\r\n\r\n  // Retry connection handler\r\n  const handleRetry = () => {\r\n    setRetryCount(0);\r\n    dispatch(fetchQuizzes({}));\r\n  };\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 py-8\">\r\n        <div className=\"max-w-5xl mx-auto px-4\">\r\n          <div className=\"text-center\">\r\n            <div className=\"text-red-600 text-xl mb-4\">\r\n              {error}\r\n            </div>\r\n            <button\r\n              onClick={handleRetry}\r\n              className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors\"\r\n            >\r\n              {t('quiz.retryConnection')}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 py-8\">\r\n        <div className=\"max-w-5xl mx-auto px-4\">\r\n          <div className=\"flex justify-center items-center space-x-2\">\r\n            <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600\"></div>\r\n            <span className=\"text-gray-600\">{t('quiz.loadingData')}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 py-8\">\r\n      <div className=\"max-w-7xl mx-auto px-4\">\r\n        {/* Header Section */}\r\n        <div className=\"mb-8\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-4xl font-bold text-gray-900 mb-2\">{title || t('quiz.discoverTitle')}</h1>\r\n              <p className=\"text-gray-600 text-lg\">{t('quiz.discoverDescription')}</p>\r\n            </div>\r\n            <div className=\"flex items-center gap-4\">\r\n              <button\r\n                onClick={() => setShowStats(!showStats)}\r\n                className={`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${\r\n                  showStats ? 'bg-blue-50 border-blue-200 text-blue-700' : 'border-gray-300 text-gray-600 hover:bg-gray-50'\r\n                }`}\r\n              >\r\n                <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                  <path d=\"M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z\"/>\r\n                </svg>\r\n                {showStats\r\n                  ? translate('quiz.hideStats', '·∫®n th·ªëng k√™')\r\n                  : translate('quiz.showStats', 'Hi·ªán th·ªëng k√™')}\r\n              </button>\r\n              {/* Multiplayer Button - N·ªïi b·∫≠t */}\r\n              <button \r\n                onClick={() => navigate('/multiplayer')}\r\n                className=\"group relative flex items-center gap-2 bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 text-white px-5 py-2.5 rounded-xl hover:shadow-xl hover:scale-105 transition-all duration-300 font-semibold overflow-hidden\"\r\n              >\r\n                <div className=\"absolute inset-0 bg-gradient-to-r from-purple-400 via-pink-400 to-red-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300\"></div>\r\n                <svg className=\"w-5 h-5 relative z-10 group-hover:rotate-12 transition-transform\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path d=\"M8 3C4.13 3 1 6.13 1 10c0 2.38 1.19 4.47 3 5.74V21l6-3h2c3.87 0 7-3.13 7-7s-3.13-7-7-7H8zm13 0v6l3 3-3 3v6l-5.5-4.5L18 13l3-3-3-3V1l3 2z\"/>\r\n                </svg>\r\n                <span className=\"relative z-10\">üéÆ {t('quiz.playWithFriends')}</span>\r\n                <span className=\"absolute top-0 right-0 bg-yellow-400 text-yellow-900 text-xs font-bold px-2 py-0.5 rounded-bl-lg rounded-tr-lg\">{t('quiz.hotBadge')}</span>\r\n              </button>\r\n              {(user?.role === 'creator' || user?.role === 'admin') && (\r\n                <button \r\n                  onClick={() => navigate(ROUTES.CREATOR_NEW_QUIZ)}\r\n                  className=\"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors\"\r\n                >\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\r\n                  </svg>\r\n                  {t('quiz.createNew')}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Statistics Panel */}\r\n        {showStats && quizzes.length > 0 && (\r\n          <QuizStats quizzes={quizzes} />\r\n        )}\r\n\r\n        {/* Enhanced Filter Section */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8\">\r\n          {/* üÜï Resource Filter Tabs */}\r\n          <div className=\"flex items-center gap-2 mb-6 p-1 bg-gray-100 rounded-lg w-fit\">\r\n            <button\r\n              onClick={() => setResourceFilter('all')}\r\n              className={`px-6 py-2.5 rounded-lg font-semibold transition-all ${\r\n                resourceFilter === 'all'\r\n                  ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-md'\r\n                  : 'text-gray-600 hover:text-gray-900'\r\n              }`}\r\n            >\r\n              üìö {translate('quiz.resourceFilter.all', 'T·∫•t c·∫£ Quiz')} ({approvedQuizzes.length})\r\n            </button>\r\n            <button\r\n              onClick={() => setResourceFilter('with-resources')}\r\n              className={`px-6 py-2.5 rounded-lg font-semibold transition-all flex items-center gap-2 ${\r\n                resourceFilter === 'with-resources'\r\n                  ? 'bg-gradient-to-r from-emerald-600 to-teal-600 text-white shadow-md'\r\n                  : 'text-gray-600 hover:text-gray-900'\r\n              }`}\r\n            >\r\n              <span className=\"text-lg\">üìñ</span>\r\n              {translate('quiz.resourceFilter.withResources', 'C√≥ t√†i li·ªáu h·ªçc t·∫≠p')} ({approvedQuizzes.filter(quizHasResources).length})\r\n            </button>\r\n            <button\r\n              onClick={() => setResourceFilter('no-resources')}\r\n              className={`px-6 py-2.5 rounded-lg font-semibold transition-all flex items-center gap-2 ${\r\n                resourceFilter === 'no-resources'\r\n                  ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-md'\r\n                  : 'text-gray-600 hover:text-gray-900'\r\n              }`}\r\n            >\r\n              <span className=\"text-lg\">‚ö°</span>\r\n              {translate('quiz.resourceFilter.noResources', 'L√†m tr·ª±c ti·∫øp')} ({approvedQuizzes.filter(q => !quizHasResources(q)).length})\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4\">\r\n            {/* Enhanced Search */}\r\n            <div className=\"lg:col-span-2 relative\">\r\n              <div className=\"relative\">\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder={searchPlaceholder}\r\n                  value={search}\r\n                  onChange={(e) => setSearch(e.target.value)}\r\n                  className=\"w-full border border-gray-300 rounded-lg p-3 pl-10 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                />\r\n                <svg className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n                </svg>\r\n                {search && (\r\n                  <button\r\n                    onClick={() => setSearch('')}\r\n                    className=\"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 hover:text-gray-600\"\r\n                  >\r\n                    <svg fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                    </svg>\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Category Filter */}\r\n            <select \r\n              className=\"border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\" \r\n              value={category} \r\n              onChange={e => setCategory(e.target.value)}\r\n            >\r\n              <option value=\"all\">{translate('quiz.filters.allCategoriesOption', 'üè∑Ô∏è T·∫•t c·∫£ danh m·ª•c')}</option>\r\n              {categories.map(c => <option key={c} value={c}>{c}</option>)}\r\n            </select>\r\n            \r\n            {/* Difficulty Filter */}\r\n            <select \r\n              className=\"border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\" \r\n              value={difficulty} \r\n              onChange={e => setDifficulty(e.target.value)}\r\n            >\r\n              <option value=\"all\">{translate('quiz.filters.allDifficultiesOption', 'üìä T·∫•t c·∫£ ƒë·ªô kh√≥')}</option>\r\n              {difficulties.map(d => (\r\n                <option key={d} value={d}>\r\n                  {translate(`quiz.difficultyOptions.${d}`, difficultyOptionFallback(d))}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Advanced Controls */}\r\n          <div className=\"flex flex-wrap items-center justify-between gap-4 pt-4 border-t border-gray-100\">\r\n            <div className=\"flex items-center gap-4\">\r\n              {/* Sort Options */}\r\n              <select \r\n                className=\"border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\" \r\n                value={sortBy} \r\n                onChange={e => setSortBy(e.target.value)}\r\n              >\r\n                <option value=\"newest\">üÜï {t('quiz.sort.newest')}</option>\r\n                <option value=\"oldest\">üìÖ {t('quiz.sort.oldest')}</option>\r\n                <option value=\"popular\">üî• {t('quiz.sort.popular')}</option>\r\n                <option value=\"difficulty\">üìà {t('quiz.sort.byDifficulty')}</option>\r\n              </select>\r\n\r\n              {/* Show Completed Toggle */}\r\n              <label className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={showCompleted}\r\n                  onChange={e => setShowCompleted(e.target.checked)}\r\n                  className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n                />\r\n                {t('quiz.showCompleted')}\r\n              </label>\r\n            </div>\r\n\r\n            {/* View Mode Toggle */}\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"text-sm text-gray-600\">{t('quiz.viewMode.label')}:</span>\r\n              <div className=\"flex border border-gray-300 rounded-lg overflow-hidden\">\r\n                <button\r\n                  onClick={() => setViewMode('grid')}\r\n                  className={`p-2 ${viewMode === 'grid' ? 'bg-blue-500 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'}`}\r\n                  title={t('quiz.viewMode.grid')}\r\n                >\r\n                  <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                    <path d=\"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\" />\r\n                  </svg>\r\n                </button>\r\n                <button\r\n                  onClick={() => setViewMode('list')}\r\n                  className={`p-2 ${viewMode === 'list' ? 'bg-blue-500 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'}`}\r\n                  title={t('quiz.viewMode.list')}\r\n                >\r\n                  <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                    <path fillRule=\"evenodd\" d=\"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Results Summary */}\r\n          <div className=\"mt-4 text-sm text-gray-600\">\r\n            {resultsFoundLabel} <span className=\"font-semibold text-blue-600\">{filtered.length}</span> {itemLabel}\r\n            {search && (\r\n              <span>\r\n                {' '}\r\n                {translate('quiz.resultsSummary.searchTerm', 'cho \"{{term}}\"', { term: search })}\r\n              </span>\r\n            )}\r\n            {category !== 'all' && (\r\n              <span>\r\n                {' '}\r\n                {translate('quiz.resultsSummary.category', 'trong danh m·ª•c \"{{category}}\"', { category })}\r\n              </span>\r\n            )}\r\n            {difficulty !== 'all' && (\r\n              <span>\r\n                {' '}\r\n                {translate('quiz.resultsSummary.difficulty', 'v·ªõi ƒë·ªô kh√≥ \"{{difficulty}}\"', { difficulty })}\r\n              </span>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Quiz Grid/List */}\r\n        <div className={viewMode === 'grid' \r\n          ? \"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\" \r\n          : \"space-y-4\"\r\n        }>\r\n          {loading ? (\r\n            Array.from({length: 8}).map((_,i) => <QuizCardSkeleton key={i} />)\r\n          ) : showFirestoreError ? (\r\n            <div className=\"col-span-full bg-red-50 border border-red-200 rounded-xl p-8 text-center\">\r\n              <div className=\"text-red-600 text-xl font-semibold mb-3\">üö´ {t('quiz.errors.connection')}</div>\r\n              <div className=\"text-red-700 mb-6\">{error}</div>\r\n              <div className=\"text-sm text-gray-600 mb-6 max-w-md mx-auto\">\r\n                <div className=\"mb-3\"><strong>{t('quiz.errors.troubleshoot')}:</strong></div>\r\n                <div className=\"space-y-1\">\r\n                  <div>{t('1TatAdBlockerChoLocalhost5174')}</div>\r\n                  <div>{t('2ThemGoogleapiscomVaoWhitelist')}</div>\r\n                  <div>{t('3ThuCheDoIncognitoprivate')}</div>\r\n                  <div>{t('4KiemTraFirewallantivirus')}</div>\r\n                </div>\r\n              </div>\r\n              <button \r\n                className=\"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium\" \r\n                onClick={() => dispatch(fetchQuizzes({}))}\r\n              >\r\n                üîÑ {t('quiz.retryConnection')}\r\n              </button>\r\n            </div>\r\n          ) : error ? (\r\n            <div className=\"col-span-full text-center\">\r\n              <div className=\"bg-red-50 border border-red-200 rounded-xl p-8\">\r\n                <div className=\"text-red-600 text-lg font-medium mb-4\">‚ùå {t('quiz.errors.generic')}</div>\r\n                <div className=\"text-red-700 mb-6\">{error}</div>\r\n                <button \r\n                  className=\"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\" \r\n                  onClick={() => dispatch(fetchQuizzes({}))}\r\n                >\r\n                  üîÑ {t('quiz.retryConnection')}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ) : filtered.length === 0 ? (\r\n            <div className=\"col-span-full text-center\">\r\n              <div className=\"bg-gray-50 border border-gray-200 rounded-xl p-12\">\r\n                <svg className='w-16 h-16 mx-auto text-gray-300 mb-4' fill='none' stroke='currentColor' viewBox='0 0 24 24'>\r\n                  <path strokeLinecap='round' strokeLinejoin='round' strokeWidth={1.5} d='M9.75 17L9 21m6-4l.75 4M4 4v16c0 1.104.896 2 2 2h12a2 2 0 002-2V4M4 4l8 8m0 0l8-8' />\r\n                </svg>\r\n                <h3 className=\"text-xl font-medium text-gray-900 mb-2\">{t('quiz.noResults.title')}</h3>\r\n                <p className=\"text-gray-600 mb-6\">{t('quiz.noResults.description')}</p>\r\n                <div className=\"flex justify-center gap-4\">\r\n                  <button \r\n                    onClick={() => {\r\n                      setSearch('');\r\n                      setCategory('all');\r\n                      setDifficulty('all');\r\n                    }}\r\n                    className=\"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors\"\r\n                  >\r\n                    üîÑ {t('quiz.clearFilters')}\r\n                  </button>\r\n                  {(user?.role === 'creator' || user?.role === 'admin') && (\r\n                    <button \r\n                      className=\"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors\" \r\n                      onClick={()=>navigate(ROUTES.CREATOR_NEW_QUIZ)}\r\n                    >\r\n                      ‚ûï {t('quiz.createNew')}\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            filtered.map(quiz => (\r\n              <QuizCard \r\n                key={quiz.id} \r\n                quiz={quiz} \r\n                viewMode={viewMode}\r\n                onStartQuiz={handleQuizStart}\r\n              />\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {/* üîí Password Modal */}\r\n      {selectedQuiz && showPasswordModal && (\r\n        <PasswordModal\r\n          isOpen={showPasswordModal}\r\n          onClose={handlePasswordClose}\r\n          onSuccess={handlePasswordSuccess}\r\n          passwordData={selectedQuiz.pwd}\r\n          quizTitle={selectedQuiz.title}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizList;\r\n\r\n\r\n\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\components\\ConfirmationModals.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\r\n              C√≤n c√¢u h·ªèi ch∆∞a tr·∫£ l·ªùi\r\n            </h3>","line":60,"column":70,"nodeType":"JSXText","endLine":62,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600 mb-4\">\r\n              B·∫°n c√≤n {unansweredQuestions.length} c√¢u h·ªèi ch∆∞a tr·∫£ l·ªùi:\r\n            </p>","line":63,"column":47,"nodeType":"JSXText","endLine":64,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-gray-600 mb-4\">\r\n              B·∫°n c√≤n {unansweredQuestions.length} c√¢u h·ªèi ch∆∞a tr·∫£ l·ªùi:\r\n            </p>","line":64,"column":51,"nodeType":"JSXText","endLine":65,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                  key={question.id}\r\n                  onClick={() => {\r\n                    modalControls.setShowUnansweredModal(false);\r\n                    onGoToQuestion(index);\r\n                  }}\r\n                  className=\"block w-full text-left p-2 hover:bg-gray-100 rounded text-blue-600 hover:text-blue-800\"\r\n                >\r\n                  C√¢u {index + 1}: {question.text.slice(0, 50)}...\r\n                </button>","line":75,"column":18,"nodeType":"JSXText","endLine":76,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                onClick={() => modalControls.setShowUnansweredModal(false)}\r\n                className=\"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors\"\r\n              >\r\n                Ti·∫øp t·ª•c l√†m b√†i\r\n              </button>","line":84,"column":16,"nodeType":"JSXText","endLine":86,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n                onClick={onConfirmSubmit}\r\n                className=\"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors\"\r\n              >\r\n                N·ªôp b√†i lu√¥n\r\n              </button>","line":90,"column":16,"nodeType":"JSXText","endLine":92,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Question } from '../../../types';\r\nimport { useTranslation } from 'react-i18next';\r\nimport ConfirmDialog from '../../../../../shared/components/ui/ConfirmDialog';\r\n\r\ninterface ConfirmationModalsProps {\r\n  modalControls: {\r\n    showExitModal: boolean;\r\n    setShowExitModal: React.Dispatch<React.SetStateAction<boolean>>;\r\n    showSubmitModal: boolean;\r\n    setShowSubmitModal: React.Dispatch<React.SetStateAction<boolean>>;\r\n    showUnansweredModal: boolean;\r\n    setShowUnansweredModal: React.Dispatch<React.SetStateAction<boolean>>;\r\n  };\r\n  onConfirmExit: () => void;\r\n  onConfirmSubmit: () => void;\r\n  unansweredQuestions: Question[];\r\n  onGoToQuestion: (index: number) => void;\r\n}\r\n\r\nconst ConfirmationModals: React.FC<ConfirmationModalsProps> = ({\r\n  modalControls,\r\n  onConfirmExit,\r\n  onConfirmSubmit,\r\n  unansweredQuestions,\r\n  onGoToQuestion,\r\n}) => {\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <>\r\n      {/* Exit Confirmation Modal */}\r\n      <ConfirmDialog\r\n        isOpen={modalControls.showExitModal}\r\n        onClose={() => modalControls.setShowExitModal(false)}\r\n        onConfirm={onConfirmExit}\r\n        title=\"‚ö†Ô∏è Tho√°t kh·ªèi b√†i Quiz?\"\r\n        message=\"Ti·∫øn ƒë·ªô l√†m b√†i c·ªßa b·∫°n s·∫Ω b·ªã m·∫•t n·∫øu tho√°t b√¢y gi·ªù. B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ti·∫øp t·ª•c?\"\r\n        confirmText=\"Tho√°t\"\r\n        cancelText=\"Ti·∫øp t·ª•c l√†m b√†i\"\r\n        type=\"danger\"\r\n      />\r\n\r\n      {/* Submit Confirmation Modal */}\r\n      <ConfirmDialog\r\n        isOpen={modalControls.showSubmitModal}\r\n        onClose={() => modalControls.setShowSubmitModal(false)}\r\n        onConfirm={onConfirmSubmit}\r\n        title=\"‚úÖ N·ªôp b√†i Quiz?\"\r\n        message=\"B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i? Sau khi n·ªôp s·∫Ω kh√¥ng th·ªÉ thay ƒë·ªïi ƒë√°p √°n.\"\r\n        confirmText=\"N·ªôp b√†i\"\r\n        cancelText={t(\"common.cancel\")}\r\n        type=\"info\"\r\n      />\r\n\r\n      {/* Unanswered Questions Modal */}\r\n      {modalControls.showUnansweredModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg p-6 max-w-lg mx-4\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\r\n              C√≤n c√¢u h·ªèi ch∆∞a tr·∫£ l·ªùi\r\n            </h3>\r\n            <p className=\"text-gray-600 mb-4\">\r\n              B·∫°n c√≤n {unansweredQuestions.length} c√¢u h·ªèi ch∆∞a tr·∫£ l·ªùi:\r\n            </p>\r\n            <div className=\"max-h-40 overflow-y-auto mb-6\">\r\n              {unansweredQuestions.map((question, index) => (\r\n                <button\r\n                  key={question.id}\r\n                  onClick={() => {\r\n                    modalControls.setShowUnansweredModal(false);\r\n                    onGoToQuestion(index);\r\n                  }}\r\n                  className=\"block w-full text-left p-2 hover:bg-gray-100 rounded text-blue-600 hover:text-blue-800\"\r\n                >\r\n                  C√¢u {index + 1}: {question.text.slice(0, 50)}...\r\n                </button>\r\n              ))}\r\n            </div>\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={() => modalControls.setShowUnansweredModal(false)}\r\n                className=\"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors\"\r\n              >\r\n                Ti·∫øp t·ª•c l√†m b√†i\r\n              </button>\r\n              <button\r\n                onClick={onConfirmSubmit}\r\n                className=\"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors\"\r\n              >\r\n                N·ªôp b√†i lu√¥n\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ConfirmationModals;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\components\\LearningResourcesView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\components\\ProgressIndicator.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm font-medium text-gray-600\">Ti·∫øn ƒë·ªô</span>","line":17,"column":61,"nodeType":"JSXText","endLine":17,"endColumn":68}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\ninterface ProgressIndicatorProps {\r\n  current: number;\r\n  total: number;\r\n  percentage: number;\r\n}\r\n\r\nconst ProgressIndicator: React.FC<ProgressIndicatorProps> = ({ \r\n  current, \r\n  total, \r\n  percentage\r\n}) => {\r\n  return (\r\n    <div className=\"bg-white rounded-lg shadow-md p-4\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <span className=\"text-sm font-medium text-gray-600\">Ti·∫øn ƒë·ªô</span>\r\n        <span className=\"text-sm font-bold text-gray-900\">\r\n          {current} / {total}\r\n        </span>\r\n      </div>\r\n      \r\n      <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n        <div \r\n          className=\"bg-blue-500 h-2 rounded-full transition-all duration-300\"\r\n          style={{ width: `${percentage}%` }}\r\n        ></div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProgressIndicator;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\components\\QuestionRenderer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\components\\QuickNavigation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\components\\Timer.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs font-medium text-gray-600 flex items-center\">\r\n          <svg className=\"w-3 h-3 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n          </svg>\r\n          Th·ªùi gian c√≤n l·∫°i\r\n        </span>","line":35,"column":17,"nodeType":"JSXText","endLine":37,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-red-600 font-medium mt-1 flex items-center\">\r\n          <svg className=\"w-3 h-3 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n            <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n          </svg>\r\n          S·∫Øp h·∫øt gi·ªù!\r\n        </div>","line":56,"column":17,"nodeType":"JSXText","endLine":58,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-amber-600 font-medium mt-1 flex items-center\">\r\n          <svg className=\"w-3 h-3 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n            <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\r\n          </svg>\r\n          C√≤n √≠t th·ªùi gian\r\n        </div>","line":65,"column":17,"nodeType":"JSXText","endLine":67,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\ninterface TimerProps {\r\n  timeLeft: string;\r\n  isWarning: boolean;\r\n  isCritical: boolean;\r\n  percentage?: number;\r\n}\r\n\r\nconst Timer: React.FC<TimerProps> = ({ timeLeft, isWarning, isCritical, percentage = 0 }) => {\r\n  const getTimerColor = () => {\r\n    if (isCritical) return 'text-red-600';\r\n    if (isWarning) return 'text-amber-600';\r\n    return 'text-blue-600'; // Changed to blue for better aesthetics\r\n  };\r\n\r\n  const getBackgroundColor = () => {\r\n    if (isCritical) return 'bg-red-50 border-red-200';\r\n    if (isWarning) return 'bg-amber-50 border-amber-200';\r\n    return 'bg-blue-50 border-blue-200'; // Changed to blue theme\r\n  };\r\n\r\n  const getProgressColor = () => {\r\n    if (isCritical) return 'bg-red-500';\r\n    if (isWarning) return 'bg-amber-500';\r\n    return 'bg-blue-500'; // Changed to blue for consistency\r\n  };\r\n\r\n  return (\r\n    <div className={`rounded-md border p-3 transition-all duration-300 ${getBackgroundColor()} ${isCritical ? 'animate-pulse' : ''}`}>\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <span className=\"text-xs font-medium text-gray-600 flex items-center\">\r\n          <svg className=\"w-3 h-3 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n          </svg>\r\n          Th·ªùi gian c√≤n l·∫°i\r\n        </span>\r\n        <span className={`text-lg font-bold font-mono ${getTimerColor()}`}>\r\n          {timeLeft}\r\n        </span>\r\n      </div>\r\n      \r\n      {/* Compact progress bar */}\r\n      <div className=\"w-full bg-gray-200 rounded-full h-1.5\">\r\n        <div \r\n          className={`h-1.5 rounded-full transition-all duration-1000 ${getProgressColor()}`}\r\n          style={{ width: `${Math.min(percentage, 100)}%` }}\r\n        ></div>\r\n      </div>\r\n      \r\n      {/* Subtle warning messages */}\r\n      {isCritical && (\r\n        <div className=\"text-xs text-red-600 font-medium mt-1 flex items-center\">\r\n          <svg className=\"w-3 h-3 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n            <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n          </svg>\r\n          S·∫Øp h·∫øt gi·ªù!\r\n        </div>\r\n      )}\r\n      \r\n      {isWarning && !isCritical && (\r\n        <div className=\"text-xs text-amber-600 font-medium mt-1 flex items-center\">\r\n          <svg className=\"w-3 h-3 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n            <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\r\n          </svg>\r\n          C√≤n √≠t th·ªùi gian\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Timer;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\hooks\\useQuizData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\hooks\\useQuizNavigation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\hooks\\useQuizSession.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\hooks\\useQuizTimer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\index.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-red-500 text-6xl mb-4\">‚ö†Ô∏è</div>","line":81,"column":55,"nodeType":"JSXText","endLine":81,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Kh√¥ng th·ªÉ t·∫£i quiz</h2>","line":82,"column":65,"nodeType":"JSXText","endLine":82,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Tho√°t</span>","line":180,"column":23,"nodeType":"JSXText","endLine":180,"endColumn":28},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>C√¢u tr∆∞·ªõc</span>","line":240,"column":25,"nodeType":"JSXText","endLine":240,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>N·ªôp b√†i</span>","line":252,"column":29,"nodeType":"JSXText","endLine":252,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>C√¢u ti·∫øp</span>","line":259,"column":29,"nodeType":"JSXText","endLine":259,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../../lib/store';\r\nimport { useQuizData, useQuizSession, useQuizTimer, useQuizNavigation } from './hooks';\r\nimport Timer from './components/Timer';\r\nimport ProgressIndicator from './components/ProgressIndicator';\r\nimport QuestionRenderer from './components/QuestionRenderer';\r\nimport QuickNavigation from './components/QuickNavigation';\r\nimport ConfirmationModals from './components/ConfirmationModals';\r\nimport LearningResourcesView from './components/LearningResourcesView';\r\nimport QuizPasswordModal from '../../../../shared/components/ui/QuizPasswordModal';\r\nimport { unlockQuiz } from '../../../../lib/services/quizAccessService';\r\nimport { toast } from 'react-toastify';\r\nimport { Quiz, AnswerValue } from '../../types';\r\n\r\nconst QuizPage: React.FC = () => {\r\n  const { quiz, loading, error, needsPassword, quizMetadata, retryLoad } = useQuizData();\r\n  const user = useSelector((state: RootState) => state.auth.user);\r\n  const [showResources, setShowResources] = useState(true);\r\n  const [hasViewedResources, setHasViewedResources] = useState(false);\r\n\r\n  // Handle password submission\r\n  const handlePasswordSubmit = async (password: string): Promise<boolean> => {\r\n    if (!quizMetadata || !user) {\r\n      toast.error('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ truy c·∫≠p quiz');\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const success = await unlockQuiz(\r\n        quizMetadata.id,\r\n        user.uid,\r\n        password,\r\n        quizMetadata\r\n      );\r\n\r\n      if (success) {\r\n        toast.success('üéâ ƒê√£ m·ªü kh√≥a quiz th√†nh c√¥ng!');\r\n        // Retry loading questions\r\n        retryLoad();\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    } catch (err) {\r\n      console.error('Error unlocking quiz:', err);\r\n      toast.error('C√≥ l·ªói x·∫£y ra khi m·ªü kh√≥a quiz');\r\n      return false;\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">ƒêang t·∫£i quiz...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Show password modal if needed\r\n  if (needsPassword && quizMetadata) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-purple-50\">\r\n        <QuizPasswordModal\r\n          isOpen={true}\r\n          quizTitle={quizMetadata.title}\r\n          onClose={() => window.history.back()}\r\n          onSubmit={handlePasswordSubmit}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !quiz) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"text-red-500 text-6xl mb-4\">‚ö†Ô∏è</div>\r\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Kh√¥ng th·ªÉ t·∫£i quiz</h2>\r\n          <p className=\"text-gray-600\">{error || 'Quiz kh√¥ng t·ªìn t·∫°i'}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Check if quiz has learning resources\r\n  const hasResources = quiz.resources && quiz.resources.length > 0;\r\n\r\n  // Show resources view first if available and not viewed yet\r\n  if (hasResources && showResources && !hasViewedResources) {\r\n    return (\r\n      <LearningResourcesView\r\n        resources={quiz.resources || []}\r\n        onComplete={() => {\r\n          setHasViewedResources(true);\r\n          setShowResources(false);\r\n        }}\r\n        onSkip={() => {\r\n          setShowResources(false);\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  return <QuizPageContent quiz={quiz} />;\r\n};\r\n\r\ninterface QuizPageContentProps {\r\n  quiz: Quiz;\r\n}\r\n\r\nconst QuizPageContent: React.FC<QuizPageContentProps> = ({ quiz }) => {\r\n  // const navigate = useNavigate();\r\n  const {\r\n    session,\r\n    updateAnswer,\r\n    setCurrentQuestion,\r\n    completeQuiz,\r\n    getUnansweredQuestions,\r\n    progress\r\n  } = useQuizSession({ quiz });\r\n\r\n  const {\r\n    formattedTime,\r\n    isTimeRunningOut,\r\n    isTimeCritical,\r\n    percentage\r\n  } = useQuizTimer({\r\n    onTimeUp: completeQuiz,\r\n    isActive: !session.isCompleted\r\n  });\r\n\r\n  const {\r\n    goToNextQuestion,\r\n    goToPreviousQuestion,\r\n    goToQuestion,\r\n    handleExitQuiz,\r\n    confirmExitQuiz,\r\n    handleSubmitQuiz,\r\n    isFirstQuestion,\r\n    isLastQuestion,\r\n    modalControls\r\n  } = useQuizNavigation({\r\n    questions: quiz.questions,\r\n    currentQuestionIndex: session.currentQuestionIndex,\r\n    onQuestionChange: setCurrentQuestion,\r\n    answers: session.answers\r\n  });\r\n\r\n  const currentQuestion = quiz.questions[session.currentQuestionIndex];\r\n\r\n  if (session.isCompleted) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">ƒêang x·ª≠ l√Ω k·∫øt qu·∫£...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 py-8\">\r\n      {/* Header v·ªõi Timer v√† Progress */}\r\n      <div className=\"bg-white shadow-sm border-b\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <button\r\n                onClick={handleExitQuiz}\r\n                className=\"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors\"\r\n              >\r\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n                </svg>\r\n                <span>Tho√°t</span>\r\n              </button>\r\n              <div className=\"h-6 w-px bg-gray-300\"></div>\r\n              <h1 className=\"text-xl font-semibold text-gray-800\">{quiz.title}</h1>\r\n            </div>\r\n            \r\n            <div className=\"flex items-center space-x-3\">\r\n\r\n              <ProgressIndicator\r\n                current={session.currentQuestionIndex + 1}\r\n                total={quiz.questions.length}\r\n                percentage={progress}\r\n              />\r\n              <Timer\r\n                timeLeft={formattedTime}\r\n                isWarning={isTimeRunningOut}\r\n                isCritical={isTimeCritical}\r\n                percentage={percentage}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-8\">\r\n          {/* Navigation Panel */}\r\n          <div className=\"lg:col-span-1\">\r\n            <QuickNavigation\r\n              questions={quiz.questions}\r\n              currentQuestionIndex={session.currentQuestionIndex}\r\n              answers={session.answers}\r\n              onQuestionSelect={goToQuestion}\r\n            />\r\n          </div>\r\n\r\n          {/* Main Quiz Content */}\r\n          <div className=\"lg:col-span-3\">\r\n            <div className=\"bg-white rounded-lg shadow-sm border p-8\">\r\n              <QuestionRenderer\r\n                question={currentQuestion}\r\n                questionNumber={session.currentQuestionIndex + 1}\r\n                value={session.answers[currentQuestion.id]}\r\n                onChange={(answer: AnswerValue) => updateAnswer(currentQuestion.id, answer)}\r\n              />\r\n\r\n              {/* Navigation Buttons */}\r\n              <div className=\"flex items-center justify-between mt-8 pt-6 border-t\">\r\n                <button\r\n                  onClick={goToPreviousQuestion}\r\n                  disabled={isFirstQuestion}\r\n                  className={`flex items-center space-x-2 px-6 py-3 rounded-lg font-medium transition-all ${\r\n                    isFirstQuestion\r\n                      ? 'bg-gray-100 text-gray-400 cursor-not-allowed'\r\n                      : 'bg-gray-600 text-white hover:bg-gray-700 shadow-sm hover:shadow-md'\r\n                  }`}\r\n                >\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n                  </svg>\r\n                  <span>C√¢u tr∆∞·ªõc</span>\r\n                </button>\r\n\r\n                <div className=\"flex space-x-3\">\r\n                  {isLastQuestion ? (\r\n                    <button\r\n                      onClick={handleSubmitQuiz}\r\n                      className=\"flex items-center space-x-2 px-8 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 shadow-sm hover:shadow-md transition-all\"\r\n                    >\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      <span>N·ªôp b√†i</span>\r\n                    </button>\r\n                  ) : (\r\n                    <button\r\n                      onClick={goToNextQuestion}\r\n                      className=\"flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 shadow-sm hover:shadow-md transition-all\"\r\n                    >\r\n                      <span>C√¢u ti·∫øp</span>\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                      </svg>\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modals */}\r\n      <ConfirmationModals\r\n        modalControls={modalControls}\r\n        onConfirmExit={confirmExitQuiz}\r\n        onConfirmSubmit={completeQuiz}\r\n        unansweredQuestions={getUnansweredQuestions()}\r\n        onGoToQuestion={goToQuestion}\r\n      />\r\n\r\n      {/* Th√™m c·∫£nh b√°o h·∫øt gi·ªù n·∫øu c·∫ßn thi·∫øt - hi·ªán khi c√≤n <= 10% t·ªïng th·ªùi gian */}\r\n      {isTimeRunningOut && (\r\n        <div className=\"mb-4 p-3 bg-red-100 border border-red-300 text-red-600 rounded-lg flex items-center gap-2\">\r\n          <span className=\"text-xl\">‚è∞</span>\r\n          <span className=\"font-medium\">\r\n            {isTimeCritical \r\n              ? \"Ch·ªâ c√≤n √≠t h∆°n 1 ph√∫t! H√£y ho√†n th√†nh ngay.\" \r\n              : \"S·∫Øp h·∫øt gi·ªù! Ch·ªâ c√≤n 10% th·ªùi gian.\"}\r\n          </span>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPage\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizPreviewPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizResultViewer\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizResultViewer\\index.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</h2>","line":127,"column":65,"nodeType":"JSXText","endLine":127,"endColumn":87},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\r\n            onClick={() => navigate('/profile')}\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\r\n          >\r\n            Quay l·∫°i Profile\r\n          </button>","line":131,"column":12,"nodeType":"JSXText","endLine":133,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { getQuizResultById } from '../../api/base';\r\nimport { getQuizById } from '../../services/quiz';\r\nimport { QuizResult, Quiz } from '../../types';\r\nimport { toast } from 'react-toastify';\r\nimport QuizReviewSystem from '../../../../shared/components/QuizReviewSystem';\r\nimport {\r\n  Confetti,\r\n  LoadingSpinner,\r\n  ResultSummary,\r\n  StatsGrid,\r\n  PerformanceAnalysis,\r\n  AnswerReview,\r\n  ActionButtons\r\n} from '../ResultPage/components';\r\nimport { useLeaderboard } from '../ResultPage/hooks';\r\nimport { Leaderboard } from '../ResultPage/components';\r\n\r\ninterface QuizResultViewerProps {}\r\n\r\nexport const QuizResultViewer: React.FC<QuizResultViewerProps> = () => {\r\n  const { resultId } = useParams<{ resultId: string }>();\r\n  const navigate = useNavigate();\r\n  \r\n  const [result, setResult] = useState<QuizResult | null>(null);\r\n  const [quiz, setQuiz] = useState<Quiz | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      if (!resultId) {\r\n        console.error('‚ùå No resultId provided');\r\n        navigate('/profile');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        setLoading(true);\r\n        console.log('üîç Loading quiz result:', resultId);\r\n\r\n        // Fetch quiz result\r\n        const resultData = await getQuizResultById(resultId);\r\n        if (!resultData) {\r\n          console.error('‚ùå Quiz result not found:', resultId);\r\n          toast.error('Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ quiz!');\r\n          navigate('/profile');\r\n          return;\r\n        }\r\n\r\n        console.log('‚úÖ Loaded quiz result:', resultData);\r\n        setResult(resultData as QuizResult);\r\n\r\n        // Fetch quiz details\r\n        if (resultData.quizId) {\r\n          console.log('üîç Loading quiz details:', resultData.quizId);\r\n          const quizData = await getQuizById(resultData.quizId);\r\n          if (quizData) {\r\n            console.log('‚úÖ Loaded quiz details:', quizData.title);\r\n            setQuiz(quizData);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('‚ùå Error loading data:', error);\r\n        toast.error('Kh√¥ng th·ªÉ t·∫£i k·∫øt qu·∫£ quiz!');\r\n        navigate('/profile');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadData();\r\n  }, [resultId, navigate]);\r\n\r\n  // Calculate percentage with unified logic (same as before)\r\n  const getPercentage = () => {\r\n    if (!result) return 0;\r\n    \r\n    // Primary: Use correctAnswers/totalQuestions if available\r\n    if (typeof result.correctAnswers === 'number' && typeof result.totalQuestions === 'number' && result.totalQuestions > 0) {\r\n      return Math.round((result.correctAnswers / result.totalQuestions) * 100);\r\n    } \r\n    // Fallback: Use score field\r\n    else if (typeof result.score === 'number' && !isNaN(result.score)) {\r\n      return result.score <= 1 ? Math.round(result.score * 100) : Math.round(result.score);\r\n    }\r\n    return 0;\r\n  };\r\n\r\n  const percentage = getPercentage();\r\n  const correct = result?.correctAnswers || 0;\r\n  const total = result?.totalQuestions || 0;\r\n\r\n  // Transform result to match ResultPage format\r\n  const transformedResult = result ? {\r\n    score: percentage, // Use calculated percentage as score\r\n    correct: correct,\r\n    total: total,\r\n    timeSpent: result.timeSpent,\r\n    answers: result.answers?.reduce((acc, answer) => {\r\n      acc[answer.questionId] = answer.selectedAnswerId || '';\r\n      return acc;\r\n    }, {} as Record<string, string>) || {},\r\n    completedAt: result.completedAt,\r\n    isTimeUp: false, // Can add this field if needed\r\n    quizId: result.quizId\r\n  } : null;\r\n\r\n  // Pass current result to leaderboard\r\n  const currentResult = transformedResult ? {\r\n    score: { percentage },\r\n    correct,\r\n    total,\r\n    timeSpent: transformedResult.timeSpent\r\n  } : undefined;\r\n  \r\n  const { leaderboard, userRank, loadingStats } = useLeaderboard(quiz?.id || null, currentResult);\r\n\r\n  if (loading) {\r\n    return <LoadingSpinner />;\r\n  }\r\n\r\n  if (!result || !quiz || !transformedResult) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</h2>\r\n          <button\r\n            onClick={() => navigate('/profile')}\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\r\n          >\r\n            Quay l·∫°i Profile\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const isExcellent = percentage >= 80;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 py-8\">\r\n      {isExcellent && <Confetti />}\r\n      \r\n      <div className=\"max-w-4xl mx-auto px-4\">\r\n        {/* K·∫øt qu·∫£ t·ªïng quan */}\r\n        <ResultSummary \r\n          result={transformedResult} \r\n          percentage={percentage} \r\n          correct={correct} \r\n          total={total} \r\n        />\r\n\r\n        {/* Stats Grid */}\r\n        <StatsGrid \r\n          correct={correct} \r\n          total={total} \r\n          percentage={percentage} \r\n        />\r\n\r\n        {/* Performance Analysis */}\r\n        <PerformanceAnalysis \r\n          quiz={quiz} \r\n          result={transformedResult} \r\n          percentage={percentage} \r\n        />\r\n\r\n        {/* Review Answers Section */}\r\n        <AnswerReview \r\n          quiz={quiz} \r\n          result={transformedResult} \r\n        />\r\n\r\n        {/* Leaderboard */}\r\n        <Leaderboard \r\n          leaderboard={leaderboard} \r\n          userRank={userRank} \r\n          loadingStats={loadingStats} \r\n        />\r\n\r\n        {/* Quiz Review System */}\r\n        <QuizReviewSystem \r\n          quizId={quiz.id}\r\n          quizTitle={quiz.title}\r\n          showSubmitForm={true}\r\n        />\r\n\r\n        {/* Action Buttons */}\r\n        <ActionButtons \r\n          quiz={quiz} \r\n          percentage={percentage} \r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizResultViewer;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\QuizReviewsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1137,1140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1137,1140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1187,1190],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1187,1190],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4117,4120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4117,4120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4315,4318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4315,4318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4386,4389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4386,4389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4457,4460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4457,4460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4528,4531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4528,4531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4599,4602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4599,4602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useCallback } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { reviewService } from '../services/reviewService';\r\nimport ReviewForm from '../components/ReviewForm';\r\nimport ReviewList from '../components/ReviewList';\r\nimport { Quiz } from '../types';\r\nimport { getQuizById } from '../api';\r\nimport { Star, Users, TrendingUp, MessageSquare, BarChart3, RefreshCw } from 'lucide-react';\r\nimport { toast } from 'react-toastify';\r\nimport { doc, updateDoc, arrayUnion, arrayRemove, getDoc } from 'firebase/firestore';\r\nimport { db } from '../../../firebase/config';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\n\r\nimport { useTranslation } from 'react-i18next';\r\nimport SafeHTML from '../../../shared/components/ui/SafeHTML';\r\n\r\nconst QuizReviewsPage: React.FC = () => {\r\n  const { t } = useTranslation();\r\n  const currentUser = useSelector((state: RootState) => state.auth.user);\r\n\r\n  const { id: quizId } = useParams<{ id: string }>();\r\n  const [quiz, setQuiz] = useState<Quiz | null>(null);\r\n  const [reviews, setReviews] = useState<any[]>([]);\r\n  const [stats, setStats] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showReviewForm, setShowReviewForm] = useState(false);\r\n\r\n  const loadQuizAndReviews = useCallback(async () => {\r\n    if (!quizId) {\r\n      console.error('‚ùå No quizId provided');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    \r\n    setLoading(true);\r\n    console.log('üîÑ Starting to load quiz and reviews for:', quizId);\r\n    \r\n    try {\r\n      // Step 1: Load quiz details (REQUIRED)\r\n      console.log('üìù Loading quiz details...');\r\n      let quizData;\r\n      try {\r\n        quizData = await getQuizById(quizId);\r\n        console.log('üîç Raw quiz data from API:', quizData);\r\n        \r\n        if (!quizData) {\r\n          console.error('‚ùå Quiz not found in database for ID:', quizId);\r\n          \r\n          // Create a fallback quiz object for testing\r\n          console.log('üîß Creating fallback quiz for testing...');\r\n          const fallbackQuiz: Quiz = {\r\n            id: quizId,\r\n            title: `Quiz Sample ${quizId}`,\r\n            description: 'ƒê√¢y l√† quiz m·∫´u ƒë·ªÉ test h·ªá th·ªëng ƒë√°nh gi√°',\r\n            category: 'General',\r\n            difficulty: 'easy' as const,\r\n            questions: [\r\n              {\r\n                id: '1',\r\n                text: 'C√¢u h·ªèi m·∫´u?',\r\n                type: 'multiple',\r\n                answers: [\r\n                  { id: '1', text: 'ƒê√°p √°n A', isCorrect: true },\r\n                  { id: '2', text: 'ƒê√°p √°n B', isCorrect: false },\r\n                  { id: '3', text: 'ƒê√°p √°n C', isCorrect: false },\r\n                  { id: '4', text: 'ƒê√°p √°n D', isCorrect: false }\r\n                ],\r\n                explanation: 'Gi·∫£i th√≠ch m·∫´u',\r\n                points: 10\r\n              }\r\n            ],\r\n            duration: 300,\r\n            createdBy: 'system',\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n            isPublished: true,\r\n            tags: ['sample', 'test']\r\n          };\r\n          setQuiz(fallbackQuiz);\r\n          console.log('‚úÖ Using fallback quiz for testing');\r\n        } else {\r\n          console.log('‚úÖ Quiz data loaded successfully:', quizData.title);\r\n          setQuiz(quizData);\r\n        }\r\n      } catch (quizError) {\r\n        console.error('‚ùå Failed to load quiz:', quizError);\r\n        toast.error(t('quizReviews.errors.notFound'));\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Step 2: Load reviews (OPTIONAL - don't fail if reviews fail)\r\n      console.log('üìä Loading reviews...');\r\n      try {\r\n        // Try simple query first to avoid index issues\r\n        const reviewsData = await reviewService.getQuizReviewsSimple(quizId);\r\n        console.log(`‚úÖ Reviews loaded: ${reviewsData.length} reviews found`);\r\n        setReviews(reviewsData || []);\r\n\r\n        // Calculate stats from reviews\r\n        if (reviewsData && reviewsData.length > 0) {\r\n          const totalRating = reviewsData.reduce((sum: number, review: any) => sum + (review.rating || 0), 0);\r\n          const averageRating = totalRating / reviewsData.length;\r\n          \r\n          const ratingDistribution = {\r\n            5: reviewsData.filter((r: any) => r.rating === 5).length,\r\n            4: reviewsData.filter((r: any) => r.rating === 4).length,\r\n            3: reviewsData.filter((r: any) => r.rating === 3).length,\r\n            2: reviewsData.filter((r: any) => r.rating === 2).length,\r\n            1: reviewsData.filter((r: any) => r.rating === 1).length\r\n          };\r\n\r\n          setStats({\r\n            totalReviews: reviewsData.length,\r\n            averageRating: Math.round(averageRating * 10) / 10,\r\n            ratingDistribution\r\n          });\r\n          console.log(`üìà Stats calculated: ${reviewsData.length} reviews, ${averageRating.toFixed(1)} avg rating`);\r\n        } else {\r\n          console.log('üìä No reviews found, setting empty stats');\r\n          setStats({\r\n            totalReviews: 0,\r\n            averageRating: 0,\r\n            ratingDistribution: { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 }\r\n          });\r\n        }\r\n      } catch (reviewError) {\r\n        console.error('‚ö†Ô∏è Error loading reviews:', reviewError);\r\n        \r\n        // Set empty state on error\r\n        setReviews([]);\r\n        setStats({\r\n          totalReviews: 0,\r\n          averageRating: 0,\r\n          ratingDistribution: { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 }\r\n        });\r\n        toast.error(t('quizReviews.errors.loadFailed'));\r\n      }\r\n\r\n      console.log('üéâ Page loading completed successfully');\r\n    } catch (error) {\r\n      console.error('‚ùå Critical error in loadQuizAndReviews:', error);\r\n      toast.error(t('quizReviews.errors.pageLoadFailed'));\r\n    } finally {\r\n      // ALWAYS set loading to false\r\n      setLoading(false);\r\n      console.log('‚úÖ Loading state set to false');\r\n    }\r\n  }, [quizId, t]);\r\n\r\n  useEffect(() => {\r\n    if (quizId) {\r\n      console.log('üéØ QuizReviewsPage mounted with quizId:', quizId);\r\n      loadQuizAndReviews();\r\n    } else {\r\n      console.error('‚ùå No quizId provided in URL params');\r\n      setLoading(false);\r\n    }\r\n  }, [quizId, loadQuizAndReviews]);\r\n\r\n  const handleReviewSubmitted = async () => {\r\n    console.log('üîÑ Review submitted, refreshing data...');\r\n    setShowReviewForm(false);\r\n    \r\n    // Clear current reviews to show loading state\r\n    setReviews([]);\r\n    setLoading(true);\r\n    \r\n    // Add delay to ensure Firebase has processed the write\r\n    setTimeout(() => {\r\n      console.log('‚è∞ Delay completed, reloading reviews with cache bypass...');\r\n      loadQuizAndReviews();\r\n    }, 1500); // Increased delay to 1.5 seconds\r\n  };\r\n\r\n  const handleHelpfulClick = async (reviewId: string) => {\r\n    if (!currentUser?.uid) {\r\n      toast.error('Please login to mark reviews as helpful');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const reviewRef = doc(db, 'quiz_reviews', reviewId);\r\n      const reviewDoc = await getDoc(reviewRef);\r\n      \r\n      if (!reviewDoc.exists()) {\r\n        toast.error('Review not found');\r\n        return;\r\n      }\r\n\r\n      const reviewData = reviewDoc.data();\r\n      const helpfulBy = reviewData.helpfulBy || [];\r\n      \r\n      // Toggle helpful status\r\n      if (helpfulBy.includes(currentUser.uid)) {\r\n        // Remove from helpful\r\n        await updateDoc(reviewRef, {\r\n          helpful: (reviewData.helpful || 1) - 1,\r\n          helpfulBy: arrayRemove(currentUser.uid)\r\n        });\r\n        toast.success('Removed from helpful');\r\n      } else {\r\n        // Add to helpful\r\n        await updateDoc(reviewRef, {\r\n          helpful: (reviewData.helpful || 0) + 1,\r\n          helpfulBy: arrayUnion(currentUser.uid)\r\n        });\r\n        toast.success('Marked as helpful');\r\n      }\r\n\r\n      // Reload reviews to show updated count\r\n      setTimeout(() => loadQuizAndReviews(), 500);\r\n    } catch (error) {\r\n      console.error('Error marking review as helpful:', error);\r\n      toast.error('Failed to update helpful status');\r\n    }\r\n  };\r\n\r\n  const handleReportClick = async (reviewId: string) => {\r\n    if (!currentUser?.uid) {\r\n      toast.error('Please login to report reviews');\r\n      return;\r\n    }\r\n\r\n    const reason = prompt('Please provide a reason for reporting this review:');\r\n    if (!reason || reason.trim() === '') {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const reviewRef = doc(db, 'quiz_reviews', reviewId);\r\n      const reviewDoc = await getDoc(reviewRef);\r\n      \r\n      if (!reviewDoc.exists()) {\r\n        toast.error('Review not found');\r\n        return;\r\n      }\r\n\r\n      const reviewData = reviewDoc.data();\r\n      const reportedBy = reviewData.reportedBy || [];\r\n      \r\n      // Check if user already reported\r\n      if (reportedBy.includes(currentUser.uid)) {\r\n        toast.warning('You have already reported this review');\r\n        return;\r\n      }\r\n\r\n      // Add report\r\n      await updateDoc(reviewRef, {\r\n        reports: (reviewData.reports || 0) + 1,\r\n        reportedBy: arrayUnion(currentUser.uid),\r\n        reportReasons: arrayUnion({\r\n          userId: currentUser.uid,\r\n          reason: reason.trim(),\r\n          reportedAt: new Date().toISOString()\r\n        })\r\n      });\r\n\r\n      toast.success('Review reported successfully. Admins will review it.');\r\n    } catch (error) {\r\n      console.error('Error reporting review:', error);\r\n      toast.error('Failed to report review');\r\n    }\r\n  };\r\n\r\n  const renderRatingDistribution = () => {\r\n    if (!stats) return null;\r\n\r\n    return (\r\n      <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-100\">\r\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\r\n          <BarChart3 className=\"w-5 h-5 mr-2\" />{t(\"admin.stats.ratingDistribution\")}\r\n        </h3>\r\n        <div className=\"space-y-3\">\r\n          {[5, 4, 3, 2, 1].map(rating => {\r\n            const count = stats.ratingDistribution[rating] || 0;\r\n            const percentage = stats.totalReviews > 0 ? (count / stats.totalReviews) * 100 : 0;\r\n            \r\n            return (\r\n              <div key={rating} className=\"flex items-center space-x-3\">\r\n                <div className=\"flex items-center space-x-1 w-16\">\r\n                  <span className=\"text-sm font-medium\">{rating}</span>\r\n                  <Star className=\"w-3 h-3 fill-yellow-400 text-yellow-400\" />\r\n                </div>\r\n                <div className=\"flex-1 bg-gray-200 rounded-full h-2\">\r\n                  <div \r\n                    className=\"bg-yellow-400 h-2 rounded-full transition-all duration-300\"\r\n                    style={{ width: `${percentage}%` }}\r\n                  />\r\n                </div>\r\n                <span className=\"text-sm text-gray-600 w-12\">{count}</span>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">{t('quizReviews.loading')}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!quiz) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"text-6xl mb-4\">üòî</div>\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">{t('quizReviews.empty.notFound')}</h2>\r\n          <p className=\"text-gray-600 mb-4\">{t('quizReviews.empty.notFoundDesc')}</p>\r\n          <button \r\n            onClick={() => window.history.back()}\r\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n          >{t(\"common.back\")}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        {/* Header */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8\">\r\n          <div className=\"flex items-start justify-between\">\r\n            <div className=\"flex-1\">\r\n              <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">{quiz.title}</h1>\r\n              <SafeHTML content={quiz.description} className=\"text-gray-600 mb-4\" />\r\n              <div className=\"flex items-center space-x-6 text-sm text-gray-500\">\r\n                <span className=\"flex items-center space-x-1\">\r\n                  <Users className=\"w-4 h-4\" />\r\n                  <span>{quiz.category}</span>\r\n                </span>\r\n                <span className=\"flex items-center space-x-1\">\r\n                  <TrendingUp className=\"w-4 h-4\" />\r\n                  <span className=\"capitalize\">{quiz.difficulty}</span>\r\n                </span>\r\n                <span className=\"flex items-center space-x-1\">\r\n                  <MessageSquare className=\"w-4 h-4\" />\r\n                  <span>{quiz.questions.length} {t('quizReviews.questions')}</span>\r\n                </span>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex space-x-3\">\r\n              <button\r\n                onClick={() => {\r\n                  loadQuizAndReviews();\r\n                }}\r\n                disabled={loading}\r\n                className=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium disabled:opacity-50\"\r\n                title={t('quizReviews.refreshReviews')}\r\n              >\r\n                <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\r\n              </button>\r\n              <button\r\n                onClick={() => setShowReviewForm(true)}\r\n                className=\"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium\"\r\n              >\r\n                {t('quizReviews.writeReview')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Cards */}\r\n        {stats && (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n            <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-100\">\r\n              <div className=\"flex items-center space-x-4\">\r\n                <div className=\"p-3 bg-blue-100 rounded-full\">\r\n                  <Star className=\"w-6 h-6 text-blue-600\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-2xl font-bold text-gray-900\">\r\n                    {stats.averageRating.toFixed(1)}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-600\">{t(\"multiplayer.avgScore\")}</p>\r\n                  <div className=\"flex items-center mt-1\">\r\n                    {[1, 2, 3, 4, 5].map(star => (\r\n                      <Star\r\n                        key={star}\r\n                        className={`w-4 h-4 ${\r\n                          star <= Math.round(stats.averageRating)\r\n                            ? 'fill-yellow-400 text-yellow-400'\r\n                            : 'text-gray-300'\r\n                        }`}\r\n                      />\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-100\">\r\n              <div className=\"flex items-center space-x-4\">\r\n                <div className=\"p-3 bg-green-100 rounded-full\">\r\n                  <MessageSquare className=\"w-6 h-6 text-green-600\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-2xl font-bold text-gray-900\">\r\n                    {stats?.totalReviews || 0}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-600\">{t(\"admin.stats.totalReviews\")}</p>\r\n                  <p className=\"text-xs text-gray-500 mt-1\">\r\n                    {stats?.totalReviews === 0 ? t('quizReviews.noReviewsYet') : t('quizReviews.peopleReviewed')}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-100\">\r\n              <div className=\"flex items-center space-x-4\">\r\n                <div className=\"p-3 bg-purple-100 rounded-full\">\r\n                  <TrendingUp className=\"w-6 h-6 text-purple-600\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-2xl font-bold text-gray-900\">\r\n                    {stats.totalReviews > 0 ? Math.round((stats.ratingDistribution[5] + stats.ratingDistribution[4]) / stats.totalReviews * 100) : 0}%\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-600\">{t('quizReviews.positiveReviews')}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n          {/* Rating Distribution */}\r\n          <div className=\"lg:col-span-1\">\r\n            {renderRatingDistribution()}\r\n          </div>\r\n\r\n          {/* Reviews List */}\r\n          <div className=\"lg:col-span-2\">\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-100\">\r\n              <div className=\"p-6 border-b border-gray-100\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-900\">\r\n                    {t('quizReviews.userReviews', { count: reviews.length })}\r\n                  </h3>\r\n                  <button\r\n                    onClick={() => setShowReviewForm(true)}\r\n                    className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm\"\r\n                  >\r\n                    {t('quizReviews.writeReview')}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              <div className=\"p-6\">\r\n                {reviews.length === 0 ? (\r\n                  // Empty State - No Reviews\r\n                  <div className=\"text-center py-12\">\r\n                    <div className=\"text-6xl mb-4\">üí≠</div>\r\n                    <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\r\n                      {t('quizReviews.empty.noReviews')}\r\n                    </h3>\r\n                    <p className=\"text-gray-600 mb-6 max-w-md mx-auto\">\r\n                      {t('quizReviews.empty.noReviewsDesc')}\r\n                    </p>\r\n                    <button\r\n                      onClick={() => setShowReviewForm(true)}\r\n                      className=\"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium\"\r\n                    >\r\n                      <MessageSquare className=\"w-5 h-5 mr-2\" />\r\n                      {t('quizReviews.empty.writeFirstReview')}\r\n                    </button>\r\n                    \r\n                    {/* Decorative Elements */}\r\n                    <div className=\"mt-8 flex justify-center space-x-4\">\r\n                      <div className=\"w-2 h-2 bg-blue-200 rounded-full animate-pulse\"></div>\r\n                      <div className=\"w-2 h-2 bg-blue-300 rounded-full animate-pulse delay-75\"></div>\r\n                      <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-pulse delay-150\"></div>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  // Reviews List\r\n                  <ReviewList \r\n                    reviews={reviews} \r\n                    loading={false}\r\n                    onHelpfulClick={handleHelpfulClick}\r\n                    onReportClick={handleReportClick}\r\n                  />\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Review Form Modal */}\r\n        {showReviewForm && quizId && (\r\n          <ReviewForm\r\n            quizId={quizId}\r\n            onReviewSubmitted={handleReviewSubmitted}\r\n            onClose={() => setShowReviewForm(false)}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizReviewsPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\RealQuizListPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[470,473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[470,473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"flex items-center gap-1\">ID: <code className=\"bg-gray-100 px-2 py-0.5 rounded\">{quiz.id}</code></span>","line":103,"column":65,"nodeType":"JSXText","endLine":103,"endColumn":69}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { getRealQuizData } from '../services/realDataService';\r\nimport { Link } from 'react-router-dom';\r\nimport { ArrowLeft, RefreshCw, Eye, MessageSquare } from 'lucide-react';\r\n\r\nimport { useTranslation } from 'react-i18next';\r\nimport SafeHTML from '../../../shared/components/ui/SafeHTML';\r\nconst RealQuizListPage: React.FC = () => {\r\n  const { t } = useTranslation();\r\n\r\n  const [quizzes, setQuizzes] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadRealQuizzes();\r\n  }, []);\r\n\r\n  const loadRealQuizzes = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const realQuizzes = await getRealQuizData();\r\n      setQuizzes(realQuizzes);\r\n      console.log('Loaded real quizzes:', realQuizzes);\r\n    } catch (error) {\r\n      console.error('Error loading real quizzes:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 py-8\">\r\n        <div className=\"max-w-4xl mx-auto px-4\">\r\n          <div className=\"flex items-center justify-center py-12\">\r\n            <RefreshCw className=\"w-8 h-8 animate-spin text-blue-600 mr-3\" />\r\n            <span className=\"text-lg text-gray-600\">{t('quiz.loadingRealQuizzes')}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 py-8\">\r\n      <div className=\"max-w-5xl mx-auto px-4\">\r\n        {/* Header */}\r\n        <div className=\"mb-8\">\r\n          <Link\r\n            to=\"/admin\"\r\n            className=\"inline-flex items-center text-blue-600 hover:text-blue-800 mb-4\"\r\n          >\r\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n            {t('back')}\r\n          </Link>\r\n          \r\n          <div className=\"relative overflow-hidden rounded-2xl p-6 shadow-sm bg-gradient-to-r from-indigo-50 via-blue-50 to-sky-50 border border-gray-100\">\r\n            <div className=\"absolute inset-0 pointer-events-none opacity-40\" style={{backgroundImage:'radial-gradient(circle at 20% 20%, rgba(59,130,246,0.15), transparent 35%), radial-gradient(circle at 80% 0%, rgba(99,102,241,0.15), transparent 35%)'}} />\r\n            <div className=\"relative flex items-center justify-between\">\r\n              <div>\r\n                <h1 className=\"text-2xl md:text-3xl font-extrabold tracking-tight text-gray-900 mb-1\">\r\n                  üìö {t('quizList.title')}\r\n                </h1>\r\n                <div className=\"flex items-center gap-3 text-gray-600\">\r\n                  <span className=\"px-2.5 py-1 rounded-full bg-white/70 border border-gray-200 text-sm\">\r\n                    {quizzes.length} {t('quizList.results.quizzes')}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={loadRealQuizzes}\r\n                className=\"inline-flex items-center px-4 py-2 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow hover:from-blue-700 hover:to-indigo-700 transition-colors\"\r\n              >\r\n                <RefreshCw className=\"w-4 h-4 mr-2\" />{t('refresh')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Quiz List */}\r\n        {quizzes.length === 0 ? (\r\n          <div className=\"bg-white rounded-lg p-8 shadow-sm text-center\">\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n              {t('quiz.noQuizzesInDatabase')}\r\n            </h3>\r\n            <p className=\"text-gray-600\">\r\n              {t('quiz.createQuizzesToTest')}\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-4\">\r\n            {quizzes.map((quiz) => (\r\n              <div key={quiz.id} className=\"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg hover:border-blue-200 transition-all\">\r\n                <div className=\"flex items-start justify-between gap-6\">\r\n                  <div className=\"flex-1\">\r\n                    <h3 className=\"text-xl font-bold text-gray-900 mb-2 tracking-tight\">\r\n                      {quiz.title || t('quiz.noTitle')}\r\n                    </h3>\r\n                    \r\n                    <SafeHTML content={quiz.description || String(t('quiz.noDescription'))} className=\"text-gray-600 mb-4 line-clamp-2\" as=\"div\" />\r\n                    \r\n                    <div className=\"flex flex-wrap items-center gap-2 text-sm text-gray-600\">\r\n                      <span className=\"flex items-center gap-1\">ID: <code className=\"bg-gray-100 px-2 py-0.5 rounded\">{quiz.id}</code></span>\r\n                      {quiz.category && (\r\n                        <span className=\"px-2 py-0.5 rounded-full bg-gray-100 text-gray-700\">{t('quiz.category')}: {quiz.category}</span>\r\n                      )}\r\n                      {quiz.status && (\r\n                        <span className={`px-2.5 py-1 rounded-full text-xs font-medium border ${\r\n                          quiz.status === 'approved' ? 'bg-green-50 text-green-700 border-green-200' :\r\n                          quiz.status === 'pending' ? 'bg-yellow-50 text-yellow-700 border-yellow-200' :\r\n                          'bg-red-50 text-red-700 border-red-200'\r\n                        }`}>\r\n                          {quiz.status === 'approved' ? t('admin.quizManagement.filter.approved') :\r\n                           quiz.status === 'pending' ? t('admin.quizManagement.filter.pending') : t('status.rejected')}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <Link\r\n                       to={`/quiz/${quiz.id}/preview`}\r\n                      className=\"inline-flex items-center px-3 py-2 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700 text-sm shadow\"\r\n                    >\r\n                      <Eye className=\"w-4 h-4 mr-2\" />\r\n                       {t('quiz.preview')}\r\n                    </Link>\r\n                    \r\n                    <Link\r\n                      to={`/quiz/${quiz.id}/reviews`}\r\n                      className=\"inline-flex items-center px-3 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-700 text-sm shadow\"\r\n                    >\r\n                      <MessageSquare className=\"w-4 h-4 mr-2\" />\r\n                       {t('quiz.reviewsTitle')}\r\n                    </Link>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {/* Quick Stats */}\r\n        {quizzes.length > 0 && (\r\n          <div className=\"mt-8 bg-white rounded-lg p-6 shadow-sm\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">üìä {t('dashboard.realTimeData')}</h3>\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n              <div className=\"text-center\">\r\n                <p className=\"text-2xl font-bold text-blue-600\">{quizzes.length}</p>\r\n                <p className=\"text-sm text-gray-600\">{t('dashboard.totalQuizzes')}</p>\r\n              </div>\r\n              \r\n              <div className=\"text-center\">\r\n                <p className=\"text-2xl font-bold text-green-600\">\r\n                  {quizzes.filter(q => q.status === 'approved').length}\r\n                </p>\r\n                <p className=\"text-sm text-gray-600\">{t(\"admin.quizManagement.filter.approved\")}</p>\r\n              </div>\r\n              \r\n              <div className=\"text-center\">\r\n                <p className=\"text-2xl font-bold text-yellow-600\">\r\n                  {quizzes.filter(q => q.status === 'pending').length}\r\n                </p>\r\n                <p className=\"text-sm text-gray-600\">{t(\"admin.quizManagement.filter.pending\")}</p>\r\n              </div>\r\n              \r\n              <div className=\"text-center\">\r\n                <p className=\"text-2xl font-bold text-purple-600\">\r\n                  {new Set(quizzes.map(q => q.category).filter(Boolean)).size}\r\n                </p>\r\n                <p className=\"text-sm text-gray-600\">{t(\"admin.preview.category\")}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RealQuizListPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4376,4379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4376,4379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5887,5890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5887,5890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":252,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8681,8684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8681,8684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={() => navigate('/quiz-list')}>\r\n            Back to Quiz List\r\n          </Button>","line":305,"column":58,"nodeType":"JSXText","endLine":307,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"bg-yellow-100 border border-yellow-300 text-yellow-800 px-4 py-3 rounded-lg mb-6\">\r\n                ‚è∞ Time's up! Quiz was automatically submitted.\r\n              </div>","line":328,"column":113,"nodeType":"JSXText","endLine":330,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-3xl font-bold text-gray-900 mt-4 mb-2\">\r\n                Quiz Completed!\r\n              </h1>","line":334,"column":74,"nodeType":"JSXText","endLine":336,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-lg text-gray-700 mb-2\">\r\n                You got <span className=\"font-bold text-blue-600\">{correct}</span> out of{' '}\r\n                <span className=\"font-bold\">{total}</span> questions correct\r\n              </div>","line":345,"column":59,"nodeType":"JSXText","endLine":346,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-lg text-gray-700 mb-2\">\r\n                You got <span className=\"font-bold text-blue-600\">{correct}</span> out of{' '}\r\n                <span className=\"font-bold\">{total}</span> questions correct\r\n              </div>","line":346,"column":83,"nodeType":"JSXText","endLine":346,"endColumn":90},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-lg text-gray-700 mb-2\">\r\n                You got <span className=\"font-bold text-blue-600\">{correct}</span> out of{' '}\r\n                <span className=\"font-bold\">{total}</span> questions correct\r\n              </div>","line":347,"column":59,"nodeType":"JSXText","endLine":348,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-md text-gray-500 mt-2\">\r\n                  ‚è±Ô∏è Time taken: <span className=\"font-semibold text-blue-700\">{formatTime(safeNumber(result.timeSpent))}</span>\r\n                </div>","line":351,"column":61,"nodeType":"JSXText","endLine":352,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-gray-600\">Correct Answers</div>","line":363,"column":44,"nodeType":"JSXText","endLine":363,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-gray-600\">Incorrect Answers</div>","line":368,"column":44,"nodeType":"JSXText","endLine":368,"endColumn":61},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-gray-600\">Final Score</div>","line":373,"column":44,"nodeType":"JSXText","endLine":373,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-xl font-bold text-gray-900 mb-4\">Performance Analysis</h2>","line":379,"column":64,"nodeType":"JSXText","endLine":379,"endColumn":84},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600\">Accuracy Rate</span>","line":383,"column":47,"nodeType":"JSXText","endLine":383,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600\">Quiz Difficulty</span>","line":396,"column":47,"nodeType":"JSXText","endLine":396,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600\">Time Management</span>","line":407,"column":47,"nodeType":"JSXText","endLine":407,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-xl font-bold text-gray-900\">Review Answers</h2>","line":418,"column":61,"nodeType":"JSXText","endLine":418,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\r\n              variant=\"outline\"\r\n              onClick={() => setShowAnswers(!showAnswers)}\r\n            >\r\n              {showAnswers ? 'Hide' : 'Show'} Detailed Review\r\n            </Button>","line":423,"column":46,"nodeType":"JSXText","endLine":424,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-auto text-green-600 font-medium\">\r\n                                ‚úì Correct Answer\r\n                              </span>","line":465,"column":84,"nodeType":"JSXText","endLine":467,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-auto text-red-600 font-medium\">\r\n                                Your Answer\r\n                              </span>","line":470,"column":82,"nodeType":"JSXText","endLine":472,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium text-blue-800\">Explanation: </span>","line":481,"column":69,"nodeType":"JSXText","endLine":481,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">üèÜ Leaderboard</h2>","line":494,"column":65,"nodeType":"JSXText","endLine":494,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-blue-600 ml-2\">(You)</span>","line":523,"column":93,"nodeType":"JSXText","endLine":523,"endColumn":98},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-500\">\r\n                        {entry.correctAnswers}/{entry.totalQuestions} correct\r\n                      </div>","line":526,"column":70,"nodeType":"JSXText","endLine":527,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-500\">\r\n                      ‚è±Ô∏è {formatTime(safeNumber(entry.timeSpent))}\r\n                    </div>","line":532,"column":60,"nodeType":"JSXText","endLine":533,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-blue-800 font-medium\">Your Rank: #{userRank}</span>","line":544,"column":67,"nodeType":"JSXText","endLine":544,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-lg\">No results yet!</p>","line":553,"column":38,"nodeType":"JSXText","endLine":553,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Be the first to complete this quiz and claim the top spot!</p>","line":554,"column":18,"nodeType":"JSXText","endLine":554,"endColumn":76},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\r\n            onClick={() => navigate(`/quiz/${quiz.id}`)}\r\n            className=\"bg-blue-600 hover:bg-blue-700\"\r\n          >\r\n            Retake Quiz\r\n          </Button>","line":574,"column":12,"nodeType":"JSXText","endLine":576,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\r\n            onClick={() => navigate('/quizzes')}\r\n            variant=\"outline\"\r\n          >\r\n            More Quizzes\r\n          </Button>","line":581,"column":12,"nodeType":"JSXText","endLine":583,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\r\n            variant=\"outline\"\r\n            onClick={() => {\r\n              // Share functionality\r\n              navigator.clipboard.writeText(\r\n                `I scored ${percentage}% on \"${quiz.title}\" quiz! üéØ`\r\n              );\r\n              toast.success('Result copied to clipboard!');\r\n            }}\r\n          >\r\n            Share Result\r\n          </Button>","line":594,"column":12,"nodeType":"JSXText","endLine":596,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\r\n            onClick={() => navigate('/profile')}\r\n            variant=\"outline\"\r\n          >\r\n            View All Results\r\n          </Button>","line":601,"column":12,"nodeType":"JSXText","endLine":603,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":33,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useParams, useLocation, useNavigate } from 'react-router-dom';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../lib/store';\r\nimport { Quiz } from '../types';\r\nimport Button from '../../../shared/components/ui/Button';\r\nimport { getQuizResults, getQuizResultById, getQuizById } from '../services/quizService';\r\nimport { toast } from 'react-toastify';\r\nimport QuickReviewSection from '../../../shared/components/QuickReviewSection';\r\nimport { quizStatsService } from '../../../services/quizStatsService';\r\nimport SafeHTML from '../../../shared/components/ui/SafeHTML';\r\n\r\n\r\ninterface ResultState {\r\n  score: number;\r\n  correct: number;\r\n  total: number;\r\n  answers: Record<string, string>;\r\n  isTimeUp?: boolean;\r\n  timeSpent?: number;\r\n  quizId?: string;\r\n  tracked?: boolean; // Add this to prevent duplicate tracking\r\n}\r\n\r\ninterface LeaderboardEntry {\r\n  id: string;\r\n  userId: string;\r\n  userName: string;\r\n  userEmail: string;\r\n  score: number;\r\n  correctAnswers: number;\r\n  totalQuestions: number;\r\n  timeSpent: number;\r\n  completedAt: Date;\r\n}\r\n\r\n// **TH√äM M·ªöI**: Confetti animation component\r\nconst Confetti: React.FC = () => {\r\n  return (\r\n    <div className=\"fixed inset-0 pointer-events-none overflow-hidden\">\r\n      {[...Array(50)].map((_, i) => (\r\n        <div\r\n          key={i}\r\n          className=\"absolute animate-bounce\"\r\n          style={{\r\n            left: `${Math.random() * 100}%`,\r\n            animationDelay: `${Math.random() * 3}s`,\r\n            animationDuration: `${2 + Math.random() * 3}s`\r\n          }}\r\n        >\r\n          <div \r\n            className=\"w-2 h-2 bg-yellow-400 rounded-full\"\r\n            style={{\r\n              backgroundColor: ['#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ef4444'][Math.floor(Math.random() * 5)]\r\n            }}\r\n          />\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\n// **TH√äM M·ªöI**: Score circle component\r\nconst ScoreCircle: React.FC<{ score: number }> = ({ score }) => {\r\n  const [animatedScore, setAnimatedScore] = useState(0);\r\n  \r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      let current = 0;\r\n      const increment = score / 50; // Animation in 50 steps\r\n      const stepTimer = setInterval(() => {\r\n        current += increment;\r\n        if (current >= score) {\r\n          setAnimatedScore(score);\r\n          clearInterval(stepTimer);\r\n        } else {\r\n          setAnimatedScore(Math.floor(current));\r\n        }\r\n      }, 20);\r\n    }, 500);\r\n    \r\n    return () => clearTimeout(timer);\r\n  }, [score]);\r\n\r\n  const getScoreColor = (score: number) => {\r\n    if (score >= 80) return 'text-green-600';\r\n    if (score >= 60) return 'text-yellow-600';\r\n    return 'text-red-600';\r\n  };\r\n\r\n\r\n\r\n  const circumference = 2 * Math.PI * 45;\r\n  const strokeDasharray = circumference;\r\n  const strokeDashoffset = circumference - (animatedScore / 100) * circumference;\r\n\r\n  return (\r\n    <div className=\"relative w-32 h-32\">\r\n      <svg className=\"w-32 h-32 transform -rotate-90\" viewBox=\"0 0 100 100\">\r\n        <circle\r\n          cx=\"50\"\r\n          cy=\"50\"\r\n          r=\"45\"\r\n          stroke=\"currentColor\"\r\n          strokeWidth=\"6\"\r\n          fill=\"transparent\"\r\n          className=\"text-gray-200\"\r\n        />\r\n        <circle\r\n          cx=\"50\"\r\n          cy=\"50\"\r\n          r=\"45\"\r\n          stroke=\"currentColor\"\r\n          strokeWidth=\"6\"\r\n          fill=\"transparent\"\r\n          strokeDasharray={strokeDasharray}\r\n          strokeDashoffset={strokeDashoffset}\r\n          strokeLinecap=\"round\"\r\n          className={`transition-all duration-1000 ease-out ${\r\n            animatedScore >= 80 ? 'text-green-500' :\r\n            animatedScore >= 60 ? 'text-yellow-500' : 'text-red-500'\r\n          }`}\r\n        />\r\n      </svg>\r\n      <div className=\"absolute inset-0 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className={`text-2xl font-bold ${getScoreColor(animatedScore)}`}>\r\n            {animatedScore}%\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Helper: format seconds to mm:ss\r\nconst formatTime = (seconds: number) => {\r\n  const m = Math.floor(seconds / 60);\r\n  const s = seconds % 60;\r\n  return `${m}:${s.toString().padStart(2, '0')}`;\r\n};\r\n\r\n// Helper √©p ki·ªÉu an to√†n cho s·ªë\r\nconst safeNumber = (val: any, fallback = 0) => {\r\n  const n = Number(val);\r\n  return isNaN(n) ? fallback : n;\r\n};\r\n\r\nexport const ResultPage: React.FC = () => {\r\n  const { attemptId } = useParams<{ attemptId: string }>();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { quizzes } = useSelector((state: RootState) => state.quiz);\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  \r\n  const [result, setResult] = useState<ResultState | null>(location.state as ResultState || null);\r\n  const [quizId, setQuizId] = useState<string | null>(null);\r\n  const [quiz, setQuiz] = useState<Quiz | null>(null);\r\n  const [showAnswers, setShowAnswers] = useState(false);\r\n  const [leaderboard, setLeaderboard] = useState<LeaderboardEntry[]>([]);\r\n  const [userRank, setUserRank] = useState<number | null>(null);\r\n  const [loadingStats, setLoadingStats] = useState(true);\r\n\r\n  useEffect(() => {\r\n    console.log('üîç ResultPage useEffect - attemptId:', attemptId, 'location.state:', location.state);\r\n    \r\n    if (location.state) {\r\n      // C√≥ state t·ª´ navigation - s·ª≠ d·ª•ng ngay\r\n      const resultData = location.state as ResultState;\r\n      console.log('‚úÖ Using state from navigation:', resultData);\r\n      setResult(resultData);\r\n      setQuizId(resultData.quizId || attemptId || null);\r\n    } else if (attemptId) {\r\n      // Kh√¥ng c√≥ state, c·∫ßn fetch t·ª´ Firestore\r\n      console.log('üì° Fetching result from Firestore for attemptId:', attemptId);\r\n      getQuizResultById(attemptId).then((res: any) => {\r\n        if (res) {\r\n          console.log('‚úÖ Fetched result from Firestore:', res);\r\n          const resultData = res as ResultState;\r\n          setResult(resultData);\r\n          setQuizId(resultData.quizId || null);\r\n        } else {\r\n          console.error('‚ùå No result found for attemptId:', attemptId);\r\n          toast.error('Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ quiz!');\r\n          navigate('/quiz-list');\r\n        }\r\n      }).catch(error => {\r\n        console.error('‚ùå Error fetching result:', error);\r\n        toast.error('Kh√¥ng th·ªÉ t·∫£i k·∫øt qu·∫£ quiz!');\r\n        navigate('/quiz-list');\r\n      });\r\n    } else {\r\n      console.error('‚ùå No attemptId or state provided');\r\n      navigate('/quiz-list');\r\n    }\r\n  }, [attemptId, location.state, navigate]);\r\n\r\n  useEffect(() => {\r\n    if (!quizId) return;\r\n    \r\n    console.log('üîç Looking for quiz with ID:', quizId);\r\n    const foundQuiz = quizzes.find(q => q.id === quizId);\r\n    \r\n    if (foundQuiz) {\r\n      console.log('‚úÖ Found quiz in store:', foundQuiz.title);\r\n      setQuiz(foundQuiz);\r\n    } else {\r\n      console.log('üì° Quiz not in store, fetching from Firestore...');\r\n      // N·∫øu kh√¥ng c√≥ trong store, fetch t·ª´ Firestore\r\n      getQuizById(quizId).then(qz => {\r\n        if (qz) {\r\n          console.log('‚úÖ Fetched quiz from Firestore:', qz.title);\r\n          setQuiz(qz);\r\n        } else {\r\n          console.error('‚ùå Quiz not found:', quizId);\r\n          toast.error('Kh√¥ng t√¨m th·∫•y quiz!');\r\n          navigate('/quiz-list');\r\n        }\r\n      }).catch(error => {\r\n        console.error('‚ùå Error fetching quiz:', error);\r\n        toast.error('Kh√¥ng th·ªÉ t·∫£i quiz!');\r\n        navigate('/quiz-list');\r\n      });\r\n    }\r\n  }, [quizId, quizzes, navigate]);\r\n\r\n  // Track completion when result and quiz are both available\r\n  useEffect(() => {\r\n    if (result && quiz && user && !result.tracked) {\r\n      console.log('üìä Tracking quiz completion for user:', user.uid);\r\n      const score = safeNumber(result.correct, 0);\r\n      const total = safeNumber(result.total, quiz.questions.length);\r\n      \r\n      quizStatsService.trackCompletion(quiz.id, user.uid, score, total);\r\n      \r\n      // Mark as tracked to prevent duplicate tracking\r\n      setResult(prev => prev ? { ...prev, tracked: true } : null);\r\n    }\r\n  }, [result, quiz, user]);\r\n\r\n  useEffect(() => {\r\n    const fetchLeaderboard = async () => {\r\n      if (!quizId) return;\r\n      \r\n      try {\r\n        setLoadingStats(true);\r\n        console.log('üìä Fetching leaderboard for quiz:', quizId);\r\n        const results = await getQuizResults(quizId);\r\n        console.log('üìä Raw results from Firebase:', results);\r\n        \r\n        // Transform results to leaderboard entries with user info\r\n        const leaderboardData: LeaderboardEntry[] = results.map((result: any) => {\r\n          console.log('üîç Processing result:', result);\r\n          return {\r\n            id: result.id,\r\n            userId: result.userId,\r\n            userName: result.userName || result.userEmail?.split('@')[0] || 'Anonymous',\r\n            userEmail: result.userEmail || '',\r\n            score: result.score,\r\n            correctAnswers: result.correctAnswers,\r\n            totalQuestions: result.totalQuestions,\r\n            timeSpent: result.timeSpent || 0,\r\n            completedAt: result.completedAt?.toDate?.() || new Date(result.completedAt)\r\n          };\r\n        });\r\n\r\n        console.log('üìä Leaderboard data processed:', leaderboardData);\r\n\r\n        // Sort by score (descending) then by time (ascending) for same scores\r\n        const sortedLeaderboard = leaderboardData.sort((a, b) => {\r\n          if (a.score !== b.score) {\r\n            return b.score - a.score; // Higher score first\r\n          }\r\n          return a.timeSpent - b.timeSpent; // Faster time first if same score\r\n        });\r\n\r\n        console.log('üìä Sorted leaderboard:', sortedLeaderboard);\r\n        setLeaderboard(sortedLeaderboard.slice(0, 10)); // Top 10\r\n\r\n        // Find current user's rank\r\n        if (user) {\r\n          const userResultIndex = sortedLeaderboard.findIndex(r => r.userId === user.uid);\r\n          setUserRank(userResultIndex >= 0 ? userResultIndex + 1 : null);\r\n          console.log('üë§ User rank:', userResultIndex >= 0 ? userResultIndex + 1 : 'Not found');\r\n        }\r\n\r\n        console.log('üìä Leaderboard loaded:', sortedLeaderboard.length, 'entries');\r\n      } catch (error) {\r\n        console.error('‚ùå Failed to fetch leaderboard:', error);\r\n        toast.error('Kh√¥ng th·ªÉ t·∫£i b·∫£ng x·∫øp h·∫°ng!');\r\n      } finally {\r\n        setLoadingStats(false);\r\n      }\r\n    };\r\n\r\n    fetchLeaderboard();\r\n  }, [quizId, user]);\r\n\r\n  if (!result || !quiz) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mb-4\"></div>\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Loading results...</h2>\r\n          <Button onClick={() => navigate('/quiz-list')}>\r\n            Back to Quiz List\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // T√≠nh to√°n ƒëi·ªÉm s·ªë, ki·ªÉm tra h·ª£p l·ªá\r\n  const correct = safeNumber(result.correct);\r\n  const total = safeNumber(result.total);\r\n  const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;\r\n  const isExcellent = percentage >= 80;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 py-8\">\r\n      {isExcellent && <Confetti />}\r\n      \r\n      <div className=\"max-w-4xl mx-auto px-4\">\r\n        {/* K·∫øt qu·∫£ t·ªïng quan */}\r\n        <div className=\"text-center mb-8\">\r\n          <div className=\"bg-white rounded-2xl shadow-xl p-8 mb-6\">\r\n            {result.isTimeUp && (\r\n              <div className=\"bg-yellow-100 border border-yellow-300 text-yellow-800 px-4 py-3 rounded-lg mb-6\">\r\n                ‚è∞ Time's up! Quiz was automatically submitted.\r\n              </div>\r\n            )}\r\n            <div className=\"flex flex-col items-center\">\r\n              <ScoreCircle score={percentage} />\r\n              <h1 className=\"text-3xl font-bold text-gray-900 mt-4 mb-2\">\r\n                Quiz Completed!\r\n              </h1>\r\n              <p className=\"text-xl text-gray-600 mb-4\">\r\n                {percentage >= 90 ? 'Outstanding! üèÜ' :\r\n                 percentage >= 80 ? 'Excellent! üåü' :\r\n                 percentage >= 70 ? 'Great Job! üëè' :\r\n                 percentage >= 60 ? 'Good Work! üëç' :\r\n                 percentage >= 50 ? 'Not Bad! üìö' :\r\n                 'Keep Practicing! üí™'}\r\n              </p>\r\n              <div className=\"text-lg text-gray-700 mb-2\">\r\n                You got <span className=\"font-bold text-blue-600\">{correct}</span> out of{' '}\r\n                <span className=\"font-bold\">{total}</span> questions correct\r\n              </div>\r\n              {/* Hi·ªÉn th·ªã th·ªùi gian l√†m b√†i */}\r\n              {typeof result.timeSpent === 'number' && (\r\n                <div className=\"text-md text-gray-500 mt-2\">\r\n                  ‚è±Ô∏è Time taken: <span className=\"font-semibold text-blue-700\">{formatTime(safeNumber(result.timeSpent))}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* **TH√äM M·ªöI**: Stats Grid */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n          <div className=\"bg-white rounded-xl shadow-lg p-6 text-center\">\r\n            <div className=\"text-3xl font-bold text-green-600 mb-2\">{correct}</div>\r\n            <div className=\"text-gray-600\">Correct Answers</div>\r\n          </div>\r\n          \r\n          <div className=\"bg-white rounded-xl shadow-lg p-6 text-center\">\r\n            <div className=\"text-3xl font-bold text-red-600 mb-2\">{total - correct}</div>\r\n            <div className=\"text-gray-600\">Incorrect Answers</div>\r\n          </div>\r\n          \r\n          <div className=\"bg-white rounded-xl shadow-lg p-6 text-center\">\r\n            <div className=\"text-3xl font-bold text-blue-600 mb-2\">{percentage}%</div>\r\n            <div className=\"text-gray-600\">Final Score</div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* **TH√äM M·ªöI**: Performance Analysis */}\r\n        <div className=\"bg-white rounded-xl shadow-lg p-6 mb-8\">\r\n          <h2 className=\"text-xl font-bold text-gray-900 mb-4\">Performance Analysis</h2>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-gray-600\">Accuracy Rate</span>\r\n              <div className=\"flex items-center\">\r\n                <div className=\"w-32 bg-gray-200 rounded-full h-2 mr-3\">\r\n                  <div \r\n                    className=\"bg-blue-500 h-2 rounded-full transition-all duration-1000\"\r\n                    style={{ width: `${percentage}%` }}\r\n                  ></div>\r\n                </div>\r\n                <span className=\"font-semibold\">{percentage}%</span>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-gray-600\">Quiz Difficulty</span>\r\n              <span className={`px-3 py-1 rounded-full text-sm font-medium ${\r\n                quiz.difficulty === 'easy' ? 'bg-green-100 text-green-800' :\r\n                quiz.difficulty === 'medium' ? 'bg-yellow-100 text-yellow-800' :\r\n                'bg-red-100 text-red-800'\r\n              }`}>\r\n                {quiz.difficulty.charAt(0).toUpperCase() + quiz.difficulty.slice(1)}\r\n              </span>\r\n            </div>\r\n            \r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-gray-600\">Time Management</span>\r\n              <span className=\"font-semibold text-green-600\">\r\n                {result.isTimeUp ? 'Used full time' : 'Completed early'}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* **TH√äM M·ªöI**: Review Answers Section */}\r\n        <div className=\"bg-white rounded-xl shadow-lg p-6 mb-8\">\r\n          <div className=\"flex items-center justify-between mb-6\">\r\n            <h2 className=\"text-xl font-bold text-gray-900\">Review Answers</h2>\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => setShowAnswers(!showAnswers)}\r\n            >\r\n              {showAnswers ? 'Hide' : 'Show'} Detailed Review\r\n            </Button>\r\n          </div>\r\n\r\n          {showAnswers && (\r\n            <div className=\"space-y-6\">\r\n              {quiz.questions.map((question, index) => {\r\n                const userAnswerId = result.answers[question.id];\r\n                const userAnswer = question.answers.find(a => a.id === userAnswerId);\r\n                const isCorrect = userAnswer?.isCorrect || false;\r\n\r\n                return (\r\n                  <div key={question.id} className=\"border border-gray-200 rounded-lg p-4\">\r\n                    <div className=\"flex items-start justify-between mb-3\">\r\n                      <h3 className=\"text-lg font-medium text-gray-900\">\r\n                        {index + 1}. {question.text}\r\n                      </h3>\r\n                      <span className={`px-3 py-1 rounded-full text-sm font-medium ${\r\n                        isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'\r\n                      }`}>\r\n                        {isCorrect ? '‚úì Correct' : '‚úó Incorrect'}\r\n                      </span>\r\n                    </div>\r\n                    \r\n                    <div className=\"space-y-2\">\r\n                      {question.answers.map(answer => (\r\n                        <div\r\n                          key={answer.id}\r\n                          className={`p-3 rounded-lg border ${\r\n                            answer.isCorrect \r\n                              ? 'border-green-300 bg-green-50' \r\n                              : answer.id === userAnswerId \r\n                              ? 'border-red-300 bg-red-50'\r\n                              : 'border-gray-200 bg-gray-50'\r\n                          }`}\r\n                        >\r\n                          <div className=\"flex items-center\">\r\n                            <span className=\"font-medium mr-3\">\r\n                              {String.fromCharCode(65 + question.answers.indexOf(answer))}.\r\n                            </span>\r\n                            <span>{answer.text}</span>\r\n                            {answer.isCorrect && (\r\n                              <span className=\"ml-auto text-green-600 font-medium\">\r\n                                ‚úì Correct Answer\r\n                              </span>\r\n                            )}\r\n                            {answer.id === userAnswerId && !answer.isCorrect && (\r\n                              <span className=\"ml-auto text-red-600 font-medium\">\r\n                                Your Answer\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    \r\n                    {question.explanation && (\r\n                      <div className=\"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n                        <span className=\"font-medium text-blue-800\">Explanation: </span>\r\n                        <SafeHTML content={question.explanation} className=\"text-blue-700\" />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Leaderboard */}\r\n        <div className=\"bg-white rounded-2xl shadow-xl p-8 mb-8\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">üèÜ Leaderboard</h2>\r\n          {loadingStats ? (\r\n            <div className=\"flex justify-center items-center h-24\">\r\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n              <span className=\"ml-3 text-gray-600\">Loading leaderboard...</span>\r\n            </div>\r\n          ) : leaderboard.length > 0 ? (\r\n            <div className=\"space-y-3\">\r\n              {leaderboard.map((entry, index) => (\r\n                <div \r\n                  key={entry.id}\r\n                  className={`flex items-center justify-between p-4 rounded-lg border ${\r\n                    entry.userId === user?.uid \r\n                      ? 'bg-blue-50 border-blue-200 shadow-md' \r\n                      : 'bg-gray-50 border-gray-200'\r\n                  }`}\r\n                >\r\n                  <div className=\"flex items-center space-x-4\">\r\n                    <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm ${\r\n                      index === 0 ? 'bg-yellow-400 text-yellow-900' :\r\n                      index === 1 ? 'bg-gray-300 text-gray-700' :\r\n                      index === 2 ? 'bg-amber-600 text-amber-100' :\r\n                      'bg-gray-200 text-gray-600'\r\n                    }`}>\r\n                      {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : index + 1}\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"font-medium text-gray-900\">\r\n                        {entry.userName}\r\n                        {entry.userId === user?.uid && <span className=\"text-blue-600 ml-2\">(You)</span>}\r\n                      </div>\r\n                      <div className=\"text-sm text-gray-500\">\r\n                        {entry.correctAnswers}/{entry.totalQuestions} correct\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-right\">\r\n                    <div className=\"font-bold text-xl text-gray-900\">{safeNumber(entry.score)}%</div>\r\n                    <div className=\"text-sm text-gray-500\">\r\n                      ‚è±Ô∏è {formatTime(safeNumber(entry.timeSpent))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n              \r\n              {/* Show user rank if not in top 10 */}\r\n              {user && userRank && userRank > 10 && (\r\n                <div className=\"mt-6 pt-4 border-t border-gray-200\">\r\n                  <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n                    <div className=\"text-center\">\r\n                      <span className=\"text-blue-800 font-medium\">Your Rank: #{userRank}</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-12 text-gray-500\">\r\n              <div className=\"text-6xl mb-4\">üèÜ</div>\r\n              <p className=\"text-lg\">No results yet!</p>\r\n              <p>Be the first to complete this quiz and claim the top spot!</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Quiz Review Section */}\r\n        {quiz && (\r\n          <div className=\"mb-8\">\r\n            <QuickReviewSection \r\n              quizId={quiz.id} \r\n              quizTitle={quiz.title}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {/* Action Buttons */}\r\n        <div className=\"flex flex-wrap gap-4 justify-center\">\r\n          <Button\r\n            onClick={() => navigate(`/quiz/${quiz.id}`)}\r\n            className=\"bg-blue-600 hover:bg-blue-700\"\r\n          >\r\n            Retake Quiz\r\n          </Button>\r\n          \r\n          <Button\r\n            onClick={() => navigate('/quizzes')}\r\n            variant=\"outline\"\r\n          >\r\n            More Quizzes\r\n          </Button>\r\n          \r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() => {\r\n              // Share functionality\r\n              navigator.clipboard.writeText(\r\n                `I scored ${percentage}% on \"${quiz.title}\" quiz! üéØ`\r\n              );\r\n              toast.success('Result copied to clipboard!');\r\n            }}\r\n          >\r\n            Share Result\r\n          </Button>\r\n          \r\n          <Button\r\n            onClick={() => navigate('/profile')}\r\n            variant=\"outline\"\r\n          >\r\n            View All Results\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResultPage;\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\components\\ActionButtons.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\r\n        onClick={() => navigate(`/quiz/${quiz.id}`)}\r\n        className=\"bg-blue-600 hover:bg-blue-700\"\r\n      >\r\n        üîÑ L√†m l·∫°i Quiz\r\n      </Button>","line":27,"column":8,"nodeType":"JSXText","endLine":29,"endColumn":7},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\r\n        onClick={() => {\r\n          console.log('üìö Navigating to /quizzes...');\r\n          navigate('/quizzes');\r\n        }}\r\n        variant=\"outline\"\r\n      >\r\n        üìö Xem th√™m Quiz\r\n      </Button>","line":38,"column":8,"nodeType":"JSXText","endLine":40,"endColumn":7},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\r\n        onClick={() => navigate('/dashboard')}\r\n        variant=\"outline\"\r\n      >\r\n        üè† V·ªÅ Dashboard\r\n      </Button>","line":45,"column":8,"nodeType":"JSXText","endLine":47,"endColumn":7},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\r\n        variant=\"outline\"\r\n        onClick={handleShareResult}\r\n      >\r\n        üì§ Chia s·∫ª k·∫øt qu·∫£\r\n      </Button>","line":52,"column":8,"nodeType":"JSXText","endLine":54,"endColumn":7},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\r\n        onClick={() => navigate('/profile')}\r\n        variant=\"outline\"\r\n      >\r\n        üë§ Xem t·∫•t c·∫£ k·∫øt qu·∫£\r\n      </Button>","line":59,"column":8,"nodeType":"JSXText","endLine":61,"endColumn":7}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Quiz } from '../../../types';\r\nimport Button from '../../../../../shared/components/ui/Button';\r\nimport { toast } from 'react-toastify';\r\n\r\ninterface ActionButtonsProps {\r\n  quiz: Quiz;\r\n  percentage: number;\r\n}\r\n\r\nexport const ActionButtons: React.FC<ActionButtonsProps> = ({ quiz, percentage }) => {\r\n  const navigate = useNavigate();\r\n\r\n  const handleShareResult = () => {\r\n    navigator.clipboard.writeText(\r\n      `I scored ${percentage}% on \"${quiz.title}\" quiz! üéØ`\r\n    );\r\n    toast.success('Result copied to clipboard!');\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-wrap gap-4 justify-center\">\r\n      <Button\r\n        onClick={() => navigate(`/quiz/${quiz.id}`)}\r\n        className=\"bg-blue-600 hover:bg-blue-700\"\r\n      >\r\n        üîÑ L√†m l·∫°i Quiz\r\n      </Button>\r\n\r\n\r\n      <Button\r\n        onClick={() => {\r\n          console.log('üìö Navigating to /quizzes...');\r\n          navigate('/quizzes');\r\n        }}\r\n        variant=\"outline\"\r\n      >\r\n        üìö Xem th√™m Quiz\r\n      </Button>\r\n      \r\n      <Button\r\n        onClick={() => navigate('/dashboard')}\r\n        variant=\"outline\"\r\n      >\r\n        üè† V·ªÅ Dashboard\r\n      </Button>\r\n      \r\n      <Button\r\n        variant=\"outline\"\r\n        onClick={handleShareResult}\r\n      >\r\n        üì§ Chia s·∫ª k·∫øt qu·∫£\r\n      </Button>\r\n      \r\n      <Button\r\n        onClick={() => navigate('/profile')}\r\n        variant=\"outline\"\r\n      >\r\n        üë§ Xem t·∫•t c·∫£ k·∫øt qu·∫£\r\n      </Button>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\components\\AnswerReview.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-xl font-bold text-gray-900\">Review Answers</h2>","line":19,"column":57,"nodeType":"JSXText","endLine":19,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\r\n          variant=\"outline\"\r\n          onClick={() => setShowAnswers(!showAnswers)}\r\n        >\r\n          {showAnswers ? 'Hide' : 'Show'} Detailed Review\r\n        </Button>","line":24,"column":42,"nodeType":"JSXText","endLine":25,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium text-blue-800\">C√¢u tr·∫£ l·ªùi c·ªßa b·∫°n: </span>","line":90,"column":63,"nodeType":"JSXText","endLine":90,"endColumn":84},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-auto text-green-600 font-medium\">\r\n                              ‚úì Correct Answer\r\n                            </span>","line":114,"column":82,"nodeType":"JSXText","endLine":116,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-auto text-red-600 font-medium\">\r\n                              Your Answer\r\n                            </span>","line":119,"column":80,"nodeType":"JSXText","endLine":121,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-auto text-green-600 font-medium\">\r\n                                ‚úì Should Select\r\n                              </span>","line":152,"column":84,"nodeType":"JSXText","endLine":154,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-auto text-red-600 font-medium\">\r\n                                Wrong Selection\r\n                              </span>","line":157,"column":82,"nodeType":"JSXText","endLine":159,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-auto text-green-600 font-medium\">\r\n                                ‚úì Correct Selection\r\n                              </span>","line":162,"column":84,"nodeType":"JSXText","endLine":164,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium text-green-800\">ƒê√°p √°n ƒë√∫ng: </span>","line":177,"column":68,"nodeType":"JSXText","endLine":177,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm\"> (ho·∫∑c: {question.acceptedAnswers.join(', ')})</span>","line":181,"column":53,"nodeType":"JSXText","endLine":181,"endColumn":61},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium text-blue-800\">Explanation: </span>","line":190,"column":65,"nodeType":"JSXText","endLine":190,"endColumn":78}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Quiz } from '../../../types';\r\nimport { ResultState } from '../types';\r\nimport Button from '../../../../../shared/components/ui/Button';\r\nimport SafeHTML from '../../../../../shared/components/ui/SafeHTML';\r\n\r\n\r\ninterface AnswerReviewProps {\r\n  quiz: Quiz;\r\n  result: ResultState;\r\n}\r\n\r\nexport const AnswerReview: React.FC<AnswerReviewProps> = ({ quiz, result }) => {\r\n  const [showAnswers, setShowAnswers] = useState(false);\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-xl shadow-lg p-6 mb-8\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <h2 className=\"text-xl font-bold text-gray-900\">Review Answers</h2>\r\n        <Button\r\n          variant=\"outline\"\r\n          onClick={() => setShowAnswers(!showAnswers)}\r\n        >\r\n          {showAnswers ? 'Hide' : 'Show'} Detailed Review\r\n        </Button>\r\n      </div>\r\n\r\n      {showAnswers && (\r\n        <div className=\"space-y-6\">\r\n          {quiz.questions.map((question, index) => {\r\n            const userAnswerValue = result.answers[question.id];\r\n            \r\n            // Logic ƒë·ªÉ x√°c ƒë·ªãnh ƒë√°p √°n ƒë√∫ng sai d·ª±a tr√™n lo·∫°i c√¢u h·ªèi\r\n            let isCorrect = false;\r\n            let userAnswerText = '';\r\n            \r\n            switch (question.type) {\r\n              case 'boolean':\r\n              case 'multiple':\r\n              case 'image': {\r\n                const userAnswer = question.answers.find(a => a.id === userAnswerValue);\r\n                isCorrect = userAnswer?.isCorrect || false;\r\n                userAnswerText = userAnswer?.text || 'Ch∆∞a tr·∫£ l·ªùi';\r\n                break;\r\n              }\r\n              case 'short_answer': {\r\n                // Import checkShortAnswer function ho·∫∑c t√≠nh to√°n t·∫°i ƒë√¢y\r\n                const normalizeAnswer = (answer: string) => \r\n                  answer.trim().toLowerCase().replace(/\\s+/g, ' ');\r\n                \r\n                const normalizedUserAnswer = normalizeAnswer(userAnswerValue || '');\r\n                \r\n                if (question.correctAnswer && normalizeAnswer(question.correctAnswer) === normalizedUserAnswer) {\r\n                  isCorrect = true;\r\n                } else if (question.acceptedAnswers) {\r\n                  isCorrect = question.acceptedAnswers.some(accepted => \r\n                    normalizeAnswer(accepted) === normalizedUserAnswer\r\n                  );\r\n                }\r\n                userAnswerText = userAnswerValue || 'Ch∆∞a tr·∫£ l·ªùi';\r\n                break;\r\n              }\r\n              case 'checkbox': {\r\n                const correctIds = question.answers.filter(a => a.isCorrect).map(a => a.id).sort();\r\n                const userIds = Array.isArray(userAnswerValue) ? [...userAnswerValue].sort() : [];\r\n                isCorrect = JSON.stringify(correctIds) === JSON.stringify(userIds);\r\n                const selectedAnswers = question.answers.filter(a => userIds.includes(a.id));\r\n                userAnswerText = selectedAnswers.length > 0 \r\n                  ? selectedAnswers.map(a => a.text).join(', ')\r\n                  : 'Ch∆∞a tr·∫£ l·ªùi';\r\n                break;\r\n              }\r\n            }\r\n\r\n            return (\r\n              <div key={question.id} className=\"border border-gray-200 rounded-lg p-4\">\r\n                <div className=\"flex items-start justify-between mb-3\">\r\n                  <h3 className=\"text-lg font-medium text-gray-900\">\r\n                    {index + 1}. {question.text}\r\n                  </h3>\r\n                  <span className={`px-3 py-1 rounded-full text-sm font-medium ${\r\n                    isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'\r\n                  }`}>\r\n                    {isCorrect ? '‚úì Correct' : '‚úó Incorrect'}\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Hi·ªÉn th·ªã c√¢u tr·∫£ l·ªùi c·ªßa user */}\r\n                <div className=\"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n                  <span className=\"font-medium text-blue-800\">C√¢u tr·∫£ l·ªùi c·ªßa b·∫°n: </span>\r\n                  <span className=\"text-blue-700\">{userAnswerText}</span>\r\n                </div>\r\n                \r\n                {/* Hi·ªÉn th·ªã ƒë√°p √°n cho multiple choice, image v√† boolean */}\r\n                {(question.type === 'multiple' || question.type === 'image' || question.type === 'boolean') && (\r\n                  <div className=\"space-y-2\">\r\n                    {question.answers.map(answer => (\r\n                      <div\r\n                        key={answer.id}\r\n                        className={`p-3 rounded-lg border ${\r\n                          answer.isCorrect \r\n                            ? 'border-green-300 bg-green-50' \r\n                            : answer.id === userAnswerValue \r\n                            ? 'border-red-300 bg-red-50'\r\n                            : 'border-gray-200 bg-gray-50'\r\n                        }`}\r\n                      >\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"font-medium mr-3\">\r\n                            {String.fromCharCode(65 + question.answers.indexOf(answer))}.\r\n                          </span>\r\n                          <span>{answer.text}</span>\r\n                          {answer.isCorrect && (\r\n                            <span className=\"ml-auto text-green-600 font-medium\">\r\n                              ‚úì Correct Answer\r\n                            </span>\r\n                          )}\r\n                          {answer.id === userAnswerValue && !answer.isCorrect && (\r\n                            <span className=\"ml-auto text-red-600 font-medium\">\r\n                              Your Answer\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n                {/* Hi·ªÉn th·ªã ƒë√°p √°n cho checkbox */}\r\n                {question.type === 'checkbox' && (\r\n                  <div className=\"space-y-2\">\r\n                    {question.answers.map(answer => {\r\n                      const userSelectedIds: string[] = Array.isArray(userAnswerValue) ? userAnswerValue : [];\r\n                      const isUserSelected = userSelectedIds.includes(answer.id);\r\n                      \r\n                      return (\r\n                        <div\r\n                          key={answer.id}\r\n                          className={`p-3 rounded-lg border ${\r\n                            answer.isCorrect \r\n                              ? 'border-green-300 bg-green-50' \r\n                              : isUserSelected \r\n                              ? 'border-red-300 bg-red-50'\r\n                              : 'border-gray-200 bg-gray-50'\r\n                          }`}\r\n                        >\r\n                          <div className=\"flex items-center\">\r\n                            <span className=\"font-medium mr-3\">\r\n                              {String.fromCharCode(65 + question.answers.indexOf(answer))}.\r\n                            </span>\r\n                            <span>{answer.text}</span>\r\n                            {answer.isCorrect && (\r\n                              <span className=\"ml-auto text-green-600 font-medium\">\r\n                                ‚úì Should Select\r\n                              </span>\r\n                            )}\r\n                            {isUserSelected && !answer.isCorrect && (\r\n                              <span className=\"ml-auto text-red-600 font-medium\">\r\n                                Wrong Selection\r\n                              </span>\r\n                            )}\r\n                            {isUserSelected && answer.isCorrect && (\r\n                              <span className=\"ml-auto text-green-600 font-medium\">\r\n                                ‚úì Correct Selection\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                )}\r\n\r\n                {/* Hi·ªÉn th·ªã ƒë√°p √°n cho short answer */}\r\n                {question.type === 'short_answer' && (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"p-3 bg-green-50 border border-green-200 rounded-lg\">\r\n                      <span className=\"font-medium text-green-800\">ƒê√°p √°n ƒë√∫ng: </span>\r\n                      <span className=\"text-green-700\">\r\n                        {question.correctAnswer}\r\n                        {question.acceptedAnswers && question.acceptedAnswers.length > 0 && (\r\n                          <span className=\"text-sm\"> (ho·∫∑c: {question.acceptedAnswers.join(', ')})</span>\r\n                        )}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {question.explanation && (\r\n                  <div className=\"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n                    <span className=\"font-medium text-blue-800\">Explanation: </span>\r\n                    <SafeHTML content={question.explanation} className=\"text-blue-700\" />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\components\\Confetti.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\components\\Leaderboard.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">üèÜ Leaderboard</h2>","line":31,"column":61,"nodeType":"JSXText","endLine":31,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-white ml-2 font-bold bg-gradient-to-r from-green-500 to-emerald-600 px-3 py-1 rounded-full text-sm shadow-lg animate-pulse\">\r\n                          ÔøΩ L∆Ø·ª¢T M·ªöI NH·∫§T - X·∫æP H·∫†NG #{index + 1}\r\n                        </span>","line":63,"column":171,"nodeType":"JSXText","endLine":64,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-500 ml-2 text-sm\">(L∆∞·ª£t tr∆∞·ªõc ƒë√≥)</span>","line":69,"column":68,"nodeType":"JSXText","endLine":69,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-500\">\r\n                    {entry.correctAnswers}/{entry.totalQuestions} correct\r\n                  </div>","line":73,"column":66,"nodeType":"JSXText","endLine":74,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-gray-500\">\r\n                  ‚è±Ô∏è {formatDetailedTime(safeNumber(entry.timeSpent))}\r\n                </div>","line":82,"column":56,"nodeType":"JSXText","endLine":83,"endColumn":22},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-blue-800 font-medium\">Your Rank: #{userRank}</span>","line":94,"column":63,"nodeType":"JSXText","endLine":94,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-lg\">No results yet!</p>","line":103,"column":34,"nodeType":"JSXText","endLine":103,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Be the first to complete this quiz and claim the top spot!</p>","line":104,"column":14,"nodeType":"JSXText","endLine":104,"endColumn":72}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../../../lib/store';\r\nimport { LeaderboardEntry } from '../types';\r\nimport { safeNumber, formatDetailedTime, formatDateTime, getRankDisplay, getRankBackgroundColor } from '../utils';\r\n\r\ninterface LeaderboardProps {\r\n  leaderboard: LeaderboardEntry[];\r\n  userRank: number | null;\r\n  loadingStats: boolean;\r\n}\r\n\r\nexport const Leaderboard: React.FC<LeaderboardProps> = ({ \r\n  leaderboard, \r\n  userRank, \r\n  loadingStats \r\n}) => {\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n\r\n  // Debug logging\r\n  console.log('üèÜ Leaderboard render:', {\r\n    leaderboardLength: leaderboard.length,\r\n    loadingStats,\r\n    userRank,\r\n    hasUser: !!user,\r\n    leaderboard: leaderboard.slice(0, 3) // Show first 3 entries for debug\r\n  });\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-2xl shadow-xl p-8 mb-8\">\r\n      <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">üèÜ Leaderboard</h2>\r\n      {loadingStats ? (\r\n        <div className=\"flex justify-center items-center h-24\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n          <span className=\"ml-3 text-gray-600\">Loading leaderboard...</span>\r\n        </div>\r\n      ) : leaderboard.length > 0 ? (\r\n        <div className=\"space-y-3\">\r\n          {leaderboard.map((entry, index) => (\r\n            <div \r\n              key={entry.id}\r\n              className={`flex items-center justify-between p-4 rounded-lg border ${\r\n                entry.id === 'current-attempt'\r\n                  ? 'bg-gradient-to-r from-green-50 via-emerald-50 to-green-50 border-green-400 shadow-xl ring-4 ring-green-200 ring-opacity-50' \r\n                  : entry.userId === user?.uid \r\n                    ? 'bg-blue-50 border-blue-200 shadow-md' \r\n                    : 'bg-gray-50 border-gray-200'\r\n              }`}\r\n            >\r\n              <div className=\"flex items-center space-x-4\">\r\n                <div className={`w-12 h-12 rounded-full flex items-center justify-center font-bold text-sm ${\r\n                  entry.id === 'current-attempt' \r\n                    ? 'bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-lg transform scale-110' \r\n                    : getRankBackgroundColor(index)\r\n                }`}>\r\n                  {entry.id === 'current-attempt' ? 'ÔøΩ' : getRankDisplay(index)}\r\n                </div>\r\n                <div>\r\n                  <div className=\"font-medium text-gray-900\">\r\n                    {entry.userName}\r\n                    {entry.id === 'current-attempt' && (\r\n                      <div className=\"flex items-center mt-1\">\r\n                        <span className=\"text-white ml-2 font-bold bg-gradient-to-r from-green-500 to-emerald-600 px-3 py-1 rounded-full text-sm shadow-lg animate-pulse\">\r\n                          ÔøΩ L∆Ø·ª¢T M·ªöI NH·∫§T - X·∫æP H·∫†NG #{index + 1}\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                    {entry.userId === user?.uid && entry.id !== 'current-attempt' && (\r\n                      <span className=\"text-gray-500 ml-2 text-sm\">(L∆∞·ª£t tr∆∞·ªõc ƒë√≥)</span>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"text-sm text-gray-500\">\r\n                    {entry.correctAnswers}/{entry.totalQuestions} correct\r\n                  </div>\r\n                  <div className=\"text-xs text-gray-400 mt-1\">\r\n                    üìÖ {formatDateTime(entry.completedAt instanceof Date ? entry.completedAt.getTime() : new Date(entry.completedAt).getTime())}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <div className=\"font-bold text-xl text-gray-900\">{safeNumber(entry.score)}%</div>\r\n                <div className=\"text-sm text-gray-500\">\r\n                  ‚è±Ô∏è {formatDetailedTime(safeNumber(entry.timeSpent))}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n          \r\n          {/* Show user rank if not in top 10 */}\r\n          {user && userRank && userRank > 10 && (\r\n            <div className=\"mt-6 pt-4 border-t border-gray-200\">\r\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n                <div className=\"text-center\">\r\n                  <span className=\"text-blue-800 font-medium\">Your Rank: #{userRank}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div className=\"text-center py-12 text-gray-500\">\r\n          <div className=\"text-6xl mb-4\">üèÜ</div>\r\n          <p className=\"text-lg\">No results yet!</p>\r\n          <p>Be the first to complete this quiz and claim the top spot!</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\components\\LoadingSpinner.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={() => navigate('/quiz-list')}>\r\n          Back to Quiz List\r\n        </Button>","line":13,"column":56,"nodeType":"JSXText","endLine":15,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport Button from '../../../../../shared/components/ui/Button';\r\n\r\nexport const LoadingSpinner: React.FC = () => {\r\n  const navigate = useNavigate();\r\n\r\n  return (\r\n    <div className=\"flex items-center justify-center min-h-screen\">\r\n      <div className=\"text-center\">\r\n        <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mb-4\"></div>\r\n        <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Loading results...</h2>\r\n        <Button onClick={() => navigate('/quiz-list')}>\r\n          Back to Quiz List\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\components\\PerformanceAnalysis.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-xl font-bold text-gray-900 mb-4\">Performance Analysis</h2>","line":18,"column":60,"nodeType":"JSXText","endLine":18,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600\">Accuracy Rate</span>","line":22,"column":43,"nodeType":"JSXText","endLine":22,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600\">Quiz Difficulty</span>","line":35,"column":43,"nodeType":"JSXText","endLine":35,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-gray-600\">Time Management</span>","line":46,"column":43,"nodeType":"JSXText","endLine":46,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Quiz } from '../../../types';\r\nimport { ResultState } from '../types';\r\n\r\ninterface PerformanceAnalysisProps {\r\n  quiz: Quiz;\r\n  result: ResultState;\r\n  percentage: number;\r\n}\r\n\r\nexport const PerformanceAnalysis: React.FC<PerformanceAnalysisProps> = ({ \r\n  quiz, \r\n  result, \r\n  percentage \r\n}) => {\r\n  return (\r\n    <div className=\"bg-white rounded-xl shadow-lg p-6 mb-8\">\r\n      <h2 className=\"text-xl font-bold text-gray-900 mb-4\">Performance Analysis</h2>\r\n      \r\n      <div className=\"space-y-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span className=\"text-gray-600\">Accuracy Rate</span>\r\n          <div className=\"flex items-center\">\r\n            <div className=\"w-32 bg-gray-200 rounded-full h-2 mr-3\">\r\n              <div \r\n                className=\"bg-blue-500 h-2 rounded-full transition-all duration-1000\"\r\n                style={{ width: `${percentage}%` }}\r\n              ></div>\r\n            </div>\r\n            <span className=\"font-semibold\">{percentage}%</span>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center justify-between\">\r\n          <span className=\"text-gray-600\">Quiz Difficulty</span>\r\n          <span className={`px-3 py-1 rounded-full text-sm font-medium ${\r\n            quiz.difficulty === 'easy' ? 'bg-green-100 text-green-800' :\r\n            quiz.difficulty === 'medium' ? 'bg-yellow-100 text-yellow-800' :\r\n            'bg-red-100 text-red-800'\r\n          }`}>\r\n            {quiz.difficulty.charAt(0).toUpperCase() + quiz.difficulty.slice(1)}\r\n          </span>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center justify-between\">\r\n          <span className=\"text-gray-600\">Time Management</span>\r\n          <span className=\"font-semibold text-green-600\">\r\n            {result.isTimeUp ? 'Used full time' : 'Completed early'}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\components\\ResultSummary.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"bg-yellow-100 border border-yellow-300 text-yellow-800 px-4 py-3 rounded-lg mb-6\">\r\n            ‚è∞ Time's up! Quiz was automatically submitted.\r\n          </div>","line":23,"column":109,"nodeType":"JSXText","endLine":25,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-3xl font-bold text-gray-900 mt-4 mb-2\">\r\n            Quiz Completed!\r\n          </h1>","line":29,"column":70,"nodeType":"JSXText","endLine":31,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-lg text-gray-700 mb-2\">\r\n            You got <span className=\"font-bold text-blue-600\">{correct}</span> out of{' '}\r\n            <span className=\"font-bold\">{total}</span> questions correct\r\n          </div>","line":35,"column":55,"nodeType":"JSXText","endLine":36,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-lg text-gray-700 mb-2\">\r\n            You got <span className=\"font-bold text-blue-600\">{correct}</span> out of{' '}\r\n            <span className=\"font-bold\">{total}</span> questions correct\r\n          </div>","line":36,"column":79,"nodeType":"JSXText","endLine":36,"endColumn":86},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-lg text-gray-700 mb-2\">\r\n            You got <span className=\"font-bold text-blue-600\">{correct}</span> out of{' '}\r\n            <span className=\"font-bold\">{total}</span> questions correct\r\n          </div>","line":37,"column":55,"nodeType":"JSXText","endLine":38,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-md text-gray-500 mt-2\">\r\n              ‚è±Ô∏è Time taken: <span className=\"font-semibold text-blue-700\">{formatDetailedTime(safeNumber(result.timeSpent))}</span>\r\n            </div>","line":41,"column":57,"nodeType":"JSXText","endLine":42,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { ScoreCircle } from './ScoreCircle';\r\nimport { ResultState } from '../types';\r\nimport { getPerformanceMessage, formatDetailedTime, safeNumber } from '../utils';\r\n\r\ninterface ResultSummaryProps {\r\n  result: ResultState;\r\n  percentage: number;\r\n  correct: number;\r\n  total: number;\r\n}\r\n\r\nexport const ResultSummary: React.FC<ResultSummaryProps> = ({ \r\n  result, \r\n  percentage, \r\n  correct, \r\n  total \r\n}) => {\r\n  return (\r\n    <div className=\"text-center mb-8\">\r\n      <div className=\"bg-white rounded-2xl shadow-xl p-8 mb-6\">\r\n        {result.isTimeUp && (\r\n          <div className=\"bg-yellow-100 border border-yellow-300 text-yellow-800 px-4 py-3 rounded-lg mb-6\">\r\n            ‚è∞ Time's up! Quiz was automatically submitted.\r\n          </div>\r\n        )}\r\n        <div className=\"flex flex-col items-center\">\r\n          <ScoreCircle score={percentage} />\r\n          <h1 className=\"text-3xl font-bold text-gray-900 mt-4 mb-2\">\r\n            Quiz Completed!\r\n          </h1>\r\n          <p className=\"text-xl text-gray-600 mb-4\">\r\n            {getPerformanceMessage(percentage)}\r\n          </p>\r\n          <div className=\"text-lg text-gray-700 mb-2\">\r\n            You got <span className=\"font-bold text-blue-600\">{correct}</span> out of{' '}\r\n            <span className=\"font-bold\">{total}</span> questions correct\r\n          </div>\r\n          {/* Hi·ªÉn th·ªã th·ªùi gian l√†m b√†i - gi·ªëng y h·ªát Leaderboard */}\r\n          {typeof result.timeSpent === 'number' && (\r\n            <div className=\"text-md text-gray-500 mt-2\">\r\n              ‚è±Ô∏è Time taken: <span className=\"font-semibold text-blue-700\">{formatDetailedTime(safeNumber(result.timeSpent))}</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\components\\ScoreCircle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\components\\StatsGrid.tsx","messages":[{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-gray-600\">Correct Answers</div>","line":14,"column":40,"nodeType":"JSXText","endLine":14,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-gray-600\">Incorrect Answers</div>","line":19,"column":40,"nodeType":"JSXText","endLine":19,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-gray-600\">Final Score</div>","line":24,"column":40,"nodeType":"JSXText","endLine":24,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\ninterface StatsGridProps {\r\n  correct: number;\r\n  total: number;\r\n  percentage: number;\r\n}\r\n\r\nexport const StatsGrid: React.FC<StatsGridProps> = ({ correct, total, percentage }) => {\r\n  return (\r\n    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n      <div className=\"bg-white rounded-xl shadow-lg p-6 text-center\">\r\n        <div className=\"text-3xl font-bold text-green-600 mb-2\">{correct}</div>\r\n        <div className=\"text-gray-600\">Correct Answers</div>\r\n      </div>\r\n      \r\n      <div className=\"bg-white rounded-xl shadow-lg p-6 text-center\">\r\n        <div className=\"text-3xl font-bold text-red-600 mb-2\">{total - correct}</div>\r\n        <div className=\"text-gray-600\">Incorrect Answers</div>\r\n      </div>\r\n      \r\n      <div className=\"bg-white rounded-xl shadow-lg p-6 text-center\">\r\n        <div className=\"text-3xl font-bold text-blue-600 mb-2\">{percentage}%</div>\r\n        <div className=\"text-gray-600\">Final Score</div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\hooks\\useLeaderboard.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[304,307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[304,307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2136,2139],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2136,2139],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../../../lib/store';\r\nimport { toast } from 'react-toastify';\r\nimport { LeaderboardEntry } from '../types';\r\n\r\nexport const useLeaderboard = (quizId: string | null, currentResult?: any) => {\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const [leaderboard, setLeaderboard] = useState<LeaderboardEntry[]>([]);\r\n  const [userRank, setUserRank] = useState<number | null>(null);\r\n  const [loadingStats, setLoadingStats] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const fetchLeaderboard = async () => {\r\n      if (!quizId) return;\r\n      \r\n      try {\r\n        setLoadingStats(true);\r\n        console.log('üìä Fetching leaderboard for quiz:', quizId);\r\n        \r\n        // Fetch leaderboard from Firestore using quiz results\r\n        const { getQuizResults } = await import('../../../api/base');\r\n        const quizResults = await getQuizResults(quizId);\r\n        \r\n        console.log('üìä Raw quiz results:', quizResults);\r\n        \r\n        // Use only real data\r\n        const leaderboardData = quizResults;\r\n        \r\n        // Add current result to leaderboard if provided\r\n        if (currentResult && user) {\r\n          console.log('‚ûï Adding current result to leaderboard:', currentResult);\r\n          const currentEntry = {\r\n            id: 'current-attempt',\r\n            userId: user.uid,\r\n            userName: user.displayName || user.email?.split('@')[0] || 'B·∫°n',\r\n            userEmail: user.email || '',\r\n            quizId: quizId,\r\n            score: currentResult.score?.percentage || 0,\r\n            correctAnswers: currentResult.correct || 0,\r\n            totalQuestions: currentResult.total || 0,\r\n            timeSpent: currentResult.timeSpent || 0,\r\n            answers: [],\r\n            completedAt: new Date() // Just completed\r\n          };\r\n          leaderboardData.push(currentEntry);\r\n        }\r\n        \r\n        // Transform QuizResult data to LeaderboardEntry format\r\n        const transformedLeaderboard: LeaderboardEntry[] = leaderboardData.map((result: any) => ({\r\n          id: result.id,\r\n          userId: result.userId,\r\n          userName: result.userName,\r\n          userEmail: result.userEmail,\r\n          score: result.score,\r\n          correctAnswers: result.correctAnswers,\r\n          totalQuestions: result.totalQuestions,\r\n          timeSpent: result.timeSpent,\r\n          completedAt: result.completedAt instanceof Date ? result.completedAt : new Date(result.completedAt)\r\n        }));\r\n        \r\n        // Sort by score (descending) then by time (ascending) for same scores\r\n        const sortedLeaderboard = transformedLeaderboard.sort((a, b) => {\r\n          if (a.score !== b.score) {\r\n            return b.score - a.score; // Higher score first\r\n          }\r\n          return a.timeSpent - b.timeSpent; // Faster time first if same score\r\n        });\r\n\r\n        console.log('üìä Sorted leaderboard:', sortedLeaderboard);\r\n        setLeaderboard(sortedLeaderboard.slice(0, 10)); // Top 10\r\n\r\n        // Find current user's rank\r\n        if (user) {\r\n          const userResultIndex = sortedLeaderboard.findIndex((r: LeaderboardEntry) => r.userId === user.uid);\r\n          setUserRank(userResultIndex >= 0 ? userResultIndex + 1 : null);\r\n          console.log('üë§ User rank:', userResultIndex >= 0 ? userResultIndex + 1 : 'Not found');\r\n        }\r\n\r\n        console.log('üìä Leaderboard loaded:', sortedLeaderboard.length, 'entries');\r\n      } catch (error) {\r\n        console.error('‚ùå Failed to fetch leaderboard:', error);\r\n        toast.error('Kh√¥ng th·ªÉ t·∫£i b·∫£ng x·∫øp h·∫°ng!');\r\n      } finally {\r\n        setLoadingStats(false);\r\n      }\r\n    };\r\n\r\n    fetchLeaderboard();\r\n  }, [quizId, user, currentResult]);\r\n\r\n  return {\r\n    leaderboard,\r\n    userRank,\r\n    loadingStats\r\n  };\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\hooks\\useResultData.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3183,3186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3183,3186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":140,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":140,"endColumn":21,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6369,6369],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useParams, useLocation, useNavigate } from 'react-router-dom';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../../../../lib/store';\r\nimport { Quiz } from '../../../types';\r\nimport { getQuizById } from '../../../services/quiz';\r\nimport { toast } from 'react-toastify';\r\nimport { ResultState } from '../types';\r\nimport { getQuizResultById } from '../../../api/base';\r\n\r\nexport const useResultData = () => {\r\n  const { attemptId } = useParams<{ attemptId: string }>();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { quizzes } = useSelector((state: RootState) => state.quiz);\r\n  \r\n  const [result, setResult] = useState<ResultState | null>(location.state as ResultState || null);\r\n  const [quizId, setQuizId] = useState<string | null>(null);\r\n  const [quiz, setQuiz] = useState<Quiz | null>(null);\r\n\r\n  useEffect(() => {\r\n    console.log('üîç ResultPage useEffect - attemptId:', attemptId, 'location.state:', location.state);\r\n    console.log('üîç URL attemptId type and value:', typeof attemptId, attemptId);\r\n    console.log('üîç Current URL:', window.location.href);\r\n    \r\n    if (location.state) {\r\n      // C√≥ state t·ª´ navigation - s·ª≠ d·ª•ng ngay\r\n      const resultData = location.state as ResultState;\r\n      console.log('‚úÖ Using state from navigation:', resultData);\r\n      setResult(resultData);\r\n      setQuizId(resultData.quizId || attemptId || null);\r\n    } else if (attemptId) {\r\n      // Kh√¥ng c√≥ state, fetch t·ª´ Firestore b·∫±ng attemptId (quizResults doc id)\r\n      (async () => {\r\n        try {\r\n          console.log('üì° Fetching quizResult document for attemptId:', attemptId);\r\n          console.log('üì° This should be a Firestore document ID, not a quiz ID');\r\n          const raw = await getQuizResultById(attemptId);\r\n          if (!raw) {\r\n            console.error('‚ùå No quizResult found for attemptId:', attemptId);\r\n            console.error('‚ùå This might mean attemptId is not a valid Firestore document ID');\r\n            navigate('/quiz-list');\r\n            return;\r\n          }\r\n          // Map Firestore quizResult -> ResultState shape\r\n          const totalQuestions = (raw.totalQuestions ?? (raw.answers?.length || 0));\r\n          let correctAnswers = (raw.correctAnswers ?? 0);\r\n          // Heuristic: if correctAnswers missing/zero but score >0, derive from score percentage\r\n          if ((correctAnswers === 0 || correctAnswers === undefined) && typeof raw.score === 'number' && raw.score > 0 && totalQuestions > 0) {\r\n            const derived = Math.round(((raw.score <= 1 ? raw.score * 100 : raw.score) / 100) * totalQuestions);\r\n            console.log('üõ†Ô∏è Deriving correctAnswers from score since legacy record lacks it:', { derived, rawScore: raw.score, totalQuestions });\r\n            correctAnswers = derived;\r\n          }\r\n          const mapped: ResultState = {\r\n            score: typeof raw.score === 'number' ? (raw.score <= 1 ? raw.score * 100 : raw.score) : 0,\r\n            correct: correctAnswers,\r\n            total: totalQuestions,\r\n            answers: (raw.answers || []).reduce((acc: Record<string,string>, ans: any) => {\r\n              acc[ans.questionId] = ans.selectedAnswerId;\r\n              return acc;\r\n            }, {}),\r\n            timeSpent: raw.timeSpent,\r\n            quizId: raw.quizId\r\n          };\r\n          console.log('‚úÖ Mapped quizResult -> ResultState:', mapped);\r\n          setResult(mapped);\r\n          setQuizId(raw.quizId || null);\r\n        } catch (e) {\r\n          console.error('‚ùå Error fetching quiz result by attemptId:', e);\r\n          navigate('/quiz-list');\r\n        }\r\n      })();\r\n    } else {\r\n      console.error('‚ùå No attemptId or state provided');\r\n      navigate('/quiz-list');\r\n    }\r\n  }, [attemptId, location.state, navigate]);\r\n\r\n  useEffect(() => {\r\n    if (!quizId) return;\r\n    \r\n    console.log('üîç Looking for quiz with ID:', quizId);\r\n    const foundQuiz = quizzes.find(q => q.id === quizId);\r\n    \r\n    if (foundQuiz) {\r\n      console.log('‚úÖ Found quiz in store:', foundQuiz.title);\r\n      setQuiz(foundQuiz);\r\n    } else {\r\n      console.log('üì° Quiz not in store, fetching from Firestore...');\r\n      // N·∫øu kh√¥ng c√≥ trong store, fetch t·ª´ Firestore\r\n      getQuizById(quizId).then(qz => {\r\n        if (qz) {\r\n          console.log('‚úÖ Fetched quiz from Firestore:', qz.title);\r\n          setQuiz(qz);\r\n        } else {\r\n          console.error('‚ùå Quiz not found:', quizId);\r\n          toast.error('Kh√¥ng t√¨m th·∫•y quiz!');\r\n          navigate('/quiz-list');\r\n        }\r\n      }).catch(error => {\r\n        console.error('‚ùå Error fetching quiz:', error);\r\n        toast.error('Kh√¥ng th·ªÉ t·∫£i quiz!');\r\n        navigate('/quiz-list');\r\n      });\r\n    }\r\n  }, [quizId, quizzes, navigate]);\r\n\r\n  // Secondary reconciliation: once quiz loaded, if result.correct seems inconsistent with quiz + answers, recompute.\r\n  useEffect(() => {\r\n    if (!quiz || !result) return;\r\n    if (!quiz.questions?.length) return;\r\n    // Only attempt if (a) result.correct is 0 but score > 0 OR (b) percentage mismatch > 5%.\r\n    const currentPct = result.total > 0 ? (result.correct / result.total) * 100 : 0;\r\n    const storedPct = result.score;\r\n    const needsRecompute = (result.correct === 0 && storedPct > 0) || Math.abs(currentPct - storedPct) > 5;\r\n    if (!needsRecompute) return;\r\n    console.log('üõ†Ô∏è Recomputing correct count from quiz questions for legacy result');\r\n    // Build reverse map of user answers\r\n    const userAnswers = result.answers;\r\n    let computedCorrect = 0;\r\n    quiz.questions.forEach(q => {\r\n      const userVal = userAnswers[q.id];\r\n      if (userVal === undefined) return;\r\n      switch (q.type) {\r\n        case 'multiple':\r\n        case 'boolean':\r\n        case 'image': {\r\n          const correctId = q.answers.find(a => a.isCorrect)?.id;\r\n          if (userVal === correctId) computedCorrect++;\r\n          break;\r\n        }\r\n        case 'checkbox': {\r\n          try {\r\n            const parsed = JSON.parse(userVal);\r\n            if (Array.isArray(parsed)) {\r\n              const correctIds = q.answers.filter(a => a.isCorrect).map(a => a.id).sort();\r\n              const userIds = [...parsed].sort();\r\n              if (JSON.stringify(correctIds) === JSON.stringify(userIds)) computedCorrect++;\r\n            }\r\n          } catch {}\r\n          break;\r\n        }\r\n        case 'short_answer': {\r\n          // Simplistic: compare lowercased trimmed text with any correct answer text flagged isCorrect\r\n          const normalized = (val: string) => val?.trim().toLowerCase();\r\n          const userText = normalized(userVal);\r\n            const acceptable = q.answers.filter(a => a.isCorrect).map(a => normalized(a.text));\r\n            if (acceptable.includes(userText)) computedCorrect++;\r\n          break;\r\n        }\r\n      }\r\n    });\r\n    if (computedCorrect !== result.correct && result.total > 0) {\r\n      const recomputedScore = Math.round((computedCorrect / result.total) * 100);\r\n      console.log('‚úÖ Recomputed correctness for legacy result:', { computedCorrect, recomputedScore });\r\n      setResult(prev => prev ? { ...prev, correct: computedCorrect, score: recomputedScore } : prev);\r\n    }\r\n  }, [quiz, result]);\r\n\r\n  return {\r\n    result,\r\n    quiz,\r\n    quizId,\r\n    isLoading: !result || !quiz\r\n  };\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\pages\\ResultPage\\utils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1826,1829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1826,1829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Helper: format time (milliseconds or seconds) to mm:ss\r\nexport const formatTime = (time: number, isMilliseconds = true) => {\r\n  const seconds = isMilliseconds ? Math.floor(time / 1000) : time;\r\n  const m = Math.floor(seconds / 60);\r\n  const s = seconds % 60;\r\n  return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\r\n};\r\n\r\n// Helper: format detailed time with hours, minutes, seconds\r\nexport const formatDetailedTime = (seconds: number) => {\r\n  const hours = Math.floor(seconds / 3600);\r\n  const minutes = Math.floor((seconds % 3600) / 60);\r\n  const remainingSeconds = seconds % 60;\r\n  \r\n  if (hours > 0) {\r\n    return `${hours}h ${minutes}m ${remainingSeconds}s`;\r\n  } else if (minutes > 0) {\r\n    return `${minutes}m ${remainingSeconds}s`;\r\n  } else {\r\n    return `${remainingSeconds}s`;\r\n  }\r\n};\r\n\r\n// Helper: format date and time for leaderboard display\r\nexport const formatDateTime = (timestamp: number) => {\r\n  const date = new Date(timestamp);\r\n  const today = new Date();\r\n  const yesterday = new Date(today);\r\n  yesterday.setDate(yesterday.getDate() - 1);\r\n  \r\n  const isToday = date.toDateString() === today.toDateString();\r\n  const isYesterday = date.toDateString() === yesterday.toDateString();\r\n  \r\n  const timeString = date.toLocaleTimeString('vi-VN', {\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    second: '2-digit',\r\n    hour12: false\r\n  });\r\n  \r\n  if (isToday) {\r\n    return `H√¥m nay ${timeString}`;\r\n  } else if (isYesterday) {\r\n    return `H√¥m qua ${timeString}`;\r\n  } else {\r\n    return date.toLocaleString('vi-VN', {\r\n      day: '2-digit',\r\n      month: '2-digit',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      second: '2-digit',\r\n      hour12: false\r\n    });\r\n  }\r\n};\r\n\r\n// Helper: safe number conversion\r\nexport const safeNumber = (val: any, fallback = 0) => {\r\n  const n = Number(val);\r\n  return isNaN(n) ? fallback : n;\r\n};\r\n\r\n// Helper: get score color based on percentage\r\nexport const getScoreColor = (score: number) => {\r\n  if (score >= 80) return 'text-green-600';\r\n  if (score >= 60) return 'text-yellow-600';\r\n  return 'text-red-600';\r\n};\r\n\r\n// Helper: get performance message\r\nexport const getPerformanceMessage = (percentage: number) => {\r\n  if (percentage >= 90) return 'Outstanding! üèÜ';\r\n  if (percentage >= 80) return 'Excellent! üåü';\r\n  if (percentage >= 70) return 'Great Job! üëè';\r\n  if (percentage >= 60) return 'Good Work! üëç';\r\n  if (percentage >= 50) return 'Not Bad! üìö';\r\n  return 'Keep Practicing! üí™';\r\n};\r\n\r\n// Helper: get rank display with emoji\r\nexport const getRankDisplay = (index: number) => {\r\n  if (index === 0) return 'ü•á';\r\n  if (index === 1) return 'ü•à';\r\n  if (index === 2) return 'ü•â';\r\n  return index + 1;\r\n};\r\n\r\n// Helper: get rank background color\r\nexport const getRankBackgroundColor = (index: number) => {\r\n  if (index === 0) return 'bg-yellow-400 text-yellow-900';\r\n  if (index === 1) return 'bg-gray-300 text-gray-700';\r\n  if (index === 2) return 'bg-amber-600 text-amber-100';\r\n  return 'bg-gray-200 text-gray-600';\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services\\base.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services\\fileProcessingService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[377,380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[377,380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[496,499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[496,499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2354,2357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2354,2357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// File Processing Services\r\n// C√†i ƒë·∫∑t dependencies: npm install tesseract.js pdf-parse mammoth xlsx\r\n\r\nimport { createWorker } from 'tesseract.js';\r\nimport * as pdfjsLib from 'pdfjs-dist';\r\nimport mammoth from 'mammoth';\r\nimport * as XLSX from 'xlsx';\r\n\r\nexport interface FileProcessingResult {\r\n  extractedText: string;\r\n  success: boolean;\r\n  error?: string;\r\n  metadata?: any;\r\n}\r\n\r\n/**\r\n * OCR Service - Tr√≠ch xu·∫•t text t·ª´ h√¨nh ·∫£nh\r\n */\r\nexport class OCRService {\r\n  private static worker: any = null;\r\n\r\n  static async initializeWorker() {\r\n    if (!this.worker) {\r\n      this.worker = await createWorker();\r\n      await this.worker.loadLanguage('eng+vie');\r\n      await this.worker.initialize('eng+vie');\r\n    }\r\n    return this.worker;\r\n  }\r\n\r\n  static async extractTextFromImage(file: File): Promise<FileProcessingResult> {\r\n    try {\r\n      const worker = await this.initializeWorker();\r\n      \r\n      // ƒê·ªçc file th√†nh blob URL ƒë·ªÉ OCR\r\n      const imageUrl = URL.createObjectURL(file);\r\n      \r\n      const { data: { text, confidence } } = await worker.recognize(imageUrl);\r\n      \r\n      // Clean up\r\n      URL.revokeObjectURL(imageUrl);\r\n      \r\n      return {\r\n        extractedText: text,\r\n        success: true,\r\n        metadata: { confidence, fileSize: file.size }\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        extractedText: '',\r\n        success: false,\r\n        error: `OCR Error: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      };\r\n    }\r\n  }\r\n\r\n  static async terminateWorker() {\r\n    if (this.worker) {\r\n      await this.worker.terminate();\r\n      this.worker = null;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * PDF Service - Tr√≠ch xu·∫•t text t·ª´ PDF\r\n */\r\nexport class PDFService {\r\n  static async extractTextFromPDF(file: File): Promise<FileProcessingResult> {\r\n    try {\r\n      // ƒê·ªçc file PDF\r\n      const arrayBuffer = await file.arrayBuffer();\r\n      \r\n      // Load PDF document\r\n      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;\r\n      \r\n      let fullText = '';\r\n      const totalPages = pdf.numPages;\r\n      \r\n      // Tr√≠ch xu·∫•t text t·ª´ t·∫•t c·∫£ c√°c trang\r\n      for (let i = 1; i <= totalPages; i++) {\r\n        const page = await pdf.getPage(i);\r\n        const textContent = await page.getTextContent();\r\n        \r\n        const pageText = textContent.items\r\n          .map((item: any) => item.str)\r\n          .join(' ');\r\n        \r\n        fullText += `\\n--- Trang ${i} ---\\n${pageText}\\n`;\r\n      }\r\n      \r\n      return {\r\n        extractedText: fullText.trim(),\r\n        success: true,\r\n        metadata: { \r\n          totalPages, \r\n          fileSize: file.size,\r\n          fileName: file.name \r\n        }\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        extractedText: '',\r\n        success: false,\r\n        error: `PDF Error: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Word Document Service - Tr√≠ch xu·∫•t text t·ª´ .docx\r\n */\r\nexport class WordService {\r\n  static async extractTextFromWord(file: File): Promise<FileProcessingResult> {\r\n    try {\r\n      const arrayBuffer = await file.arrayBuffer();\r\n      \r\n      // S·ª≠ d·ª•ng mammoth ƒë·ªÉ ƒë·ªçc .docx\r\n      const result = await mammoth.extractRawText({ arrayBuffer });\r\n      \r\n      return {\r\n        extractedText: result.value,\r\n        success: true,\r\n        metadata: {\r\n          fileSize: file.size,\r\n          fileName: file.name,\r\n          messages: result.messages // Warnings t·ª´ mammoth\r\n        }\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        extractedText: '',\r\n        success: false,\r\n        error: `Word Error: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Excel/Spreadsheet Service - Tr√≠ch xu·∫•t data t·ª´ Excel/CSV\r\n */\r\nexport class SpreadsheetService {\r\n  static async extractTextFromSpreadsheet(file: File): Promise<FileProcessingResult> {\r\n    try {\r\n      const arrayBuffer = await file.arrayBuffer();\r\n      const workbook = XLSX.read(arrayBuffer, { type: 'array' });\r\n      \r\n      let fullText = '';\r\n      \r\n      // ƒê·ªçc t·∫•t c·∫£ worksheets\r\n      workbook.SheetNames.forEach(sheetName => {\r\n        const worksheet = workbook.Sheets[sheetName];\r\n        const csvText = XLSX.utils.sheet_to_csv(worksheet);\r\n        fullText += `\\n=== Sheet: ${sheetName} ===\\n${csvText}\\n`;\r\n      });\r\n      \r\n      return {\r\n        extractedText: fullText.trim(),\r\n        success: true,\r\n        metadata: {\r\n          fileSize: file.size,\r\n          fileName: file.name,\r\n          sheetCount: workbook.SheetNames.length,\r\n          sheetNames: workbook.SheetNames\r\n        }\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        extractedText: '',\r\n        success: false,\r\n        error: `Spreadsheet Error: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Text File Service - ƒê·ªçc plain text files\r\n */\r\nexport class TextService {\r\n  static async extractTextFromTextFile(file: File): Promise<FileProcessingResult> {\r\n    try {\r\n      const text = await file.text();\r\n      \r\n      return {\r\n        extractedText: text,\r\n        success: true,\r\n        metadata: {\r\n          fileSize: file.size,\r\n          fileName: file.name\r\n        }\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        extractedText: '',\r\n        success: false,\r\n        error: `Text Error: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Main File Processor - Router ƒë·ªÉ x·ª≠ l√Ω c√°c lo·∫°i file kh√°c nhau\r\n */\r\nexport class FileProcessor {\r\n  static getSupportedTypes() {\r\n    return {\r\n      images: ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp'],\r\n      documents: ['.pdf', '.doc', '.docx', '.txt', '.rtf'],\r\n      spreadsheets: ['.csv', '.xlsx', '.xls']\r\n    };\r\n  }\r\n\r\n  static isFileSupported(fileName: string): boolean {\r\n    const lowercaseName = fileName.toLowerCase();\r\n    const supportedTypes = this.getSupportedTypes();\r\n    \r\n    return Object.values(supportedTypes)\r\n      .flat()\r\n      .some(ext => lowercaseName.endsWith(ext));\r\n  }\r\n\r\n  static async processFile(file: File): Promise<FileProcessingResult> {\r\n    const fileName = file.name.toLowerCase();\r\n    const supportedTypes = this.getSupportedTypes();\r\n    \r\n    try {\r\n      // Check file size (limit 50MB)\r\n      if (file.size > 50 * 1024 * 1024) {\r\n        return {\r\n          extractedText: '',\r\n          success: false,\r\n          error: 'File qu√° l·ªõn. Vui l√≤ng ch·ªçn file nh·ªè h∆°n 50MB.'\r\n        };\r\n      }\r\n\r\n      // Route to appropriate service\r\n      if (supportedTypes.images.some(ext => fileName.endsWith(ext))) {\r\n        return await OCRService.extractTextFromImage(file);\r\n      }\r\n      \r\n      if (fileName.endsWith('.pdf')) {\r\n        return await PDFService.extractTextFromPDF(file);\r\n      }\r\n      \r\n      if (fileName.endsWith('.docx') || fileName.endsWith('.doc')) {\r\n        return await WordService.extractTextFromWord(file);\r\n      }\r\n      \r\n      if (supportedTypes.spreadsheets.some(ext => fileName.endsWith(ext))) {\r\n        return await SpreadsheetService.extractTextFromSpreadsheet(file);\r\n      }\r\n      \r\n      if (fileName.endsWith('.txt') || fileName.endsWith('.rtf')) {\r\n        return await TextService.extractTextFromTextFile(file);\r\n      }\r\n      \r\n      return {\r\n        extractedText: '',\r\n        success: false,\r\n        error: 'ƒê·ªãnh d·∫°ng file kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£.'\r\n      };\r\n      \r\n    } catch (error) {\r\n      return {\r\n        extractedText: '',\r\n        success: false,\r\n        error: `Processing Error: ${error instanceof Error ? error.message : 'Unknown error'}`\r\n      };\r\n    }\r\n  }\r\n\r\n  // Cleanup resources\r\n  static async cleanup() {\r\n    await OCRService.terminateWorker();\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services\\firebaseAIService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1912,1915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1912,1915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3620,3623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3620,3623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3993,3996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3993,3996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Firebase AI Service using Google Generative AI (Gemini)\r\n// Service ƒë·ªÉ t·∫°o c√¢u h·ªèi t·ª± ƒë·ªông b·∫±ng AI\r\n\r\nimport { Question } from '../types';\r\nimport { getFunctions, httpsCallable } from 'firebase/functions';\r\nimport { getAuth } from 'firebase/auth';\r\n\r\nexport interface FirebaseAIConfig {\r\n  model?: 'gemini-2.0-flash-exp' | 'gemini-pro' | 'gemini-pro-vision';\r\n  temperature?: number;\r\n  maxTokens?: number;\r\n}\r\n\r\nexport interface QuestionGenerationOptions {\r\n  content: string;\r\n  customPrompt?: string;\r\n  numQuestions?: number;\r\n  difficulty?: 'easy' | 'medium' | 'hard' | 'mixed';\r\n  language?: 'vi' | 'en';\r\n  questionTypes?: ('multiple' | 'true-false' | 'fill-in-blank')[];\r\n}\r\n\r\n/**\r\n * Firebase AI Service using Google Generative AI (Gemini)\r\n */\r\nexport class FirebaseAIService {\r\n  private static functions = getFunctions();\r\n  \r\n  static async generateQuestions(\r\n    config: FirebaseAIConfig = {},\r\n    options: QuestionGenerationOptions\r\n  ): Promise<Question[]> {\r\n    const { \r\n      content, \r\n      customPrompt, \r\n      numQuestions = 5, \r\n      difficulty = 'mixed', \r\n      language = 'vi' \r\n    } = options;\r\n\r\n    // Ki·ªÉm tra x√°c th·ª±c\r\n    const auth = getAuth();\r\n    if (!auth.currentUser) {\r\n      throw new Error('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng AI');\r\n    }\r\n\r\n    try {\r\n      // T·∫°o system prompt\r\n      const systemPrompt = customPrompt || this.getDefaultPrompt(numQuestions, difficulty, language);\r\n      \r\n      // G·ªçi Firebase Function\r\n      const generateQuestions = httpsCallable(this.functions, 'generateQuestions');\r\n      \r\n      const result = await generateQuestions({\r\n        prompt: systemPrompt,\r\n        content: content,\r\n        config: {\r\n          model: config.model || 'gemini-2.0-flash-exp',\r\n          temperature: config.temperature || 0.7,\r\n          maxTokens: config.maxTokens || 2000\r\n        }\r\n      });\r\n\r\n      const data = result.data as any;\r\n      \r\n      if (!data.success) {\r\n        throw new Error(data.error || 'AI generation failed');\r\n      }\r\n\r\n      return this.parseQuestionsFromResponse(data.questions);\r\n    } catch (error) {\r\n      console.error('Firebase AI Service Error:', error);\r\n      throw new Error(`Kh√¥ng th·ªÉ t·∫°o c√¢u h·ªèi: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * T·∫°o prompt m·∫∑c ƒë·ªãnh cho vi·ªác generate c√¢u h·ªèi\r\n   */\r\n  private static getDefaultPrompt(numQuestions: number, difficulty: string, language: string): string {\r\n    const lang = language === 'vi' ? 'ti·∫øng Vi·ªát' : 'English';\r\n    \r\n    return `\r\nB·∫°n l√† m·ªôt chuy√™n gia t·∫°o c√¢u h·ªèi tr·∫Øc nghi·ªám ch·∫•t l∆∞·ª£ng cao. H√£y t·∫°o ${numQuestions} c√¢u h·ªèi tr·∫Øc nghi·ªám b·∫±ng ${lang} d·ª±a tr√™n n·ªôi dung ƒë∆∞·ª£c cung c·∫•p.\r\n\r\nY√™u c·∫ßu:\r\n- M·ªói c√¢u h·ªèi c√≥ 4 ƒë√°p √°n (A, B, C, D)\r\n- Ch·ªâ c√≥ 1 ƒë√°p √°n ƒë√∫ng\r\n- C√¢u h·ªèi ph·∫£i li√™n quan tr·ª±c ti·∫øp ƒë·∫øn n·ªôi dung\r\n- ƒê·ªô kh√≥: ${difficulty}\r\n- Bao g·ªìm gi·∫£i th√≠ch cho ƒë√°p √°n ƒë√∫ng\r\n- ƒê·∫£m b·∫£o c√¢u h·ªèi c√≥ t√≠nh ph√¢n bi·ªát cao\r\n\r\nTr·∫£ v·ªÅ ƒë·ªãnh d·∫°ng JSON ch√≠nh x√°c nh∆∞ sau:\r\n{\r\n  \"questions\": [\r\n    {\r\n      \"text\": \"C√¢u h·ªèi ·ªü ƒë√¢y\",\r\n      \"answers\": [\r\n        {\"text\": \"ƒê√°p √°n A\", \"isCorrect\": true},\r\n        {\"text\": \"ƒê√°p √°n B\", \"isCorrect\": false},\r\n        {\"text\": \"ƒê√°p √°n C\", \"isCorrect\": false},\r\n        {\"text\": \"ƒê√°p √°n D\", \"isCorrect\": false}\r\n      ],\r\n      \"explanation\": \"Gi·∫£i th√≠ch t·∫°i sao ƒë√°p √°n A ƒë√∫ng\",\r\n      \"points\": 10,\r\n      \"difficulty\": \"${difficulty}\"\r\n    }\r\n  ]\r\n}\r\n\r\nQUAN TR·ªåNG: Ch·ªâ tr·∫£ v·ªÅ JSON thu·∫ßn t√∫y, kh√¥ng th√™m text ho·∫∑c markdown n√†o kh√°c.\r\n`;\r\n  }\r\n\r\n  /**\r\n   * Parse questions t·ª´ Firebase Function response\r\n   */\r\n  private static parseQuestionsFromResponse(questionsData: any[]): Question[] {\r\n    try {\r\n      const questions: Question[] = [];\r\n      \r\n      for (const questionData of questionsData) {\r\n        const question: Question = {\r\n          id: `q_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n          text: questionData.text || '',\r\n          type: 'multiple',\r\n          answers: questionData.answers?.map((answer: any, index: number) => ({\r\n            id: `a_${index + 1}`,\r\n            text: answer.text || '',\r\n            isCorrect: answer.isCorrect === true\r\n          })) || [],\r\n          explanation: questionData.explanation || '',\r\n          points: questionData.points || 10,\r\n          difficulty: questionData.difficulty || 'medium'\r\n        };\r\n\r\n        // Validate question\r\n        if (question.text && question.answers.length >= 2) {\r\n          questions.push(question);\r\n        }\r\n      }\r\n\r\n      return questions;\r\n    } catch (error) {\r\n      console.error('Error parsing questions from response:', error);\r\n      throw new Error('Kh√¥ng th·ªÉ ph√¢n t√≠ch c√¢u h·ªèi t·ª´ AI');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Ki·ªÉm tra availability c·ªßa Firebase AI\r\n   */\r\n  static async checkAvailability(): Promise<boolean> {\r\n    try {\r\n      const auth = getAuth();\r\n      if (!auth.currentUser) {\r\n        return false;\r\n      }\r\n\r\n      // Test v·ªõi m·ªôt request ƒë∆°n gi·∫£n\r\n      const testGenerate = httpsCallable(this.functions, 'testAI');\r\n      const result = await testGenerate({ test: true });\r\n      \r\n      return result.data ? true : false;\r\n    } catch (error) {\r\n      console.error('Firebase AI not available:', error);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\nexport default FirebaseAIService;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services\\geminiAIService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services\\learningService.ts","messages":[{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":174,"column":7,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":174,"endColumn":62}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Learning Materials Service\r\n * Qu·∫£n l√Ω ti·∫øn ƒë·ªô xem t√†i li·ªáu v√† gating logic\r\n */\r\n\r\nimport {\r\n  collection,\r\n  doc,\r\n  getDoc,\r\n  setDoc,\r\n  updateDoc,\r\n  serverTimestamp,\r\n  Timestamp\r\n} from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport {\r\n  LearningResource,\r\n  LearningSession,\r\n  ResourceViewProgress,\r\n  LearningEvent\r\n} from '../types/learning';\r\n\r\n/**\r\n * L·∫•y learning session c·ªßa user cho m·ªôt quiz\r\n */\r\nexport const getLearningSession = async (\r\n  userId: string,\r\n  quizId: string\r\n): Promise<LearningSession | null> => {\r\n  try {\r\n    const sessionId = `${quizId}_${userId}`;\r\n    const sessionRef = doc(db, 'userQuizSessions', sessionId);\r\n    const sessionDoc = await getDoc(sessionRef);\r\n\r\n    if (!sessionDoc.exists()) {\r\n      return null;\r\n    }\r\n\r\n    const data = sessionDoc.data();\r\n    return {\r\n      id: sessionDoc.id,\r\n      userId,\r\n      quizId,\r\n      viewedResources: data.viewedResources || {},\r\n      ready: data.ready || false,\r\n      readyAt: data.readyAt?.toDate(),\r\n      totalResourcesRequired: data.totalResourcesRequired || 0,\r\n      completedResourcesRequired: data.completedResourcesRequired || 0,\r\n      completionPercent: data.completionPercent || 0,\r\n      startedAt: data.startedAt?.toDate() || new Date(),\r\n      lastActivityAt: data.lastActivityAt?.toDate() || new Date(),\r\n      updatedAt: data.updatedAt?.toDate() || new Date()\r\n    };\r\n  } catch (error) {\r\n    console.error('Error getting learning session:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * T·∫°o ho·∫∑c c·∫≠p nh·∫≠t learning session\r\n */\r\nexport const initializeLearningSession = async (\r\n  userId: string,\r\n  quizId: string,\r\n  resources: LearningResource[]\r\n): Promise<LearningSession> => {\r\n  const sessionId = `${quizId}_${userId}`;\r\n  const sessionRef = doc(db, 'userQuizSessions', sessionId);\r\n\r\n  const requiredResources = resources.filter(r => r.required);\r\n  const now = new Date();\r\n\r\n  const session: Partial<LearningSession> = {\r\n    userId,\r\n    quizId,\r\n    viewedResources: {},\r\n    ready: requiredResources.length === 0, // N·∫øu kh√¥ng c√≥ required ‚Üí ready lu√¥n\r\n    totalResourcesRequired: requiredResources.length,\r\n    completedResourcesRequired: 0,\r\n    completionPercent: 0,\r\n    startedAt: now,\r\n    lastActivityAt: now,\r\n    updatedAt: now\r\n  };\r\n\r\n  await setDoc(sessionRef, {\r\n    ...session,\r\n    startedAt: Timestamp.fromDate(now),\r\n    lastActivityAt: Timestamp.fromDate(now),\r\n    updatedAt: serverTimestamp()\r\n  }, { merge: true });\r\n\r\n  return session as LearningSession;\r\n};\r\n\r\n/**\r\n * C·∫≠p nh·∫≠t ti·∫øn ƒë·ªô xem t√†i li·ªáu\r\n */\r\nexport const updateResourceProgress = async (\r\n  userId: string,\r\n  quizId: string,\r\n  resourceId: string,\r\n  progress: Partial<ResourceViewProgress>\r\n): Promise<void> => {\r\n  try {\r\n    const sessionId = `${quizId}_${userId}`;\r\n    const sessionRef = doc(db, 'userQuizSessions', sessionId);\r\n\r\n    // Get current session\r\n    const sessionDoc = await getDoc(sessionRef);\r\n    if (!sessionDoc.exists()) {\r\n      throw new Error('Session not found');\r\n    }\r\n\r\n    const sessionData = sessionDoc.data();\r\n    const viewedResources = sessionData.viewedResources || {};\r\n    const currentProgress = viewedResources[resourceId] || {};\r\n\r\n    // Merge progress\r\n    const updatedProgress: ResourceViewProgress = {\r\n      ...currentProgress,\r\n      ...progress,\r\n      resourceId,\r\n      lastActivityAt: new Date()\r\n    };\r\n\r\n    // Update session\r\n    await updateDoc(sessionRef, {\r\n      [`viewedResources.${resourceId}`]: {\r\n        ...updatedProgress,\r\n        startedAt: updatedProgress.startedAt ? Timestamp.fromDate(updatedProgress.startedAt) : serverTimestamp(),\r\n        lastActivityAt: serverTimestamp(),\r\n        completedAt: updatedProgress.completedAt ? Timestamp.fromDate(updatedProgress.completedAt) : null\r\n      },\r\n      lastActivityAt: serverTimestamp(),\r\n      updatedAt: serverTimestamp()\r\n    });\r\n\r\n    console.log('‚úÖ Resource progress updated:', resourceId, progress);\r\n  } catch (error) {\r\n    console.error('‚ùå Error updating resource progress:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Ki·ªÉm tra resource ƒë√£ ho√†n th√†nh threshold ch∆∞a\r\n */\r\nexport const validateResourceCompletion = (\r\n  resource: LearningResource,\r\n  progress: ResourceViewProgress\r\n): { completed: boolean; reason?: string } => {\r\n  const threshold = resource.threshold;\r\n\r\n  switch (resource.type) {\r\n    case 'video':\r\n      // Check video completion\r\n      if (threshold.minWatchSec && (!progress.secondsWatched || progress.secondsWatched < threshold.minWatchSec)) {\r\n        return {\r\n          completed: false,\r\n          reason: `C·∫ßn xem t·ªëi thi·ªÉu ${Math.ceil(threshold.minWatchSec / 60)} ph√∫t`\r\n        };\r\n      }\r\n      if (threshold.minWatchPercent && (!progress.watchPercent || progress.watchPercent < threshold.minWatchPercent)) {\r\n        return {\r\n          completed: false,\r\n          reason: `C·∫ßn xem t·ªëi thi·ªÉu ${threshold.minWatchPercent}% video`\r\n        };\r\n      }\r\n      return { completed: true };\r\n\r\n    case 'pdf':\r\n      const minTimePerPage = threshold.minTimePerPage || 1.5; // Default 1.5s per page\r\n      \r\n      if (threshold.mustReachLastPage) {\r\n        const lastPage = resource.totalPages || 1;\r\n        if (!progress.pagesViewed?.includes(lastPage)) {\r\n          return {\r\n            completed: false,\r\n            reason: 'C·∫ßn ƒë·ªçc ƒë·∫øn trang cu·ªëi'\r\n          };\r\n        }\r\n      }\r\n\r\n      if (threshold.minPages) {\r\n        const viewedCount = progress.pagesViewed?.length || 0;\r\n        if (viewedCount < threshold.minPages) {\r\n          return {\r\n            completed: false,\r\n            reason: `C·∫ßn xem t·ªëi thi·ªÉu ${threshold.minPages} trang`\r\n          };\r\n        }\r\n\r\n        // Check time per page (anti-skip)\r\n        if (progress.pageViewTimes) {\r\n          const validPages = Object.values(progress.pageViewTimes).filter(\r\n            time => time >= minTimePerPage\r\n          ).length;\r\n          \r\n          if (validPages < threshold.minPages) {\r\n            return {\r\n              completed: false,\r\n              reason: `C·∫ßn d√†nh √≠t nh·∫•t ${minTimePerPage}s cho m·ªói trang`\r\n            };\r\n          }\r\n        }\r\n      }\r\n      return { completed: true };\r\n\r\n    case 'image':\r\n    case 'slides':\r\n      if (threshold.minViewedCount) {\r\n        const viewedCount = progress.imagesViewed?.length || 0;\r\n        if (viewedCount < threshold.minViewedCount) {\r\n          return {\r\n            completed: false,\r\n            reason: `C·∫ßn xem t·ªëi thi·ªÉu ${threshold.minViewedCount} ·∫£nh/slide`\r\n          };\r\n        }\r\n\r\n        // Check min view time per image\r\n        if (threshold.minViewTime && progress.imageViewTimes) {\r\n          const validImages = Object.values(progress.imageViewTimes).filter(\r\n            time => time >= (threshold.minViewTime || 0)\r\n          ).length;\r\n          \r\n          if (validImages < threshold.minViewedCount) {\r\n            return {\r\n              completed: false,\r\n              reason: `C·∫ßn xem m·ªói ·∫£nh √≠t nh·∫•t ${threshold.minViewTime}s`\r\n            };\r\n          }\r\n        }\r\n      }\r\n      return { completed: true };\r\n\r\n    case 'link':\r\n      if (threshold.requireConfirm && !progress.confirmed) {\r\n        return {\r\n          completed: false,\r\n          reason: 'C·∫ßn x√°c nh·∫≠n ƒë√£ ƒë·ªçc'\r\n        };\r\n      }\r\n\r\n      if (threshold.miniCheck) {\r\n        const passingScore = threshold.miniCheck.passingScore;\r\n        if (!progress.miniCheckScore || progress.miniCheckScore < passingScore) {\r\n          return {\r\n            completed: false,\r\n            reason: `C·∫ßn ƒë·∫°t t·ªëi thi·ªÉu ${passingScore} ƒëi·ªÉm mini-check`\r\n          };\r\n        }\r\n      }\r\n      return { completed: true };\r\n\r\n    default:\r\n      return { completed: false, reason: 'Unknown resource type' };\r\n  }\r\n};\r\n\r\n/**\r\n * Ki·ªÉm tra gating - user c√≥ th·ªÉ b·∫Øt ƒë·∫ßu quiz kh√¥ng\r\n */\r\nexport const checkGatingStatus = async (\r\n  userId: string,\r\n  quizId: string,\r\n  resources: LearningResource[]\r\n): Promise<{\r\n  ready: boolean;\r\n  requiredCount: number;\r\n  completedCount: number;\r\n  missingResources: LearningResource[];\r\n  warnings: string[];\r\n}> => {\r\n  try {\r\n    const session = await getLearningSession(userId, quizId);\r\n    \r\n    if (!session) {\r\n      // Ch∆∞a c√≥ session ‚Üí init\r\n      await initializeLearningSession(userId, quizId, resources);\r\n      const requiredResources = resources.filter(r => r.required);\r\n      return {\r\n        ready: requiredResources.length === 0,\r\n        requiredCount: requiredResources.length,\r\n        completedCount: 0,\r\n        missingResources: requiredResources,\r\n        warnings: requiredResources.length > 0 \r\n          ? ['B·∫°n ch∆∞a xem t√†i li·ªáu b·∫Øt bu·ªôc']\r\n          : []\r\n      };\r\n    }\r\n\r\n    const requiredResources = resources.filter(r => r.required);\r\n    const missingResources: LearningResource[] = [];\r\n    const warnings: string[] = [];\r\n\r\n    for (const resource of requiredResources) {\r\n      const progress = session.viewedResources[resource.id];\r\n      \r\n      if (!progress) {\r\n        missingResources.push(resource);\r\n        warnings.push(`Ch∆∞a xem: ${resource.title}`);\r\n        continue;\r\n      }\r\n\r\n      const validation = validateResourceCompletion(resource, progress);\r\n      if (!validation.completed) {\r\n        missingResources.push(resource);\r\n        warnings.push(`${resource.title}: ${validation.reason}`);\r\n      }\r\n    }\r\n\r\n    const completedCount = requiredResources.length - missingResources.length;\r\n    const ready = missingResources.length === 0;\r\n\r\n    // Update session ready status\r\n    if (ready && !session.ready) {\r\n      const sessionRef = doc(db, 'userQuizSessions', `${quizId}_${userId}`);\r\n      await updateDoc(sessionRef, {\r\n        ready: true,\r\n        readyAt: serverTimestamp(),\r\n        completedResourcesRequired: completedCount,\r\n        completionPercent: 100,\r\n        updatedAt: serverTimestamp()\r\n      });\r\n    } else {\r\n      const completionPercent = requiredResources.length > 0\r\n        ? Math.round((completedCount / requiredResources.length) * 100)\r\n        : 100;\r\n        \r\n      const sessionRef = doc(db, 'userQuizSessions', `${quizId}_${userId}`);\r\n      await updateDoc(sessionRef, {\r\n        ready,\r\n        completedResourcesRequired: completedCount,\r\n        completionPercent,\r\n        updatedAt: serverTimestamp()\r\n      });\r\n    }\r\n\r\n    return {\r\n      ready,\r\n      requiredCount: requiredResources.length,\r\n      completedCount,\r\n      missingResources,\r\n      warnings\r\n    };\r\n  } catch (error) {\r\n    console.error('Error checking gating status:', error);\r\n    return {\r\n      ready: false,\r\n      requiredCount: 0,\r\n      completedCount: 0,\r\n      missingResources: [],\r\n      warnings: ['C√≥ l·ªói ki·ªÉm tra tr·∫°ng th√°i']\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Log learning event\r\n */\r\nexport const logLearningEvent = async (event: Omit<LearningEvent, 'id' | 'timestamp'>): Promise<void> => {\r\n  try {\r\n    const eventsRef = collection(db, 'learningEvents');\r\n    await setDoc(doc(eventsRef), {\r\n      ...event,\r\n      timestamp: serverTimestamp()\r\n    });\r\n  } catch (error) {\r\n    console.error('Error logging learning event:', error);\r\n  }\r\n};\r\n\r\n/**\r\n * T√≠nh to√°n completion percentage cho progress bar\r\n */\r\nexport const calculateProgress = (\r\n  resources: LearningResource[],\r\n  viewedResources: Record<string, ResourceViewProgress>\r\n): {\r\n  totalRequired: number;\r\n  completedRequired: number;\r\n  totalRecommended: number;\r\n  completedRecommended: number;\r\n  overallPercent: number;\r\n} => {\r\n  const required = resources.filter(r => r.required);\r\n  const recommended = resources.filter(r => !r.required);\r\n\r\n  const completedRequired = required.filter(r => {\r\n    const progress = viewedResources[r.id];\r\n    if (!progress) return false;\r\n    return validateResourceCompletion(r, progress).completed;\r\n  }).length;\r\n\r\n  const completedRecommended = recommended.filter(r => {\r\n    const progress = viewedResources[r.id];\r\n    if (!progress) return false;\r\n    return validateResourceCompletion(r, progress).completed;\r\n  }).length;\r\n\r\n  const totalResources = resources.length;\r\n  const completedTotal = completedRequired + completedRecommended;\r\n  const overallPercent = totalResources > 0 \r\n    ? Math.round((completedTotal / totalResources) * 100)\r\n    : 0;\r\n\r\n  return {\r\n    totalRequired: required.length,\r\n    completedRequired,\r\n    totalRecommended: recommended.length,\r\n    completedRecommended,\r\n    overallPercent\r\n  };\r\n};\r\n\r\nexport default {\r\n  getLearningSession,\r\n  initializeLearningSession,\r\n  updateResourceProgress,\r\n  validateResourceCompletion,\r\n  checkGatingStatus,\r\n  logLearningEvent,\r\n  calculateProgress\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services\\quiz.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[318,321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[318,321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[324,327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[324,327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1403,1406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1403,1406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2312,2315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2312,2315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2373,2376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2373,2376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { collection, getDocs, doc, getDoc, query, where, limit } from 'firebase/firestore';\r\nimport { db } from '../../../lib/firebase/config';\r\nimport { Quiz } from '../types';\r\nimport { QUIZZES_COLLECTION } from '../constants';\r\n\r\n// Helper function to convert Firestore Timestamps\r\nconst convertTimestamps = (data: any): any => {\r\n  if (!data || typeof data !== 'object') {\r\n    return data;\r\n  }\r\n\r\n  // Handle arrays\r\n  if (Array.isArray(data)) {\r\n    return data.map(item => convertTimestamps(item));\r\n  }\r\n\r\n  const converted = { ...data };\r\n  \r\n  // Convert all fields recursively\r\n  Object.keys(converted).forEach(key => {\r\n    const value = converted[key];\r\n    \r\n    if (value && typeof value === 'object') {\r\n      // Check if it's a Firestore Timestamp\r\n      if (value.toDate && typeof value.toDate === 'function') {\r\n        // Firestore Timestamp\r\n        converted[key] = value.toDate().toISOString();\r\n      } else if (value instanceof Date) {\r\n        // JavaScript Date\r\n        converted[key] = value.toISOString();\r\n      } else if (Array.isArray(value)) {\r\n        // Recursively handle arrays\r\n        converted[key] = value.map(item => convertTimestamps(item));\r\n      } else {\r\n        // Recursively handle nested objects\r\n        converted[key] = convertTimestamps(value);\r\n      }\r\n    }\r\n  });\r\n  \r\n  return converted;\r\n};\r\n\r\nexport const getQuizzes = async (\r\n  filters?: any,\r\n  pageSize?: number\r\n) => {\r\n  try {\r\n    let q = query(\r\n      collection(db, QUIZZES_COLLECTION),\r\n      where('status', '==', 'approved'), // CH·ªà L·∫§Y QUIZ ƒê√É DUY·ªÜT\r\n      limit(pageSize || 10)\r\n    );\r\n\r\n    if (filters) {\r\n      if (filters.category) {\r\n        q = query(q, where('category', '==', filters.category));\r\n      }\r\n      if (filters.difficulty) {\r\n        q = query(q, where('difficulty', '==', filters.difficulty));\r\n      }\r\n    }\r\n\r\n    const snapshot = await getDocs(q);\r\n    const quizzes = snapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...convertTimestamps(doc.data())\r\n    })) as Quiz[];\r\n\r\n    return {\r\n      quizzes,\r\n      lastDoc: snapshot.docs[snapshot.docs.length - 1]\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching quizzes:', error);\r\n    if (error instanceof Error) {\r\n      console.error('Error message:', error.message);\r\n      if ((error as any).code) {\r\n        console.error('Error code:', (error as any).code);\r\n      }\r\n    } else {\r\n      console.error('Unknown error:', error);\r\n    }\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const getQuizById = async (id: string): Promise<Quiz> => {\r\n  try {\r\n    const docRef = doc(db, QUIZZES_COLLECTION, id);\r\n    const docSnap = await getDoc(docRef);\r\n    \r\n    if (!docSnap.exists()) {\r\n      throw new Error('Quiz not found');\r\n    }\r\n    \r\n    const data = docSnap.data();\r\n    const convertedData = convertTimestamps(data);\r\n    \r\n    return {\r\n      id: docSnap.id,\r\n      ...convertedData\r\n    } as Quiz;\r\n  } catch (error) {\r\n    console.error('Error fetching quiz:', error);\r\n    throw error;\r\n  }\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services\\quizService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[661,664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[661,664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  DocumentSnapshot,\r\n} from 'firebase/firestore';\r\nimport { Quiz, QuizFilters } from '../types';\r\n\r\n// Import role-based quiz services\r\nimport { getAdminQuizzes, getUserQuizzesAdmin } from '../api/admin';\r\nimport { getCreatorQuizzes, getCreatorOwnQuizzes } from '../api/creator';\r\nimport { getUserQuizzes as getUserRoleQuizzes, getAnonymousQuizzes } from '../api/user';\r\n\r\n// Export all base functions\r\nexport * from '../api/base';\r\nexport * from '../api/shared';\r\n\r\n/**\r\n * Main function to get quizzes based on user role\r\n */\r\nexport const getQuizzes = async (\r\n  filters?: QuizFilters, \r\n  pageSize = 20, \r\n  lastDoc?: DocumentSnapshot, \r\n  user?: any\r\n): Promise<{\r\n  quizzes: Quiz[];\r\n  lastDoc: DocumentSnapshot | null;\r\n  hasMore: boolean;\r\n}> => {\r\n  try {\r\n    console.log('üîç [MAIN] getQuizzes called with user:', {\r\n      uid: user?.uid,\r\n      role: user?.role,\r\n      email: user?.email\r\n    });\r\n\r\n    if (!user) {\r\n      // Anonymous user\r\n      console.log('ÔøΩ [MAIN] Routing to anonymous quiz service');\r\n      return await getAnonymousQuizzes(filters, pageSize, lastDoc);\r\n    }\r\n\r\n    switch (user.role) {\r\n      case 'admin':\r\n        console.log('üîç [MAIN] Routing to admin quiz service');\r\n        return await getAdminQuizzes(filters, pageSize, lastDoc);\r\n        \r\n      case 'creator':\r\n        console.log('üîç [MAIN] Routing to creator quiz service');\r\n        return await getCreatorQuizzes(user.uid, filters, pageSize, lastDoc);\r\n        \r\n      case 'user':\r\n      default:\r\n        console.log('üîç [MAIN] Routing to user quiz service');\r\n        return await getUserRoleQuizzes(filters, pageSize, lastDoc);\r\n    }\r\n  } catch (error) {\r\n    console.error('‚ùå [MAIN] Error in getQuizzes:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Get quizzes created by a specific user (role-aware)\r\n */\r\nexport const getUserQuizzes = async (userId: string, userRole?: string): Promise<Quiz[]> => {\r\n  try {\r\n    if (userRole === 'admin') {\r\n      return await getUserQuizzesAdmin(userId);\r\n    } else {\r\n      return await getCreatorOwnQuizzes(userId);\r\n    }\r\n  } catch (error) {\r\n    console.error('Error fetching user quizzes:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport { \r\n  getQuizById, \r\n  createQuiz, \r\n  updateQuiz, \r\n  deleteQuiz, \r\n  getQuizResults, \r\n  getQuizResultById \r\n} from '../api/base';\r\nexport { \r\n  getQuizCategories, \r\n  getPopularQuizzes, \r\n  searchQuizzes, \r\n  applyQuizFilters, \r\n  getUserQuizResults \r\n} from '../api/shared';\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services\\realDataService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services\\reviewService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\services\\simpleAIService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\store.ts","messages":[{"ruleId":"@typescript-eslint/ban-types","severity":1,"message":"Don't use `{}` as a type. `{}` actually means \"any non-nullish value\".\n- If you want a type meaning \"any object\", you probably want `object` instead.\n- If you want a type meaning \"any value\", you probably want `unknown` instead.\n- If you want a type meaning \"empty object\", you probably want `Record<string, never>` instead.\n- If you really want a type meaning \"any non-nullish value\", you probably want `NonNullable<unknown>` instead.","line":9,"column":13,"nodeType":"TSTypeLiteral","messageId":"bannedTypeMessage","endLine":9,"endColumn":15,"suggestions":[{"messageId":"bannedTypeReplacement","data":{"name":"{}","replacement":"object"},"fix":{"range":[343,345],"text":"object"},"desc":"Replace `{}` with `object`."},{"messageId":"bannedTypeReplacement","data":{"name":"{}","replacement":"unknown"},"fix":{"range":[343,345],"text":"unknown"},"desc":"Replace `{}` with `unknown`."},{"messageId":"bannedTypeReplacement","data":{"name":"{}","replacement":"Record<string, never>"},"fix":{"range":[343,345],"text":"Record<string, never>"},"desc":"Replace `{}` with `Record<string, never>`."},{"messageId":"bannedTypeReplacement","data":{"name":"{}","replacement":"NonNullable<unknown>"},"fix":{"range":[343,345],"text":"NonNullable<unknown>"},"desc":"Replace `{}` with `NonNullable<unknown>`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[509,512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[509,512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createSlice, PayloadAction, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport { Quiz, QuizResult, QuizFilters } from './types';\r\nimport * as quizService from './services/quiz';\r\nimport { getUserQuizResults } from './api/shared';\r\n\r\n// Async thunks\r\nexport const fetchQuizzes = createAsyncThunk(\r\n  'quiz/fetchQuizzes',\r\n  async (_: {}, { rejectWithValue }) => {\r\n    try {\r\n      const result = await quizService.getQuizzes(undefined, undefined);\r\n      return result.quizzes;\r\n    } catch (error: any) {\r\n      console.error('Failed to fetch quizzes:', error);\r\n      \r\n      if (error.type === 'CONNECTION_ERROR') {\r\n        return rejectWithValue('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng c·ªßa b·∫°n.');\r\n      }\r\n      \r\n      if (error.type === 'TIMEOUT_ERROR') {\r\n        return rejectWithValue('Server kh√¥ng ph·∫£n h·ªìi. Vui l√≤ng th·ª≠ l·∫°i sau.');\r\n      }\r\n      \r\n      return rejectWithValue('ƒê√£ c√≥ l·ªói x·∫£y ra khi t·∫£i danh s√°ch quiz. Vui l√≤ng th·ª≠ l·∫°i.');\r\n    }\r\n  }\r\n);\r\n\r\nexport const fetchQuizById = createAsyncThunk(\r\n  'quiz/fetchQuizById',\r\n  async (quizId: string) => {\r\n    const quiz = await quizService.getQuizById(quizId);\r\n    return quiz;\r\n  }\r\n);\r\n\r\nexport const fetchUserQuizResults = createAsyncThunk(\r\n  'quiz/fetchUserQuizResults',\r\n  async (userId: string) => {\r\n    const results = await getUserQuizResults(userId);\r\n    return results;\r\n  }\r\n);\r\n\r\n// Th√™m isTimeWarning v√† totalTime v√†o QuizState\r\ninterface QuizState {\r\n  quizzes: Quiz[];\r\n  currentQuiz: Quiz | null;\r\n  userResults: QuizResult[];\r\n  loading: boolean;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  connectionError: boolean;\r\n  filters: QuizFilters;\r\n  currentQuestionIndex: number;\r\n  userAnswers: Record<string, string>;\r\n  timeLeft: number;\r\n  quizStartTime: number | null;\r\n  retryCount: number;\r\n  lastError: string | null;\r\n  isTimeWarning: boolean;\r\n  totalTime: number;\r\n}\r\n\r\nconst initialState: QuizState = {\r\n  quizzes: [],\r\n  currentQuiz: null,\r\n  userResults: [],\r\n  loading: false,\r\n  isLoading: false,\r\n  error: null,\r\n  connectionError: false,\r\n  filters: {\r\n    category: 'all',\r\n    difficulty: undefined,\r\n    searchTerm: '',\r\n  },\r\n  currentQuestionIndex: 0,\r\n  userAnswers: {},\r\n  timeLeft: 0,\r\n  quizStartTime: null,\r\n  retryCount: 0,\r\n  lastError: null,\r\n  isTimeWarning: false,\r\n  totalTime: 0,\r\n};\r\n\r\n// Fixed Redux store configuration - v2\r\nconst quizSlice = createSlice({\r\n  name: 'quiz',\r\n  initialState,\r\n  reducers: {\r\n    // Quiz loading states\r\n    setLoading: (state, action: PayloadAction<boolean>) => {\r\n      state.isLoading = action.payload;\r\n    },\r\n    setError: (state, action: PayloadAction<string | null>) => {\r\n      state.error = action.payload;\r\n    },\r\n    \r\n    // Quiz data management\r\n    setQuizzes: (state, action: PayloadAction<Quiz[]>) => {\r\n      state.quizzes = action.payload;\r\n    },\r\n    addQuiz: (state, action: PayloadAction<Quiz>) => {\r\n      state.quizzes.unshift(action.payload);\r\n    },\r\n    updateQuiz: (state, action: PayloadAction<Quiz>) => {\r\n      const index = state.quizzes.findIndex(q => q.id === action.payload.id);\r\n      if (index !== -1) {\r\n        state.quizzes[index] = action.payload;\r\n      }\r\n    },\r\n    removeQuiz: (state, action: PayloadAction<string>) => {\r\n      state.quizzes = state.quizzes.filter(q => q.id !== action.payload);\r\n    },\r\n    \r\n    // Current quiz management\r\n    setCurrentQuiz: (state, action: PayloadAction<Quiz | null>) => {\r\n      state.currentQuiz = action.payload;\r\n      if (action.payload) {\r\n        state.currentQuestionIndex = 0;\r\n        state.userAnswers = {};\r\n        state.totalTime = action.payload.duration * 60; // T·ªïng th·ªùi gian (gi√¢y)\r\n        state.timeLeft = state.totalTime;\r\n        state.quizStartTime = Date.now();\r\n        state.isTimeWarning = false;\r\n      } else {\r\n        state.currentQuestionIndex = 0;\r\n        state.userAnswers = {};\r\n        state.timeLeft = 0;\r\n        state.quizStartTime = null;\r\n        state.totalTime = 0;\r\n        state.isTimeWarning = false;\r\n      }\r\n    },\r\n\r\n    // C·∫≠p nh·∫≠t timeLeft d·ª±a tr√™n th·ªùi gian th·ª±c t·∫ø ƒë√£ tr√¥i qua\r\n    updateTimeLeft: (state) => {\r\n      if (state.quizStartTime && state.totalTime > 0) {\r\n        const elapsed = Math.floor((Date.now() - state.quizStartTime) / 1000);\r\n        const newTimeLeft = Math.max(state.totalTime - elapsed, 0);\r\n        state.timeLeft = newTimeLeft;\r\n        // C·∫£nh b√°o khi c√≤n <= 10% t·ªïng th·ªùi gian\r\n        state.isTimeWarning = newTimeLeft <= Math.ceil(state.totalTime * 0.1);\r\n      }\r\n    },\r\n\r\n    // Gi·ªØ decrementTime cho tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát\r\n    decrementTime: (state) => {\r\n      if (state.timeLeft > 0) {\r\n        state.timeLeft -= 1;\r\n        // C·∫£nh b√°o khi c√≤n <= 10% t·ªïng th·ªùi gian\r\n        state.isTimeWarning = state.timeLeft <= Math.ceil(state.totalTime * 0.1);\r\n      }\r\n    },\r\n    \r\n    // Answer management\r\n    setUserAnswer: (state, action: PayloadAction<{ questionId: string; answerId: string }>) => {\r\n      state.userAnswers[action.payload.questionId] = action.payload.answerId;\r\n    },\r\n    clearUserAnswers: (state) => {\r\n      state.userAnswers = {};\r\n    },\r\n    \r\n    // Timer management\r\n    setTimeLeft: (state, action: PayloadAction<number>) => {\r\n      state.timeLeft = action.payload;\r\n    },\r\n    \r\n    // Results management\r\n    setUserResults: (state, action: PayloadAction<QuizResult[]>) => {\r\n      state.userResults = action.payload;\r\n    },\r\n    addUserResult: (state, action: PayloadAction<QuizResult>) => {\r\n      state.userResults.unshift(action.payload);\r\n    },\r\n    \r\n    // Filters\r\n    setFilters: (state, action: PayloadAction<QuizFilters>) => {\r\n      state.filters = action.payload;\r\n    },\r\n    updateFilter: (state, action: PayloadAction<Partial<QuizFilters>>) => {\r\n      state.filters = { ...state.filters, ...action.payload };\r\n    },\r\n    clearFilters: (state) => {\r\n      state.filters = {};\r\n    },\r\n    \r\n    // Reset quiz state\r\n    resetQuizState: (state) => {\r\n      state.currentQuiz = null;\r\n      state.currentQuestionIndex = 0;\r\n      state.userAnswers = {};\r\n      state.timeLeft = 0;\r\n      state.quizStartTime = null;\r\n      state.totalTime = 0;\r\n      state.isTimeWarning = false;\r\n    },\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(fetchQuizzes.pending, (state) => {\r\n        state.loading = true;\r\n        state.isLoading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(fetchQuizzes.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.isLoading = false;\r\n        // Now action.payload is just the quizzes array\r\n        state.quizzes = action.payload;\r\n      })\r\n      .addCase(fetchQuizzes.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.isLoading = false;\r\n        state.error = action.error.message || 'L·ªói khi t·∫£i quiz';\r\n      })\r\n      // Handle single quiz fetch\r\n      .addCase(fetchQuizById.pending, (state) => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(fetchQuizById.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        if (action.payload) {\r\n          state.currentQuiz = action.payload;\r\n          // Also add to quizzes array if not exists\r\n          const exists = state.quizzes.find(q => q.id === action.payload!.id);\r\n          if (!exists) {\r\n            state.quizzes.push(action.payload);\r\n          }\r\n        }\r\n      })\r\n      .addCase(fetchQuizById.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.error.message || 'L·ªói khi t·∫£i quiz';\r\n      })\r\n      .addCase(fetchUserQuizResults.pending, (state) => {\r\n        state.loading = true;\r\n      })\r\n      .addCase(fetchUserQuizResults.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.userResults = action.payload;\r\n      })\r\n      .addCase(fetchUserQuizResults.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.error.message || 'L·ªói khi t·∫£i k·∫øt qu·∫£ quiz';\r\n      });\r\n  },\r\n});\r\n\r\nexport const {\r\n  setQuizzes,\r\n  setCurrentQuiz,\r\n  decrementTime,\r\n  updateTimeLeft,\r\n  resetQuizState,\r\n  addUserResult,\r\n  setFilters,\r\n  updateFilter,\r\n  clearFilters,\r\n  setUserResults,\r\n  setUserAnswer,\r\n  clearUserAnswers,\r\n  setTimeLeft,\r\n  setLoading,\r\n  setError,\r\n  addQuiz,\r\n  updateQuiz,\r\n  removeQuiz,\r\n} = quizSlice.actions;\r\n\r\nexport default quizSlice.reducer;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\types\\learning.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5400,5403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5400,5403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":268,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6494,6497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6494,6497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Learning Materials System Types\r\n * H·ªó tr·ª£ xem t√†i li·ªáu tr∆∞·ªõc khi l√†m b√†i tr·∫Øc nghi·ªám\r\n */\r\n\r\n/**\r\n * Lo·∫°i t√†i li·ªáu h·ªçc t·∫≠p\r\n */\r\nexport type ResourceType = 'video' | 'pdf' | 'image' | 'audio' | 'link' | 'slides';\r\n\r\n/**\r\n * Learning Outcome - M·ª•c ti√™u h·ªçc t·∫≠p\r\n */\r\nexport interface LearningOutcome {\r\n  id: string;\r\n  code: string; // LO1, LO2, LO3...\r\n  title: string;\r\n  description: string;\r\n}\r\n\r\n/**\r\n * Ng∆∞·ª°ng ho√†n th√†nh cho t·ª´ng lo·∫°i t√†i li·ªáu\r\n */\r\nexport interface ResourceThreshold {\r\n  // Video thresholds\r\n  minWatchSec?: number; // T·ªëi thi·ªÉu X gi√¢y\r\n  minWatchPercent?: number; // T·ªëi thi·ªÉu X% video (0-100)\r\n  \r\n  // PDF thresholds\r\n  minPages?: number; // T·ªëi thi·ªÉu X trang\r\n  mustReachLastPage?: boolean; // Ph·∫£i ƒë·ªçc ƒë·∫øn trang cu·ªëi\r\n  minTimePerPage?: number; // T·ªëi thi·ªÉu X gi√¢y/trang (default: 1.5s)\r\n  \r\n  // Image/Slides thresholds\r\n  minViewedCount?: number; // T·ªëi thi·ªÉu X ·∫£nh/slide\r\n  minViewTime?: number; // T·ªëi thi·ªÉu X gi√¢y xem m·ªói ·∫£nh\r\n  \r\n  // Link thresholds\r\n  requireConfirm?: boolean; // Y√™u c·∫ßu tick \"ƒë√£ ƒë·ªçc\"\r\n  miniCheck?: MiniCheck; // C√¢u h·ªèi ki·ªÉm tra nhanh\r\n}\r\n\r\n/**\r\n * C√¢u h·ªèi ki·ªÉm tra nhanh cho external links\r\n */\r\nexport interface MiniCheck {\r\n  questions: MiniCheckQuestion[];\r\n  passingScore: number; // ƒêi·ªÉm t·ªëi thi·ªÉu ƒë·ªÉ pass (v√≠ d·ª•: 1/1, 2/3)\r\n}\r\n\r\nexport interface MiniCheckQuestion {\r\n  id: string;\r\n  question: string;\r\n  options: string[];\r\n  correctAnswer: number; // Index c·ªßa ƒë√°p √°n ƒë√∫ng\r\n}\r\n\r\n/**\r\n * T√†i li·ªáu h·ªçc t·∫≠p\r\n */\r\nexport interface LearningResource {\r\n  id: string;\r\n  type: ResourceType;\r\n  title: string;\r\n  description?: string;\r\n  url: string;\r\n  \r\n  // C·∫•u h√¨nh\r\n  required: boolean; // B·∫Øt bu·ªôc ph·∫£i xem\r\n  threshold: ResourceThreshold;\r\n  learningOutcomes: string[]; // LO IDs li√™n quan\r\n  \r\n  // Metadata\r\n  duration?: number; // Video duration (seconds)\r\n  totalPages?: number; // PDF total pages\r\n  totalSlides?: number; // Slide count\r\n  estimatedTime?: number; // Th·ªùi gian ∆∞·ªõc t√≠nh (ph√∫t)\r\n  \r\n  // Display\r\n  order: number; // Th·ª© t·ª± hi·ªÉn th·ªã\r\n  thumbnailUrl?: string;\r\n  whyWatch?: string; // \"V√¨ sao xem ph·∫ßn n√†y?\" - g·ª£i √Ω cho learner\r\n  \r\n  // Timestamps\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\n/**\r\n * Ti·∫øn ƒë·ªô xem t√†i li·ªáu c·ªßa c√° nh√¢n\r\n */\r\nexport interface ResourceViewProgress {\r\n  resourceId: string;\r\n  \r\n  // Completion status\r\n  completed: boolean;\r\n  completedAt?: Date;\r\n  \r\n  // Video tracking\r\n  secondsWatched?: number;\r\n  watchPercent?: number; // 0-100\r\n  lastWatchPosition?: number; // Last video position (seconds)\r\n  playbackSpeeds?: number[]; // T·ªëc ƒë·ªô ph√°t (ƒë·ªÉ detect >2x)\r\n  \r\n  // PDF tracking\r\n  pagesViewed?: number[]; // Array of page numbers viewed\r\n  pageViewTimes?: Record<number, number>; // Page number ‚Üí time spent (seconds)\r\n  \r\n  // Image/Slides tracking\r\n  imagesViewed?: number[]; // Array of image indices viewed\r\n  imageViewTimes?: Record<number, number>; // Image index ‚Üí time spent\r\n  \r\n  // Link tracking\r\n  confirmed?: boolean; // ƒê√£ tick \"ƒë√£ ƒë·ªçc\"\r\n  miniCheckScore?: number; // ƒêi·ªÉm mini-check (0-100)\r\n  miniCheckAnswers?: number[]; // User answers\r\n  \r\n  // Anti-cheating\r\n  tabFocusTime?: number; // T·ªïng th·ªùi gian tab ·ªü foreground\r\n  totalTime?: number; // T·ªïng th·ªùi gian (bao g·ªìm background)\r\n  suspiciousActivity?: string[]; // Log c√°c h√†nh vi ƒë√°ng ng·ªù\r\n  \r\n  // Timestamps\r\n  startedAt: Date;\r\n  lastActivityAt: Date;\r\n}\r\n\r\n/**\r\n * Session h·ªçc t·∫≠p c·ªßa user cho m·ªôt quiz\r\n */\r\nexport interface LearningSession {\r\n  id: string;\r\n  userId: string;\r\n  quizId: string;\r\n  \r\n  // Progress\r\n  viewedResources: Record<string, ResourceViewProgress>; // resourceId ‚Üí progress\r\n  \r\n  // Gating status\r\n  ready: boolean; // ƒê·ªß ƒëi·ªÅu ki·ªán b·∫Øt ƒë·∫ßu quiz\r\n  readyAt?: Date;\r\n  \r\n  // Stats\r\n  totalResourcesRequired: number;\r\n  completedResourcesRequired: number;\r\n  completionPercent: number; // 0-100\r\n  \r\n  // Timestamps\r\n  startedAt: Date;\r\n  lastActivityAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\n/**\r\n * K·∫øt qu·∫£ ph√¢n t√≠ch sau khi l√†m b√†i\r\n */\r\nexport interface LearningAnalytics {\r\n  userId: string;\r\n  quizId: string;\r\n  \r\n  // Correlation gi·ªØa xem t√†i li·ªáu v√† ƒëi·ªÉm\r\n  watchedAllRequired: boolean;\r\n  watchedAllRecommended: boolean;\r\n  quizScore: number;\r\n  \r\n  // LO Performance\r\n  loPerformance: Record<string, {\r\n    loId: string;\r\n    correct: number;\r\n    total: number;\r\n    percentage: number;\r\n    relatedResources: string[]; // Resource IDs\r\n  }>;\r\n  \r\n  // Recommendations\r\n  recommendedReview: string[]; // Resource IDs n√™n xem l·∫°i\r\n  \r\n  // Timestamps\r\n  completedAt: Date;\r\n}\r\n\r\n/**\r\n * Instructor Analytics - Dashboard cho gi·∫£ng vi√™n\r\n */\r\nexport interface InstructorAnalytics {\r\n  quizId: string;\r\n  \r\n  // Resource completion stats\r\n  resourceStats: Record<string, {\r\n    resourceId: string;\r\n    totalViews: number;\r\n    completionRate: number; // %\r\n    avgTimeSpent: number; // seconds\r\n    avgScore?: number; // Score c·ªßa users ƒë√£ xem resource n√†y\r\n  }>;\r\n  \r\n  // LO correlation\r\n  loCorrelation: Record<string, {\r\n    loId: string;\r\n    relatedResources: string[];\r\n    avgScoreWithResources: number;\r\n    avgScoreWithoutResources: number;\r\n    improvement: number; // % improvement\r\n  }>;\r\n  \r\n  // Heatmap data\r\n  heatmap: {\r\n    resourceId: string;\r\n    loId: string;\r\n    errorReduction: number; // % gi·∫£m t·ª∑ l·ªá sai\r\n  }[];\r\n  \r\n  // A/B Testing results\r\n  abTests?: {\r\n    testId: string;\r\n    variants: {\r\n      variant: string;\r\n      threshold: any;\r\n      avgScore: number;\r\n      completionRate: number;\r\n    }[];\r\n  }[];\r\n  \r\n  updatedAt: Date;\r\n}\r\n\r\n/**\r\n * Config cho gating behavior\r\n */\r\nexport interface GatingConfig {\r\n  mode: 'strict' | 'soft' | 'none';\r\n  // strict: Kh√¥ng th·ªÉ v√†o b√†i n·∫øu ch∆∞a ƒë·∫°t required\r\n  // soft: C√≥ th·ªÉ v√†o nh∆∞ng c√≥ c·∫£nh b√°o + ƒëi·ªÉm tr·ª´ nh·ªè\r\n  // none: Ch·ªâ khuy·∫øn ngh·ªã, kh√¥ng √©p bu·ªôc\r\n  \r\n  softPenalty?: number; // ƒêi·ªÉm tr·ª´ n·∫øu v√†o m√† ch∆∞a ƒë·∫°t (soft mode)\r\n  showWarning?: boolean; // Hi·ªÉn th·ªã c·∫£nh b√°o\r\n  warningMessage?: string;\r\n}\r\n\r\n/**\r\n * Event tracking cho analytics\r\n */\r\nexport interface LearningEvent {\r\n  id: string;\r\n  userId: string;\r\n  quizId: string;\r\n  resourceId: string;\r\n  \r\n  eventType: \r\n    | 'resource_started'\r\n    | 'resource_viewed'\r\n    | 'resource_completed'\r\n    | 'video_play'\r\n    | 'video_pause'\r\n    | 'video_seek'\r\n    | 'video_speed_change'\r\n    | 'pdf_page_view'\r\n    | 'pdf_scroll'\r\n    | 'image_view'\r\n    | 'link_visit'\r\n    | 'link_confirm'\r\n    | 'mini_check_attempt'\r\n    | 'mini_check_pass'\r\n    | 'tab_blur'\r\n    | 'tab_focus';\r\n  \r\n  metadata?: Record<string, any>;\r\n  timestamp: Date;\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\types\\quiz.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[100,103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[100,103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[147,150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[147,150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Quiz type stub for build\r\nexport interface Quiz {\r\n  id: string;\r\n  title: string;\r\n  questions: any[];\r\n  duration?: number;\r\n  [key: string]: any;\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\features\\quiz\\types\\review.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\firebase\\config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\locales\\resources.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\services\\fileProcessor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\services\\firebase\\collections.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\services\\firebase\\dataModels.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":335,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7210,7213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7210,7213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":382,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":382,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8157,8160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8157,8160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8294,8297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8294,8297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":388,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":388,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8436,8439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8436,8439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * üìä Firestore Data Models\r\n * Type-safe data structures cho t·∫•t c·∫£ collections\r\n */\r\n\r\nimport { Timestamp } from 'firebase/firestore';\r\n\r\n// ============= USER MODELS =============\r\nexport interface UserProfile {\r\n  uid: string;\r\n  email: string;\r\n  displayName: string;\r\n  photoURL: string | null;\r\n  role: 'user' | 'admin' | 'creator';\r\n  emailVerified: boolean;\r\n  isActive: boolean;\r\n  createdAt: Timestamp;\r\n  updatedAt: Timestamp;\r\n  lastLoginAt: Timestamp | null;\r\n  \r\n  // Preferences\r\n  preferences: {\r\n    language: string;\r\n    theme: 'light' | 'dark' | 'auto';\r\n    notifications: boolean;\r\n  };\r\n}\r\n\r\nexport interface UserStats {\r\n  userId: string;\r\n  quizzesCreated: number;\r\n  quizzesCompleted: number;\r\n  totalScore: number;\r\n  totalTimeSpent: number; // seconds\r\n  averageScore: number;\r\n  streak: number;\r\n  lastActivityAt: Timestamp;\r\n  updatedAt: Timestamp;\r\n}\r\n\r\nexport interface UserQuizActivity {\r\n  userId: string;\r\n  quizId: string;\r\n  attempts: number;\r\n  bestScore: number;\r\n  lastAttemptAt: Timestamp;\r\n  totalTimeSpent: number;\r\n  completed: boolean;\r\n}\r\n\r\n// ============= QUIZ MODELS =============\r\nexport interface Quiz {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  category: string;\r\n  difficulty: 'easy' | 'medium' | 'hard';\r\n  duration: number; // minutes\r\n  \r\n  // Media\r\n  imageUrl: string | null; // ‚úÖ Storage URL\r\n  \r\n  // Content\r\n  questions: Question[];\r\n  resources: LearningResource[]; // üÜï\r\n  \r\n  // Metadata\r\n  tags: string[];\r\n  language: string;\r\n  \r\n  // Creator\r\n  createdBy: string; // User ID\r\n  creatorName: string; // Denormalized\r\n  creatorAvatar: string | null; // Denormalized\r\n  \r\n  // Status\r\n  status: 'draft' | 'pending' | 'approved' | 'rejected';\r\n  isPublished: boolean;\r\n  isPublic: boolean;\r\n  \r\n  // Settings\r\n  allowRetake: boolean;\r\n  showAnswers: boolean;\r\n  randomizeQuestions: boolean;\r\n  randomizeAnswers: boolean;\r\n  passingScore: number;\r\n  \r\n  // Stats\r\n  attempts: number;\r\n  completions: number;\r\n  averageScore: number;\r\n  totalPlayers: number;\r\n  rating: number;\r\n  reviewCount: number;\r\n  \r\n  // Timestamps\r\n  createdAt: Timestamp;\r\n  updatedAt: Timestamp;\r\n  publishedAt: Timestamp | null;\r\n}\r\n\r\nexport interface Question {\r\n  id: string;\r\n  text: string;\r\n  type: 'multiple' | 'boolean' | 'text' | 'image';\r\n  imageUrl: string | null; // ‚úÖ Storage URL\r\n  \r\n  answers: Answer[];\r\n  correctAnswer: string | null;\r\n  acceptedAnswers: string[];\r\n  \r\n  explanation: string;\r\n  points: number;\r\n  timeLimit: number | null; // seconds\r\n  order: number;\r\n}\r\n\r\nexport interface Answer {\r\n  id: string;\r\n  text: string;\r\n  imageUrl: string | null; // ‚úÖ Storage URL\r\n  isCorrect: boolean;\r\n}\r\n\r\n// ============= LEARNING RESOURCE MODELS =============\r\nexport interface LearningResource {\r\n  id: string;\r\n  type: 'video' | 'pdf' | 'image' | 'audio' | 'link';\r\n  title: string;\r\n  description: string;\r\n  url: string; // ‚úÖ Storage URL or external URL\r\n  \r\n  // Metadata\r\n  duration: number | null; // seconds (for video/audio)\r\n  size: number | null; // bytes\r\n  mimeType: string | null;\r\n  thumbnailUrl: string | null;\r\n  \r\n  // Requirements\r\n  required: boolean;\r\n  threshold: ResourceThreshold;\r\n  estimatedTime: number; // minutes\r\n  \r\n  // Organization\r\n  order: number;\r\n  category: string | null;\r\n}\r\n\r\nexport interface ResourceThreshold {\r\n  type: 'percentage' | 'pages' | 'time';\r\n  value: number;\r\n  unit: string;\r\n}\r\n\r\n// ============= QUIZ RESULTS =============\r\nexport interface QuizResult {\r\n  id: string;\r\n  quizId: string;\r\n  quizTitle: string; // Denormalized\r\n  userId: string;\r\n  userName: string; // Denormalized\r\n  userAvatar: string | null; // Denormalized\r\n  \r\n  // Scores\r\n  score: number;\r\n  percentage: number;\r\n  totalQuestions: number;\r\n  correctAnswers: number;\r\n  wrongAnswers: number;\r\n  skippedAnswers: number;\r\n  \r\n  // Timing\r\n  timeSpent: number; // seconds\r\n  startedAt: Timestamp;\r\n  completedAt: Timestamp;\r\n  \r\n  // Details\r\n  answers: QuestionAnswer[];\r\n  \r\n  // Context\r\n  mode: 'normal' | 'multiplayer' | 'practice';\r\n  multiplayerRoomId: string | null;\r\n}\r\n\r\nexport interface QuestionAnswer {\r\n  questionId: string;\r\n  selectedAnswerId: string | null;\r\n  selectedAnswer: string | null; // For text answers\r\n  isCorrect: boolean;\r\n  points: number;\r\n  timeSpent: number; // seconds\r\n}\r\n\r\n// ============= REVIEW & RATING =============\r\nexport interface QuizReview {\r\n  id: string;\r\n  quizId: string;\r\n  userId: string;\r\n  userName: string; // Denormalized\r\n  userAvatar: string | null; // Denormalized\r\n  \r\n  rating: number; // 1-5\r\n  comment: string;\r\n  \r\n  // Moderation\r\n  isApproved: boolean;\r\n  isFlagged: boolean;\r\n  \r\n  // Engagement\r\n  helpfulCount: number;\r\n  reportCount: number;\r\n  \r\n  createdAt: Timestamp;\r\n  updatedAt: Timestamp;\r\n}\r\n\r\n// ============= MULTIPLAYER MODELS =============\r\nexport interface MultiplayerRoom {\r\n  id: string;\r\n  code: string;\r\n  quizId: string;\r\n  quizTitle: string; // Denormalized\r\n  \r\n  // Host\r\n  hostId: string;\r\n  hostName: string; // Denormalized\r\n  \r\n  // Settings\r\n  maxPlayers: number;\r\n  isPrivate: boolean;\r\n  allowLateJoin: boolean;\r\n  \r\n  // Status\r\n  status: 'waiting' | 'playing' | 'finished';\r\n  currentQuestionIndex: number;\r\n  \r\n  // Stats\r\n  playerCount: number;\r\n  \r\n  // Timestamps\r\n  createdAt: Timestamp;\r\n  startedAt: Timestamp | null;\r\n  finishedAt: Timestamp | null;\r\n  expiresAt: Timestamp;\r\n}\r\n\r\nexport interface MultiplayerPlayer {\r\n  userId: string;\r\n  userName: string;\r\n  userAvatar: string | null;\r\n  \r\n  isReady: boolean;\r\n  isHost: boolean;\r\n  isOnline: boolean;\r\n  \r\n  score: number;\r\n  correctAnswers: number;\r\n  \r\n  joinedAt: Timestamp;\r\n  lastActivityAt: Timestamp;\r\n}\r\n\r\nexport interface MultiplayerMessage {\r\n  id: string;\r\n  userId: string;\r\n  userName: string;\r\n  userAvatar: string | null;\r\n  \r\n  type: 'chat' | 'system' | 'reaction';\r\n  content: string;\r\n  \r\n  createdAt: Timestamp;\r\n}\r\n\r\n// ============= LEARNING SESSION =============\r\nexport interface UserQuizSession {\r\n  id: string; // Format: `${quizId}_${userId}`\r\n  userId: string;\r\n  quizId: string;\r\n  \r\n  // Progress\r\n  viewedResources: Record<string, ResourceProgress>;\r\n  completionPercent: number;\r\n  ready: boolean; // Can start quiz\r\n  \r\n  // Timestamps\r\n  startedAt: Timestamp;\r\n  updatedAt: Timestamp;\r\n  lastActivityAt: Timestamp;\r\n}\r\n\r\nexport interface ResourceProgress {\r\n  resourceId: string;\r\n  completed: boolean;\r\n  \r\n  // Video/Audio tracking\r\n  secondsWatched: number;\r\n  watchPercent: number;\r\n  playbackSpeed: number;\r\n  tabBlurred: boolean;\r\n  \r\n  // PDF tracking\r\n  pagesViewed: number[];\r\n  totalPages: number;\r\n  \r\n  // Image tracking\r\n  viewCount: number;\r\n  timeSpent: number;\r\n  \r\n  // Link tracking\r\n  visited: boolean;\r\n  confirmChecked: boolean;\r\n  miniCheckPassed: boolean;\r\n  \r\n  lastActivityAt: Timestamp;\r\n}\r\n\r\n// ============= ANALYTICS =============\r\nexport interface LearningEvent {\r\n  id: string;\r\n  userId: string;\r\n  quizId: string;\r\n  resourceId: string;\r\n  \r\n  eventType: \r\n    | 'video_play' \r\n    | 'video_pause' \r\n    | 'video_complete'\r\n    | 'pdf_page_view'\r\n    | 'pdf_complete'\r\n    | 'image_view'\r\n    | 'link_visit'\r\n    | 'resource_completed';\r\n  \r\n  metadata: Record<string, any>;\r\n  \r\n  timestamp: Timestamp;\r\n  sessionId: string;\r\n}\r\n\r\n// ============= SYSTEM =============\r\nexport interface SystemNotification {\r\n  id: string;\r\n  type: 'info' | 'warning' | 'error' | 'success';\r\n  title: string;\r\n  message: string;\r\n  \r\n  isActive: boolean;\r\n  priority: number;\r\n  \r\n  targetUsers: string[] | null; // null = all users\r\n  \r\n  createdBy: string;\r\n  createdAt: Timestamp;\r\n  updatedAt: Timestamp;\r\n  expiresAt: Timestamp | null;\r\n}\r\n\r\nexport interface Category {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  iconUrl: string; // ‚úÖ Storage URL\r\n  color: string;\r\n  \r\n  quizCount: number;\r\n  order: number;\r\n  isActive: boolean;\r\n  \r\n  createdAt: Timestamp;\r\n  updatedAt: Timestamp;\r\n}\r\n\r\n// ============= FAVORITES =============\r\nexport interface UserFavorites {\r\n  userId: string;\r\n  quizIds: string[];\r\n  updatedAt: Timestamp;\r\n}\r\n\r\n// ============= TYPE GUARDS =============\r\nexport const isQuiz = (data: any): data is Quiz =>\r\n  data && typeof data.title === 'string' && Array.isArray(data.questions);\r\n\r\nexport const isUserProfile = (data: any): data is UserProfile =>\r\n  data && typeof data.uid === 'string' && typeof data.email === 'string';\r\n\r\nexport const isQuizResult = (data: any): data is QuizResult =>\r\n  data && typeof data.quizId === 'string' && typeof data.userId === 'string' && typeof data.score === 'number';\r\n\r\n// ============= DATA CLEANERS =============\r\n/**\r\n * Clean data before saving to Firestore\r\n * Removes undefined values and applies defaults\r\n */\r\nexport const cleanQuizData = (quiz: Partial<Quiz>): Partial<Quiz> => ({\r\n  ...quiz,\r\n  title: quiz.title || '',\r\n  description: quiz.description || '',\r\n  category: quiz.category || '',\r\n  difficulty: quiz.difficulty || 'medium',\r\n  duration: quiz.duration || 15,\r\n  imageUrl: quiz.imageUrl || null,\r\n  questions: quiz.questions || [],\r\n  resources: quiz.resources || [],\r\n  tags: quiz.tags || [],\r\n  language: quiz.language || 'vi',\r\n  status: quiz.status || 'draft',\r\n  isPublished: quiz.isPublished ?? false,\r\n  isPublic: quiz.isPublic ?? true,\r\n  allowRetake: quiz.allowRetake ?? true,\r\n  showAnswers: quiz.showAnswers ?? true,\r\n  randomizeQuestions: quiz.randomizeQuestions ?? false,\r\n  randomizeAnswers: quiz.randomizeAnswers ?? false,\r\n  passingScore: quiz.passingScore ?? 60,\r\n  attempts: quiz.attempts ?? 0,\r\n  completions: quiz.completions ?? 0,\r\n  averageScore: quiz.averageScore ?? 0,\r\n  totalPlayers: quiz.totalPlayers ?? 0,\r\n  rating: quiz.rating ?? 0,\r\n  reviewCount: quiz.reviewCount ?? 0,\r\n});\r\n\r\nexport const cleanQuestionData = (question: Partial<Question>): Partial<Question> => ({\r\n  ...question,\r\n  text: question.text || '',\r\n  type: question.type || 'multiple',\r\n  imageUrl: question.imageUrl || null,\r\n  answers: question.answers || [],\r\n  correctAnswer: question.correctAnswer || null,\r\n  acceptedAnswers: question.acceptedAnswers || [],\r\n  explanation: question.explanation || '',\r\n  points: question.points ?? 1,\r\n  timeLimit: question.timeLimit || null,\r\n  order: question.order ?? 0,\r\n});\r\n\r\nexport const cleanResourceData = (resource: Partial<LearningResource>): Partial<LearningResource> => ({\r\n  ...resource,\r\n  title: resource.title || '',\r\n  description: resource.description || '',\r\n  url: resource.url || '',\r\n  duration: resource.duration || null,\r\n  size: resource.size || null,\r\n  mimeType: resource.mimeType || null,\r\n  thumbnailUrl: resource.thumbnailUrl || null,\r\n  required: resource.required ?? false,\r\n  threshold: resource.threshold || { type: 'percentage', value: 80, unit: '%' },\r\n  estimatedTime: resource.estimatedTime ?? 5,\r\n  order: resource.order ?? 0,\r\n  category: resource.category || null,\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\services\\firebase\\firestoreService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2549,2552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2549,2552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3101,3104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3101,3104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4257,4260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4257,4260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":354,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":354,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9621,9624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9621,9624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":358,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":358,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9757,9760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9757,9760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":366,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9970,9973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9970,9973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":394,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":394,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10754,10757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10754,10757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":401,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":401,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10874,10877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10874,10877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":407,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11110,11113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11110,11113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":457,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":457,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12380,12383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12380,12383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":463,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":463,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12498,12501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12498,12501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":474,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":474,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12819,12822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12819,12822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":515,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":515,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14165,14168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14165,14168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":515,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":515,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14171,14174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14171,14174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":516,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":516,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14198,14201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14198,14201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * üî• Unified Firestore Service\r\n * Centralized service layer cho t·∫•t c·∫£ Firestore operations\r\n * H·ªó tr·ª£: Type-safety, Offline mode, Cache management\r\n */\r\n\r\nimport {\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  setDoc,\r\n  addDoc,\r\n  updateDoc,\r\n  deleteDoc,\r\n  collection,\r\n  query,\r\n  where,\r\n  orderBy,\r\n  limit,\r\n  startAfter,\r\n  DocumentSnapshot,\r\n  QueryConstraint,\r\n  serverTimestamp,\r\n  writeBatch,\r\n  DocumentData,\r\n  WithFieldValue,\r\n  PartialWithFieldValue,\r\n} from 'firebase/firestore';\r\nimport { db } from '../../firebase/config';\r\nimport { COLLECTIONS, compositeKeys } from './collections';\r\nimport type {\r\n  Quiz,\r\n  UserProfile,\r\n  QuizResult,\r\n  QuizReview,\r\n  UserQuizSession,\r\n  MultiplayerRoom,\r\n  SystemNotification,\r\n  Category,\r\n  UserFavorites,\r\n} from './dataModels';\r\n\r\n// ============= GENERIC CRUD OPERATIONS =============\r\n\r\nexport class FirestoreService<T extends DocumentData> {\r\n  protected collectionName: string;\r\n  \r\n  constructor(collectionName: string) {\r\n    this.collectionName = collectionName;\r\n  }\r\n\r\n  /**\r\n   * Get single document by ID\r\n   */\r\n  async getById(docId: string): Promise<T | null> {\r\n    try {\r\n      const docRef = doc(db, this.collectionName, docId);\r\n      const docSnap = await getDoc(docRef);\r\n      \r\n      if (!docSnap.exists()) {\r\n        return null;\r\n      }\r\n      \r\n      return { id: docSnap.id, ...docSnap.data() } as unknown as T;\r\n    } catch (error) {\r\n      console.error(`[Firestore] Error getting document from ${this.collectionName}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get multiple documents with query constraints\r\n   */\r\n  async getMany(constraints: QueryConstraint[] = []): Promise<T[]> {\r\n    try {\r\n      const collectionRef = collection(db, this.collectionName);\r\n      const q = query(collectionRef, ...constraints);\r\n      const snapshot = await getDocs(q);\r\n      \r\n      return snapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      })) as unknown as T[];\r\n    } catch (error) {\r\n      console.error(`[Firestore] Error getting documents from ${this.collectionName}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all documents (use with caution!)\r\n   */\r\n  async getAll(): Promise<T[]> {\r\n    return this.getMany();\r\n  }\r\n\r\n  /**\r\n   * Create new document with auto-generated ID\r\n   */\r\n  async create(data: WithFieldValue<Partial<T>>): Promise<string> {\r\n    try {\r\n      const collectionRef = collection(db, this.collectionName);\r\n      const docRef = await addDoc(collectionRef, {\r\n        ...(data as any),\r\n        createdAt: serverTimestamp(),\r\n        updatedAt: serverTimestamp(),\r\n      });\r\n      \r\n      return docRef.id;\r\n    } catch (error) {\r\n      console.error(`[Firestore] Error creating document in ${this.collectionName}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set document with specific ID (overwrites existing)\r\n   */\r\n  async set(docId: string, data: WithFieldValue<Partial<T>>): Promise<void> {\r\n    try {\r\n      const docRef = doc(db, this.collectionName, docId);\r\n      await setDoc(docRef, {\r\n        ...(data as any),\r\n        updatedAt: serverTimestamp(),\r\n      });\r\n    } catch (error) {\r\n      console.error(`[Firestore] Error setting document in ${this.collectionName}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update existing document (merge)\r\n   */\r\n  async update(docId: string, data: PartialWithFieldValue<T>): Promise<void> {\r\n    try {\r\n      const docRef = doc(db, this.collectionName, docId);\r\n      await updateDoc(docRef, {\r\n        ...data,\r\n        updatedAt: serverTimestamp(),\r\n      });\r\n    } catch (error) {\r\n      console.error(`[Firestore] Error updating document in ${this.collectionName}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete document\r\n   */\r\n  async delete(docId: string): Promise<void> {\r\n    try {\r\n      const docRef = doc(db, this.collectionName, docId);\r\n      await deleteDoc(docRef);\r\n    } catch (error) {\r\n      console.error(`[Firestore] Error deleting document in ${this.collectionName}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Batch write operations\r\n   */\r\n  async batchWrite(operations: Array<{\r\n    type: 'set' | 'update' | 'delete';\r\n    docId: string;\r\n    data?: any;\r\n  }>): Promise<void> {\r\n    try {\r\n      const batch = writeBatch(db);\r\n      \r\n      for (const op of operations) {\r\n        const docRef = doc(db, this.collectionName, op.docId);\r\n        \r\n        switch (op.type) {\r\n          case 'set':\r\n            batch.set(docRef, { ...op.data, updatedAt: serverTimestamp() });\r\n            break;\r\n          case 'update':\r\n            batch.update(docRef, { ...op.data, updatedAt: serverTimestamp() });\r\n            break;\r\n          case 'delete':\r\n            batch.delete(docRef);\r\n            break;\r\n        }\r\n      }\r\n      \r\n      await batch.commit();\r\n    } catch (error) {\r\n      console.error(`[Firestore] Error in batch write for ${this.collectionName}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Paginated query\r\n   */\r\n  async getPaginated(\r\n    constraints: QueryConstraint[] = [],\r\n    pageSize: number = 20,\r\n    lastDoc?: DocumentSnapshot\r\n  ): Promise<{ data: T[]; lastDoc: DocumentSnapshot | null }> {\r\n    try {\r\n      const collectionRef = collection(db, this.collectionName);\r\n      const queryConstraints = [\r\n        ...constraints,\r\n        limit(pageSize),\r\n      ];\r\n      \r\n      if (lastDoc) {\r\n        queryConstraints.push(startAfter(lastDoc));\r\n      }\r\n      \r\n      const q = query(collectionRef, ...queryConstraints);\r\n      const snapshot = await getDocs(q);\r\n      \r\n      const data = snapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      })) as unknown as T[];\r\n      \r\n      const newLastDoc = snapshot.docs[snapshot.docs.length - 1] || null;\r\n      \r\n      return { data, lastDoc: newLastDoc };\r\n    } catch (error) {\r\n      console.error(`[Firestore] Error in paginated query for ${this.collectionName}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\n// ============= SPECIALIZED SERVICES =============\r\n\r\n/**\r\n * Quiz Service\r\n */\r\nexport class QuizService extends FirestoreService<Quiz> {\r\n  constructor() {\r\n    super(COLLECTIONS.QUIZZES);\r\n  }\r\n\r\n  async getPublishedQuizzes(): Promise<Quiz[]> {\r\n    return this.getMany([\r\n      where('isPublished', '==', true),\r\n      orderBy('createdAt', 'desc'),\r\n    ]);\r\n  }\r\n\r\n  async getQuizzesByCategory(category: string): Promise<Quiz[]> {\r\n    return this.getMany([\r\n      where('category', '==', category),\r\n      where('isPublished', '==', true),\r\n      orderBy('createdAt', 'desc'),\r\n    ]);\r\n  }\r\n\r\n  async getQuizzesByCreator(userId: string): Promise<Quiz[]> {\r\n    return this.getMany([\r\n      where('createdBy', '==', userId),\r\n      orderBy('createdAt', 'desc'),\r\n    ]);\r\n  }\r\n\r\n  async searchQuizzes(searchTerm: string): Promise<Quiz[]> {\r\n    // Note: Firestore doesn't support full-text search\r\n    // Use Algolia or implement client-side filtering\r\n    const allQuizzes = await this.getPublishedQuizzes();\r\n    const lowerSearch = searchTerm.toLowerCase();\r\n    \r\n    return allQuizzes.filter(quiz =>\r\n      quiz.title.toLowerCase().includes(lowerSearch) ||\r\n      quiz.description.toLowerCase().includes(lowerSearch) ||\r\n      quiz.tags.some(tag => tag.toLowerCase().includes(lowerSearch))\r\n    );\r\n  }\r\n\r\n  async incrementAttempts(quizId: string): Promise<void> {\r\n    const quizRef = doc(db, this.collectionName, quizId);\r\n    const quizDoc = await getDoc(quizRef);\r\n    \r\n    if (quizDoc.exists()) {\r\n      const currentAttempts = quizDoc.data().attempts || 0;\r\n      await updateDoc(quizRef, {\r\n        attempts: currentAttempts + 1,\r\n        updatedAt: serverTimestamp(),\r\n      });\r\n    }\r\n  }\r\n\r\n  async updateStats(quizId: string, score: number): Promise<void> {\r\n    const quizRef = doc(db, this.collectionName, quizId);\r\n    const quizDoc = await getDoc(quizRef);\r\n    \r\n    if (quizDoc.exists()) {\r\n      const data = quizDoc.data();\r\n      const currentTotal = (data.averageScore || 0) * (data.completions || 0);\r\n      const newCompletions = (data.completions || 0) + 1;\r\n      const newAverage = (currentTotal + score) / newCompletions;\r\n      \r\n      await updateDoc(quizRef, {\r\n        completions: newCompletions,\r\n        averageScore: Math.round(newAverage * 100) / 100,\r\n        totalPlayers: (data.totalPlayers || 0) + 1,\r\n        updatedAt: serverTimestamp(),\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Quiz Results Service\r\n */\r\nexport class QuizResultsService extends FirestoreService<QuizResult> {\r\n  constructor() {\r\n    super(COLLECTIONS.QUIZ_RESULTS);\r\n  }\r\n\r\n  async getUserResults(userId: string, limitCount: number = 50): Promise<QuizResult[]> {\r\n    return this.getMany([\r\n      where('userId', '==', userId),\r\n      orderBy('completedAt', 'desc'),\r\n      limit(limitCount),\r\n    ]);\r\n  }\r\n\r\n  async getQuizLeaderboard(quizId: string, limitCount: number = 10): Promise<QuizResult[]> {\r\n    return this.getMany([\r\n      where('quizId', '==', quizId),\r\n      orderBy('score', 'desc'),\r\n      limit(limitCount),\r\n    ]);\r\n  }\r\n\r\n  async getGlobalLeaderboard(limitCount: number = 100): Promise<QuizResult[]> {\r\n    return this.getMany([\r\n      orderBy('score', 'desc'),\r\n      orderBy('completedAt', 'desc'),\r\n      limit(limitCount),\r\n    ]);\r\n  }\r\n}\r\n\r\n/**\r\n * User Service\r\n */\r\nexport class UserService extends FirestoreService<UserProfile> {\r\n  constructor() {\r\n    super(COLLECTIONS.USERS);\r\n  }\r\n\r\n  async updateLastLogin(userId: string): Promise<void> {\r\n    await this.update(userId, {\r\n      lastLoginAt: serverTimestamp(),\r\n    } as any);\r\n  }\r\n\r\n  async updateRole(userId: string, role: UserProfile['role']): Promise<void> {\r\n    await this.update(userId, { role } as any);\r\n  }\r\n\r\n  async toggleActive(userId: string): Promise<void> {\r\n    const user = await this.getById(userId);\r\n    if (user) {\r\n      await this.update(userId, {\r\n        isActive: !user.isActive,\r\n      } as any);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Learning Session Service\r\n */\r\nexport class LearningSessionService extends FirestoreService<UserQuizSession> {\r\n  constructor() {\r\n    super(COLLECTIONS.USER_QUIZ_SESSIONS);\r\n  }\r\n\r\n  async getSession(quizId: string, userId: string): Promise<UserQuizSession | null> {\r\n    const sessionId = compositeKeys.userQuizSession(quizId, userId);\r\n    return this.getById(sessionId);\r\n  }\r\n\r\n  async initSession(quizId: string, userId: string): Promise<void> {\r\n    const sessionId = compositeKeys.userQuizSession(quizId, userId);\r\n    await this.set(sessionId, {\r\n      userId,\r\n      quizId,\r\n      viewedResources: {},\r\n      completionPercent: 0,\r\n      ready: false,\r\n      startedAt: serverTimestamp(),\r\n      lastActivityAt: serverTimestamp(),\r\n    } as any);\r\n  }\r\n\r\n  async updateProgress(\r\n    quizId: string,\r\n    userId: string,\r\n    resourceId: string,\r\n    progress: any\r\n  ): Promise<void> {\r\n    const sessionId = compositeKeys.userQuizSession(quizId, userId);\r\n    await this.update(sessionId, {\r\n      [`viewedResources.${resourceId}`]: progress,\r\n      lastActivityAt: serverTimestamp(),\r\n    } as any);\r\n  }\r\n}\r\n\r\n/**\r\n * Multiplayer Room Service\r\n */\r\nexport class MultiplayerRoomService extends FirestoreService<MultiplayerRoom> {\r\n  constructor() {\r\n    super(COLLECTIONS.MULTIPLAYER_ROOMS);\r\n  }\r\n\r\n  async getRoomByCode(code: string): Promise<MultiplayerRoom | null> {\r\n    const rooms = await this.getMany([\r\n      where('code', '==', code),\r\n      limit(1),\r\n    ]);\r\n    \r\n    return rooms[0] || null;\r\n  }\r\n\r\n  async getActiveRooms(): Promise<MultiplayerRoom[]> {\r\n    return this.getMany([\r\n      where('status', 'in', ['waiting', 'playing']),\r\n      orderBy('createdAt', 'desc'),\r\n    ]);\r\n  }\r\n}\r\n\r\n/**\r\n * Favorites Service\r\n */\r\nexport class FavoritesService extends FirestoreService<UserFavorites> {\r\n  constructor() {\r\n    super(COLLECTIONS.USER_FAVORITES);\r\n  }\r\n\r\n  async getUserFavorites(userId: string): Promise<string[]> {\r\n    const favDoc = await this.getById(userId);\r\n    return favDoc?.quizIds || [];\r\n  }\r\n\r\n  async addFavorite(userId: string, quizId: string): Promise<void> {\r\n    const favDoc = await this.getById(userId);\r\n    \r\n    if (favDoc) {\r\n      const currentFavs = favDoc.quizIds || [];\r\n      if (!currentFavs.includes(quizId)) {\r\n        await this.update(userId, {\r\n          quizIds: [...currentFavs, quizId],\r\n        } as any);\r\n      }\r\n    } else {\r\n      await this.set(userId, {\r\n        userId,\r\n        quizIds: [quizId],\r\n      } as any);\r\n    }\r\n  }\r\n\r\n  async removeFavorite(userId: string, quizId: string): Promise<void> {\r\n    const favDoc = await this.getById(userId);\r\n    \r\n    if (favDoc) {\r\n      const currentFavs = favDoc.quizIds || [];\r\n      await this.update(userId, {\r\n        quizIds: currentFavs.filter(id => id !== quizId),\r\n      } as any);\r\n    }\r\n  }\r\n}\r\n\r\n// ============= EXPORT INSTANCES =============\r\nexport const quizService = new QuizService();\r\nexport const quizResultsService = new QuizResultsService();\r\nexport const userService = new UserService();\r\nexport const learningSessionService = new LearningSessionService();\r\nexport const multiplayerRoomService = new MultiplayerRoomService();\r\nexport const favoritesService = new FavoritesService();\r\n\r\n// Generic services for other collections\r\nexport const reviewService = new FirestoreService<QuizReview>(COLLECTIONS.QUIZ_REVIEWS);\r\nexport const categoryService = new FirestoreService<Category>(COLLECTIONS.CATEGORIES);\r\nexport const notificationService = new FirestoreService<SystemNotification>(COLLECTIONS.SYSTEM_NOTIFICATIONS);\r\n\r\n// ============= UTILITY FUNCTIONS =============\r\n\r\n/**\r\n * Check if user has permission\r\n */\r\nexport const hasPermission = async (\r\n  userId: string,\r\n  resourceOwnerId: string,\r\n  requiredRole?: UserProfile['role']\r\n): Promise<boolean> => {\r\n  const user = await userService.getById(userId);\r\n  \r\n  if (!user) return false;\r\n  if (user.role === 'admin') return true;\r\n  if (requiredRole && user.role !== requiredRole) return false;\r\n  if (userId === resourceOwnerId) return true;\r\n  \r\n  return false;\r\n};\r\n\r\n/**\r\n * Clean data helper\r\n */\r\nexport const cleanDataForFirestore = (data: any): any => {\r\n  const cleaned: any = {};\r\n  \r\n  for (const [key, value] of Object.entries(data)) {\r\n    if (value === undefined) {\r\n      // Skip undefined values\r\n      continue;\r\n    } else if (value === null) {\r\n      cleaned[key] = null;\r\n    } else if (Array.isArray(value)) {\r\n      cleaned[key] = value.map(item =>\r\n        typeof item === 'object' ? cleanDataForFirestore(item) : item\r\n      );\r\n    } else if (typeof value === 'object' && value !== null) {\r\n      cleaned[key] = cleanDataForFirestore(value);\r\n    } else {\r\n      cleaned[key] = value;\r\n    }\r\n  }\r\n  \r\n  return cleaned;\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\services\\firebase\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\services\\firebase\\storage.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3179,3182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3179,3182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3289,3292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3289,3292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3395,3398],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3395,3398],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3505,3508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3505,3508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4033,4036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4033,4036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * üìÅ Cloud Storage Paths Constants\r\n * Centralized storage paths ƒë·ªÉ tr√°nh typo v√† d·ªÖ maintain\r\n */\r\n\r\n// ============= STORAGE FOLDERS =============\r\nexport const STORAGE_PATHS = {\r\n  // User uploads\r\n  AVATARS: 'avatars',\r\n  \r\n  // Quiz assets\r\n  QUIZ_COVERS: 'covers',\r\n  \r\n  // Questions\r\n  QUESTION_IMAGES: 'questions',\r\n  \r\n  // Learning Resources\r\n  RESOURCES: {\r\n    ROOT: 'resources',\r\n    VIDEOS: 'resources/videos',\r\n    PDFS: 'resources/pdfs',\r\n    IMAGES: 'resources/images',\r\n    AUDIOS: 'resources/audios',\r\n  },\r\n  \r\n  // Thumbnails (auto-generated by Extension)\r\n  THUMBNAILS: 'thumbnails',\r\n  \r\n  // Temporary uploads (cleanup after 24h)\r\n  TEMP: 'temp',\r\n} as const;\r\n\r\n// ============= PATH BUILDERS =============\r\nexport const storagePaths = {\r\n  // User avatar\r\n  userAvatar: (userId: string, ext: string = 'jpg') => \r\n    `${STORAGE_PATHS.AVATARS}/${userId}.${ext}`,\r\n  \r\n  // Quiz cover\r\n  quizCover: (quizId: string, ext: string = 'jpg') => \r\n    `${STORAGE_PATHS.QUIZ_COVERS}/${quizId}.${ext}`,\r\n  \r\n  // Question image\r\n  questionImage: (quizId: string, questionId: string, ext: string = 'jpg') => \r\n    `${STORAGE_PATHS.QUESTION_IMAGES}/${quizId}/${questionId}.${ext}`,\r\n  \r\n  // Learning resources\r\n  learningVideo: (quizId: string, resourceId: string, ext: string = 'mp4') =>\r\n    `${STORAGE_PATHS.RESOURCES.VIDEOS}/${quizId}/${resourceId}.${ext}`,\r\n  \r\n  learningPDF: (quizId: string, resourceId: string) =>\r\n    `${STORAGE_PATHS.RESOURCES.PDFS}/${quizId}/${resourceId}.pdf`,\r\n  \r\n  learningImage: (quizId: string, resourceId: string, ext: string = 'jpg') =>\r\n    `${STORAGE_PATHS.RESOURCES.IMAGES}/${quizId}/${resourceId}.${ext}`,\r\n  \r\n  learningAudio: (quizId: string, resourceId: string, ext: string = 'mp3') =>\r\n    `${STORAGE_PATHS.RESOURCES.AUDIOS}/${quizId}/${resourceId}.${ext}`,\r\n  \r\n  // Thumbnail (generated)\r\n  thumbnail: (originalPath: string, size: '200x200' | '400x400' | '800x800') => {\r\n    const fileName = originalPath.split('/').pop()?.split('.')[0];\r\n    const ext = originalPath.split('.').pop();\r\n    return `${STORAGE_PATHS.THUMBNAILS}/${fileName}_${size}.${ext}`;\r\n  },\r\n  \r\n  // Temporary upload\r\n  tempFile: (userId: string, filename: string) =>\r\n    `${STORAGE_PATHS.TEMP}/${userId}/${filename}`,\r\n};\r\n\r\n// ============= FILE TYPES =============\r\nexport const FILE_TYPES = {\r\n  IMAGE: {\r\n    mimeTypes: ['image/jpeg', 'image/png', 'image/webp', 'image/gif'],\r\n    extensions: ['.jpg', '.jpeg', '.png', '.webp', '.gif'],\r\n    maxSize: 10 * 1024 * 1024, // 10MB\r\n  },\r\n  VIDEO: {\r\n    mimeTypes: ['video/mp4', 'video/webm', 'video/quicktime'],\r\n    extensions: ['.mp4', '.webm', '.mov'],\r\n    maxSize: 100 * 1024 * 1024, // 100MB\r\n  },\r\n  PDF: {\r\n    mimeTypes: ['application/pdf'],\r\n    extensions: ['.pdf'],\r\n    maxSize: 20 * 1024 * 1024, // 20MB\r\n  },\r\n  AUDIO: {\r\n    mimeTypes: ['audio/mpeg', 'audio/wav', 'audio/ogg'],\r\n    extensions: ['.mp3', '.wav', '.ogg'],\r\n    maxSize: 20 * 1024 * 1024, // 20MB\r\n  },\r\n} as const;\r\n\r\n// ============= VALIDATION HELPERS =============\r\nexport const storageValidation = {\r\n  isValidImageType: (file: File): boolean =>\r\n    FILE_TYPES.IMAGE.mimeTypes.includes(file.type as any),\r\n  \r\n  isValidVideoType: (file: File): boolean =>\r\n    FILE_TYPES.VIDEO.mimeTypes.includes(file.type as any),\r\n  \r\n  isValidPDFType: (file: File): boolean =>\r\n    FILE_TYPES.PDF.mimeTypes.includes(file.type as any),\r\n  \r\n  isValidAudioType: (file: File): boolean =>\r\n    FILE_TYPES.AUDIO.mimeTypes.includes(file.type as any),\r\n  \r\n  isValidFileSize: (file: File, type: keyof typeof FILE_TYPES): boolean =>\r\n    file.size <= FILE_TYPES[type].maxSize,\r\n  \r\n  getFileExtension: (filename: string): string =>\r\n    filename.slice(filename.lastIndexOf('.')),\r\n};\r\n\r\n// ============= CLEANUP RULES =============\r\nexport const CLEANUP_RULES = {\r\n  TEMP_FILES_LIFETIME: 24 * 60 * 60 * 1000, // 24 hours\r\n  ORPHANED_FILES_CHECK_INTERVAL: 7 * 24 * 60 * 60 * 1000, // 7 days\r\n};\r\n\r\nexport type StoragePath = string;\r\nexport type StoragePathBuilder = (...args: any[]) => StoragePath;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\services\\firebase\\storageService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4608,4611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4608,4611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":209,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5523,5526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5523,5526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5840,5843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5840,5843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * üìÅ Unified Storage Service\r\n * Centralized service layer cho t·∫•t c·∫£ Cloud Storage operations\r\n * H·ªó tr·ª£: Upload, Download, Delete, URL generation\r\n */\r\n\r\nimport {\r\n  ref,\r\n  uploadBytes,\r\n  uploadBytesResumable,\r\n  getDownloadURL,\r\n  deleteObject,\r\n  listAll,\r\n  getMetadata,\r\n  updateMetadata,\r\n  StorageReference,\r\n} from 'firebase/storage';\r\nimport { storage } from '../../firebase/config';\r\nimport { storagePaths, storageValidation, FILE_TYPES } from './storage';\r\n\r\n// ============= UPLOAD OPTIONS =============\r\nexport interface UploadOptions {\r\n  onProgress?: (progress: number) => void;\r\n  onComplete?: (url: string) => void;\r\n  onError?: (error: Error) => void;\r\n  \r\n  // Compression settings\r\n  compress?: boolean;\r\n  quality?: number; // 0-1 for images\r\n  maxWidth?: number;\r\n  maxHeight?: number;\r\n  \r\n  // Metadata\r\n  metadata?: {\r\n    contentType?: string;\r\n    customMetadata?: Record<string, string>;\r\n  };\r\n}\r\n\r\nexport interface UploadResult {\r\n  url: string;\r\n  path: string;\r\n  size: number;\r\n  contentType: string;\r\n  thumbnails?: {\r\n    small: string;\r\n    medium: string;\r\n    large: string;\r\n  };\r\n}\r\n\r\n// ============= STORAGE SERVICE =============\r\nexport class StorageService {\r\n  /**\r\n   * Upload file to Storage\r\n   */\r\n  async uploadFile(\r\n    file: File,\r\n    path: string,\r\n    options: UploadOptions = {}\r\n  ): Promise<UploadResult> {\r\n    try {\r\n      // Validate file\r\n      this.validateFile(file);\r\n      \r\n      // Compress if needed\r\n      const fileToUpload = options.compress\r\n        ? await this.compressFile(file, options)\r\n        : file;\r\n      \r\n      // Create storage reference\r\n      const storageRef = ref(storage, path);\r\n      \r\n      // Set metadata\r\n      const metadata = {\r\n        contentType: file.type,\r\n        ...options.metadata,\r\n        customMetadata: {\r\n          originalName: file.name,\r\n          uploadedAt: new Date().toISOString(),\r\n          ...options.metadata?.customMetadata,\r\n        },\r\n      };\r\n      \r\n      // Upload\r\n      if (options.onProgress) {\r\n        // Resumable upload with progress\r\n        const uploadTask = uploadBytesResumable(storageRef, fileToUpload, metadata);\r\n        \r\n        return new Promise((resolve, reject) => {\r\n          uploadTask.on(\r\n            'state_changed',\r\n            (snapshot) => {\r\n              const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\r\n              options.onProgress?.(progress);\r\n            },\r\n            (error) => {\r\n              options.onError?.(error);\r\n              reject(error);\r\n            },\r\n            async () => {\r\n              const url = await getDownloadURL(uploadTask.snapshot.ref);\r\n              const result: UploadResult = {\r\n                url,\r\n                path,\r\n                size: uploadTask.snapshot.totalBytes,\r\n                contentType: uploadTask.snapshot.metadata.contentType || file.type,\r\n              };\r\n              \r\n              options.onComplete?.(url);\r\n              resolve(result);\r\n            }\r\n          );\r\n        });\r\n      } else {\r\n        // Simple upload\r\n        const snapshot = await uploadBytes(storageRef, fileToUpload, metadata);\r\n        const url = await getDownloadURL(snapshot.ref);\r\n        \r\n        return {\r\n          url,\r\n          path,\r\n          size: snapshot.metadata.size,\r\n          contentType: snapshot.metadata.contentType || file.type,\r\n        };\r\n      }\r\n    } catch (error) {\r\n      console.error('[Storage] Upload error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Upload with instant preview (WebP compression)\r\n   */\r\n  async uploadWithInstantPreview(\r\n    file: File,\r\n    path: string,\r\n    options: UploadOptions = {}\r\n  ): Promise<{ previewUrl: string; finalUrl: Promise<UploadResult> }> {\r\n    // Create instant preview\r\n    const previewUrl = URL.createObjectURL(file);\r\n    \r\n    // Start background upload\r\n    const finalUrl = this.uploadFile(file, path, {\r\n      ...options,\r\n      compress: true,\r\n      quality: 0.8,\r\n    });\r\n    \r\n    return { previewUrl, finalUrl };\r\n  }\r\n\r\n  /**\r\n   * Get download URL from path\r\n   */\r\n  async getDownloadUrl(path: string): Promise<string> {\r\n    try {\r\n      const storageRef = ref(storage, path);\r\n      return await getDownloadURL(storageRef);\r\n    } catch (error) {\r\n      console.error('[Storage] Get URL error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete file\r\n   */\r\n  async deleteFile(path: string): Promise<void> {\r\n    try {\r\n      const storageRef = ref(storage, path);\r\n      await deleteObject(storageRef);\r\n    } catch (error: any) {\r\n      // Ignore if file doesn't exist\r\n      if (error.code === 'storage/object-not-found') {\r\n        console.warn('[Storage] File not found, already deleted:', path);\r\n        return;\r\n      }\r\n      console.error('[Storage] Delete error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete multiple files\r\n   */\r\n  async deleteFiles(paths: string[]): Promise<void> {\r\n    await Promise.all(paths.map(path => this.deleteFile(path)));\r\n  }\r\n\r\n  /**\r\n   * List all files in folder\r\n   */\r\n  async listFiles(folderPath: string): Promise<StorageReference[]> {\r\n    try {\r\n      const folderRef = ref(storage, folderPath);\r\n      const result = await listAll(folderRef);\r\n      return result.items;\r\n    } catch (error) {\r\n      console.error('[Storage] List files error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get file metadata\r\n   */\r\n  async getMetadata(path: string): Promise<any> {\r\n    try {\r\n      const storageRef = ref(storage, path);\r\n      return await getMetadata(storageRef);\r\n    } catch (error) {\r\n      console.error('[Storage] Get metadata error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update file metadata\r\n   */\r\n  async updateMetadata(path: string, metadata: any): Promise<void> {\r\n    try {\r\n      const storageRef = ref(storage, path);\r\n      await updateMetadata(storageRef, metadata);\r\n    } catch (error) {\r\n      console.error('[Storage] Update metadata error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get thumbnail URLs (from Resize Images Extension)\r\n   */\r\n  async getThumbnailUrls(\r\n    originalPath: string,\r\n    maxRetries: number = 10,\r\n    delayMs: number = 2000\r\n  ): Promise<{ small: string; medium: string; large: string }> {\r\n    const sizes = ['200x200', '400x400', '800x800'] as const;\r\n    \r\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\r\n      try {\r\n        const [small, medium, large] = await Promise.all(\r\n          sizes.map(size => {\r\n            const thumbnailPath = storagePaths.thumbnail(originalPath, size);\r\n            return this.getDownloadUrl(thumbnailPath);\r\n          })\r\n        );\r\n        \r\n        return { small, medium, large };\r\n      } catch (error) {\r\n        if (attempt === maxRetries) {\r\n          console.warn('[Storage] Thumbnails not generated yet, using original');\r\n          const originalUrl = await this.getDownloadUrl(originalPath);\r\n          return {\r\n            small: originalUrl,\r\n            medium: originalUrl,\r\n            large: originalUrl,\r\n          };\r\n        }\r\n        \r\n        // Progressive delay\r\n        const delay = delayMs * Math.pow(1.2, attempt - 1);\r\n        await new Promise(resolve => setTimeout(resolve, delay));\r\n      }\r\n    }\r\n    \r\n    throw new Error('Failed to get thumbnails after max retries');\r\n  }\r\n\r\n  // ============= PRIVATE HELPERS =============\r\n\r\n  /**\r\n   * Validate file before upload\r\n   */\r\n  private validateFile(file: File): void {\r\n    // Check file type\r\n    const isImage = storageValidation.isValidImageType(file);\r\n    const isVideo = storageValidation.isValidVideoType(file);\r\n    const isPDF = storageValidation.isValidPDFType(file);\r\n    const isAudio = storageValidation.isValidAudioType(file);\r\n    \r\n    if (!isImage && !isVideo && !isPDF && !isAudio) {\r\n      throw new Error(`Unsupported file type: ${file.type}`);\r\n    }\r\n    \r\n    // Check file size\r\n    let fileType: keyof typeof FILE_TYPES;\r\n    if (isImage) fileType = 'IMAGE';\r\n    else if (isVideo) fileType = 'VIDEO';\r\n    else if (isPDF) fileType = 'PDF';\r\n    else fileType = 'AUDIO';\r\n    \r\n    if (!storageValidation.isValidFileSize(file, fileType)) {\r\n      const maxSize = FILE_TYPES[fileType].maxSize / (1024 * 1024);\r\n      throw new Error(`File too large. Max size: ${maxSize}MB`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Compress image file\r\n   */\r\n  private async compressFile(file: File, options: UploadOptions): Promise<File> {\r\n    if (!file.type.startsWith('image/')) {\r\n      return file; // Only compress images\r\n    }\r\n    \r\n    return new Promise((resolve) => {\r\n      const reader = new FileReader();\r\n      \r\n      reader.onload = (e) => {\r\n        const img = new Image();\r\n        \r\n        img.onload = () => {\r\n          const canvas = document.createElement('canvas');\r\n          const ctx = canvas.getContext('2d')!;\r\n          \r\n          // Calculate dimensions\r\n          let width = img.width;\r\n          let height = img.height;\r\n          \r\n          if (options.maxWidth && width > options.maxWidth) {\r\n            height = (height * options.maxWidth) / width;\r\n            width = options.maxWidth;\r\n          }\r\n          \r\n          if (options.maxHeight && height > options.maxHeight) {\r\n            width = (width * options.maxHeight) / height;\r\n            height = options.maxHeight;\r\n          }\r\n          \r\n          canvas.width = width;\r\n          canvas.height = height;\r\n          \r\n          // Draw and compress\r\n          ctx.drawImage(img, 0, 0, width, height);\r\n          \r\n          canvas.toBlob(\r\n            (blob) => {\r\n              if (blob) {\r\n                const compressedFile = new File([blob], file.name, {\r\n                  type: 'image/webp',\r\n                  lastModified: Date.now(),\r\n                });\r\n                resolve(compressedFile);\r\n              } else {\r\n                resolve(file); // Fallback to original\r\n              }\r\n            },\r\n            'image/webp',\r\n            options.quality || 0.8\r\n          );\r\n        };\r\n        \r\n        img.src = e.target?.result as string;\r\n      };\r\n      \r\n      reader.readAsDataURL(file);\r\n    });\r\n  }\r\n}\r\n\r\n// ============= SPECIALIZED UPLOAD SERVICES =============\r\n\r\n/**\r\n * Avatar Upload Service\r\n */\r\nexport class AvatarUploadService extends StorageService {\r\n  async uploadAvatar(userId: string, file: File): Promise<string> {\r\n    const path = storagePaths.userAvatar(userId, 'jpg');\r\n    \r\n    const result = await this.uploadFile(file, path, {\r\n      compress: true,\r\n      quality: 0.85,\r\n      maxWidth: 400,\r\n      maxHeight: 400,\r\n    });\r\n    \r\n    return result.url;\r\n  }\r\n}\r\n\r\n/**\r\n * Quiz Cover Upload Service\r\n */\r\nexport class QuizCoverUploadService extends StorageService {\r\n  async uploadCover(quizId: string, file: File): Promise<UploadResult> {\r\n    const path = storagePaths.quizCover(quizId, 'jpg');\r\n    \r\n    return await this.uploadFile(file, path, {\r\n      compress: true,\r\n      quality: 0.85,\r\n      maxWidth: 1200,\r\n      maxHeight: 630,\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Learning Resource Upload Service\r\n */\r\nexport class ResourceUploadService extends StorageService {\r\n  async uploadVideo(\r\n    quizId: string,\r\n    resourceId: string,\r\n    file: File,\r\n    onProgress?: (progress: number) => void\r\n  ): Promise<UploadResult> {\r\n    const ext = storageValidation.getFileExtension(file.name);\r\n    const path = storagePaths.learningVideo(quizId, resourceId, ext.slice(1));\r\n    \r\n    return await this.uploadFile(file, path, {\r\n      onProgress,\r\n      compress: false, // Don't compress videos\r\n    });\r\n  }\r\n\r\n  async uploadPDF(\r\n    quizId: string,\r\n    resourceId: string,\r\n    file: File,\r\n    onProgress?: (progress: number) => void\r\n  ): Promise<UploadResult> {\r\n    const path = storagePaths.learningPDF(quizId, resourceId);\r\n    \r\n    return await this.uploadFile(file, path, {\r\n      onProgress,\r\n    });\r\n  }\r\n\r\n  async uploadImage(\r\n    quizId: string,\r\n    resourceId: string,\r\n    file: File,\r\n    onProgress?: (progress: number) => void\r\n  ): Promise<UploadResult> {\r\n    const ext = storageValidation.getFileExtension(file.name);\r\n    const path = storagePaths.learningImage(quizId, resourceId, ext.slice(1));\r\n    \r\n    return await this.uploadFile(file, path, {\r\n      onProgress,\r\n      compress: true,\r\n      quality: 0.85,\r\n    });\r\n  }\r\n\r\n  async uploadAudio(\r\n    quizId: string,\r\n    resourceId: string,\r\n    file: File,\r\n    onProgress?: (progress: number) => void\r\n  ): Promise<UploadResult> {\r\n    const ext = storageValidation.getFileExtension(file.name);\r\n    const path = storagePaths.learningAudio(quizId, resourceId, ext.slice(1));\r\n    \r\n    return await this.uploadFile(file, path, {\r\n      onProgress,\r\n    });\r\n  }\r\n}\r\n\r\n// ============= EXPORT INSTANCES =============\r\nexport const storageService = new StorageService();\r\nexport const avatarUploadService = new AvatarUploadService();\r\nexport const quizCoverUploadService = new QuizCoverUploadService();\r\nexport const resourceUploadService = new ResourceUploadService();\r\n\r\n// ============= CLEANUP UTILITIES =============\r\n\r\n/**\r\n * Delete quiz and all related files\r\n */\r\nexport async function deleteQuizFiles(quizId: string): Promise<void> {\r\n  const paths = [\r\n    storagePaths.quizCover(quizId),\r\n    // Add more paths as needed\r\n  ];\r\n  \r\n  await storageService.deleteFiles(paths);\r\n  \r\n  // Delete resource folders\r\n  const resourceFolders = [\r\n    `${quizId}`,\r\n  ];\r\n  \r\n  for (const folder of resourceFolders) {\r\n    try {\r\n      const files = await storageService.listFiles(`resources/videos/${folder}`);\r\n      await Promise.all(files.map(file => storageService.deleteFile(file.fullPath)));\r\n    } catch (error) {\r\n      console.warn('[Storage] No files found in folder:', folder);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up temporary files older than 24h\r\n */\r\nexport async function cleanupTempFiles(): Promise<void> {\r\n  try {\r\n    const files = await storageService.listFiles('temp');\r\n    const now = Date.now();\r\n    const maxAge = 24 * 60 * 60 * 1000; // 24 hours\r\n    \r\n    for (const fileRef of files) {\r\n      const metadata = await storageService.getMetadata(fileRef.fullPath);\r\n      const uploadTime = new Date(metadata.timeCreated).getTime();\r\n      \r\n      if (now - uploadTime > maxAge) {\r\n        await storageService.deleteFile(fileRef.fullPath);\r\n        console.log('[Storage] Deleted temp file:', fileRef.name);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('[Storage] Cleanup error:', error);\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\services\\geminiAI.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[567,570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[567,570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-constant-condition","severity":1,"message":"Unexpected constant condition.","line":35,"column":12,"nodeType":"Literal","messageId":"unexpected","endLine":35,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1666,1669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1666,1669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2777,2780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2777,2780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3728,3731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3728,3731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4374,4377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4374,4377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4656,4659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4656,4659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4894,4897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4894,4897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { GoogleGenerativeAI } from \"@google/generative-ai\";\r\n\r\n// API Key - s·ª≠ d·ª•ng environment variable n·∫øu c√≥, fallback v·ªÅ hardcoded\r\nconst API_KEY = import.meta.env.VITE_GEMINI_API_KEY || \"AIzaSyB7vFdW8BKswDq0TEjKvoLemzWCSk6b5Xg\";\r\n\r\nclass GeminiAIService {\r\n  private genAI: GoogleGenerativeAI;\r\n\r\n  constructor() {\r\n    this.genAI = new GoogleGenerativeAI(API_KEY);\r\n  }\r\n\r\n  private async sleep(ms: number) {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n\r\n  private isRetriableError(error: unknown): boolean {\r\n    const anyErr = error as any;\r\n    const status = anyErr?.status || anyErr?.statusCode || anyErr?.response?.status;\r\n    const code = String(status || '').toLowerCase();\r\n    const msg = (error instanceof Error ? error.message : String(error)).toLowerCase();\r\n    return (\r\n      code === '503' || code === '429' ||\r\n      msg.includes('503') ||\r\n      msg.includes('overloaded') ||\r\n      msg.includes('timeout') ||\r\n      msg.includes('429') ||\r\n      msg.includes('rate') ||\r\n      msg.includes('unavailable')\r\n    );\r\n  }\r\n\r\n  private async callWithRetry<T>(fn: () => Promise<T>, retries = 2, baseDelayMs = 800): Promise<T> {\r\n    let attempt = 0;\r\n    while (true) {\r\n      try {\r\n        return await fn();\r\n      } catch (e) {\r\n        if (attempt >= retries || !this.isRetriableError(e)) {\r\n          throw e;\r\n        }\r\n        const jitter = Math.floor(Math.random() * 200);\r\n        const delay = Math.min(8000, baseDelayMs * Math.pow(2, attempt)) + jitter;\r\n        await this.sleep(delay);\r\n        attempt++;\r\n      }\r\n    }\r\n  }\r\n\r\n  private async generateViaRest(modelName: string, prompt: string): Promise<any[]> {\r\n    const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${API_KEY}`;\r\n    const res = await fetch(url, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        contents: [{ parts: [{ text: prompt }] }],\r\n        generationConfig: { temperature: 0.7, maxOutputTokens: 2000 }\r\n      })\r\n    });\r\n    if (!res.ok) {\r\n      const text = await res.text().catch(() => '');\r\n      throw new Error(`Gemini REST ${res.status} ${res.statusText} ${text}`);\r\n    }\r\n    const data = await res.json();\r\n    const generatedText = data?.candidates?.[0]?.content?.parts?.[0]?.text || '';\r\n    const cleaned = (generatedText as string).replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\r\n    const jsonMatch = cleaned.match(/\\{[\\s\\S]*\\}/);\r\n    const clean = jsonMatch ? jsonMatch[0] : cleaned;\r\n    const parsed = JSON.parse(clean);\r\n    if (!parsed.questions || !Array.isArray(parsed.questions)) {\r\n      throw new Error('Invalid REST response structure');\r\n    }\r\n    return parsed.questions as any[];\r\n  }\r\n\r\n  async generateQuestions(topic: string, difficulty: string, numQuestions: number) {\r\n    try {\r\n      const prompt = `\r\nT·∫°o ${numQuestions} c√¢u h·ªèi tr·∫Øc nghi·ªám v·ªÅ ch·ªß ƒë·ªÅ \"${topic}\" v·ªõi ƒë·ªô kh√≥ ${difficulty}.\r\n\r\nY√™u c·∫ßu ƒë·ªãnh d·∫°ng JSON ch√≠nh x√°c:\r\n{\r\n  \"questions\": [\r\n    {\r\n      \"text\": \"C√¢u h·ªèi...\",\r\n      \"answers\": [\r\n        {\"text\": \"ƒê√°p √°n A\", \"isCorrect\": false},\r\n        {\"text\": \"ƒê√°p √°n B\", \"isCorrect\": true},\r\n        {\"text\": \"ƒê√°p √°n C\", \"isCorrect\": false},\r\n        {\"text\": \"ƒê√°p √°n D\", \"isCorrect\": false}\r\n      ]\r\n    }\r\n  ]\r\n}\r\n\r\nL∆∞u √Ω:\r\n- M·ªói c√¢u h·ªèi ph·∫£i c√≥ ƒë√∫ng 4 ƒë√°p √°n\r\n- Ch·ªâ c√≥ 1 ƒë√°p √°n ƒë√∫ng (isCorrect: true)\r\n- C√¢u h·ªèi ph·∫£i r√µ r√†ng, ch√≠nh x√°c\r\n- ƒê√°p √°n ph·∫£i h·ª£p l√Ω v√† ƒëa d·∫°ng\r\n- Tr·∫£ v·ªÅ CH√çNH X√ÅC ƒë·ªãnh d·∫°ng JSON, kh√¥ng th√™m text kh√°c\r\n`;\r\n\r\n      const models = [\r\n        'gemini-1.5-flash',\r\n        'gemini-1.5-flash-8b',\r\n        'gemini-1.5-pro',\r\n        'gemini-pro'\r\n      ];\r\n\r\n      let lastError: any = null;\r\n      for (const name of models) {\r\n        try {\r\n          const model = this.genAI.getGenerativeModel({ model: name });\r\n          const run = async () => {\r\n            const result = await model.generateContent(prompt);\r\n            const response = await result.response;\r\n            let text = response.text();\r\n            text = text.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\r\n            const data = JSON.parse(text);\r\n            if (!data.questions || !Array.isArray(data.questions)) {\r\n              throw new Error('Invalid response structure');\r\n            }\r\n            data.questions.forEach((q: any, index: number) => {\r\n              if (!q.text || !q.answers || !Array.isArray(q.answers) || q.answers.length !== 4) {\r\n                throw new Error(`Invalid question structure at index ${index}`);\r\n              }\r\n              const correctAnswers = q.answers.filter((a: any) => a.isCorrect);\r\n              if (correctAnswers.length !== 1) {\r\n                throw new Error(`Question ${index + 1} must have exactly 1 correct answer`);\r\n              }\r\n            });\r\n            return data.questions as any[];\r\n          };\r\n\r\n          const questions = await this.callWithRetry(run, 2, 800);\r\n          return {\r\n            success: true,\r\n            questions,\r\n            message: `ƒê√£ t·∫°o th√†nh c√¥ng ${questions.length} c√¢u h·ªèi`\r\n          };\r\n        } catch (err) {\r\n          lastError = err;\r\n          // Lu√¥n th·ª≠ model k·∫ø ti·∫øp khi l·ªói, ∆∞u ti√™n chuy·ªÉn model khi flash qu√° t·∫£i\r\n          continue;\r\n        }\r\n      }\r\n\r\n      // If SDK attempts failed, try REST fallback with a stable model\r\n      try {\r\n        const questions = await this.callWithRetry(() => this.generateViaRest('gemini-pro', prompt), 1, 1000);\r\n        return {\r\n          success: true,\r\n          questions,\r\n          message: `ƒê√£ t·∫°o th√†nh c√¥ng ${questions.length} c√¢u h·ªèi`\r\n        };\r\n      } catch (e) {\r\n        lastError = e;\r\n      }\r\n\r\n      throw lastError || new Error('Gemini unavailable');\r\n\r\n    } catch (error) {\r\n      console.error('Gemini AI Error:', error);\r\n      \r\n      if (error instanceof SyntaxError) {\r\n        return {\r\n          success: false,\r\n          error: 'L·ªói ƒë·ªãnh d·∫°ng JSON t·ª´ AI. Vui l√≤ng th·ª≠ l·∫°i.',\r\n          questions: []\r\n        };\r\n      }\r\n      \r\n      const msg = (error instanceof Error ? error.message : 'C√≥ l·ªói x·∫£y ra khi t·∫°o c√¢u h·ªèi');\r\n      const friendly = /503|overloaded|429|rate|unavailable/i.test(msg)\r\n        ? 'M√°y ch·ªß AI ƒëang qu√° t·∫£i ho·∫∑c t·∫°m th·ªùi kh√¥ng ph·∫£n h·ªìi. Vui l√≤ng th·ª≠ l·∫°i sau m·ªôt l√∫c.'\r\n        : msg;\r\n      return {\r\n        success: false,\r\n        error: friendly,\r\n        questions: []\r\n      };\r\n    }\r\n  }\r\n\r\n  async testConnection() {\r\n    try {\r\n      const model = this.genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\r\n      const result = await model.generateContent(\"Ch√†o b·∫°n! H√£y tr·∫£ l·ªùi ng·∫Øn g·ªçn b·∫±ng ti·∫øng Vi·ªát: AI ƒëang ho·∫°t ƒë·ªông t·ªët kh√¥ng?\");\r\n      const response = await result.response;\r\n      const text = response.text();\r\n      \r\n      return {\r\n        success: true,\r\n        message: \"K·∫øt n·ªëi AI th√†nh c√¥ng!\",\r\n        response: text\r\n      };\r\n    } catch (error) {\r\n      console.error('Test connection error:', error);\r\n      return {\r\n        success: false,\r\n        message: \"Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn AI\",\r\n        error: error instanceof Error ? error.message : 'Unknown error'\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\nexport const geminiAI = new GeminiAIService();\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\services\\imageUploadService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2802,2805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2802,2805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3439,3442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3439,3442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":252,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7759,7762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7759,7762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":261,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7968,7971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7968,7971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":394,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":394,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12077,12080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12077,12080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":406,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":406,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12308,12311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12308,12311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":495,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":495,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14916,14919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14916,14919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Image Upload Service v·ªõi t√≠ch h·ª£p Resize Images Extension\r\n * \r\n * Extension s·∫Ω t·ª± ƒë·ªông resize ·∫£nh khi upload v√†o Storage\r\n * - Original image: /images/original/{filename}\r\n * - Thumbnails: /thumbnails/{filename}_200x200, _400x400, _800x800\r\n */\r\n\r\nimport { getStorage, ref, uploadBytesResumable, getDownloadURL, deleteObject, UploadMetadata } from 'firebase/storage';\r\nimport { getAuth } from 'firebase/auth';\r\n\r\nconst storage = getStorage();\r\n\r\nexport interface ImageUploadOptions {\r\n  folder?: 'avatars' | 'quizzes' | 'covers' | 'temp';\r\n  maxSizeKB?: number;\r\n  allowedTypes?: string[];\r\n  generateThumbnails?: boolean;\r\n}\r\n\r\nexport interface ImageUploadResult {\r\n  success: boolean;\r\n  originalUrl?: string;\r\n  thumbnailUrls?: {\r\n    small?: string;    // 200x200\r\n    medium?: string;   // 400x400\r\n    large?: string;    // 800x800\r\n  };\r\n  fileName?: string;\r\n  filePath?: string;\r\n  error?: string;\r\n}\r\n\r\nexport interface UploadProgress {\r\n  progress: number;\r\n  bytesTransferred: number;\r\n  totalBytes: number;\r\n  state: 'running' | 'paused' | 'success' | 'error';\r\n}\r\n\r\n/**\r\n * Validate image file\r\n */\r\nconst validateImage = (\r\n  file: File,\r\n  maxSizeKB: number = 5120, // 5MB default\r\n  allowedTypes: string[] = ['image/jpeg', 'image/png', 'image/webp', 'image/gif']\r\n): { valid: boolean; error?: string } => {\r\n  // Check file type\r\n  if (!allowedTypes.includes(file.type)) {\r\n    return {\r\n      valid: false,\r\n      error: `Ch·ªâ ch·∫•p nh·∫≠n c√°c ƒë·ªãnh d·∫°ng: ${allowedTypes.map(t => t.split('/')[1]).join(', ')}`\r\n    };\r\n  }\r\n\r\n  // Check file size\r\n  const fileSizeKB = file.size / 1024;\r\n  if (fileSizeKB > maxSizeKB) {\r\n    return {\r\n      valid: false,\r\n      error: `K√≠ch th∆∞·ªõc file v∆∞·ª£t qu√° ${maxSizeKB}KB (${Math.round(fileSizeKB)}KB)`\r\n    };\r\n  }\r\n\r\n  return { valid: true };\r\n};\r\n\r\n/**\r\n * Generate unique filename with timestamp\r\n */\r\nconst generateFileName = (originalName: string, userId: string): string => {\r\n  const timestamp = Date.now();\r\n  const randomStr = Math.random().toString(36).substring(2, 8);\r\n  const extension = originalName.split('.').pop();\r\n  const cleanName = originalName.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 20);\r\n  \r\n  return `${cleanName}_${userId}_${timestamp}_${randomStr}.${extension}`;\r\n};\r\n\r\n/**\r\n * Get thumbnail URLs based on original filename\r\n * Extension t·ª± ƒë·ªông t·∫°o thumbnails v·ªõi format: {filename}_200x200.{ext}\r\n * Retry multiple times v√¨ extension c·∫ßn th·ªùi gian x·ª≠ l√Ω\r\n */\r\nconst getThumbnailUrls = async (\r\n  fileName: string\r\n): Promise<{ small?: string; medium?: string; large?: string }> => {\r\n  const thumbnailSizes = [\r\n    { key: 'small', size: '200x200', maxRetries: 8 },\r\n    { key: 'medium', size: '400x400', maxRetries: 8 },\r\n    { key: 'large', size: '800x800', maxRetries: 10 }\r\n  ];\r\n\r\n  const thumbnailUrls: any = {};\r\n  const nameWithoutExt = fileName.substring(0, fileName.lastIndexOf('.'));\r\n  const extension = fileName.split('.').pop();\r\n\r\n  // Function ƒë·ªÉ retry l·∫•y thumbnail URL\r\n  const getThumbnailWithRetry = async (\r\n    thumbnailPath: string,\r\n    maxRetries: number,\r\n    size: string\r\n  ): Promise<string | null> => {\r\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\r\n      try {\r\n        const thumbnailRef = ref(storage, thumbnailPath);\r\n        const url = await getDownloadURL(thumbnailRef);\r\n        console.log(`‚úÖ Thumbnail ${size} ready after ${attempt} attempts`);\r\n        return url;\r\n      } catch (error: any) {\r\n        if (attempt < maxRetries) {\r\n          // ƒê·ª£i l√¢u h∆°n cho m·ªói l·∫ßn retry (2s, 3s, 4s, ...)\r\n          const waitTime = 2000 + (attempt * 1000);\r\n          console.log(`‚è≥ Waiting for thumbnail ${size}... attempt ${attempt}/${maxRetries}`);\r\n          await new Promise(resolve => setTimeout(resolve, waitTime));\r\n        } else {\r\n          console.log(`‚ö†Ô∏è Thumbnail ${size} not available after ${maxRetries} attempts (Extension may still be processing)`);\r\n          return null;\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n\r\n  // L·∫•y t·∫•t c·∫£ thumbnails song song\r\n  const thumbnailPromises = thumbnailSizes.map(async ({ key, size, maxRetries }) => {\r\n    const thumbnailFileName = `${nameWithoutExt}_${size}.${extension}`;\r\n    const thumbnailPath = `thumbnails/${thumbnailFileName}`;\r\n    const url = await getThumbnailWithRetry(thumbnailPath, maxRetries, size);\r\n    return { key, url };\r\n  });\r\n\r\n  const results = await Promise.all(thumbnailPromises);\r\n  \r\n  // Map results to object\r\n  results.forEach(({ key, url }) => {\r\n    if (url) {\r\n      thumbnailUrls[key] = url;\r\n    }\r\n  });\r\n\r\n  return thumbnailUrls;\r\n};\r\n\r\n/**\r\n * Upload image to Firebase Storage v·ªõi Progress Callback\r\n */\r\nexport const uploadImage = async (\r\n  file: File,\r\n  options: ImageUploadOptions = {},\r\n  onProgress?: (progress: UploadProgress) => void\r\n): Promise<ImageUploadResult> => {\r\n  const auth = getAuth();\r\n  const currentUser = auth.currentUser;\r\n\r\n  if (!currentUser) {\r\n    return {\r\n      success: false,\r\n      error: 'B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ upload ·∫£nh'\r\n    };\r\n  }\r\n\r\n  const {\r\n    folder = 'temp',\r\n    maxSizeKB = 5120,\r\n    allowedTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'],\r\n    generateThumbnails = true\r\n  } = options;\r\n\r\n  // Validate image\r\n  const validation = validateImage(file, maxSizeKB, allowedTypes);\r\n  if (!validation.valid) {\r\n    return {\r\n      success: false,\r\n      error: validation.error\r\n    };\r\n  }\r\n\r\n  try {\r\n    // Generate unique filename\r\n    const fileName = generateFileName(file.name, currentUser.uid);\r\n    const filePath = `images/${folder}/${fileName}`;\r\n    const storageRef = ref(storage, filePath);\r\n\r\n    // Metadata cho image\r\n    const metadata: UploadMetadata = {\r\n      contentType: file.type,\r\n      customMetadata: {\r\n        uploadedBy: currentUser.uid,\r\n        uploadedAt: new Date().toISOString(),\r\n        originalName: file.name,\r\n        folder: folder\r\n      },\r\n      cacheControl: 'public, max-age=31536000' // Cache 1 nƒÉm\r\n    };\r\n\r\n    // Upload with progress tracking\r\n    const uploadTask = uploadBytesResumable(storageRef, file, metadata);\r\n\r\n    return new Promise((resolve, _reject) => {\r\n      uploadTask.on(\r\n        'state_changed',\r\n        (snapshot) => {\r\n          // Progress callback\r\n          if (onProgress) {\r\n            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\r\n            onProgress({\r\n              progress: Math.round(progress),\r\n              bytesTransferred: snapshot.bytesTransferred,\r\n              totalBytes: snapshot.totalBytes,\r\n              state: snapshot.state as 'running' | 'paused'\r\n            });\r\n          }\r\n        },\r\n        (error) => {\r\n          // Error handling\r\n          console.error('Upload error:', error);\r\n          resolve({\r\n            success: false,\r\n            error: 'L·ªói khi upload ·∫£nh: ' + error.message\r\n          });\r\n        },\r\n        async () => {\r\n          // Upload completed\r\n          try {\r\n            const originalUrl = await getDownloadURL(uploadTask.snapshot.ref);\r\n            \r\n            let thumbnailUrls = {};\r\n            \r\n            // ƒê·ª£i Extension t·∫°o thumbnails (n·∫øu enabled)\r\n            if (generateThumbnails) {\r\n              thumbnailUrls = await getThumbnailUrls(fileName);\r\n            }\r\n\r\n            resolve({\r\n              success: true,\r\n              originalUrl,\r\n              thumbnailUrls,\r\n              fileName,\r\n              filePath\r\n            });\r\n\r\n            if (onProgress) {\r\n              onProgress({\r\n                progress: 100,\r\n                bytesTransferred: uploadTask.snapshot.totalBytes,\r\n                totalBytes: uploadTask.snapshot.totalBytes,\r\n                state: 'success'\r\n              });\r\n            }\r\n          } catch (error: any) {\r\n            resolve({\r\n              success: false,\r\n              error: 'Kh√¥ng th·ªÉ l·∫•y URL download: ' + error.message\r\n            });\r\n          }\r\n        }\r\n      );\r\n    });\r\n  } catch (error: any) {\r\n    console.error('Upload image error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'C√≥ l·ªói x·∫£y ra: ' + error.message\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * üöÄ INSTANT UPLOAD - Upload ngay l·∫≠p t·ª©c (1-3s) kh√¥ng ƒë·ª£i compression\r\n * \r\n * Strategy:\r\n * 1. Upload file g·ªëc ngay l·∫≠p t·ª©c ‚Üí User th·∫•y k·∫øt qu·∫£ trong 1-3s\r\n * 2. Compress trong background ‚Üí Kh√¥ng block UI\r\n * 3. Thay th·∫ø b·∫±ng file compressed ‚Üí Ti·∫øt ki·ªám bandwidth sau\r\n * \r\n * Trade-off:\r\n * + Upload c·ª±c nhanh (1-3s)\r\n * + UX m∆∞·ª£t m√†\r\n * - Storage t·∫°m th·ªùi l·ªõn h∆°n (s·∫Ω ƒë∆∞·ª£c thay th·∫ø sau)\r\n */\r\nexport const instantUploadImage = async (\r\n  file: File,\r\n  options: ImageUploadOptions = {},\r\n  onProgress?: (progress: UploadProgress) => void\r\n): Promise<ImageUploadResult> => {\r\n  const auth = getAuth();\r\n  const currentUser = auth.currentUser;\r\n\r\n  if (!currentUser) {\r\n    return {\r\n      success: false,\r\n      error: 'B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ upload ·∫£nh'\r\n    };\r\n  }\r\n\r\n  try {\r\n    const {\r\n      folder = 'temp',\r\n      maxSizeKB = 5120,\r\n      allowedTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'],\r\n      generateThumbnails = true\r\n    } = options;\r\n\r\n    // Validate\r\n    const validation = validateImage(file, maxSizeKB, allowedTypes);\r\n    if (!validation.valid) {\r\n      return {\r\n        success: false,\r\n        error: validation.error\r\n      };\r\n    }\r\n\r\n    const fileName = generateFileName(file.name, currentUser.uid);\r\n    const filePath = `images/${folder}/${fileName}`;\r\n    const storageRef = ref(storage, filePath);\r\n\r\n    // Metadata\r\n    const metadata: UploadMetadata = {\r\n      contentType: file.type,\r\n      customMetadata: {\r\n        uploadedBy: currentUser.uid,\r\n        uploadedAt: new Date().toISOString(),\r\n        originalName: file.name,\r\n        instant: 'true' // ƒê√°nh d·∫•u ƒë√¢y l√† instant upload\r\n      }\r\n    };\r\n\r\n    console.log('‚ö° INSTANT UPLOAD START:', {\r\n      file: file.name,\r\n      size: `${Math.round(file.size / 1024)}KB`,\r\n      type: file.type\r\n    });\r\n\r\n    // üöÄ UPLOAD NGAY - Kh√¥ng ƒë·ª£i compression\r\n    const uploadTask = uploadBytesResumable(storageRef, file, metadata);\r\n\r\n    const uploadResult = await new Promise<ImageUploadResult>((resolve, _reject) => {\r\n      uploadTask.on(\r\n        'state_changed',\r\n        (snapshot) => {\r\n          if (onProgress) {\r\n            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\r\n            onProgress({\r\n              progress: Math.round(progress),\r\n              bytesTransferred: snapshot.bytesTransferred,\r\n              totalBytes: snapshot.totalBytes,\r\n              state: snapshot.state as 'running' | 'paused'\r\n            });\r\n          }\r\n        },\r\n        (error) => {\r\n          console.error('‚ùå Instant upload error:', error);\r\n          resolve({\r\n            success: false,\r\n            error: 'L·ªói upload: ' + error.message\r\n          });\r\n        },\r\n        async () => {\r\n          try {\r\n            const originalUrl = await getDownloadURL(uploadTask.snapshot.ref);\r\n            \r\n            console.log('‚úÖ INSTANT UPLOAD DONE:', {\r\n              time: '1-3s',\r\n              url: originalUrl.substring(0, 50) + '...'\r\n            });\r\n\r\n            // Return ngay - kh√¥ng ƒë·ª£i thumbnails\r\n            resolve({\r\n              success: true,\r\n              originalUrl,\r\n              fileName,\r\n              filePath,\r\n              thumbnailUrls: {} // S·∫Ω c√≥ sau 5-30s\r\n            });\r\n\r\n            // üîÑ Background: ƒê·ª£i thumbnails sau (kh√¥ng block)\r\n            if (generateThumbnails) {\r\n              setTimeout(async () => {\r\n                const thumbnails = await getThumbnailUrls(fileName);\r\n                console.log('üñºÔ∏è Thumbnails ready (background):', Object.keys(thumbnails));\r\n              }, 10000); // ƒê·ª£i 10s r·ªìi check\r\n            }\r\n\r\n            if (onProgress) {\r\n              onProgress({\r\n                progress: 100,\r\n                bytesTransferred: uploadTask.snapshot.totalBytes,\r\n                totalBytes: uploadTask.snapshot.totalBytes,\r\n                state: 'success'\r\n              });\r\n            }\r\n          } catch (error: any) {\r\n            resolve({\r\n              success: false,\r\n              error: 'Kh√¥ng l·∫•y ƒë∆∞·ª£c URL: ' + error.message\r\n            });\r\n          }\r\n        }\r\n      );\r\n    });\r\n\r\n    return uploadResult;\r\n\r\n  } catch (error: any) {\r\n    console.error('‚ùå Instant upload error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'C√≥ l·ªói x·∫£y ra: ' + error.message\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Upload avatar v·ªõi optimization cho profile pictures\r\n */\r\nexport const uploadAvatar = async (\r\n  file: File,\r\n  onProgress?: (progress: UploadProgress) => void\r\n): Promise<ImageUploadResult> => {\r\n  return uploadImage(file, {\r\n    folder: 'avatars',\r\n    maxSizeKB: 2048, // 2MB max for avatars\r\n    allowedTypes: ['image/jpeg', 'image/png', 'image/webp'],\r\n    generateThumbnails: true\r\n  }, onProgress);\r\n};\r\n\r\n/**\r\n * Upload quiz cover image\r\n */\r\nexport const uploadQuizCover = async (\r\n  file: File,\r\n  onProgress?: (progress: UploadProgress) => void\r\n): Promise<ImageUploadResult> => {\r\n  return uploadImage(file, {\r\n    folder: 'covers',\r\n    maxSizeKB: 3072, // 3MB max for covers\r\n    allowedTypes: ['image/jpeg', 'image/png', 'image/webp'],\r\n    generateThumbnails: true\r\n  }, onProgress);\r\n};\r\n\r\n/**\r\n * Upload quiz question image\r\n */\r\nexport const uploadQuizImage = async (\r\n  file: File,\r\n  onProgress?: (progress: UploadProgress) => void\r\n): Promise<ImageUploadResult> => {\r\n  return uploadImage(file, {\r\n    folder: 'quizzes',\r\n    maxSizeKB: 2048, // 2MB max for quiz images\r\n    allowedTypes: ['image/jpeg', 'image/png', 'image/webp', 'image/gif'],\r\n    generateThumbnails: true\r\n  }, onProgress);\r\n};\r\n\r\n/**\r\n * Delete image from Storage (c·∫£ original v√† thumbnails)\r\n */\r\nexport const deleteImage = async (filePath: string): Promise<{ success: boolean; error?: string }> => {\r\n  try {\r\n    const auth = getAuth();\r\n    if (!auth.currentUser) {\r\n      return { success: false, error: 'B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p' };\r\n    }\r\n\r\n    // Delete original image\r\n    const imageRef = ref(storage, filePath);\r\n    await deleteObject(imageRef);\r\n\r\n    // Try to delete thumbnails\r\n    const fileName = filePath.split('/').pop();\r\n    if (fileName) {\r\n      const nameWithoutExt = fileName.substring(0, fileName.lastIndexOf('.'));\r\n      const extension = fileName.split('.').pop();\r\n\r\n      const thumbnailSizes = ['200x200', '400x400', '800x800'];\r\n      \r\n      for (const size of thumbnailSizes) {\r\n        try {\r\n          const thumbnailPath = `thumbnails/${nameWithoutExt}_${size}.${extension}`;\r\n          const thumbnailRef = ref(storage, thumbnailPath);\r\n          await deleteObject(thumbnailRef);\r\n        } catch (error) {\r\n          // Thumbnail might not exist, ignore error\r\n          console.warn(`Thumbnail ${size} not found, skipping`);\r\n        }\r\n      }\r\n    }\r\n\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Delete image error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Kh√¥ng th·ªÉ x√≥a ·∫£nh: ' + error.message\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Get image URL t·ª´ Storage path\r\n */\r\nexport const getImageUrl = async (filePath: string): Promise<string | null> => {\r\n  try {\r\n    const imageRef = ref(storage, filePath);\r\n    return await getDownloadURL(imageRef);\r\n  } catch (error) {\r\n    console.error('Get image URL error:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Compress image si√™u nhanh v·ªõi WebP format\r\n * WebP nh·∫π h∆°n JPEG 25-35%, encode nhanh h∆°n, quality t·ªët h∆°n\r\n */\r\nexport const compressImage = async (\r\n  file: File,\r\n  maxWidth: number = 1920,\r\n  maxHeight: number = 1080,\r\n  quality: number = 0.85,\r\n  useWebP: boolean = true // WebP m·∫∑c ƒë·ªãnh cho t·ªëc ƒë·ªô\r\n): Promise<File> => {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    \r\n    reader.onload = (event) => {\r\n      const img = new Image();\r\n      img.src = event.target?.result as string;\r\n      \r\n      img.onload = () => {\r\n        const canvas = document.createElement('canvas');\r\n        let width = img.width;\r\n        let height = img.height;\r\n\r\n        // Calculate new dimensions\r\n        if (width > maxWidth || height > maxHeight) {\r\n          const ratio = Math.min(maxWidth / width, maxHeight / height);\r\n          width = Math.floor(width * ratio);\r\n          height = Math.floor(height * ratio);\r\n        }\r\n\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n\r\n        const ctx = canvas.getContext('2d', { alpha: false }); // Disable alpha for better performance\r\n        if (!ctx) {\r\n          reject(new Error('Cannot get canvas context'));\r\n          return;\r\n        }\r\n\r\n        // High quality rendering\r\n        ctx.imageSmoothingEnabled = true;\r\n        ctx.imageSmoothingQuality = 'high';\r\n        ctx.drawImage(img, 0, 0, width, height);\r\n\r\n        // Use WebP for faster compression (25-35% smaller)\r\n        const outputType = useWebP ? 'image/webp' : file.type;\r\n        const outputExtension = useWebP ? '.webp' : file.name.split('.').pop();\r\n        const outputName = file.name.replace(/\\.[^/.]+$/, `.${outputExtension}`);\r\n\r\n        canvas.toBlob(\r\n          (blob) => {\r\n            if (!blob) {\r\n              reject(new Error('Canvas to Blob failed'));\r\n              return;\r\n            }\r\n            \r\n            const compressedFile = new File([blob], outputName, {\r\n              type: outputType,\r\n              lastModified: Date.now()\r\n            });\r\n            \r\n            console.log(`üóúÔ∏è Compressed: ${Math.round(file.size/1024)}KB ‚Üí ${Math.round(compressedFile.size/1024)}KB (${Math.round((1 - compressedFile.size/file.size) * 100)}% reduction)`);\r\n            \r\n            resolve(compressedFile);\r\n          },\r\n          outputType,\r\n          quality\r\n        );\r\n      };\r\n\r\n      img.onerror = () => {\r\n        reject(new Error('Failed to load image'));\r\n      };\r\n    };\r\n\r\n    reader.onerror = () => {\r\n      reject(new Error('Failed to read file'));\r\n    };\r\n  });\r\n};\r\n\r\n/**\r\n * FAST UPLOAD: Compress + Upload ngay khi ch·ªçn file (kh√¥ng ƒë·ª£i user confirm)\r\n * D√πng cho tr·∫£i nghi·ªám instant upload\r\n */\r\nexport const fastUploadImage = async (\r\n  file: File,\r\n  options: ImageUploadOptions = {},\r\n  onProgress?: (progress: UploadProgress) => void\r\n): Promise<ImageUploadResult> => {\r\n  // Step 1: Compress si√™u nhanh v·ªõi WebP\r\n  console.time('‚ö° FastUpload - Compression');\r\n  const compressed = await compressImage(file, 1920, 1080, 0.8, true); // WebP, quality 0.8 for speed\r\n  console.timeEnd('‚ö° FastUpload - Compression');\r\n  \r\n  // Step 2: Upload ngay kh√¥ng ƒë·ª£i\r\n  console.time('‚ö° FastUpload - Upload');\r\n  const result = await uploadImage(compressed, options, onProgress);\r\n  console.timeEnd('‚ö° FastUpload - Upload');\r\n  \r\n  return result;\r\n};\r\n\r\n/**\r\n * BACKGROUND UPLOAD: Upload trong background, return promise ngay\r\n * User kh√¥ng c·∫ßn ƒë·ª£i, c√≥ th·ªÉ l√†m vi·ªác kh√°c\r\n */\r\nexport const backgroundUploadImage = (\r\n  file: File,\r\n  options: ImageUploadOptions = {},\r\n  onComplete?: (result: ImageUploadResult) => void\r\n): void => {\r\n  // Compress v√† upload trong background\r\n  (async () => {\r\n    try {\r\n      const compressed = await compressImage(file, 1920, 1080, 0.8, true);\r\n      const result = await uploadImage(compressed, options);\r\n      \r\n      if (onComplete) {\r\n        onComplete(result);\r\n      }\r\n    } catch (error) {\r\n      console.error('Background upload failed:', error);\r\n      if (onComplete) {\r\n        onComplete({\r\n          success: false,\r\n          error: 'Upload th·∫•t b·∫°i: ' + (error as Error).message\r\n        });\r\n      }\r\n    }\r\n  })();\r\n  \r\n  console.log('üì§ Background upload started...');\r\n};\r\n\r\nexport default {\r\n  uploadImage,\r\n  instantUploadImage, // üöÄ NEW: Upload ngay 1-3s\r\n  uploadAvatar,\r\n  uploadQuizCover,\r\n  uploadQuizImage,\r\n  deleteImage,\r\n  getImageUrl,\r\n  compressImage,\r\n  fastUploadImage,\r\n  backgroundUploadImage\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\services\\quizStatsService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\setupTests.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\AchievementSystem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\Footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\Header.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[770,773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[770,773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { RootState } from '../../lib/store';\r\nimport { ROUTES } from '../../config/routes';\r\nimport { signOut } from 'firebase/auth';\r\nimport { auth } from '../../lib/firebase/config';\r\nimport { logout } from '../../features/auth/store';\r\nimport { toast } from 'react-toastify';\r\nimport NotificationCenter from './NotificationCenter';\r\nimport LanguageSwitcher from './LanguageSwitcher';\r\nimport { User, LogOut, Settings, Crown, Zap, Home, BookOpen, Heart, Trophy, UserCircle, Plus, ChevronDown } from 'lucide-react';\r\n\r\ninterface HeaderProps {\r\n  user?: any;\r\n}\r\n\r\nconst Header: React.FC<HeaderProps> = () => {\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n  const user = useSelector((state: RootState) => state.auth.user);\r\n  const { t } = useTranslation();\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n  const [isUserMenuOpen, setIsUserMenuOpen] = useState(false);\r\n  const [scrolled, setScrolled] = useState(false);\r\n  const [prevScrollPos, setPrevScrollPos] = useState(0);\r\n  const [visible, setVisible] = useState(true);\r\n  const userMenuRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Handle scroll effect with hide/show\r\n  useEffect(() => {\r\n    const handleScroll = () => {\r\n      const currentScrollPos = window.scrollY;\r\n      \r\n      // Determine if navbar should be visible\r\n      const isVisible = prevScrollPos > currentScrollPos || currentScrollPos < 10;\r\n      \r\n      setVisible(isVisible);\r\n      setScrolled(currentScrollPos > 10);\r\n      setPrevScrollPos(currentScrollPos);\r\n    };\r\n    \r\n    window.addEventListener('scroll', handleScroll);\r\n    return () => window.removeEventListener('scroll', handleScroll);\r\n  }, [prevScrollPos]);\r\n\r\n  // Close menus when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (userMenuRef.current && !userMenuRef.current.contains(event.target as Node)) {\r\n        setIsUserMenuOpen(false);\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, []);\r\n\r\n  // Close mobile menu on resize\r\n  useEffect(() => {\r\n    const handleResize = () => {\r\n      if (window.innerWidth >= 1024) {\r\n        setIsMobileMenuOpen(false);\r\n      }\r\n    };\r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      await signOut(auth);\r\n      dispatch(logout());\r\n      toast.success('ƒêƒÉng xu·∫•t th√†nh c√¥ng!');\r\n      navigate('/login');\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n      toast.error('C√≥ l·ªói x·∫£y ra khi ƒëƒÉng xu·∫•t');\r\n    }\r\n  };\r\n\r\n  const navigationItems = [\r\n    { path: '/', label: t('nav.home'), icon: Home },\r\n    { path: '/quizzes', label: t('nav.quizzes'), icon: BookOpen },\r\n    { path: '/favorites', label: t('nav.favorites'), icon: Heart },\r\n    { path: '/leaderboard', label: t('nav.leaderboard'), icon: Trophy },\r\n  ];\r\n\r\n  if (user?.role === 'creator' || user?.role === 'admin') {\r\n    navigationItems.push({ path: ROUTES.CREATOR, label: t('nav.creator'), icon: Plus });\r\n  }\r\n\r\n  if (user?.role === 'admin') {\r\n    navigationItems.push({ path: '/admin', label: t('nav.admin'), icon: Settings });\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <header \r\n        className={`fixed top-0 left-0 right-0 z-50 transition-all duration-500 ${\r\n          visible ? 'translate-y-0' : '-translate-y-full'\r\n        } ${\r\n          scrolled \r\n            ? 'bg-white/95 backdrop-blur-xl shadow-lg border-b border-gray-200/50' \r\n            : 'bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 shadow-xl'\r\n        }`}\r\n      >\r\n        <div className=\"max-w-full mx-auto px-3 sm:px-4 lg:px-6 xl:px-8\">\r\n          <div className=\"flex justify-between items-center h-14 sm:h-16 lg:h-18\">\r\n            {/* Logo & Brand - Compact */}\r\n            <div \r\n              className=\"flex items-center space-x-2 cursor-pointer group z-50 flex-shrink-0\"\r\n              onClick={() => navigate('/')}\r\n            >\r\n              <div className={`w-9 h-9 sm:w-10 sm:h-10 rounded-xl flex items-center justify-center ring-2 shadow-md transition-all duration-500 ${\r\n                scrolled \r\n                  ? 'bg-gradient-to-br from-blue-500 to-purple-600 ring-blue-200 group-hover:ring-blue-300' \r\n                  : 'bg-white/20 backdrop-blur-md ring-white/40 group-hover:ring-white/60'\r\n              } group-hover:scale-110 group-hover:rotate-6`}>\r\n                <Zap className={`w-4 h-4 sm:w-5 sm:h-5 transition-colors duration-300 ${\r\n                  scrolled ? 'text-white' : 'text-white group-hover:text-yellow-200'\r\n                }`} />\r\n              </div>\r\n              <div className=\"group-hover:scale-105 transition-transform duration-300 hidden sm:block\">\r\n                <h1 className={`text-base sm:text-lg lg:text-xl font-bold transition-all duration-300 leading-tight ${\r\n                  scrolled \r\n                    ? 'bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent' \r\n                    : 'text-white'\r\n                }`}>\r\n                  {t('header.appName')}\r\n                </h1>\r\n                <p className={`text-xs hidden lg:block transition-colors duration-300 ${\r\n                  scrolled ? 'text-gray-600' : 'text-blue-100/90'\r\n                }`}>\r\n                  {t('landing.hero.title')} ‚ú®\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Desktop Navigation - Compact icons only on medium screens */}\r\n            {user && (\r\n              <nav className=\"hidden lg:flex items-center space-x-1 flex-1 justify-center max-w-3xl mx-4\">\r\n                {navigationItems.map((item) => {\r\n                  const Icon = item.icon;\r\n                  const isActive = window.location.pathname === item.path;\r\n                  return (\r\n                    <button\r\n                      key={item.path}\r\n                      onClick={() => navigate(item.path)}\r\n                      className={`flex items-center px-3 py-2 rounded-lg font-medium transition-all duration-300 hover:scale-105 ${\r\n                        scrolled\r\n                          ? isActive\r\n                            ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-md'\r\n                            : 'text-gray-700 hover:bg-gray-100'\r\n                          : isActive\r\n                            ? 'bg-white/30 text-white shadow-md ring-1 ring-white/30'\r\n                            : 'text-white/90 hover:text-white hover:bg-white/20'\r\n                      }`}\r\n                    >\r\n                      <Icon className=\"w-4 h-4\" />\r\n                      <span className=\"text-xs xl:text-sm ml-1.5 hidden xl:inline whitespace-nowrap\">{item.label}</span>\r\n                    </button>\r\n                  );\r\n                })}\r\n              </nav>\r\n            )}\r\n\r\n            {/* Right Section - Compact */}\r\n            <div className=\"flex items-center space-x-1.5 sm:space-x-2 z-50 flex-shrink-0\">\r\n              {/* Language Switcher - Compact */}\r\n              <div className=\"hidden sm:block\">\r\n                <LanguageSwitcher variant=\"header\" />\r\n              </div>\r\n\r\n              {/* Notification Center - Compact */}\r\n              {user && (\r\n                <div className=\"hidden sm:block\">\r\n                  <NotificationCenter />\r\n                </div>\r\n              )}\r\n\r\n              {/* User Menu - Compact */}\r\n              {user && (\r\n                <div className=\"relative z-[100]\" ref={userMenuRef}>\r\n                  <button\r\n                    onClick={() => setIsUserMenuOpen(!isUserMenuOpen)}\r\n                    className={`flex items-center space-x-2 rounded-xl px-2 sm:px-3 py-2 transition-all duration-300 shadow-md hover:scale-105 group ${\r\n                      scrolled\r\n                        ? 'bg-gray-100 hover:bg-gray-200 border border-gray-200'\r\n                        : 'bg-white/15 hover:bg-white/25 backdrop-blur-md border border-white/30'\r\n                    }`}\r\n                  >\r\n                    <div className={`w-8 h-8 rounded-full flex items-center justify-center ring-2 shadow-sm transition-all duration-300 ${\r\n                      scrolled\r\n                        ? 'bg-gradient-to-br from-blue-500 to-purple-600 ring-blue-200 group-hover:ring-blue-300'\r\n                        : 'bg-white/30 ring-white/40 group-hover:ring-white/60'\r\n                    }`}>\r\n                      <User className=\"w-4 h-4 text-white\" />\r\n                    </div>\r\n                    <div className=\"hidden lg:block text-left\">\r\n                      <p className={`text-sm font-semibold truncate max-w-24 xl:max-w-32 transition-colors leading-tight ${\r\n                        scrolled ? 'text-gray-900' : 'text-white'\r\n                      }`}>\r\n                        {user?.displayName || user?.email || 'User'}\r\n                      </p>\r\n                      {user?.role && (\r\n                        <p className={`text-xs flex items-center font-medium ${\r\n                          scrolled ? 'text-gray-600' : 'text-blue-100/90'\r\n                        }`}>\r\n                          {user.role === 'admin' && <Crown className=\"w-3 h-3 mr-1 text-yellow-500\" />}\r\n                          {user.role === 'admin' ? t('ui.admin') : \r\n                           user.role === 'creator' ? t('ui.creator') : t('ui.user')}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                    <ChevronDown className={`hidden lg:block w-3.5 h-3.5 transition-transform duration-300 ${\r\n                      isUserMenuOpen ? 'rotate-180' : ''\r\n                    } ${scrolled ? 'text-gray-600' : 'text-white/90'}`} />\r\n                  </button>\r\n\r\n                  {/* User Dropdown - Refined */}\r\n                  {isUserMenuOpen && (\r\n                    <div className=\"absolute right-0 mt-2 w-64 sm:w-72 bg-white rounded-xl shadow-2xl border border-gray-100 overflow-hidden z-[200] animate-in slide-in-from-top-2 duration-200\">\r\n                      {/* User Info Header */}\r\n                      <div className=\"bg-gradient-to-r from-blue-500 to-purple-600 px-4 py-3\">\r\n                        <div className=\"flex items-center space-x-3\">\r\n                          <div className=\"w-11 h-11 bg-white/20 backdrop-blur-md rounded-lg flex items-center justify-center ring-2 ring-white/50 shadow-md flex-shrink-0\">\r\n                            <User className=\"w-5 h-5 text-white\" />\r\n                          </div>\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <p className=\"font-bold text-white text-sm truncate\">{user?.displayName || user?.email}</p>\r\n                            <p className=\"text-xs text-blue-100 truncate\">{user?.email}</p>\r\n                          </div>\r\n                        </div>\r\n                        {user?.role && (\r\n                          <div className=\"mt-2\">\r\n                            <span className={`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold shadow-sm ${\r\n                              user.role === 'admin' ? 'bg-yellow-400 text-yellow-900' :\r\n                              user.role === 'creator' ? 'bg-green-400 text-green-900' :\r\n                              'bg-gray-400 text-gray-900'\r\n                            }`}>\r\n                              {user.role === 'admin' && <Crown className=\"w-3 h-3 mr-1\" />}\r\n                              {user.role === 'admin' ? t('ui.admin') : \r\n                               user.role === 'creator' ? t('ui.creator') : t('ui.user')}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n\r\n                      {/* Menu Items */}\r\n                      <div className=\"py-1\">\r\n                        <button\r\n                          onClick={() => {\r\n                            navigate('/profile');\r\n                            setIsUserMenuOpen(false);\r\n                          }}\r\n                          className=\"w-full flex items-center px-4 py-2.5 text-gray-700 hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-200 group\"\r\n                        >\r\n                          <UserCircle className=\"w-4 h-4 mr-2.5 text-blue-600 group-hover:scale-110 transition-transform\" />\r\n                          <span className=\"font-medium text-sm\">{t('profile.myProfile')}</span>\r\n                        </button>\r\n                        <button\r\n                          onClick={() => {\r\n                            handleLogout();\r\n                            setIsUserMenuOpen(false);\r\n                          }}\r\n                          className=\"w-full flex items-center px-4 py-2.5 text-red-600 hover:bg-red-50 transition-all duration-200 group\"\r\n                        >\r\n                          <LogOut className=\"w-4 h-4 mr-2.5 group-hover:scale-110 transition-transform\" />\r\n                          <span className=\"font-medium text-sm\">{t('auth.logout')}</span>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Mobile Menu Button - Compact */}\r\n              {user && (\r\n                <button\r\n                  onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\r\n                  className={`lg:hidden p-2 rounded-lg transition-all duration-300 hover:scale-110 ${\r\n                    scrolled\r\n                      ? 'bg-gray-100 hover:bg-gray-200 text-gray-700'\r\n                      : 'bg-white/10 backdrop-blur-md border border-white/20 text-white hover:bg-white/20'\r\n                  }`}\r\n                  aria-label=\"Toggle menu\"\r\n                >\r\n                  <div className=\"relative w-5 h-5\">\r\n                    <span className={`absolute left-0 w-5 h-0.5 rounded-full transition-all duration-300 ${\r\n                      scrolled ? 'bg-gray-700' : 'bg-white'\r\n                    } ${isMobileMenuOpen ? 'top-2.5 rotate-45' : 'top-1'}`} />\r\n                    <span className={`absolute left-0 top-2.5 w-5 h-0.5 rounded-full transition-all duration-300 ${\r\n                      scrolled ? 'bg-gray-700' : 'bg-white'\r\n                    } ${isMobileMenuOpen ? 'opacity-0' : 'opacity-100'}`} />\r\n                    <span className={`absolute left-0 w-5 h-0.5 rounded-full transition-all duration-300 ${\r\n                      scrolled ? 'bg-gray-700' : 'bg-white'\r\n                    } ${isMobileMenuOpen ? 'top-2.5 -rotate-45' : 'top-4'}`} />\r\n                  </div>\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Mobile Menu Overlay - Refined */}\r\n      {user && isMobileMenuOpen && (\r\n        <>\r\n          <div \r\n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] lg:hidden animate-in fade-in duration-200\"\r\n            onClick={() => setIsMobileMenuOpen(false)}\r\n          />\r\n          <div className=\"fixed top-14 sm:top-16 left-0 right-0 bg-white shadow-2xl z-[70] lg:hidden animate-in slide-in-from-top-4 duration-300 max-h-[calc(100vh-3.5rem)] sm:max-h-[calc(100vh-4rem)] overflow-y-auto\">\r\n            <nav className=\"py-3 px-3 space-y-1\">\r\n              {navigationItems.map((item) => {\r\n                const Icon = item.icon;\r\n                const isActive = window.location.pathname === item.path;\r\n                return (\r\n                  <button\r\n                    key={item.path}\r\n                    onClick={() => {\r\n                      navigate(item.path);\r\n                      setIsMobileMenuOpen(false);\r\n                    }}\r\n                    className={`w-full flex items-center px-4 py-3 rounded-lg font-medium transition-all duration-200 group ${\r\n                      isActive \r\n                        ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-md' \r\n                        : 'text-gray-700 hover:bg-gray-100'\r\n                    }`}\r\n                  >\r\n                    <Icon className=\"w-5 h-5 mr-3 group-hover:scale-110 transition-transform\" />\r\n                    <span className=\"text-sm\">{item.label}</span>\r\n                  </button>\r\n                );\r\n              })}\r\n              \r\n              {/* Mobile-only items */}\r\n              <div className=\"pt-3 border-t border-gray-200 space-y-2\">\r\n                <div className=\"sm:hidden px-2 py-2\">\r\n                  <LanguageSwitcher variant=\"header\" />\r\n                </div>\r\n                <div className=\"sm:hidden px-2 py-2\">\r\n                  <NotificationCenter />\r\n                </div>\r\n              </div>\r\n            </nav>\r\n          </div>\r\n        </>\r\n      )}\r\n\r\n      {/* Spacer to prevent content jump */}\r\n      <div className=\"h-14 sm:h-16 lg:h-18\" />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Header;\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\I18nProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\LanguageSwitcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\NotificationBanner.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[408,411],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[408,411],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { collection, getDocs, query, where, orderBy, limit } from 'firebase/firestore';\r\nimport { db } from '../../lib/firebase/config';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../../lib/store';\r\n\r\ninterface Notification {\r\n  id: string;\r\n  message: string;\r\n  type: 'info' | 'warning' | 'success' | 'error';\r\n  createdAt: any;\r\n  targetRole?: 'all' | 'user' | 'creator' | 'admin';\r\n  isActive: boolean;\r\n}\r\n\r\nconst NotificationBanner: React.FC = () => {\r\n  const [notification, setNotification] = useState<Notification | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n\r\n  // S·ª≠a l·∫°i useEffect ƒë·ªÉ x·ª≠ l√Ω l·ªói ƒë√∫ng c√°ch\r\n  useEffect(() => {\r\n    // H√†m n√†y ƒë∆∞·ª£c khai b√°o trong useEffect ƒë·ªÉ tr√°nh v·∫•n ƒë·ªÅ v·ªõi React Hooks\r\n    const loadActiveNotification = async () => {\r\n      if (!user) {\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        setLoading(true);\r\n        const notificationsRef = collection(db, 'system_notifications');\r\n        \r\n        const q = query(\r\n          notificationsRef,\r\n          where('isActive', '==', true),\r\n          orderBy('createdAt', 'desc'),\r\n          limit(1)\r\n        );\r\n\r\n        const snapshot = await getDocs(q);\r\n        if (snapshot.empty) {\r\n          setNotification(null);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        let activeNotification = null;\r\n        snapshot.forEach(doc => {\r\n          const data = doc.data() as Notification;\r\n          data.id = doc.id;\r\n          if (\r\n            data.targetRole === 'all' || \r\n            !data.targetRole || \r\n            data.targetRole === user.role\r\n          ) {\r\n            activeNotification = data;\r\n          }\r\n        });\r\n\r\n        setNotification(activeNotification);\r\n      } catch (err) {\r\n        console.error('Error loading notifications:', err);\r\n        setError('Error loading notifications');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadActiveNotification().catch(console.error);\r\n  }, [user]);\r\n\r\n  // Kh√¥ng hi·ªÉn th·ªã g√¨ n·∫øu ƒëang t·∫£i ho·∫∑c kh√¥ng c√≥ th√¥ng b√°o\r\n  if (loading || !notification) return null;\r\n\r\n  // N·∫øu c√≥ l·ªói, c√≥ th·ªÉ hi·ªÉn th·ªã m·ªôt th√¥ng b√°o l·ªói ho·∫∑c kh√¥ng hi·ªÉn th·ªã g√¨\r\n  if (error) {\r\n    console.error('NotificationBanner error:', error);\r\n    return null;\r\n  }\r\n\r\n  // X√°c ƒë·ªãnh m√†u s·∫Øc d·ª±a tr√™n lo·∫°i th√¥ng b√°o\r\n  const getBgColor = () => {\r\n    switch (notification.type) {\r\n      case 'info': return 'bg-blue-100 border-blue-500 text-blue-800';\r\n      case 'warning': return 'bg-yellow-100 border-yellow-500 text-yellow-800';\r\n      case 'success': return 'bg-green-100 border-green-500 text-green-800';\r\n      case 'error': return 'bg-red-100 border-red-500 text-red-800';\r\n      default: return 'bg-gray-100 border-gray-500 text-gray-800';\r\n    }\r\n  };\r\n\r\n  // Th√™m h√†m getButtonColor\r\n  const getButtonColor = () => {\r\n    switch (notification?.type) {\r\n      case 'info': return 'text-blue-800 hover:text-blue-600';\r\n      case 'warning': return 'text-yellow-800 hover:text-yellow-600';\r\n      case 'success': return 'text-green-800 hover:text-green-600';\r\n      case 'error': return 'text-red-800 hover:text-red-600';\r\n      default: return 'text-gray-800 hover:text-gray-600';\r\n    }\r\n  };\r\n\r\n  // S·ª≠a l·∫°i n√∫t ƒë√≥ng ƒë·ªÉ s·ª≠ d·ª•ng m√†u ch·ªØ ph√π h·ª£p\r\n  return (\r\n    <div className={`fixed top-0 left-0 right-0 z-50 p-4 border-l-4 ${getBgColor()} w-full shadow-md`}>\r\n      <div className=\"max-w-5xl mx-auto flex justify-between items-center\">\r\n        <p className=\"font-medium\">{notification.message}</p>\r\n        <button \r\n          onClick={() => setNotification(null)}\r\n          className={`ml-4 font-bold text-xl ${getButtonColor()} hover:scale-110 transition-transform`}\r\n          aria-label=\"ƒê√≥ng th√¥ng b√°o\"\r\n        >\r\n          &times;\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NotificationBanner;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\NotificationCenter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\PopularQuizzesRanking.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\QuickReviewSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\QuizReviewSystem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\RoleBasedRedirect.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ScrollToTop.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\SearchComponent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\layout\\Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\layout\\Loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\layout\\NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\layout\\Unauthorized.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\AudioPlayer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\ConfirmDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\ImageViewer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\Input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\LoadingSpinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\Modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\PDFViewer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\PasswordModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\QuizPasswordModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\RichTextEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\RichTextViewer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\SafeHTML.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\ShareLinkModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\YouTubePlayer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\components\\ui\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\pages\\Creator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\pages\\Dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\pages\\Home.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1589,1592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1589,1592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { RootState } from '../../lib/store';\r\nimport { ROUTES } from '../../config/routes';\r\nimport { fetchQuizzes } from '../../features/quiz/store';\r\nimport { Quiz } from '../../features/quiz/types';\r\nimport QuizCard from '../../features/quiz/components/QuizCard';\r\nimport Button from '../components/ui/Button';\r\nimport PopularQuizzesRanking from '../components/PopularQuizzesRanking';\r\nimport { collection, getDocs, query, where } from 'firebase/firestore';\r\nimport { db } from '../../lib/firebase/config';\r\n\r\nimport { useTranslation } from 'react-i18next';\r\n// **TH√äM M·ªöI**: Dashboard stats interface\r\ninterface DashboardStats {\r\n  totalQuizzes: number;\r\n  totalUsers: number;\r\n  completedQuizzes: number;\r\n  totalCreators: number;\r\n}\r\n\r\nconst Home: React.FC = () => {\r\n  const { t } = useTranslation();\r\n\r\n  const dispatch = useDispatch();\r\n  const { user } = useSelector((state: RootState) => state.auth);\r\n  const { quizzes, loading } = useSelector((state: RootState) => state.quiz);\r\n  \r\n  // **TH√äM M·ªöI**: Dashboard stats state v·ªõi d·ªØ li·ªáu th·∫≠t\r\n  const [stats, setStats] = useState<DashboardStats>({\r\n    totalQuizzes: 0,\r\n    totalUsers: 0,\r\n    completedQuizzes: 0,\r\n    totalCreators: 0\r\n  });\r\n\r\n  const [featuredQuizzes, setFeaturedQuizzes] = useState<Quiz[]>([]);\r\n  const [statsLoading, setStatsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (quizzes.length === 0) {\r\n      dispatch(fetchQuizzes({ user }) as any);\r\n    }\r\n    loadRealStats();\r\n  }, [dispatch, user, quizzes.length]);\r\n\r\n  const loadRealStats = async () => {\r\n    try {\r\n      setStatsLoading(true);\r\n      \r\n      // L·∫•y d·ªØ li·ªáu th·ª±c t·ª´ Firebase - CH·ªà QUIZ APPROVED\r\n      const [quizzesSnapshot, usersSnapshot] = await Promise.all([\r\n        getDocs(query(collection(db, 'quizzes'), where('status', '==', 'approved'))),\r\n        getDocs(collection(db, 'users'))\r\n      ]);\r\n      \r\n      // ƒê·∫øm ch·ªâ users ACTIVE (kh√¥ng b·ªã xo√° v√† isActive = true)\r\n      const users = usersSnapshot.docs.map(doc => doc.data());\r\n      const activeUsers = users.filter(user => \r\n        user.isActive !== false && \r\n        user.isDeleted !== true\r\n      );\r\n      \r\n      // ƒê·∫øm creators trong s·ªë users ACTIVE\r\n      const creators = activeUsers.filter(user => \r\n        user.role === 'creator' || user.role === 'admin'\r\n      );\r\n      \r\n      // Quiz ho√†n th√†nh t·∫°m th·ªùi = 0 v√¨ ch∆∞a c√≥ data v·ªÅ quiz results\r\n      const completedQuizzes = 0;\r\n      \r\n      setStats({\r\n        totalQuizzes: quizzesSnapshot.size,\r\n        totalUsers: activeUsers.length, // CH·ªà ƒê·∫æM USERS HO·∫†T ƒê·ªòNG\r\n        completedQuizzes: completedQuizzes,\r\n        totalCreators: creators.length // CH·ªà ƒê·∫æM CREATORS HO·∫†T ƒê·ªòNG\r\n      });\r\n      \r\n    } catch (error) {\r\n      console.error('Error loading real stats:', error);\r\n    } finally {\r\n      setStatsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (quizzes.length > 0) {\r\n      // **TH√äM M·ªöI**: Set featured quizzes (trending/popular)\r\n      const trending = quizzes\r\n        .filter(q => q.isPublic)\r\n        .sort((a, b) => (b.attempts || 0) - (a.attempts || 0))\r\n        .slice(0, 6);\r\n      setFeaturedQuizzes(trending);\r\n    }\r\n  }, [quizzes]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-96\">\r\n        {Array.from({length: 4}).map((_,i) => (\r\n          <div key={i} className=\"animate-pulse bg-white rounded-xl shadow-lg h-40 w-80 m-4\" />\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-8\">\r\n      {/* Hero Section */}\r\n      <div className=\"bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-800 rounded-3xl p-8 lg:p-12 text-white shadow-2xl relative overflow-hidden\">\r\n        {/* Background Pattern */}\r\n        <div className=\"absolute inset-0 bg-white/5 backdrop-blur-3xl\"></div>\r\n        <div className=\"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-32 translate-x-32\"></div>\r\n        <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-white/10 rounded-full translate-y-24 -translate-x-24\"></div>\r\n        \r\n        <div className=\"relative max-w-5xl\">\r\n          <div className=\"flex items-center mb-6\">\r\n            <div className=\"w-16 h-16 lg:w-20 lg:h-20 bg-white/20 backdrop-blur-sm rounded-3xl flex items-center justify-center ring-4 ring-white/30 shadow-2xl mr-6\">\r\n              <span className=\"text-3xl lg:text-4xl\">üéØ</span>\r\n            </div>\r\n            <div>\r\n              <h1 className=\"text-3xl lg:text-5xl font-bold mb-2 drop-shadow-lg\">\r\n                {t('home.hero.welcome', { name: user?.displayName?.split(' ')[0] || 'Quiz Master' })}\r\n              </h1>\r\n              <p className=\"text-blue-100 text-lg lg:text-xl\">\r\n                {t('home.hero.subtitle')}\r\n              </p>\r\n            </div>\r\n          </div>\r\n          \r\n          <p className=\"text-xl lg:text-2xl text-blue-100 mb-8 leading-relaxed\">\r\n            {t('home.hero.description')}\r\n          </p>\r\n          \r\n          <div className=\"flex flex-col sm:flex-row gap-4 lg:gap-6\">\r\n            <Link to=\"/quizzes\">\r\n              <Button className=\"w-full sm:w-auto bg-white text-blue-600 hover:bg-blue-50 font-bold px-8 py-4 text-lg rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105\">\r\n                <span className=\"mr-2\">üìö</span>{t(\"quizList.exploreQuizzes\")}\r\n              </Button>\r\n            </Link>\r\n            <Link to=\"/multiplayer\">\r\n              <Button className=\"w-full sm:w-auto bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600 font-bold px-8 py-4 text-lg rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105 ring-2 ring-white/50\">\r\n                <span className=\"mr-2\">üéÆ</span>{t('home.playMultiplayer')}\r\n              </Button>\r\n            </Link>\r\n            <Link to={ROUTES.CREATOR}>\r\n              <Button className=\"w-full sm:w-auto border-2 border-white text-white hover:bg-white hover:text-blue-600 font-bold px-8 py-4 text-lg rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105\">\r\n                <span className=\"mr-2\">‚ú®</span>{t(\"creator.createNewQuiz\")}\r\n              </Button>\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* **TH√äM M·ªöI**: Dashboard Stats */}\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n        <div className=\"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-6 border border-gray-100 group hover:border-blue-200\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-gray-600 text-sm font-medium mb-2\">{t(\"dashboard.totalQuizzes\")}</p>\r\n              <p className=\"text-3xl font-bold text-gray-900\">\r\n                {statsLoading ? '...' : stats.totalQuizzes}\r\n              </p>\r\n              <p className=\"text-xs text-green-600 font-medium mt-1\">{t('home.stats.realData')}</p>\r\n            </div>\r\n            <div className=\"bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-4 group-hover:scale-110 transition-transform duration-300 shadow-lg\">\r\n              <svg className=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-6 border border-gray-100 group hover:border-green-200\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-gray-600 text-sm font-medium mb-2\">{t(\"admin.tabs.users\")}</p>\r\n              <p className=\"text-3xl font-bold text-gray-900\">\r\n                {statsLoading ? '...' : stats.totalUsers}\r\n              </p>\r\n              <p className=\"text-xs text-green-600 font-medium mt-1\">{t('home.stats.registered')}</p>\r\n            </div>\r\n            <div className=\"bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-4 group-hover:scale-110 transition-transform duration-300 shadow-lg\">\r\n              <svg className=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\" />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-6 border border-gray-100 group hover:border-purple-200\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-gray-600 text-sm font-medium mb-2\">{t(\"dashboard.completedQuizzes\")}</p>\r\n              <p className=\"text-3xl font-bold text-gray-900\">\r\n                {statsLoading ? '...' : stats.completedQuizzes}\r\n              </p>\r\n              <p className=\"text-xs text-purple-600 font-medium mt-1\">{t('home.stats.pending')}</p>\r\n            </div>\r\n            <div className=\"bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-4 group-hover:scale-110 transition-transform duration-300 shadow-lg\">\r\n              <svg className=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-6 border border-gray-100 group hover:border-yellow-200\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-gray-600 text-sm font-medium mb-2\">{t(\"admin.quizManagement.table.creator\")}</p>\r\n              <p className=\"text-3xl font-bold text-gray-900\">\r\n                {statsLoading ? '...' : stats.totalCreators}\r\n              </p>\r\n              <p className=\"text-xs text-yellow-600 font-medium mt-1\">{t('home.stats.creatorsAndAdmins')}</p>\r\n            </div>\r\n            <div className=\"bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-2xl p-4 group-hover:scale-110 transition-transform duration-300 shadow-lg\">\r\n              <svg className=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\" />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* **TH√äM M·ªöI**: Featured/Trending Quizzes */}\r\n      {featuredQuizzes.length > 0 && (\r\n        <div className=\"bg-white rounded-3xl shadow-xl p-8 border border-gray-100\">\r\n          <div className=\"flex items-center justify-between mb-8\">\r\n            <div className=\"flex items-center\">\r\n              <div className=\"w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-2xl flex items-center justify-center mr-4 shadow-lg\">\r\n                <span className=\"text-2xl\">üî•</span>\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-2xl lg:text-3xl font-bold text-gray-900\">{t('home.trending.title')}</h2>\r\n                <p className=\"text-gray-600\">{t('home.trending.subtitle')}</p>\r\n              </div>\r\n            </div>\r\n            <Link \r\n              to=\"/quizzes\" \r\n              className=\"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 rounded-2xl font-semibold hover:from-orange-600 hover:to-red-600 transition-all duration-300 flex items-center shadow-lg hover:shadow-xl transform hover:scale-105\"\r\n            >\r\n              <span>{t('home.trending.viewAll')}</span>\r\n              <svg className=\"w-5 h-5 ml-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 7l5 5m0 0l-5 5m5-5H6\" />\r\n              </svg>\r\n            </Link>\r\n          </div>\r\n          \r\n          {featuredQuizzes.length > 0 ? (\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 lg:gap-8\">\r\n              {featuredQuizzes.map((quiz) => (\r\n                <div key={quiz.id} className=\"transform hover:scale-105 transition-all duration-300\">\r\n                  <QuizCard quiz={quiz} />\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-12\">\r\n              <div className=\"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                <span className=\"text-4xl\">üìù</span>\r\n              </div>\r\n              <h3 className=\"text-xl font-semibold text-gray-900 mb-3\">{t('home.trending.noQuizzes')}</h3>\r\n              <p className=\"text-gray-600 mb-6\">{t('home.trending.createFirst')}</p>\r\n              <Link to={ROUTES.CREATOR}>\r\n                <Button className=\"bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-2xl font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all duration-300\">\r\n                  {t('home.trending.createNow')}\r\n                </Button>\r\n              </Link>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* **TH√äM M·ªöI**: Quick Actions */}\r\n      <div className=\"bg-white rounded-3xl shadow-xl p-8 border border-gray-100\">\r\n        <div className=\"flex items-center mb-8\">\r\n          <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl flex items-center justify-center mr-4 shadow-lg\">\r\n            <span className=\"text-2xl\">‚ö°</span>\r\n          </div>\r\n          <div>\r\n            <h2 className=\"text-2xl lg:text-3xl font-bold text-gray-900\">{t('home.quickActions.title')}</h2>\r\n            <p className=\"text-gray-600\">{t('home.quickActions.subtitle')}</p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n          <Link \r\n            to={ROUTES.CREATOR}\r\n            className=\"group bg-gradient-to-br from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 rounded-2xl p-8 transition-all duration-300 transform hover:scale-105 hover:shadow-xl border border-blue-200\"\r\n          >\r\n            <div className=\"text-blue-600 mb-6 group-hover:scale-110 transition-transform duration-300\">\r\n              <svg className=\"w-14 h-14\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n              </svg>\r\n            </div>\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-3\">{t(\"creator.createNewQuiz\")}</h3>\r\n            <p className=\"text-gray-600 leading-relaxed\">{t('home.quickActions.createDescription')}</p>\r\n            <div className=\"mt-4 text-blue-600 font-semibold group-hover:translate-x-1 transition-transform duration-300 flex items-center\">\r\n              {t('home.quickActions.startCreating')} <span className=\"ml-2\">‚Üí</span>\r\n            </div>\r\n          </Link>\r\n          \r\n          <Link \r\n            to=\"/quizzes?filter=random\" \r\n            className=\"group bg-gradient-to-br from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 rounded-2xl p-8 transition-all duration-300 transform hover:scale-105 hover:shadow-xl border border-green-200\"\r\n          >\r\n            <div className=\"text-green-600 mb-6 group-hover:scale-110 transition-transform duration-300\">\r\n              <svg className=\"w-14 h-14\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\r\n              </svg>\r\n            </div>\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-3\">{t('home.quickActions.randomQuiz')}</h3>\r\n            <p className=\"text-gray-600 leading-relaxed\">{t('home.quickActions.randomDescription')}</p>\r\n            <div className=\"mt-4 text-green-600 font-semibold group-hover:translate-x-1 transition-transform duration-300 flex items-center\">\r\n              {t('home.quickActions.playNow')} <span className=\"ml-2\">‚Üí</span>\r\n            </div>\r\n          </Link>\r\n          \r\n          <Link \r\n            to=\"/profile\" \r\n            className=\"group bg-gradient-to-br from-purple-50 to-purple-100 hover:from-purple-100 hover:to-purple-200 rounded-2xl p-8 transition-all duration-300 transform hover:scale-105 hover:shadow-xl border border-purple-200\"\r\n          >\r\n            <div className=\"text-purple-600 mb-6 group-hover:scale-110 transition-transform duration-300\">\r\n              <svg className=\"w-14 h-14\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\r\n              </svg>\r\n            </div>\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-3\">{t('home.quickActions.viewProgress')}</h3>\r\n            <p className=\"text-gray-600 leading-relaxed\">{t('home.quickActions.progressDescription')}</p>\r\n            <div className=\"mt-4 text-purple-600 font-semibold group-hover:translate-x-1 transition-transform duration-300 flex items-center\">\r\n              {t(\"viewDetails\")} <span className=\"ml-2\">‚Üí</span>\r\n            </div>\r\n          </Link>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Popular Quizzes Section */}\r\n      <div className=\"bg-white rounded-3xl shadow-xl p-8 border border-gray-100\">\r\n        <div className=\"flex items-center mb-8\">\r\n          <div className=\"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-500 rounded-2xl flex items-center justify-center mr-4 shadow-lg\">\r\n            <span className=\"text-2xl\">üèÜ</span>\r\n          </div>\r\n          <div>\r\n            <h2 className=\"text-2xl lg:text-3xl font-bold text-gray-900\">{t('home.popular.title')}</h2>\r\n            <p className=\"text-gray-600\">{t('home.popular.subtitle')}</p>\r\n          </div>\r\n        </div>\r\n        <PopularQuizzesRanking />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\pages\\LandingPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\pages\\NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\pages\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\shared\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\tests\\testStorageUpload.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1738,1741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1738,1741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Test Firebase Storage Upload\r\n * Ch·∫°y script n√†y ƒë·ªÉ test upload PDF/Video/Audio\r\n */\r\n\r\nimport { storage } from '../lib/firebase/config';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\n\r\nasync function testStorageUpload() {\r\n  console.log('üß™ Testing Firebase Storage Upload...\\n');\r\n\r\n  try {\r\n    // Test 1: Create a test text file\r\n    console.log('üìù Test 1: Creating test file...');\r\n    const testContent = 'This is a test file for Firebase Storage';\r\n    const testBlob = new Blob([testContent], { type: 'text/plain' });\r\n    const testFile = new File([testBlob], 'test.txt', { type: 'text/plain' });\r\n\r\n    // Test 2: Upload to Storage\r\n    console.log('‚¨ÜÔ∏è Test 2: Uploading to learning-resources/pdfs/test/...');\r\n    const timestamp = Date.now();\r\n    const storagePath = `learning-resources/pdfs/test_${timestamp}/test.txt`;\r\n    const storageRef = ref(storage, storagePath);\r\n\r\n    const metadata = {\r\n      contentType: 'text/plain',\r\n      customMetadata: {\r\n        uploadedBy: 'test-script',\r\n        uploadedAt: new Date().toISOString()\r\n      }\r\n    };\r\n\r\n    await uploadBytes(storageRef, testFile, metadata);\r\n    console.log('‚úÖ Upload successful!');\r\n\r\n    // Test 3: Get download URL\r\n    console.log('üîó Test 3: Getting download URL...');\r\n    const downloadURL = await getDownloadURL(storageRef);\r\n    console.log('‚úÖ Download URL:', downloadURL);\r\n\r\n    console.log('\\n‚úÖ ALL TESTS PASSED!');\r\n    console.log('\\nüìä Summary:');\r\n    console.log('  ‚úì Firebase Storage initialized');\r\n    console.log('  ‚úì File upload working');\r\n    console.log('  ‚úì Download URL generation working');\r\n    console.log('  ‚úì Storage Rules allowing uploads');\r\n    \r\n    return true;\r\n  } catch (error: any) {\r\n    console.error('\\n‚ùå TEST FAILED:', error.message);\r\n    console.error('\\nüîç Error details:', error);\r\n    \r\n    if (error.code === 'storage/unauthorized') {\r\n      console.error('\\n‚ö†Ô∏è PERMISSION DENIED - Storage Rules ch∆∞a deploy ho·∫∑c ch∆∞a ƒë√∫ng!');\r\n      console.error('   Gi·∫£i ph√°p:');\r\n      console.error('   1. Ch·∫°y: firebase deploy --only storage');\r\n      console.error('   2. Ho·∫∑c deploy qua Firebase Console');\r\n      console.error('   3. ƒê·ª£i 30s cho rules c√≥ hi·ªáu l·ª±c');\r\n    }\r\n    \r\n    return false;\r\n  }\r\n}\r\n\r\n// Run test if this file is executed directly\r\nif (typeof window !== 'undefined') {\r\n  console.log('‚ö†Ô∏è Ch·∫°y test n√†y trong browser console:');\r\n  console.log('import(\"./src/tests/testStorageUpload\").then(m => m.default())');\r\n}\r\n\r\nexport default testStorageUpload;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\utils\\htmlUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\utils\\initializeCategories.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Thuctap_WebQuiz\\QuizTrivia-App\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]